<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Kafkaå…¥é—¨åˆ°ç²¾é€š | é’å¢¨æŸ“çƒŸé›¨</title><meta name="author" content="Chen Jiabin,2948429338@qq.com"><meta name="copyright" content="Chen Jiabin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Kafkaå…¥é—¨åˆ°ç²¾é€š">
<meta property="og:type" content="article">
<meta property="og:title" content="Kafkaå…¥é—¨åˆ°ç²¾é€š">
<meta property="og:url" content="https://blog.chenjiabin.xyz/posts/14310/index.html">
<meta property="og:site_name" content="é’å¢¨æŸ“çƒŸé›¨">
<meta property="og:description" content="Kafkaå…¥é—¨åˆ°ç²¾é€š">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0325c825fa31fa6f45916f706a22cca4.png">
<meta property="article:published_time" content="2025-03-04T15:34:11.000Z">
<meta property="article:modified_time" content="2025-03-04T15:39:57.933Z">
<meta property="article:author" content="Chen Jiabin">
<meta property="article:tag" content="å…¥é—¨åˆ°ç²¾é€š">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0325c825fa31fa6f45916f706a22cca4.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Kafkaå…¥é—¨åˆ°ç²¾é€š",
  "url": "https://blog.chenjiabin.xyz/posts/14310/",
  "image": "https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0325c825fa31fa6f45916f706a22cca4.png",
  "datePublished": "2025-03-04T15:34:11.000Z",
  "dateModified": "2025-03-04T15:39:57.933Z",
  "author": [
    {
      "@type": "Person",
      "name": "Chen Jiabin",
      "url": "https://blog.chenjiabin.xyz/"
    }
  ]
}</script><link rel="shortcut icon" href="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/202503011641807.svg"><link rel="canonical" href="https://blog.chenjiabin.xyz/posts/14310/index.html"><link rel="preconnect" href="//cdnjs.cloudflare.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="4yH3_EEqHZ9_glXp2Ey1UlNzL_EQ2NQ0TO1lAXhBrvE"/><meta name="baidu-site-verification" content="codeva-dQzACO1Fjm"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdnjs.cloudflare.com/ajax/libs/egjs-infinitegrid/4.12.0/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Kafkaå…¥é—¨åˆ°ç²¾é€š',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (true) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/202503011603481.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">15</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> å›¾ç‰‡</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-solid fa-bars"></i><span> æ¨è</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fa-solid fa-headphones"></i><span> æ­Œæ›²</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa-solid fa-book"></i><span> ä¹¦ç±</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0325c825fa31fa6f45916f706a22cca4.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/202503011641807.svg" alt="Logo"><span class="site-name">é’å¢¨æŸ“çƒŸé›¨</span></a><a class="nav-page-title" href="/"><span class="site-name">Kafkaå…¥é—¨åˆ°ç²¾é€š</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> å›¾ç‰‡</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa-solid fa-bars"></i><span> æ¨è</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fa-solid fa-headphones"></i><span> æ­Œæ›²</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa-solid fa-book"></i><span> ä¹¦ç±</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Kafkaå…¥é—¨åˆ°ç²¾é€š</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-03-04T15:34:11.000Z" title="å‘è¡¨äº 2025-03-04 23:34:11">2025-03-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-03-04T15:39:57.933Z" title="æ›´æ–°äº 2025-03-04 23:39:57">2025-03-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Kafka/">Kafka</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">48k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>202åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/posts/14310/#post-comment"><span class="waline-comment-count" data-path="/posts/14310/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="â€”â€”â€“"><a href="#â€”â€”â€“" class="headerlink" title="â€”â€”â€“"></a>â€”â€”â€“</h1><h1 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h1><h1 id="â€”â€”â€“-1"><a href="#â€”â€”â€“-1" class="headerlink" title="â€”â€”â€“"></a>â€”â€”â€“</h1><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p><a target="_blank" rel="noopener" href="https://kafka.apache.org/">Kafka</a> æ˜¯åŸºäºå‘å¸ƒä¸è®¢é˜…çš„æ¶ˆæ¯ç³»ç»Ÿã€‚å®ƒæœ€åˆç”± LinkedIn å…¬å¸å¼€å‘ï¼Œä¹‹åæˆä¸º Apache é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>å› ä¸ºæœ‹å‹å·²ç»å†™äº†ä¸€ç¯‡å¾ˆä¸é”™çš„ Kafka å…¥é—¨æ–‡ç« ï¼Œæ‰€ä»¥è‰¿è‰¿å°±å¯ä»¥å…‰æ˜æ­£å¤§çš„å·æ‡’äº†ã€‚å¯¹ Kafka ä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥å…ˆé˜…è¯» <a target="_blank" rel="noopener" href="http://www.iocoder.cn/Kafka/yuliu/doc">ã€Šæ¶ˆæ¯é˜Ÿåˆ—ä¹‹ Kafkaã€‹</a> æ–‡ç« çš„ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Kafka/install/?self#">ã€Œ1. Kafka ç‰¹ç‚¹ã€</a> å’Œ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Kafka/install/?self#">ã€Œ2. Kafka ä¸­çš„åŸºæœ¬æ¦‚å¿µã€</a> ä¸¤ä¸ªå°èŠ‚ã€‚ğŸ˜œ</p>
<h1 id="2-å•æœºéƒ¨ç½²"><a href="#2-å•æœºéƒ¨ç½²" class="headerlink" title="2. å•æœºéƒ¨ç½²"></a>2. å•æœºéƒ¨ç½²</h1><blockquote>
<p>æ“ä½œç³»ç»Ÿï¼šmacOS 10.14</p>
<p>å…¶å®ƒç³»ç»Ÿï¼ŒåŸºæœ¬ä¸€è‡´çš„ã€‚</p>
</blockquote>
<p>Kafka ä¾èµ– ZooKeeper æœåŠ¡ï¼Œæ‰€ä»¥èƒ–å‹å…ˆè‡ªè¡Œå®‰è£…å¹¶å¯åŠ¨ä¸€ä¸ª ZooKeeper æœåŠ¡ã€‚ä¸ä¼šçš„èƒ–å‹ï¼Œå¯ä»¥å‚è€ƒé˜…è¯»ä¸‹ <a target="_blank" rel="noopener" href="http://www.iocoder.cn/ZooKeeper/install/?self">ã€ŠZooKeeper æç®€å…¥é—¨ã€‹</a> æ–‡ç« çš„ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Kafka/install/?self#">ã€Œ2. å•æœºéƒ¨ç½²ã€</a> å°èŠ‚ã€‚è¿™é‡Œï¼Œè‰¿è‰¿åœ¨æœ¬æœº <code>127.0.0.1:2181</code> å¯åŠ¨äº†ä¸€ä¸ª ZooKeeper å•èŠ‚ç‚¹ã€‚</p>
<h2 id="2-1-ä¸‹è½½è½¯ä»¶åŒ…"><a href="#2-1-ä¸‹è½½è½¯ä»¶åŒ…" class="headerlink" title="2.1 ä¸‹è½½è½¯ä»¶åŒ…"></a>2.1 ä¸‹è½½è½¯ä»¶åŒ…</h2><p>æ‰“å¼€ <a target="_blank" rel="noopener" href="http://kafka.apache.org/downloads">Kafka Download</a> é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Kafka æ‰€æœ‰çš„å‘å¸ƒç‰ˆæœ¬ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©æœ€æ–°çš„ <a href="hhttp://kafka.apache.org/downloads#2.3.1">Kafka 2.3.1</a> ç‰ˆæœ¬ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ç§å‘å¸ƒç‰ˆæœ¬ï¼š</p>
<ul>
<li>Source: <a target="_blank" rel="noopener" href="https://www.apache.org/dyn/closer.cgi?path=/kafka/2.3.1/kafka-2.3.1-src.tgz">kafka-2.3.1-src.tgz</a></li>
<li>Binary: <a target="_blank" rel="noopener" href="https://www.apache.org/dyn/closer.cgi?path=/kafka/2.3.1/kafka_2.12-2.3.1.tgz">kafka_2.12-2.3.1.tgz</a></li>
</ul>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ Binary ç‰ˆæœ¬ï¼Œå®ƒæ˜¯ Kafka å·²ç»ç¼–è¯‘å¥½ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨çš„ Kafka è½¯ä»¶åŒ…ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹ä¸‹è½½ Kafka Binary è½¯ä»¶åŒ…ã€‚å‘½ä»¤è¡Œæ“ä½œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºç›®å½•</span><br><span class="line">$ mkdir -p /Users/yunai/Kafka</span><br><span class="line">$ cd /Users/yunai/Kafka</span><br><span class="line"></span><br><span class="line"># ä¸‹è½½</span><br><span class="line">$ wget http://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.3.1/kafka_2.12-2.3.1.tgz</span><br><span class="line"></span><br><span class="line"># è§£å‹</span><br><span class="line">$ unzip kafka_2.12-2.3.1.tgz</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹ Kafka è½¯ä»¶åŒ…çš„ç›®å½•</span><br><span class="line">$ kafka_2.12-2.3.1</span><br><span class="line">$ ls -ls</span><br><span class="line">total 72</span><br><span class="line">64 -rw-r--r--   1 yunai  staff  32216 Oct 18 08:10 LICENSE</span><br><span class="line"> 8 -rw-r--r--   1 yunai  staff    337 Oct 18 08:10 NOTICE</span><br><span class="line"> 0 drwxr-xr-x  33 yunai  staff   1056 Oct 18 08:12 bin # æ‰§è¡Œè„šæœ¬</span><br><span class="line"> 0 drwxr-xr-x  16 yunai  staff    512 Oct 18 08:12 config # é…ç½®æ–‡ä»¶</span><br><span class="line"> 0 drwxr-xr-x  94 yunai  staff   3008 Oct 18 08:12 libs # Kafka jar åŒ…</span><br><span class="line"> 0 drwxr-xr-x   9 yunai  staff    288 Dec  5 14:50 logs # æ—¥å¿—æ–‡ä»¶</span><br><span class="line"> 0 drwxr-xr-x   3 yunai  staff     96 Oct 18 08:12 site-docs # æ–‡æ¡£</span><br></pre></td></tr></table></figure>



<h2 id="2-2-é…ç½®æ–‡ä»¶"><a href="#2-2-é…ç½®æ–‡ä»¶" class="headerlink" title="2.2 é…ç½®æ–‡ä»¶"></a>2.2 é…ç½®æ–‡ä»¶</h2><p>åœ¨ <code>config</code> ç›®å½•ä¸‹ï¼Œæä¾›äº† Kafka å„ä¸ªç»„ä»¶çš„é…ç½®æ–‡ä»¶ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ ls -ls config</span><br><span class="line">total 136</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff   906 Oct 18 08:10 connect-console-sink.properties</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff   909 Oct 18 08:10 connect-console-source.properties</span><br><span class="line">16 -rw-r--r--  1 yunai  staff  5321 Oct 18 08:10 connect-distributed.properties</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff   883 Oct 18 08:10 connect-file-sink.properties</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff   881 Oct 18 08:10 connect-file-source.properties</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff  1552 Oct 18 08:10 connect-log4j.properties</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff  2262 Oct 18 08:10 connect-standalone.properties</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff  1221 Oct 18 08:10 consumer.properties</span><br><span class="line">16 -rw-r--r--  1 yunai  staff  4727 Oct 18 08:10 log4j.properties</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff  1925 Oct 18 08:10 producer.properties</span><br><span class="line">16 -rw-r--r--  1 yunai  staff  6851 Oct 18 08:10 server.properties</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff  1032 Oct 18 08:10 tools-log4j.properties</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff  1169 Oct 18 08:10 trogdor.conf</span><br><span class="line"> 8 -rw-r--r--  1 yunai  staff  1023 Oct 18 08:10 zookeeper.properties</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª <code>data</code> ç›®å½•ï¼Œç„¶åç¼–è¾‘ <code>conf/server.properties</code> é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æ•°æ®ç›®å½•ä¸ºæ–°åˆ›å»ºçš„ <code>data</code> ç›®å½•ï¼Œå³ <code>log.dirs=/Users/yunai/Kafka/kafka_2.12-2.3.1/data</code> ã€‚</p>
<p>ğŸ˜ˆ å½“ç„¶ï¼Œå› ä¸ºå•æœºéƒ¨ç½²æ˜¯å­¦ä¹ æˆ–è€…æµ‹è¯•ä¹‹ç”¨ï¼Œæ‰€ä»¥ä¸æ”¹ä¹Ÿé—®é¢˜ä¸å¤§ã€‚</p>
<h2 id="2-3-å¯åŠ¨-Kafka"><a href="#2-3-å¯åŠ¨-Kafka" class="headerlink" title="2.3 å¯åŠ¨ Kafka"></a>2.3 å¯åŠ¨ Kafka</h2><p>å¯åŠ¨ä¸€ä¸ª Kafka Broker æœåŠ¡ã€‚å‘½ä»¤è¡Œæ“ä½œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nohup bin/kafka-server-start.sh config/server.properties &amp;</span><br></pre></td></tr></table></figure>



<p>å¯åŠ¨å®Œæˆåï¼ŒæŸ¥çœ‹æ—¥å¿—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹ Kafka Broker æ—¥å¿—ã€‚</span><br><span class="line">$ tail -f logs/server.log</span><br><span class="line"></span><br><span class="line">[2019-12-07 19:34:27,983] INFO Kafka version: 2.3.1 (org.apache.kafka.common.utils.AppInfoParser)</span><br><span class="line">[2019-12-07 19:34:27,983] INFO Kafka commitId: 18a913733fb71c01 (org.apache.kafka.common.utils.AppInfoParser)</span><br><span class="line">[2019-12-07 19:34:27,983] INFO Kafka startTimeMs: 1575545667980 (org.apache.kafka.common.utils.AppInfoParser)</span><br><span class="line">[2019-12-07 19:34:27,985] INFO [KafkaServer id=0] started (kafka.server.KafkaServer)</span><br></pre></td></tr></table></figure>



<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒKafka Broker æ—¥å¿—æ–‡ä»¶æ‰€åœ¨åœ°å€ä¸º <code>logs/server.log</code> ã€‚å¦‚æœæƒ³è¦è‡ªå®šä¹‰ï¼Œå¯ä»¥é€šè¿‡ <code>config/log4j.properties</code> é…ç½®æ–‡ä»¶æ¥è¿›è¡Œä¿®æ”¹ã€‚</li>
</ul>
<p>ğŸ˜ˆ è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº† Kafka å•æœºéƒ¨ç½²ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹è¿›è¡Œä¸‹æ¶ˆæ¯çš„å‘é€å’Œæ¶ˆè´¹çš„æµ‹è¯•ã€‚</p>
<h2 id="2-4-åˆ›å»º-Topic"><a href="#2-4-åˆ›å»º-Topic" class="headerlink" title="2.4 åˆ›å»º Topic"></a>2.4 åˆ›å»º Topic</h2><p>åœ¨å‘é€å’Œæ¶ˆè´¹æ¶ˆæ¯ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ›å»º Topic ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>bin/kafka-topics.sh</code> è„šæœ¬ï¼Œæ¥è¿›è¡Œ Kafka Topic çš„ç®¡ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºåå­—ä¸º TestTopic çš„ Topic ã€‚ </span><br><span class="line"># @param replication-factor å‚æ•°ï¼šTopic å‰¯æœ¬æ•°</span><br><span class="line"># @param partitions å‚æ•°ï¼šTopic åˆ†åŒºæ•°</span><br><span class="line"># å…³äºä¸¤ä¸ªå‚æ•°çš„è¯¦ç»†è§£é‡Šï¼Œå¯ä»¥çœ‹çœ‹ https://www.cnblogs.com/liuys635/p/10806665.html</span><br><span class="line">$ bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic TestTopic</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢ Topic åˆ—è¡¨</span><br><span class="line">$ bin/kafka-topics.sh --list --zookeeper 127.0.0.1:2181</span><br><span class="line">TestTopic</span><br></pre></td></tr></table></figure>



<h2 id="2-5-æµ‹è¯•å‘é€æ¶ˆæ¯"><a href="#2-5-æµ‹è¯•å‘é€æ¶ˆæ¯" class="headerlink" title="2.5 æµ‹è¯•å‘é€æ¶ˆæ¯"></a>2.5 æµ‹è¯•å‘é€æ¶ˆæ¯</h2><p>é€šè¿‡ä½¿ç”¨ <code>bin/kafka-console-producer.sh</code> è„šæœ¬ï¼Œå®ç°æµ‹è¯•å‘é€æ¶ˆæ¯ã€‚å‘½ä»¤è¡Œæ“ä½œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œ kafka-console-producer.sh è„šæœ¬ï¼Œè¿›å…¥ä½¿ç”¨å‘½ä»¤è¡Œå‘é€æ¶ˆæ¯çš„æ¨¡å¼ã€‚</span><br><span class="line">$ bin/kafka-console-producer.sh --broker-list 127.0.0.1:9092 --topic TestTopic</span><br><span class="line"></span><br><span class="line"># æ¯è¾“å…¥ä¸€è¡Œï¼Œæ•²å›è½¦ï¼Œéƒ½ä¼šå‘é€ä¸€æ¡æ¶ˆæ¯</span><br><span class="line">&gt; yudaoyuanma</span><br><span class="line">&gt; nicai</span><br><span class="line">&gt; hahaha</span><br></pre></td></tr></table></figure>



<p>å®Œæˆå‘é€ä¸‰æ¡æµ‹è¯•æ¶ˆæ¯åï¼Œæˆ‘ä»¬ä½¿ç”¨ã€Œcommand + Cã€ç»ˆæ­¢å½“å‰è„šæœ¬ï¼Œé€€å‡ºã€‚</p>
<h2 id="2-6-æµ‹è¯•æ¶ˆè´¹æ¶ˆæ¯"><a href="#2-6-æµ‹è¯•æ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="2.6 æµ‹è¯•æ¶ˆè´¹æ¶ˆæ¯"></a>2.6 æµ‹è¯•æ¶ˆè´¹æ¶ˆæ¯</h2><p>é€šè¿‡ä½¿ç”¨ <code>bin/kafka-console-consumer.sh</code> è„šæœ¬ï¼Œå®ç°æµ‹è¯•æ¶ˆè´¹æ¶ˆæ¯ã€‚å‘½ä»¤è¡Œæ“ä½œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œ kafka-console-consumer.sh è„šæœ¬ï¼Œè¿›å…¥ä½¿ç”¨å‘½ä»¤è¡Œæ¶ˆè´¹æ¶ˆæ¯</span><br><span class="line">$ bin/kafka-console-consumer.sh --bootstrap-server 127.0.0.1:9092 --topic TestTopic --from-beginning</span><br><span class="line"># æ‰§è¡Œåï¼Œçœ‹åˆ°åˆšå‘é€çš„ä¸‰æ¡æ¶ˆæ¯ï¼Œè¢«æˆåŠŸæ¶ˆè´¹ï¼Œå¹¶æ‰“å°åœ¨ç»ˆç«¯ä¸Šã€‚</span><br><span class="line">yudaoyuanma</span><br><span class="line">nicai</span><br><span class="line">hahaha</span><br></pre></td></tr></table></figure>



<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆå•æœºéƒ¨ç½²çš„ Kafka çš„æµ‹è¯•ï¼Œèˆ’æœ~</p>
<h1 id="3-é›†ç¾¤éƒ¨ç½²"><a href="#3-é›†ç¾¤éƒ¨ç½²" class="headerlink" title="3. é›†ç¾¤éƒ¨ç½²"></a>3. é›†ç¾¤éƒ¨ç½²</h1><p>å’³å’³å’³ï¼Œå·æ‡’ä¸‹ã€‚èƒ–å‹å¯ä»¥å…ˆçœ‹è‰¿è‰¿æœ‹å‹å†™çš„ <a target="_blank" rel="noopener" href="http://www.iocoder.cn/Kafka/yuliu/doc">ã€Šæ¶ˆæ¯é˜Ÿåˆ—ä¹‹ Kafkaã€‹</a> æ–‡ç« çš„ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Kafka/install/?self#">ã€Œ6. Kafka é›†ç¾¤é…ç½®ã€</a> å°èŠ‚ã€‚</p>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œå¿…é¡»æ­å»º Kafka é«˜å¯ç”¨é›†ç¾¤ï¼Œä¸ç„¶ç®€ç›´æ˜¯æ‰¾æ­»ã€‚</p>
<h1 id="4-Kafka-Manager"><a href="#4-Kafka-Manager" class="headerlink" title="4. Kafka Manager"></a>4. Kafka Manager</h1><p><a target="_blank" rel="noopener" href="https://github.com/yahoo/kafka-manager">Kafka Manager</a> æ˜¯ç”± Yahoo é›…è™å¼€æºçš„ Kafka ç®¡ç†å·¥å…·ã€‚å®ƒæ”¯æŒå¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<blockquote>
<p>æ‰“å¼€æœ‰é“è¯å…¸ï¼Œä¸€é¡¿ç¿»è¯‘ã€‚ä¸è¿‡ç›¸ä¿¡èƒ–å‹ï¼Œå¤§ä½“æ„æ€æ˜¯èƒ½çœ‹çš„æ‡‚çš„ã€‚</p>
</blockquote>
<ul>
<li>Manage multiple clusters</li>
<li>Easy inspection of cluster state (topics, consumers, offsets, brokers, replica distribution, partition distribution)</li>
<li>Run preferred replica election</li>
<li>Generate partition assignments with option to select brokers to use</li>
<li>Run reassignment of partition (based on generated assignments)</li>
<li>Create a topic with optional topic configs (0.8.1.1 has different configs than 0.8.2+)</li>
<li>Delete topic (only supported on 0.8.2+ and remember set delete.topic.enable&#x3D;true in broker config)</li>
<li>Topic list now indicates topics marked for deletion (only supported on 0.8.2+)</li>
<li>Batch generate partition assignments for multiple topics with option to select brokers to use</li>
<li>Batch run reassignment of partition for multiple topics</li>
<li>Add partitions to existing topic</li>
<li>Update config for existing topic</li>
<li>Optionally enable JMX polling for broker level and topic level metrics.</li>
<li>Optionally filter out consumers that do not have ids&#x2F; owners&#x2F; &amp; offsets&#x2F; directories in zookeeper.</li>
</ul>
<p>ä¸‹é¢ï¼Œè®©æˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ª Kafka Manager ã€‚</p>
<h2 id="4-1-ä¸‹è½½è½¯ä»¶åŒ…"><a href="#4-1-ä¸‹è½½è½¯ä»¶åŒ…" class="headerlink" title="4.1 ä¸‹è½½è½¯ä»¶åŒ…"></a>4.1 ä¸‹è½½è½¯ä»¶åŒ…</h2><p>Kafka Manager åœ¨ <a target="_blank" rel="noopener" href="https://github.com/yahoo/kafka-manager/releases">Releases</a> ä¸­ï¼Œæš‚æ—¶åªæä¾›æºç  Source åŒ…ï¼Œæœªæä¾›ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ Binary åŒ…ã€‚</p>
<p>è€ƒè™‘åˆ° Kafka Manager éœ€è¦ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://www.scala-sbt.org/">sbt</a> è¿›è¡Œæ„é€ ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æš‚æ—¶ä¸è€ƒè™‘ç¼–è¯‘æºç çš„æ–¹å¼ã€‚è€Œæ˜¯ï¼Œä»çƒ­å¿ƒâ€œç½‘å‹â€æä¾›çš„<a target="_blank" rel="noopener" href="https://blog.wolfogre.com/posts/kafka-manager-download/">Kafka Manager å®‰è£…åŒ…ä¸‹è½½</a> ï¼Œç¾æ»‹æ»‹ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ Kafka Manager 2.0.0.2 ç‰ˆæœ¬ã€‚æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ ä¸‹è½½ã€‚å¯èƒ½å¾ˆæ…¢ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨è¿…é›·ä¸‹è½½ã€‚</span><br><span class="line">$ wget https://github.com/wolfogre/kafka-manager-docker/releases/download/2.0.0.2/kafka-manager-2.0.0.2.zip</span><br><span class="line"></span><br><span class="line">$ è§£å‹</span><br><span class="line">$ unzip kafka-manager-2.0.0.2.zip</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹ Kafka Manager è½¯ä»¶åŒ…çš„ç›®å½•</span><br><span class="line">$ cd kafka-manager-2.0.0.2</span><br><span class="line">$ ls -ls</span><br><span class="line">total 24</span><br><span class="line">24 -rw-r--r--@   1 yunai  staff  8686 Apr 11  2019 README.md</span><br><span class="line"> 0 drwxr-xr-x@  14 yunai  staff   448 Dec  5 23:17 bin #  æ‰§è¡Œè„šæœ¬</span><br><span class="line"> 0 drwxr-xr-x@   7 yunai  staff   224 Dec  5 23:17 conf # é…ç½®æ–‡ä»¶</span><br><span class="line"> 0 drwxr-xr-x@ 103 yunai  staff  3296 Dec  5 23:17 lib # Kafka Manager jar åŒ…</span><br><span class="line"> 0 drwxr-xr-x@   3 yunai  staff    96 Dec  5 23:17 share</span><br></pre></td></tr></table></figure>



<h2 id="4-2-é…ç½®æ–‡ä»¶"><a href="#4-2-é…ç½®æ–‡ä»¶" class="headerlink" title="4.2 é…ç½®æ–‡ä»¶"></a>4.2 é…ç½®æ–‡ä»¶</h2><p>ç¼–è¾‘ <code>conf/application.conf</code> é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®é¡¹ä¸º <code>kafka-manager.zkhosts=&quot;127.0.0.1:2181&quot;</code> ã€‚æ­¤å¤„ï¼Œå¡«å†™çš„æ˜¯èƒ–å‹çš„ ZooKeeper åœ°å€ã€‚å› ä¸ºè‰¿è‰¿æ˜¯æœ¬åœ°å¯çš„ ZooKeeper æœåŠ¡ï¼Œæ‰€ä»¥å¡«å†™äº† <code>&quot;127.0.0.1:2181&quot;</code> ã€‚</p>
<h2 id="4-3-å¯åŠ¨-Kafka-Manager"><a href="#4-3-å¯åŠ¨-Kafka-Manager" class="headerlink" title="4.3 å¯åŠ¨ Kafka Manager"></a>4.3 å¯åŠ¨ Kafka Manager</h2><p>å¯åŠ¨ä¸€ä¸ª Kafka Manager æœåŠ¡ã€‚å‘½ä»¤è¡Œæ“ä½œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nohup bin/kafka-manager &amp;</span><br></pre></td></tr></table></figure>



<p>å¯åŠ¨å®Œæˆåï¼ŒæŸ¥çœ‹æ—¥å¿—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹ Kafka Broker æ—¥å¿—ã€‚</span><br><span class="line">$ tail -f logs/application.log</span><br><span class="line"></span><br><span class="line">Application started (Prod)</span><br><span class="line"></span><br><span class="line">2019-12-07 23:32:17,845 - [INFO] - from play.core.server.AkkaHttpServer in main</span><br><span class="line">Listening for HTTP on /0:0:0:0:0:0:0:0:9000</span><br></pre></td></tr></table></figure>



<h2 id="4-4-æ·»åŠ -Kafka-é›†ç¾¤"><a href="#4-4-æ·»åŠ -Kafka-é›†ç¾¤" class="headerlink" title="4.4 æ·»åŠ  Kafka é›†ç¾¤"></a>4.4 æ·»åŠ  Kafka é›†ç¾¤</h2><p>ä½¿ç”¨æµè§ˆå™¨ï¼Œè®¿é—® <a target="_blank" rel="noopener" href="http://127.0.0.1:9000/">http://127.0.0.1:9000/</a> åœ°å€ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ° Kafka Manager çš„ç•Œé¢ã€‚å¦‚ä¸‹å›¾ï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Ff2878c5bde54b9f4d89f4b6c2d1887cd.jpeg" alt="Kafka Manager"></p>
<p>ç‚¹å‡»å¯¼èˆªæ çš„ã€ŒClusterã€æŒ‰é’®ï¼Œé€‰æ‹©ã€ŒAdd Clusterã€é€‰é¡¹ï¼Œè¿›å…¥ <a target="_blank" rel="noopener" href="http://127.0.0.1:9000/addCluster">http://127.0.0.1:9000/addCluster</a> åœ°å€ã€‚åœ¨è¯¥ç•Œé¢ï¼Œæˆ‘ä»¬é…ç½®æ–°å¢ Kafka é›†ç¾¤ã€‚å¦‚ä¸‹å›¾ï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Ffa85164b2464857418fc15ff5d41933a.jpeg" alt="Kafka Manager"></p>
<p>å¡«å†™å®Œæˆåï¼Œæ‹‰åˆ°è¡¨å•æœ€åº•éƒ¨ï¼Œç‚¹å‡»ã€ŒSaveã€æŒ‰é’®ï¼Œä¿å­˜ Kafka é›†ç¾¤ã€‚ä¿å­˜æˆåŠŸåï¼Œæˆ‘ä»¬é‡æ–°è®¿é—® <a target="_blank" rel="noopener" href="http://127.0.0.1:9000/">http://127.0.0.1:9000/</a> åœ°å€ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–°æ·»åŠ çš„ Kafka é›†ç¾¤ã€‚å¦‚ä¸‹å›¾ï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Ffc8e549c1646eee8abbb9eaab5350de5.jpeg" alt="Kafka Manager"></p>
<p>ç‚¹å‡»ã€Œtestã€Kafka é›†ç¾¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®¡ç†è¯¥ Kafka é›†ç¾¤ã€‚å¦‚ä¸‹å›¾ï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F71702acc8401cb0451649a4521e8a950.jpeg" alt="Kafka Manager"></p>
<p>å…·ä½“çš„åŠŸèƒ½ï¼Œèƒ–å‹å¯ä»¥è‡ªå·±å¤šå¤šä½“éªŒï¼Œè‰¿è‰¿å°±ä¸å•°å—¦èµ˜è¿°äº†ã€‚</p>
<h1 id="5-ç®€å•ç¤ºä¾‹"><a href="#5-ç®€å•ç¤ºä¾‹" class="headerlink" title="5. ç®€å•ç¤ºä¾‹"></a>5. ç®€å•ç¤ºä¾‹</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-native/">lab-03-kafka-native</a> ã€‚</p>
</blockquote>
<p>æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åœ¨ Java ä¸­ï¼Œå¦‚ä½•ä½¿ç”¨ç”Ÿäº§è€… Producer å‘é€æ¶ˆæ¯ï¼Œå’Œæ¶ˆè´¹è€… Consumer æ¶ˆè´¹æ¶ˆæ¯ã€‚</p>
<h2 id="5-1-å¼•å…¥ä¾èµ–"><a href="#5-1-å¼•å…¥ä¾èµ–" class="headerlink" title="5.1 å¼•å…¥ä¾èµ–"></a>5.1 å¼•å…¥ä¾èµ–</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-native/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;lab-03-kafka-native&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- å¼•å…¥ Kafka å®¢æˆ·ç«¯ä¾èµ– --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.3.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>



<p>å…·ä½“æ¯ä¸ªä¾èµ–çš„ä½œç”¨ï¼Œèƒ–å‹è‡ªå·±è®¤çœŸçœ‹ä¸‹è‰¿è‰¿æ·»åŠ çš„æ‰€æœ‰æ³¨é‡Šå™¢ã€‚</p>
<h2 id="5-2-ProducerMain"><a href="#5-2-ProducerMain" class="headerlink" title="5.2 ProducerMain"></a>5.2 ProducerMain</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-native/src/main/java/cn/iocoder/springboot/lab03/kafkademo/ProducerMain.java">ProducerMain</a> ç±»ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/apache/kafka/blob/master/clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java">KafkaProducer</a> å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// ProducerMain.java</span><br><span class="line"></span><br><span class="line">public class ProducerMain &#123;</span><br><span class="line"></span><br><span class="line">    private static Producer&lt;String, String&gt; createProducer() &#123;</span><br><span class="line">        // è®¾ç½® Producer çš„å±æ€§</span><br><span class="line">        Properties properties = new Properties();</span><br><span class="line">        properties.put(&quot;bootstrap.servers&quot;, &quot;127.0.0.1:9092&quot;); // è®¾ç½® Broker çš„åœ°å€</span><br><span class="line">        properties.put(&quot;acks&quot;, &quot;1&quot;); // 0-ä¸åº”ç­”ã€‚1-leader åº”ç­”ã€‚all-æ‰€æœ‰ leader å’Œ follower åº”ç­”ã€‚</span><br><span class="line">        properties.put(&quot;retries&quot;, 3); // å‘é€å¤±è´¥æ—¶ï¼Œé‡è¯•å‘é€çš„æ¬¡æ•°</span><br><span class="line">//        properties.put(&quot;batch.size&quot;, 16384);</span><br><span class="line">//        properties.put(&quot;linger.ms&quot;, 1);</span><br><span class="line">//        properties.put(&quot;client.id&quot;, &quot;DemoProducer&quot;);</span><br><span class="line">//        properties.put(&quot;buffer.memory&quot;, 33554432);</span><br><span class="line">        properties.put(&quot;key.serializer&quot;, StringSerializer.class.getName()); // æ¶ˆæ¯çš„ key çš„åºåˆ—åŒ–æ–¹å¼</span><br><span class="line">        properties.put(&quot;value.serializer&quot;, StringSerializer.class.getName()); // æ¶ˆæ¯çš„ value çš„åºåˆ—åŒ–æ–¹å¼</span><br><span class="line"></span><br><span class="line">        // åˆ›å»º KafkaProducer å¯¹è±¡</span><br><span class="line">        // å› ä¸ºæˆ‘ä»¬æ¶ˆæ¯çš„ key å’Œ value éƒ½ä½¿ç”¨ String ç±»å‹ï¼Œæ‰€ä»¥åˆ›å»ºçš„ Producer æ˜¯ &lt;String, String&gt; çš„æ³›å‹ã€‚</span><br><span class="line">        return new KafkaProducer&lt;&gt;(properties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws ExecutionException, InterruptedException &#123;</span><br><span class="line">        // åˆ›å»º KafkaProducer å¯¹è±¡</span><br><span class="line">        Producer&lt;String, String&gt; producer = createProducer();</span><br><span class="line"></span><br><span class="line">        // åˆ›å»ºæ¶ˆæ¯ã€‚ä¼ å…¥çš„ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ Topic ï¼Œæ¶ˆæ¯çš„ key ï¼Œæ¶ˆæ¯çš„ message ã€‚</span><br><span class="line">        ProducerRecord&lt;String, String&gt; message = new ProducerRecord&lt;&gt;(&quot;TestTopic&quot;, &quot;key&quot;, &quot;yudaoyuanma&quot;);</span><br><span class="line"></span><br><span class="line">        // åŒæ­¥å‘é€æ¶ˆæ¯</span><br><span class="line">        Future&lt;RecordMetadata&gt; sendResultFuture = producer.send(message);</span><br><span class="line">        RecordMetadata result = sendResultFuture.get();</span><br><span class="line">        System.out.println(&quot;message sent to &quot; + result.topic() + &quot;, partition &quot; + result.partition() + &quot;, offset &quot; + result.offset());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹æ ¹æ®è‰¿è‰¿æ·»åŠ çš„æ³¨é‡Šï¼Œç†è§£ä¸‹å“ˆã€‚</li>
</ul>
<p>æ‰§è¡Œ <code>#main(args)</code> æ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯åˆ° Kafka ã€‚æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message sent to TestTopic, partition 0, offset 8</span><br></pre></td></tr></table></figure>



<ul>
<li>å‘é€æ¶ˆæ¯æˆåŠŸã€‚</li>
</ul>
<h2 id="5-3-ConsumerMain"><a href="#5-3-ConsumerMain" class="headerlink" title="5.3 ConsumerMain"></a>5.3 ConsumerMain</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-native/src/main/java/cn/iocoder/springboot/lab03/kafkademo/ConsumerMain.java">ConsumerMain</a> ç±»ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/apache/kafka/blob/master/clients/src/main/java/org/apache/kafka/clients/consumer/KafkaConsumer.java">KafkaConsumer</a> æ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// ConsumerMain.java</span><br><span class="line"></span><br><span class="line">public class ConsumerMain &#123;</span><br><span class="line"></span><br><span class="line">    private static Consumer&lt;String, String&gt; createConsumer() &#123;</span><br><span class="line">        // è®¾ç½® Producer çš„å±æ€§</span><br><span class="line">        Properties properties = new Properties();</span><br><span class="line">        properties.put(&quot;bootstrap.servers&quot;, &quot;127.0.0.1:9092&quot;); // è®¾ç½® Broker çš„åœ°å€</span><br><span class="line">        properties.put(&quot;group.id&quot;, &quot;demo-consumer-group&quot;); // æ¶ˆè´¹è€…åˆ†ç»„</span><br><span class="line">        properties.put(&quot;auto.offset.reset&quot;, &quot;earliest&quot;); // è®¾ç½®æ¶ˆè´¹è€…åˆ†ç»„æœ€åˆçš„æ¶ˆè´¹è¿›åº¦ä¸º earliest ã€‚å¯å‚è€ƒåšå®¢ https://blog.csdn.net/lishuangzhe7047/article/details/74530417 ç†è§£</span><br><span class="line">        properties.put(&quot;enable.auto.commit&quot;, true); // æ˜¯å¦è‡ªåŠ¨æäº¤æ¶ˆè´¹è¿›åº¦</span><br><span class="line">        properties.put(&quot;auto.commit.interval.ms&quot;, &quot;1000&quot;); // è‡ªåŠ¨æäº¤æ¶ˆè´¹è¿›åº¦é¢‘ç‡</span><br><span class="line">        properties.put(&quot;key.deserializer&quot;, StringDeserializer.class.getName()); // æ¶ˆæ¯çš„ key çš„ååºåˆ—åŒ–æ–¹å¼</span><br><span class="line">        properties.put(&quot;value.deserializer&quot;, StringDeserializer.class.getName()); // æ¶ˆæ¯çš„ value çš„ååºåˆ—åŒ–æ–¹å¼</span><br><span class="line"></span><br><span class="line">        // åˆ›å»º KafkaProducer å¯¹è±¡</span><br><span class="line">        // å› ä¸ºæˆ‘ä»¬æ¶ˆæ¯çš„ key å’Œ value éƒ½ä½¿ç”¨ String ç±»å‹ï¼Œæ‰€ä»¥åˆ›å»ºçš„ Producer æ˜¯ &lt;String, String&gt; çš„æ³›å‹ã€‚</span><br><span class="line">        return new KafkaConsumer&lt;&gt;(properties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // åˆ›å»º KafkaConsumer å¯¹è±¡</span><br><span class="line">        Consumer&lt;String, String&gt; consumer = createConsumer();</span><br><span class="line"></span><br><span class="line">        // è®¢é˜…æ¶ˆæ¯</span><br><span class="line">        consumer.subscribe(Collections.singleton(&quot;TestTopic&quot;));</span><br><span class="line"></span><br><span class="line">        // æ‹‰å–æ¶ˆæ¯</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            // æ‹‰å–æ¶ˆæ¯ã€‚å¦‚æœæ‹‰å–ä¸åˆ°æ¶ˆæ¯ï¼Œé˜»å¡ç­‰å¾…æœ€å¤š 10 ç§’ï¼Œæˆ–è€…ç­‰å¾…æ‹‰å–åˆ°æ¶ˆæ¯ã€‚</span><br><span class="line">            ConsumerRecords records = consumer.poll(Duration.ofSeconds(10));</span><br><span class="line">            // éå†å¤„ç†æ¶ˆæ¯</span><br><span class="line">            records.forEach(new java.util.function.Consumer&lt;ConsumerRecord&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                public void accept(ConsumerRecord record) &#123;</span><br><span class="line">                    System.out.println(record.key() + &quot;\t&quot; + record.value());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹æ ¹æ®è‰¿è‰¿æ·»åŠ çš„æ³¨é‡Šï¼Œç†è§£ä¸‹å“ˆã€‚</li>
</ul>
<p>æ‰§è¡Œ <code>#main(args)</code> æ–¹æ³•ï¼Œä» Kafka æ¶ˆè´¹æ¶ˆæ¯ã€‚æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">null	123</span><br><span class="line">null	fsf</span><br><span class="line">null	123</span><br><span class="line">null	123</span><br><span class="line">null	nicai</span><br><span class="line">null	1232321</span><br><span class="line">null	3213231</span><br><span class="line">key	yudaoyuanma</span><br><span class="line">key	yudaoyuanma</span><br></pre></td></tr></table></figure>



<ul>
<li>ğŸ˜ˆ æœ‰ä¸€éƒ¨åˆ†æ¶ˆæ¯æ˜¯è‰¿è‰¿ä¹‹å‰åšæµ‹è¯•å‘çš„ï¼Œå¯ä»¥å¿½ç•¥å“ˆã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸæ¶ˆè´¹ã€‚</li>
</ul>
<h1 id="â€”â€”â€“-2"><a href="#â€”â€”â€“-2" class="headerlink" title="â€”â€”â€“"></a>â€”â€”â€“</h1><h1 id="SpringBootä¸­çš„Kafka"><a href="#SpringBootä¸­çš„Kafka" class="headerlink" title="SpringBootä¸­çš„Kafka"></a>SpringBootä¸­çš„Kafka</h1><h1 id="â€”â€”â€“-3"><a href="#â€”â€”â€“-3" class="headerlink" title="â€”â€”â€“"></a>â€”â€”â€“</h1><blockquote>
<p>æœ¬æ–‡åœ¨æä¾›å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œå¯è§ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs">https://github.com/YunaiV/SpringBoot-Labs</a> çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka">lab-03-kafka</a> ç›®å½•ã€‚</p>
<p>åŸåˆ›ä¸æ˜“ï¼Œç»™ç‚¹ä¸ª <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/stargazers">Star</a> å˜¿ï¼Œä¸€èµ·å†²é¸­ï¼</p>
</blockquote>
<h1 id="1-æ¦‚è¿°-1"><a href="#1-æ¦‚è¿°-1" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>å¦‚æœèƒ–å‹è¿˜æ²¡äº†è§£è¿‡åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ— <a target="_blank" rel="noopener" href="https://kafka.apache.org/">Apache Kafka</a> ï¼Œå»ºè®®å…ˆé˜…è¯»ä¸‹è‰¿è‰¿å†™çš„ <a target="_blank" rel="noopener" href="http://www.iocoder.cn/Kafka/install/?self">ã€ŠèŠ‹é“ Kafka æç®€å…¥é—¨ã€‹</a> æ–‡ç« ã€‚è™½ç„¶è¿™ç¯‡æ–‡ç« æ ‡é¢˜æ˜¯å®‰è£…éƒ¨ç½²ï¼Œå®é™…å¯ä»¥ç†è§£æˆã€Šä¸€æ–‡å¸¦ä½ å¿«é€Ÿå…¥é—¨ Kafkaã€‹ï¼Œå“ˆå“ˆå“ˆã€‚</p>
<p>è€ƒè™‘è¿™æ˜¯ Kafka å¦‚ä½•åœ¨ Spring Boot æ•´åˆä¸ä½¿ç”¨çš„æ–‡ç« ï¼Œæ‰€ä»¥è¿˜æ˜¯ç®€å•ä»‹ç»ä¸‹ Kafka æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<blockquote>
<p>FROM <a target="_blank" rel="noopener" href="https://www.oschina.net/p/kafka">ã€Šåˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ Kafkaã€‹</a></p>
<p>Kafka æ˜¯ä¸€ç§é«˜ååé‡çš„åˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œå¥¹æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>é€šè¿‡ O(1) çš„ç£ç›˜æ•°æ®ç»“æ„æä¾›æ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œè¿™ç§ç»“æ„å¯¹äºå³ä½¿æ•°ä»¥TBçš„æ¶ˆæ¯å­˜å‚¨ä¹Ÿèƒ½å¤Ÿä¿æŒé•¿æ—¶é—´çš„ç¨³å®šæ€§èƒ½ã€‚</li>
<li>é«˜ååé‡ï¼šå³ä½¿æ˜¯éå¸¸æ™®é€šçš„ç¡¬ä»¶kafkaä¹Ÿå¯ä»¥æ”¯æŒæ¯ç§’æ•°åä¸‡çš„æ¶ˆæ¯ã€‚</li>
<li>æ”¯æŒé€šè¿‡ Kafka æœåŠ¡å™¨å’Œæ¶ˆè´¹æœºé›†ç¾¤æ¥åˆ†åŒºæ¶ˆæ¯ã€‚</li>
</ul>
</blockquote>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šæ¯” <a target="_blank" rel="noopener" href="http://www.iocoder.cn/Kafka/install/?self">ã€ŠèŠ‹é“ Kafka æç®€å…¥é—¨ã€‹</a> æä¾›æ›´å¤šçš„ç”Ÿäº§è€… Producer å’Œæ¶ˆè´¹è€… Consumer çš„ä½¿ç”¨ç¤ºä¾‹ã€‚ä¾‹å¦‚è¯´ï¼š</p>
<ul>
<li>Producer ä¸‰ç§å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚</li>
<li>Producer å‘é€<strong>é¡ºåº</strong>æ¶ˆæ¯ï¼ŒConsumer <strong>é¡ºåº</strong>æ¶ˆè´¹æ¶ˆæ¯ã€‚</li>
<li>Producer å‘é€<strong>å®šæ—¶</strong>æ¶ˆæ¯ã€‚ï¼ˆæš‚ä¸æ”¯æŒï¼‰</li>
<li>Producer <strong>æ‰¹é‡</strong>å‘é€æ¶ˆæ¯ã€‚</li>
<li>Producer å‘é€<strong>äº‹åŠ¡</strong>æ¶ˆæ¯ã€‚</li>
<li>Consumer <strong>æ‰¹é‡</strong>æ¶ˆè´¹æ¶ˆæ¯ã€‚</li>
<li>Consumer <strong>å¹¿æ’­</strong>å’Œ<strong>é›†ç¾¤</strong>æ¶ˆè´¹æ¶ˆæ¯ã€‚</li>
</ul>
<p>èƒ–å‹ä½ å°±è¯´ï¼Œè‰¿è‰¿æ˜¯ä¸æ˜¯å¾ˆè‰¯å¿ƒã€‚ğŸ˜œ</p>
<h1 id="2-Spring-Kafka"><a href="#2-Spring-Kafka" class="headerlink" title="2. Spring-Kafka"></a>2. Spring-Kafka</h1><p>åœ¨ Spring ç”Ÿæ€ä¸­ï¼Œæä¾›äº† <a target="_blank" rel="noopener" href="https://spring.io/projects/spring-kafka">Spring-Kafka</a> é¡¹ç›®ï¼Œè®©æˆ‘ä»¬æ›´ç®€ä¾¿çš„ä½¿ç”¨ Kafka ã€‚å…¶å®˜ç½‘ä»‹ç»å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>The Spring for Apache Kafka (spring-kafka) project applies core Spring concepts to the development of Kafka-based messaging solutions.<br>Spring for Apache Kafka (spring-kafka) é¡¹ç›®å°† Spring æ ¸å¿ƒæ¦‚å¿µåº”ç”¨äºåŸºäº Kafka çš„æ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆçš„å¼€å‘ã€‚</p>
<p>It provides a â€œtemplateâ€ as a high-level abstraction for sending messages.<br>å®ƒæä¾›äº†ä¸€ä¸ªâ€œæ¨¡æ¿â€ä½œä¸ºå‘é€æ¶ˆæ¯çš„é«˜çº§æŠ½è±¡ã€‚</p>
<p>It also provides support for Message-driven POJOs with @KafkaListener annotations and a â€œlistener containerâ€.<br>å®ƒè¿˜é€šè¿‡ @KafkaListener æ³¨è§£å’Œâ€œä¾¦å¬å™¨å®¹å™¨(listener container)â€ä¸ºæ¶ˆæ¯é©±åŠ¨çš„ POJO æä¾›æ”¯æŒã€‚</p>
<p>These libraries promote the use of dependency injection and declarative.<br>è¿™äº›åº“ä¿ƒè¿›äº†ä¾èµ–æ³¨å…¥å’Œå£°æ˜çš„ä½¿ç”¨ã€‚</p>
<p>In all of these cases, you will see similarities to the JMS support in the Spring Framework and RabbitMQ support in Spring AMQP.<br>åœ¨æ‰€æœ‰è¿™äº›ç”¨ä¾‹ä¸­ï¼Œä½ å°†çœ‹åˆ° Spring Framework ä¸­çš„ JMS æ”¯æŒï¼Œä»¥åŠå’Œ Spring AMQP ä¸­çš„ RabbitMQ æ”¯æŒçš„ç›¸ä¼¼ä¹‹å¤„ã€‚</p>
</blockquote>
<ul>
<li>ğŸ˜ˆ æ³¨æ„ï¼ŒSpring-Kafka æ˜¯åŸºäº <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/tree/master/spring-messaging/src/main/java/org/springframework/messaging">Spring Message</a> æ¥å®ç° Kafka çš„å‘é€ç«¯å’Œæ¥æ”¶ç«¯ã€‚</li>
</ul>
<blockquote>
<p>Features(åŠŸèƒ½ç‰¹æ€§)</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/core/KafkaTemplate.java">KafkaTemplate</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/listener/KafkaMessageListenerContainer.java">KafkaMessageListenerContainer</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/annotation/KafkaListener.java">@KafkaListener</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/transaction/KafkaTransactionManager.java">KafkaTransactionManager</a></li>
<li><code>spring-kafka-test</code> jar with embedded kafka server(å¸¦åµŒå…¥å¼ Kafka æœåŠ¡å™¨çš„ <code>spring-kafka-test</code> jar åŒ…)</li>
</ul>
</blockquote>
<h1 id="3-å¿«é€Ÿå…¥é—¨"><a href="#3-å¿«é€Ÿå…¥é—¨" class="headerlink" title="3. å¿«é€Ÿå…¥é—¨"></a>3. å¿«é€Ÿå…¥é—¨</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo">lab-31-kafka-demo</a> ã€‚</p>
</blockquote>
<p>æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬å…ˆæ¥å¯¹ Kafka-Spring åšä¸€ä¸ªå¿«é€Ÿå…¥é—¨ï¼Œå®ç° Producer ä¸‰ç§å‘é€æ¶ˆæ¯çš„æ–¹å¼çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ª Consumer æ¶ˆè´¹æ¶ˆæ¯ã€‚</p>
<p>è€ƒè™‘åˆ°ä¸€ä¸ªåº”ç”¨æ—¢å¯ä»¥ä½¿ç”¨ç”Ÿäº§è€… Producer ï¼Œåˆå¯ä»¥ä½¿ç”¨æ¶ˆè´¹è€… Consumer ï¼Œæ‰€ä»¥ç¤ºä¾‹å°±åšæˆä¸€ä¸ª <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo">lab-31-kafka-demo</a> é¡¹ç›®ã€‚</p>
<h2 id="3-1-å¼•å…¥ä¾èµ–"><a href="#3-1-å¼•å…¥ä¾èµ–" class="headerlink" title="3.1 å¼•å…¥ä¾èµ–"></a>3.1 å¼•å…¥ä¾èµ–</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lab-03-kafka-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥ Spring-Kafka ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å·²ç»å†…ç½® kafka-clients ä¾èµ–ï¼Œæ‰€ä»¥æ— éœ€é‡å¤å¼•å…¥ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- å®ç°å¯¹ JSON çš„è‡ªåŠ¨åŒ–é…ç½® --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å› ä¸ºï¼ŒKafka å¯¹å¤æ‚å¯¹è±¡çš„ Message åºåˆ—åŒ–æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åˆ° JSON --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            åŒæ—¶ï¼Œspring-boot-starter-json å¼•å…¥äº† spring-boot-starter ï¼Œè€Œ spring-boot-starter åˆå¼•å…¥äº† spring-boot-autoconfigure ã€‚</span></span><br><span class="line"><span class="comment">            spring-boot-autoconfigure å®ç°äº† Spring-Kafka çš„è‡ªåŠ¨åŒ–é…ç½®</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- æ–¹ä¾¿ç­‰ä¼šå†™å•å…ƒæµ‹è¯• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li>å…·ä½“æ¯ä¸ªä¾èµ–çš„ä½œç”¨ï¼Œèƒ–å‹è‡ªå·±è®¤çœŸçœ‹ä¸‹è‰¿è‰¿æ·»åŠ çš„æ‰€æœ‰æ³¨é‡Šå™¢ã€‚</li>
<li>ä¸è¿‡æœ‰ç‚¹å¾ˆå¥‡æ€ªçš„æ˜¯ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot">Spring Boot</a> å·²ç»æä¾›äº† Kafka çš„<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/kafka">è‡ªåŠ¨åŒ–é…ç½®</a>çš„æ”¯æŒï¼Œä½†æ˜¯ç«Ÿç„¶æ²¡æœ‰æä¾› spring-boot-kafka-starter åŒ…ï¼Œæœ‰ç‚¹ç¥å¥‡~</li>
</ul>
<h2 id="3-2-åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#3-2-åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="3.2 åº”ç”¨é…ç½®æ–‡ä»¶"></a>3.2 åº”ç”¨é…ç½®æ–‡ä»¶</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/resources"><code>resources</code></a> ç›®å½•ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo/src/main/resources/application.yaml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># Kafka é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProperties é…ç½®ç±»</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">bootstrap-servers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">    <span class="comment"># Kafka Producer é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">producer:</span></span><br><span class="line">      <span class="attr">acks:</span> <span class="number">1</span> <span class="comment"># 0-ä¸åº”ç­”ã€‚1-leader åº”ç­”ã€‚all-æ‰€æœ‰ leader å’Œ follower åº”ç­”ã€‚</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span> <span class="comment"># å‘é€å¤±è´¥æ—¶ï¼Œé‡è¯•å‘é€çš„æ¬¡æ•°</span></span><br><span class="line">      <span class="attr">key-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span> <span class="comment"># æ¶ˆæ¯çš„ key çš„åºåˆ—åŒ–</span></span><br><span class="line">      <span class="attr">value-serializer:</span> <span class="string">org.springframework.kafka.support.serializer.JsonSerializer</span> <span class="comment"># æ¶ˆæ¯çš„ value çš„åºåˆ—åŒ–</span></span><br><span class="line">    <span class="comment"># Kafka Consumer é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">consumer:</span></span><br><span class="line">      <span class="attr">auto-offset-reset:</span> <span class="string">earliest</span> <span class="comment"># è®¾ç½®æ¶ˆè´¹è€…åˆ†ç»„æœ€åˆçš„æ¶ˆè´¹è¿›åº¦ä¸º earliest ã€‚å¯å‚è€ƒåšå®¢ https://blog.csdn.net/lishuangzhe7047/article/details/74530417 ç†è§£</span></span><br><span class="line">      <span class="attr">key-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="attr">value-deserializer:</span> <span class="string">org.springframework.kafka.support.serializer.JsonDeserializer</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">spring:</span></span><br><span class="line">          <span class="attr">json:</span></span><br><span class="line">            <span class="attr">trusted:</span></span><br><span class="line">              <span class="attr">packages:</span> <span class="string">cn.iocoder.springboot.lab03.kafkademo.message</span></span><br><span class="line">    <span class="comment"># Kafka Consumer Listener ç›‘å¬å™¨é…ç½®</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">missing-topics-fatal:</span> <span class="literal">false</span> <span class="comment"># æ¶ˆè´¹ç›‘å¬æ¥å£ç›‘å¬çš„ä¸»é¢˜ä¸å­˜åœ¨æ—¶ï¼Œé»˜è®¤ä¼šæŠ¥é”™ã€‚æ‰€ä»¥é€šè¿‡è®¾ç½®ä¸º false ï¼Œè§£å†³æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">springframework:</span></span><br><span class="line">        <span class="attr">kafka:</span> <span class="string">ERROR</span> <span class="comment"># spring-kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span></span><br><span class="line">      <span class="attr">apache:</span></span><br><span class="line">        <span class="attr">kafka:</span> <span class="string">ERROR</span> <span class="comment"># kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p>åœ¨ <code>spring.kafka</code> é…ç½®é¡¹ï¼Œè®¾ç½® Kafka çš„é…ç½®ï¼Œå¯¹åº” <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/kafka/KafkaProperties.java">KafkaProperties</a> é…ç½®ç±»ã€‚</p>
</li>
<li><p>Spring Boot æä¾›çš„ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/kafka/KafkaAutoConfiguration.java">KafkaAutoConfiguration</a> è‡ªåŠ¨åŒ–é…ç½®ç±»ï¼Œå®ç° Kafka çš„è‡ªåŠ¨é…ç½®ï¼Œåˆ›å»ºç›¸åº”çš„ Producer å’Œ Consumer ã€‚</p>
</li>
<li><p><code>spring.kafka.bootstrap-servers</code> é…ç½®é¡¹ï¼Œè®¾ç½® Kafka Broker åœ°å€ã€‚å¦‚æœå¤šä¸ªï¼Œä½¿ç”¨é€—å·åˆ†éš”ã€‚</p>
</li>
<li><pre><code class="yaml">spring.kafka.producer
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">  é…ç½®é¡¹ï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯ Kafka Producer æ‰€ç‹¬æœ‰ã€‚</span><br><span class="line"></span><br><span class="line">  - `value-serializer` é…ç½®ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Spring-Kafka æä¾›çš„ [JsonSerializer](https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/support/serializer/JsonSerializer.java) åºåˆ—åŒ–ç±»ï¼Œå› ä¸ºç¨åæˆ‘ä»¬è¦ä½¿ç”¨ JSON çš„æ–¹å¼ï¼Œåºåˆ—åŒ–å¤æ‚çš„ Message æ¶ˆæ¯ã€‚</span><br><span class="line">  - å…¶å®ƒé…ç½®ï¼Œä¸€èˆ¬é»˜è®¤å³å¯ã€‚</span><br><span class="line"></span><br><span class="line">- ```yaml</span><br><span class="line">  spring.kafka.consumer</span><br></pre></td></tr></table></figure>

 

é…ç½®é¡¹ï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯ Kafka Consumer æ‰€ç‹¬æœ‰ã€‚

- `value-serializer` é…ç½®ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Spring-Kafka æä¾›çš„ [JsonDeserializer](https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/support/serializer/JsonDeserializer.java) ååºåˆ—åŒ–ç±»ï¼Œå› ä¸ºç¨åæˆ‘ä»¬è¦ä½¿ç”¨ JSON çš„æ–¹å¼ï¼Œååºåˆ—åŒ–å¤æ‚çš„ Message æ¶ˆæ¯ã€‚
- `properties.spring.json.trusted.packages` é…ç½®ï¼Œé…ç½®ä¿¡ä»» [`cn.iocoder.springboot.lab03.kafkademo.message`](https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message) åŒ…ä¸‹çš„ Message ç±»ä»¬ã€‚å› ä¸º JsonDeserializer åœ¨ååºåˆ—åŒ–æ¶ˆæ¯æ—¶ï¼Œè€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œåªååºåˆ—åŒ–æˆä¿¡ä»»çš„ Message ç±»ã€‚ğŸ˜ˆ æƒ³è¦å°è¯•ä¸‹æ•ˆæœçš„èƒ–å‹ï¼Œå¯ä»¥é€‰æ‹©å»æ‰è¿™ä¸ªé…ç½®ï¼Œå¾ˆé…¸çˆ½ã€‚
</code></pre>
</li>
</ul>
<h2 id="3-3-Application"><a href="#3-3-Application" class="headerlink" title="3.3 Application"></a>3.3 Application</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/Application.java"><code>Application.java</code></a> ç±»ï¼Œé…ç½® <code>@SpringBootApplication</code> æ³¨è§£å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Application.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-4-Demo01Message"><a href="#3-4-Demo01Message" class="headerlink" title="3.4 Demo01Message"></a>3.4 Demo01Message</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message"><code>cn.iocoder.springboot.lab03.kafkademo.message</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message/Demo01Message.java">Demo01Message</a> æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo01Message.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Message</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC</span> <span class="operator">=</span> <span class="string">&quot;DEMO_01&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–å·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... çœç•¥ set/get/toString æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>TOPIC</code> é™æ€å±æ€§ï¼Œæˆ‘ä»¬è®¾ç½®è¯¥æ¶ˆæ¯ç±»å¯¹åº” Topic ä¸º <code>&quot;DEMO_01&quot;</code> ã€‚</li>
</ul>
<h2 id="3-5-Demo01Producer"><a href="#3-5-Demo01Producer" class="headerlink" title="3.5 Demo01Producer"></a>3.5 Demo01Producer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer"><code>cn.iocoder.springboot.lab03.kafkademo.producer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo01Producer.java">Demo01Producer</a> ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Kafka-Spring å°è£…æä¾›çš„ KafkaTemplate ï¼Œå®ç°ä¸‰ç§å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo01Producer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Producer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;Object, Object&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SendResult <span class="title function_">syncSend</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Demo01Message æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Demo01Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo01Message</span>();</span><br><span class="line">        message.setId(id);</span><br><span class="line">        <span class="comment">// åŒæ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> kafkaTemplate.send(Demo01Message.TOPIC, message).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ListenableFuture&lt;SendResult&lt;Object, Object&gt;&gt; <span class="title function_">asyncSend</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Demo01Message æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Demo01Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo01Message</span>();</span><br><span class="line">        message.setId(id);</span><br><span class="line">        <span class="comment">// å¼‚æ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> kafkaTemplate.send(Demo01Message.TOPIC, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>#asyncSend(...)</code> æ–¹æ³•ï¼Œ<strong>å¼‚æ­¥</strong>å‘é€æ¶ˆæ¯ã€‚åœ¨æ–¹æ³•å†…éƒ¨ï¼Œä¼šè°ƒç”¨ <code>KafkaTemplate#send(topic, data)</code> æ–¹æ³•ï¼Œ<strong>å¼‚æ­¥</strong>å‘é€æ¶ˆæ¯ï¼Œè¿”å› Spring <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/util/concurrent/ListenableFuture.java">ListenableFuture</a> å¯¹è±¡ï¼Œä¸€ä¸ªå¯ä»¥é€šè¿‡ç›‘å¬æ‰§è¡Œç»“æœçš„ Future å¢å¼ºã€‚</li>
<li><code>#syncSend(...)</code> æ–¹æ³•ï¼Œ<strong>åŒæ­¥</strong>å‘é€æ¶ˆæ¯ã€‚åœ¨æ–¹æ³•å†…éƒ¨ï¼Œä¹Ÿæ˜¯è°ƒç”¨ <code>KafkaTemplate#send(topic, data)</code> æ–¹æ³•ï¼Œ<strong>å¼‚æ­¥</strong>å‘é€æ¶ˆæ¯ã€‚ä¸è¿‡ï¼Œå› ä¸ºæˆ‘ä»¬åé¢è°ƒç”¨äº† ListenableFuture å¯¹è±¡çš„ <code>#get()</code> æ–¹æ³•ï¼Œé˜»å¡ç­‰å¾…å‘é€ç»“æœï¼Œä»è€Œå®ç°åŒæ­¥çš„æ•ˆæœã€‚</li>
<li>æš‚æ—¶æœªæä¾› <strong>oneway</strong> å‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚å› ä¸ºéœ€è¦é…ç½® Producer çš„ <code>acks = 0</code> ï¼Œæ‰å¯ä»¥ä½¿ç”¨è¿™ç§å‘é€æ–¹å¼ã€‚ğŸ˜ˆ å½“ç„¶ï¼Œå®é™…åœºæ™¯ä¸‹ï¼ŒåŸºæœ¬ä¸ä¼šä½¿ç”¨ <strong>oneway</strong> çš„æ–¹å¼æ¥å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥ç›´æ¥å…ˆå¿½ç•¥å§ã€‚</li>
</ul>
<p>å¯¹äºèƒ–å‹æ¥è¯´ï¼Œå¯èƒ½æœ€å…³å¿ƒçš„æ˜¯ï¼Œæ¶ˆæ¯ Message æ˜¯æ€ä¹ˆåºåˆ—åŒ–çš„ã€‚</p>
<ul>
<li>åœ¨åºåˆ—åŒ–æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† JsonSerializer åºåˆ—åŒ– Message æ¶ˆæ¯å¯¹è±¡ï¼Œå®ƒä¼šåœ¨ Kafka æ¶ˆæ¯ <a target="_blank" rel="noopener" href="https://kafka.apache.org/0110/javadoc/index.html?org/apache/kafka/common/header/Headers.html">Headers</a> çš„ <code>__TypeId__</code> ä¸Šï¼Œå€¼ä¸º Message æ¶ˆæ¯å¯¹åº”çš„<strong>ç±»å…¨å</strong>ã€‚</li>
<li>åœ¨ååºåˆ—åŒ–æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† JsonDeserializer åºåˆ—åŒ–å‡º Message æ¶ˆæ¯å¯¹è±¡ï¼Œå®ƒä¼šæ ¹æ® Kafka æ¶ˆæ¯ <a target="_blank" rel="noopener" href="https://kafka.apache.org/0110/javadoc/index.html?org/apache/kafka/common/header/Headers.html">Headers</a> çš„ <code>__TypeId__</code> çš„å€¼ï¼Œååºåˆ—åŒ–æ¶ˆæ¯å†…å®¹æˆè¯¥ Message å¯¹è±¡ã€‚</li>
</ul>
<h2 id="3-6-Demo01Consumer"><a href="#3-6-Demo01Consumer" class="headerlink" title="3.6 Demo01Consumer"></a>3.6 Demo01Consumer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/"><code>cn.iocoder.springboot.lab03.kafkademo.consumer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/Demo01Consumer.java">Demo01Consumer</a> ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo01Consumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo01Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo01-consumer-group-&quot; + Demo01Message.TOPIC)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Demo01Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>åœ¨æ–¹æ³•ä¸Šï¼Œæ·»åŠ äº† <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/annotation/KafkaListener.java"><code>@KafkaListener</code></a> æ³¨è§£ï¼Œå£°æ˜æ¶ˆè´¹çš„ Topic æ˜¯ <code>&quot;DEMO_01&quot;</code> ï¼Œæ¶ˆè´¹è€…åˆ†ç»„æ˜¯ <code>&quot;demo01-consumer-group-DEMO_01&quot;</code> ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†ç»„ï¼Œä»…æ¶ˆè´¹ä¸€ä¸ª Topic ã€‚è¿™æ ·åšä¼šæœ‰ä¸ªå¥½å¤„ï¼šæ¯ä¸ªæ¶ˆè´¹è€…åˆ†ç»„èŒè´£å•ä¸€ï¼Œåªæ¶ˆè´¹ä¸€ä¸ª Topic ã€‚</li>
<li>æ–¹æ³•å‚æ•°ï¼Œä½¿ç”¨æ¶ˆè´¹ Topic å¯¹åº”çš„æ¶ˆæ¯ç±»å³å¯ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.4 Demo01Messageã€</a> ã€‚</li>
<li>è™½ç„¶è¯´ï¼Œ<code>@KafkaListener</code> æ³¨è§£æ˜¯æ–¹æ³•çº§åˆ«çš„ï¼Œè‰¿è‰¿è¿˜æ˜¯å»ºè®®ä¸€ä¸ªç±»ï¼Œå¯¹åº”ä¸€ä¸ªæ–¹æ³•ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ğŸ˜ˆ ç®€å•æ¸…æ™°~</li>
</ul>
<h2 id="3-7-Demo01AConsumer"><a href="#3-7-Demo01AConsumer" class="headerlink" title="3.7 Demo01AConsumer"></a>3.7 Demo01AConsumer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/"><code>cn.iocoder.springboot.lab03.kafkademo.consumer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/Demo01AConsumer.java">Demo01AConsumer</a> ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo01AConsumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01AConsumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo01Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo01-A-consumer-group-&quot; + Demo01Message.TOPIC)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(ConsumerRecord&lt;Integer, String&gt; record)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), record);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>æ•´ä½“å’Œ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.6 Demo01Consumerã€</a> æ˜¯ä¸€è‡´çš„ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå·®å¼‚ç‚¹ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åˆé¢å¤–åˆ›å»ºäº†è¿™ä¸ªæ¶ˆè´¹è€…çš„åŸå› ã€‚</li>
</ul>
<p><strong>å·®å¼‚ä¸€</strong>ï¼Œåœ¨æ–¹æ³•ä¸Šï¼Œæ·»åŠ äº† <code>@KafkaListener</code> æ³¨è§£ï¼Œå£°æ˜æ¶ˆè´¹çš„ Topic <strong>è¿˜æ˜¯</strong> <code>&quot;DEMO_01&quot;</code> ï¼Œæ¶ˆè´¹è€…åˆ†ç»„ä¿®<strong>æ”¹æˆ</strong>äº† <code>&quot;demo01-A-consumer-group-DEMO_01&quot;</code> ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æµ‹è¯• Kafka é›†ç¾¤æ¶ˆè´¹çš„ç‰¹æ€§ã€‚</p>
<blockquote>
<p>é›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰ï¼šé›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒ Consumer Group çš„æ¯ä¸ª Consumer å®ä¾‹å¹³å‡åˆ†æ‘Šæ¶ˆæ¯ã€‚</p>
</blockquote>
<ul>
<li>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å‘é€ä¸€æ¡ Topic ä¸º <code>&quot;DEMO_01&quot;</code> çš„æ¶ˆæ¯ï¼Œå¯ä»¥åˆ†åˆ«è¢« <code>&quot;demo01-A-consumer-group-DEMO_01&quot;</code> å’Œ <code>&quot;demo01-consumer-group-DEMO_01&quot;</code> éƒ½æ¶ˆè´¹ä¸€æ¬¡ã€‚</li>
<li>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¯åŠ¨ä¸¤ä¸ªè¯¥ç¤ºä¾‹çš„å®ä¾‹ï¼Œåˆ™æ¶ˆè´¹è€…åˆ†ç»„ <code>&quot;demo01-A-consumer-group-DEMO_01&quot;</code> å’Œ <code>&quot;demo01-consumer-group-DEMO_01&quot;</code> éƒ½ä¼šæœ‰å¤šä¸ª Consumer ç¤ºä¾‹ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å†å‘é€ä¸€æ¡ Topic ä¸º <code>&quot;DEMO_01&quot;</code> çš„æ¶ˆæ¯ï¼Œåªä¼šè¢« <code>&quot;demo01-A-consumer-group-DEMO_01&quot;</code> çš„ä¸€ä¸ª Consumer æ¶ˆè´¹ä¸€æ¬¡ï¼Œä¹ŸåŒæ ·åªä¼šè¢« <code>&quot;demo01-A-consumer-group-DEMO_01&quot;</code> çš„ä¸€ä¸ª Consumer æ¶ˆè´¹ä¸€æ¬¡ã€‚</li>
</ul>
<p>å¥½å¥½ç†è§£ä¸Šè¿°çš„ä¸¤æ®µè¯ï¼Œéå¸¸é‡è¦ã€‚</p>
<p>é€šè¿‡<strong>é›†ç¾¤æ¶ˆè´¹</strong>çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°é’ˆå¯¹ç›¸åŒ Topic ï¼Œä¸åŒæ¶ˆè´¹è€…åˆ†ç»„å®ç°å„è‡ªçš„ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚è¯´ï¼šç”¨æˆ·æ³¨å†ŒæˆåŠŸæ—¶ï¼Œå‘é€ä¸€æ¡ Topic ä¸º <code>&quot;USER_REGISTER&quot;</code> çš„æ¶ˆæ¯ã€‚ç„¶åï¼Œä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„æ¶ˆè´¹è€…åˆ†ç»„ï¼Œè®¢é˜…è¯¥ Topic ï¼Œå®ç°å„è‡ªçš„æ‹“å±•é€»è¾‘ï¼š</p>
<ul>
<li>ç§¯åˆ†æ¨¡å—ï¼šåˆ¤æ–­å¦‚æœæ˜¯æ‰‹æœºæ³¨å†Œï¼Œç»™ç”¨æˆ·å¢åŠ  20 ç§¯åˆ†ã€‚</li>
<li>ä¼˜æƒ åŠµæ¨¡å—ï¼šå› ä¸ºæ˜¯æ–°ç”¨æˆ·ï¼Œæ‰€ä»¥å‘æ”¾æ–°ç”¨æˆ·ä¸“äº«ä¼˜æƒ åŠµã€‚</li>
<li>ç«™å†…ä¿¡æ¨¡å—ï¼šå› ä¸ºæ˜¯æ–°ç”¨æˆ·ï¼Œæ‰€ä»¥å‘é€æ–°ç”¨æˆ·çš„æ¬¢è¿è¯­çš„ç«™å†…ä¿¡ã€‚</li>
<li>â€¦ ç­‰ç­‰</li>
</ul>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æ³¨å†ŒæˆåŠŸåçš„ä¸šåŠ¡æ‹“å±•é€»è¾‘ï¼Œå®ç°ä¸šåŠ¡ä¸Šçš„è§£è€¦ï¼Œæœªæ¥ä¹Ÿæ›´åŠ å®¹æ˜“æ‹“å±•ã€‚åŒæ—¶ï¼Œä¹Ÿæé«˜äº†æ³¨å†Œæ¥å£çš„æ€§èƒ½ï¼Œé¿å…ç”¨æˆ·éœ€è¦ç­‰å¾…ä¸šåŠ¡æ‹“å±•é€»è¾‘æ‰§è¡Œå®Œæˆåï¼Œæ‰å“åº”æ³¨å†ŒæˆåŠŸã€‚</p>
<p><strong>å·®å¼‚äºŒ</strong>ï¼Œæ–¹æ³•å‚æ•°ï¼Œè®¾ç½®æ¶ˆè´¹çš„æ¶ˆæ¯å¯¹åº”çš„ç±»ä¸æ˜¯ Demo01Message ç±»ï¼Œè€Œæ˜¯ Kafka å†…ç½®çš„ <a target="_blank" rel="noopener" href="https://github.com/axbaretto/kafka/blob/master/clients/src/main/java/org/apache/kafka/clients/consumer/ConsumerRecord.java">ConsumerRecord</a> ç±»ã€‚é€šè¿‡ ConsumerRecord ç±»ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°æ¶ˆè´¹çš„æ¶ˆæ¯çš„æ›´å¤šä¿¡æ¯ï¼Œä¾‹å¦‚è¯´æ¶ˆæ¯çš„æ‰€å±é˜Ÿåˆ—ã€åˆ›å»ºæ—¶é—´ç­‰ç­‰å±æ€§ï¼Œä¸è¿‡æ¶ˆæ¯çš„å†…å®¹(<code>value</code>)å°±éœ€è¦è‡ªå·±å»ååºåˆ—åŒ–ã€‚å½“ç„¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä¼šä½¿ç”¨ ConsumerRecord ç±»ã€‚</p>
<h2 id="3-8-ç®€å•æµ‹è¯•"><a href="#3-8-ç®€å•æµ‹è¯•" class="headerlink" title="3.8 ç®€å•æµ‹è¯•"></a>3.8 ç®€å•æµ‹è¯•</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo/src/test/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo01ProducerTest.java">Demo01ProducerTest</a> æµ‹è¯•ç±»ï¼Œç¼–å†™äºŒä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo01Producer äºŒä¸ªå‘é€æ¶ˆæ¯çš„æ–¹å¼ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01ProducerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Demo01Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSyncSend</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> (<span class="type">int</span>) (System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">        <span class="type">SendResult</span> <span class="variable">result</span> <span class="operator">=</span> producer.syncSend(id);</span><br><span class="line">        logger.info(<span class="string">&quot;[testSyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€ç»“æœï¼š[&#123;&#125;]]&quot;</span>, id, result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testASyncSend</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> (<span class="type">int</span>) (System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">        producer.asyncSend(id).addCallback(<span class="keyword">new</span> <span class="title class_">ListenableFutureCallback</span>&lt;SendResult&lt;Object, Object&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;[testASyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€å¼‚å¸¸]]&quot;</span>, id, e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(SendResult&lt;Object, Object&gt; result)</span> &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;[testASyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[&#123;&#125;]]&quot;</span>, id, result);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±çœ‹ä¸‹ä¸‰ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥æ‰§è¡Œ <code>#testSyncSend()</code> æ–¹æ³•ï¼Œæµ‹è¯•åŒæ­¥å‘é€æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚æ³¨æ„ __TypeId__</span><br><span class="line">2019-12-08 18:14:11.174  INFO 89529 --- [           main] c.i.s.l.k.producer.Demo01ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[1575627250] å‘é€ç»“æœï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_01, partition=null, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [99, 110, 46, 105, 111, 99, 111, 100, 101, 114, 46, 115, 112, 114, 105, 110, 103, 98, 111, 111, 116, 46, 108, 97, 98, 48, 51, 46, 107, 97, 102, 107, 97, 100, 101, 109, 111, 46, 109, 101, 115, 115, 97, 103, 101, 46, 68, 101, 109, 111, 48, 49, 77, 101, 115, 115, 97, 103, 101])], isReadOnly = true), key=null, value=Demo01Message&#123;id=1575627250&#125;, timestamp=null), recordMetadata=DEMO_01-0@0]]]</span><br><span class="line"></span><br><span class="line"># Demo01AConsumer æ¶ˆè´¹äº†ä¸€æ¬¡è¯¥æ¶ˆæ¯</span><br><span class="line">2019-12-08 18:14:11.217  INFO 89529 --- [ntainer#0-0-C-1] c.i.s.l.k.consumer.Demo01AConsumer       : [onMessage][çº¿ç¨‹ç¼–å·:16 æ¶ˆæ¯å†…å®¹ï¼šConsumerRecord(topic = DEMO_01, partition = 0, leaderEpoch = 0, offset = 0, CreateTime = 1575627251158, serialized key size = -1, serialized value size = 17, headers = RecordHeaders(headers = [], isReadOnly = false), key = null, value = Demo01Message&#123;id=1575627250&#125;)]</span><br><span class="line"></span><br><span class="line"># Demo01Consumer æ¶ˆè´¹äº†ä¸€æ¬¡è¯¥æ¶ˆæ¯</span><br><span class="line">2019-12-08 18:14:11.220  INFO 89529 --- [ntainer#1-0-C-1] c.i.s.l.k.consumer.Demo01Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:18 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=1575627250&#125;]</span><br></pre></td></tr></table></figure>



<ul>
<li>é€šè¿‡æ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å‘é€çš„æ¶ˆæ¯ï¼Œåˆ†åˆ«è¢« Demo01AConsumer å’Œ Demo01Consumer ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ˆæ¶ˆè´¹è€…åˆ†ç»„ï¼‰éƒ½æ¶ˆè´¹äº†ä¸€æ¬¡ã€‚</li>
<li>åŒæ—¶ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œæ¶ˆè´¹äº†è¿™æ¡æ¶ˆæ¯ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥æ‰§è¡Œ <code>#testASyncSend()</code> æ–¹æ³•ï¼Œæµ‹è¯•å¼‚æ­¥å‘é€æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šæ³¨æ„ï¼Œä¸è¦å…³é—­ <code>#testSyncSend()</code> å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬è¦æ¨¡æ‹Ÿæ¯ä¸ªæ¶ˆè´¹è€…é›†ç¾¤ï¼Œéƒ½æœ‰å¤šä¸ª Consumer èŠ‚ç‚¹ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// Producer å¼‚æ­¥å‘é€æ¶ˆæ¯æˆåŠŸ</span><br><span class="line">2019-12-08 18:20:34.096  INFO 89818 --- [ad | producer-1] c.i.s.l.k.producer.Demo01ProducerTest    : [testASyncSend][å‘é€ç¼–å·ï¼š[1575627633] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_01, partition=null, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [99, 110, 46, 105, 111, 99, 111, 100, 101, 114, 46, 115, 112, 114, 105, 110, 103, 98, 111, 111, 116, 46, 108, 97, 98, 48, 51, 46, 107, 97, 102, 107, 97, 100, 101, 109, 111, 46, 109, 101, 115, 115, 97, 103, 101, 46, 68, 101, 109, 111, 48, 49, 77, 101, 115, 115, 97, 103, 101])], isReadOnly = true), key=null, value=Demo01Message&#123;id=1575627633&#125;, timestamp=null), recordMetadata=DEMO_01-0@2]]]</span><br><span class="line"></span><br><span class="line"># Demo01AConsumer æ¶ˆè´¹äº†ä¸€æ¬¡è¯¥æ¶ˆæ¯</span><br><span class="line">2019-12-08 18:20:34.139  INFO 89818 --- [ntainer#0-0-C-1] c.i.s.l.k.consumer.Demo01AConsumer       : [onMessage][çº¿ç¨‹ç¼–å·:16 æ¶ˆæ¯å†…å®¹ï¼šConsumerRecord(topic = DEMO_01, partition = 0, leaderEpoch = 0, offset = 2, CreateTime = 1575627634079, serialized key size = -1, serialized value size = 17, headers = RecordHeaders(headers = [], isReadOnly = false), key = null, value = Demo01Message&#123;id=1575627633&#125;)</span><br><span class="line"></span><br><span class="line"># Demo01Consumer æ¶ˆè´¹äº†ä¸€æ¬¡è¯¥æ¶ˆæ¯</span><br><span class="line">2019-12-08 18:20:34.142  INFO 89818 --- [ntainer#1-0-C-1] c.i.s.l.k.consumer.Demo01Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:18 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=1575627633&#125;]</span><br></pre></td></tr></table></figure>



<ul>
<li>å’Œ <code>#testSyncSend()</code> æ–¹æ³•æ‰§è¡Œçš„ç»“æœï¼Œæ˜¯ä¸€è‡´çš„ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬æ‰“å¼€ <code>#testSyncSend()</code> æ–¹æ³•æ‰€åœ¨çš„æ§åˆ¶å°ï¼Œä¸ä¼šçœ‹åˆ°æœ‰æ¶ˆæ¯æ¶ˆè´¹çš„æ—¥å¿—ã€‚è¯´æ˜ï¼Œç¬¦åˆé›†ç¾¤æ¶ˆè´¹çš„æœºåˆ¶ï¼š<strong>é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒ Consumer Group çš„æ¯ä¸ª Consumer å®ä¾‹å¹³å‡åˆ†æ‘Šæ¶ˆæ¯ã€‚</strong>ã€‚</li>
<li>ğŸ˜ˆ ä¸è¿‡å¦‚ä¸Šçš„æ—¥å¿—ï¼Œä¹Ÿå¯èƒ½å‡ºç°åœ¨ <code>#testSyncSend()</code> æ–¹æ³•æ‰€åœ¨çš„æ§åˆ¶å°ï¼Œè€Œä¸åœ¨ <code>#testASyncSend()</code> æ–¹æ³•æ‰€åœ¨çš„æ§åˆ¶å°ã€‚</li>
</ul>
<h2 id="3-9-KafkaListener"><a href="#3-9-KafkaListener" class="headerlink" title="3.9 @KafkaListener"></a>3.9 @KafkaListener</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.6 Demo01Consumerã€</a> ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº† <code>@KafkaListener</code> æ³¨è§£ï¼Œè®¾ç½®æ¯ä¸ª Kafka æ¶ˆè´¹è€… Consumer çš„æ¶ˆæ¯ç›‘å¬å™¨çš„é…ç½®ã€‚</p>
<p><code>@KafkaListener</code> æ³¨è§£çš„<strong>å¸¸ç”¨</strong>å±æ€§å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›‘å¬çš„ Topic æ•°ç»„</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * The topics for this listener.</span></span><br><span class="line"><span class="comment"> * The entries can be &#x27;topic name&#x27;, &#x27;property-placeholder keys&#x27; or &#x27;expressions&#x27;.</span></span><br><span class="line"><span class="comment"> * An expression must be resolved to the topic name.</span></span><br><span class="line"><span class="comment"> * This uses group management and Kafka will assign partitions to group members.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Mutually exclusive with &#123;<span class="doctag">@link</span> #topicPattern()&#125; and &#123;<span class="doctag">@link</span> #topicPartitions()&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the topic names or expressions (SpEL) to listen to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String[] topics() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›‘å¬çš„ Topic è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * The topic pattern for this listener. The entries can be &#x27;topic pattern&#x27;, a</span></span><br><span class="line"><span class="comment"> * &#x27;property-placeholder key&#x27; or an &#x27;expression&#x27;. The framework will create a</span></span><br><span class="line"><span class="comment"> * container that subscribes to all topics matching the specified pattern to get</span></span><br><span class="line"><span class="comment"> * dynamically assigned partitions. The pattern matching will be performed</span></span><br><span class="line"><span class="comment"> * periodically against topics existing at the time of check. An expression must</span></span><br><span class="line"><span class="comment"> * be resolved to the topic pattern (String or Pattern result types are supported).</span></span><br><span class="line"><span class="comment"> * This uses group management and Kafka will assign partitions to group members.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Mutually exclusive with &#123;<span class="doctag">@link</span> #topics()&#125; and &#123;<span class="doctag">@link</span> #topicPartitions()&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the topic pattern or expression (SpEL).</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.apache.kafka.clients.CommonClientConfigs#METADATA_MAX_AGE_CONFIG</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">topicPattern</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@TopicPartition</span> æ³¨è§£çš„æ•°ç»„ã€‚æ¯ä¸ª <span class="doctag">@TopicPartition</span> æ³¨è§£ï¼Œå¯é…ç½®ç›‘å¬çš„ Topicã€é˜Ÿåˆ—ã€æ¶ˆè´¹çš„å¼€å§‹ä½ç½®</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * The topicPartitions for this listener when using manual topic/partition</span></span><br><span class="line"><span class="comment"> * assignment.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Mutually exclusive with &#123;<span class="doctag">@link</span> #topicPattern()&#125; and &#123;<span class="doctag">@link</span> #topics()&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the topic names or expressions (SpEL) to listen to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">TopicPartition[] topicPartitions() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…åˆ†ç»„</span></span><br><span class="line"><span class="comment"> * Override the &#123;<span class="doctag">@code</span> group.id&#125; property for the consumer factory with this value</span></span><br><span class="line"><span class="comment"> * for this listener only.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;SpEL &#123;<span class="doctag">@code</span> #&#123;...&#125;&#125; and property place holders &#123;<span class="doctag">@code</span> $&#123;...&#125;&#125; are supported.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the group id.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">groupId</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨æ¶ˆè´¹å¼‚å¸¸å¤„ç†å™¨ KafkaListenerErrorHandler çš„ Bean åå­—</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Set an &#123;<span class="doctag">@link</span> org.springframework.kafka.listener.KafkaListenerErrorHandler&#125; bean</span></span><br><span class="line"><span class="comment"> * name to invoke if the listener method throws an exception.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the error handler.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">errorHandler</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰æ¶ˆè´¹è€…ç›‘å¬å™¨çš„å¹¶å‘æ•°ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨ TODO è¯¦ç»†è§£æã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Override the container factory&#x27;s &#123;<span class="doctag">@code</span> concurrency&#125; setting for this listener. May</span></span><br><span class="line"><span class="comment"> * be a property placeholder or SpEL expression that evaluates to a &#123;<span class="doctag">@link</span> Number&#125;, in</span></span><br><span class="line"><span class="comment"> * which case &#123;<span class="doctag">@link</span> Number#intValue()&#125; is used to obtain the value.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;SpEL &#123;<span class="doctag">@code</span> #&#123;...&#125;&#125; and property place holders &#123;<span class="doctag">@code</span> $&#123;...&#125;&#125; are supported.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the concurrency.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">concurrency</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦è‡ªåŠ¨å¯åŠ¨ç›‘å¬å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸º true è‡ªåŠ¨å¯åŠ¨ã€‚</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> * Set to true or false, to override the default setting in the container factory. May</span></span><br><span class="line"><span class="comment"> * be a property placeholder or SpEL expression that evaluates to a &#123;<span class="doctag">@link</span> Boolean&#125; or</span></span><br><span class="line"><span class="comment"> * a &#123;<span class="doctag">@link</span> String&#125;, in which case the &#123;<span class="doctag">@link</span> Boolean#parseBoolean(String)&#125; is used to</span></span><br><span class="line"><span class="comment"> * obtain the value.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;SpEL &#123;<span class="doctag">@code</span> #&#123;...&#125;&#125; and property place holders &#123;<span class="doctag">@code</span> $&#123;...&#125;&#125; are supported.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> true to auto start, false to not auto start.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">autoStartup</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Kafka Consumer æ‹“å±•å±æ€§ã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Kafka consumer properties; they will supersede any properties with the same name</span></span><br><span class="line"><span class="comment"> * defined in the consumer factory (if the consumer factory supports property overrides).</span></span><br><span class="line"><span class="comment"> * &lt;h3&gt;Supported Syntax&lt;/h3&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The supported syntax for key-value pairs is the same as the</span></span><br><span class="line"><span class="comment"> * syntax defined for entries in a Java</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@linkplain</span> java.util.Properties#load(java.io.Reader) properties file&#125;:</span></span><br><span class="line"><span class="comment"> * &lt;ul&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;&#123;<span class="doctag">@code</span> key=value&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;&#123;<span class="doctag">@code</span> key:value&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;&#123;<span class="doctag">@code</span> key value&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> group.id&#125; and &#123;<span class="doctag">@code</span> client.id&#125; are ignored.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the properties.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.2.4</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.apache.kafka.clients.consumer.ConsumerConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #groupId()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #clientIdPrefix()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String[] properties() <span class="keyword">default</span> &#123;&#125;;</span><br></pre></td></tr></table></figure>



<p><code>@KafkaListener</code> æ³¨è§£çš„<strong>ä¸å¸¸ç”¨</strong>å±æ€§å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> * The unique identifier of the container managing for this endpoint.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If none is specified an auto-generated one is provided.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note: When provided, this value will override the group id property</span></span><br><span class="line"><span class="comment"> * in the consumer factory configuration, unless &#123;<span class="doctag">@link</span> #idIsGroup()&#125;</span></span><br><span class="line"><span class="comment"> * is set to false.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;SpEL &#123;<span class="doctag">@code</span> #&#123;...&#125;&#125; and property place holders &#123;<span class="doctag">@code</span> $&#123;...&#125;&#125; are supported.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the &#123;<span class="doctag">@code</span> id&#125; for the container managing for this endpoint.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.kafka.config.KafkaListenerEndpointRegistry#getListenerContainer(String)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">id</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * id å”¯ä¸€æ ‡è¯†çš„å‰ç¼€</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> * When provided, overrides the client id property in the consumer factory</span></span><br><span class="line"><span class="comment"> * configuration. A suffix (&#x27;-n&#x27;) is added for each container instance to ensure</span></span><br><span class="line"><span class="comment"> * uniqueness when concurrency is used.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;SpEL &#123;<span class="doctag">@code</span> #&#123;...&#125;&#125; and property place holders &#123;<span class="doctag">@code</span> $&#123;...&#125;&#125; are supported.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the client id prefix.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.1.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">clientIdPrefix</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“ groupId æœªè®¾ç½®æ—¶ï¼Œæ˜¯å¦ä½¿ç”¨ id ä½œä¸º groupId</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * When &#123;<span class="doctag">@link</span> #groupId() groupId&#125; is not provided, use the &#123;<span class="doctag">@link</span> #id() id&#125; (if</span></span><br><span class="line"><span class="comment"> * provided) as the &#123;<span class="doctag">@code</span> group.id&#125; property for the consumer. Set to false, to use</span></span><br><span class="line"><span class="comment"> * the &#123;<span class="doctag">@code</span> group.id&#125; from the consumer factory.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> false to disable.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">idIsGroup</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨çš„ KafkaListenerContainerFactory Bean çš„åå­—ã€‚</span></span><br><span class="line"><span class="comment"> * è‹¥æœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„ KafkaListenerContainerFactory Bean ã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * The bean name of the &#123;<span class="doctag">@link</span> org.springframework.kafka.config.KafkaListenerContainerFactory&#125;</span></span><br><span class="line"><span class="comment"> * to use to create the message listener container responsible to serve this endpoint.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If not specified, the default container factory is used, if any.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the container factory bean name.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">containerFactory</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰€å± MessageListenerContainer Bean çš„åå­—ã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * If provided, the listener container for this listener will be added to a bean</span></span><br><span class="line"><span class="comment"> * with this value as its name, of type &#123;<span class="doctag">@code</span> Collection&lt;MessageListenerContainer&gt;&#125;.</span></span><br><span class="line"><span class="comment"> * This allows, for example, iteration over the collection to start/stop a subset</span></span><br><span class="line"><span class="comment"> * of containers.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;SpEL &#123;<span class="doctag">@code</span> #&#123;...&#125;&#125; and property place holders &#123;<span class="doctag">@code</span> $&#123;...&#125;&#125; are supported.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the bean name for the group.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">containerGroup</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * çœŸå®ç›‘å¬å®¹å™¨çš„ Bean åå­—ï¼Œéœ€è¦åœ¨åå­—å‰åŠ  &quot;__&quot; ã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * A pseudo bean name used in SpEL expressions within this annotation to reference</span></span><br><span class="line"><span class="comment"> * the current bean within which this listener is defined. This allows access to</span></span><br><span class="line"><span class="comment"> * properties and methods within the enclosing bean.</span></span><br><span class="line"><span class="comment"> * Default &#x27;__listener&#x27;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Example: &#123;<span class="doctag">@code</span> topics = &quot;#&#123;__listener.topicList&#125;&quot;&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the pseudo bean name.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.1.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String <span class="title function_">beanRef</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;__listener&quot;</span>;</span><br></pre></td></tr></table></figure>



<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/annotation/TopicPartition.java"><code>@TopicPartition</code></a> æ³¨è§£</li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/annotation/PartitionOffset.java"><code>@PartitionOffset</code></a> æ³¨è§£</li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/annotation/KafkaListeners.java"><code>@KafkaListeners</code></a> æ³¨è§£ï¼Œå…è®¸æˆ‘ä»¬åœ¨å…¶ä¸­ï¼ŒåŒæ—¶æ·»åŠ å¤šä¸ª <code>@KafkaListener</code> æ³¨è§£ã€‚</li>
</ul>
<h1 id="4-æ‰¹é‡å‘é€æ¶ˆæ¯"><a href="#4-æ‰¹é‡å‘é€æ¶ˆæ¯" class="headerlink" title="4. æ‰¹é‡å‘é€æ¶ˆæ¯"></a>4. æ‰¹é‡å‘é€æ¶ˆæ¯</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch">lab-03-kafka-demo-batch</a> ã€‚</p>
</blockquote>
<p>åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Producer æ‰¹é‡å‘é€æ¶ˆæ¯ï¼Œæé«˜å‘é€æ€§èƒ½ã€‚ä¸åŒäºæˆ‘ä»¬åœ¨<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/RocketMQ/?self">ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— RocketMQ å…¥é—¨ã€‹</a> çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€</a> åŠŸèƒ½ï¼ŒRocketMQ æ˜¯æä¾›äº†ä¸€ä¸ªå¯ä»¥æ‰¹é‡å‘é€å¤šæ¡æ¶ˆæ¯çš„ API ã€‚è€Œ Kafka æä¾›çš„æ‰¹é‡å‘é€æ¶ˆæ¯ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª <a target="_blank" rel="noopener" href="http://people.apache.org/~nehanarkhede/kafka-0.9-producer-javadoc/doc/org/apache/kafka/clients/producer/internals/RecordAccumulator.html">RecordAccumulator</a> æ¶ˆæ¯æ”¶é›†å™¨ï¼Œå°†å‘é€ç»™ç›¸åŒ Topic çš„ç›¸åŒ Partition åˆ†åŒºçš„æ¶ˆæ¯ä»¬ï¼Œâ€œ<strong>å·å·</strong>â€æ”¶é›†åœ¨ä¸€èµ·ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶å€™ï¼Œä¸€æ¬¡æ€§æ‰¹é‡å‘é€æäº¤ç»™ Kafka Broker ã€‚å¦‚ä¸‹æ˜¯ä¸‰ä¸ªæ¡ä»¶ï¼Œæ»¡è¶³<strong>ä»»ä¸€</strong>å³ä¼šæ‰¹é‡å‘é€ï¼š</p>
<ul>
<li>ã€æ•°é‡ã€‘<code>batch-size</code> ï¼šè¶…è¿‡æ”¶é›†çš„æ¶ˆæ¯æ•°é‡çš„æœ€å¤§æ¡æ•°ã€‚</li>
<li>ã€ç©ºé—´ã€‘<code>buffer-memory</code> ï¼šè¶…è¿‡æ”¶é›†çš„æ¶ˆæ¯å ç”¨çš„æœ€å¤§å†…å­˜ã€‚</li>
<li>ã€æ—¶é—´ã€‘<code>linger.ms</code> ï¼šè¶…è¿‡æ”¶é›†çš„æ—¶é—´çš„æœ€å¤§ç­‰å¾…æ—¶é•¿ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚</li>
</ul>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Producer æ‰¹é‡å‘é€æ¶ˆæ¯çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a> çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch">lab-03-kafka-demo-batch</a> é¡¹ç›®ã€‚</p>
<h2 id="4-1-å¼•å…¥ä¾èµ–"><a href="#4-1-å¼•å…¥ä¾èµ–" class="headerlink" title="4.1 å¼•å…¥ä¾èµ–"></a>4.1 å¼•å…¥ä¾èµ–</h2><p>å’Œ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">3.1 å¼•å…¥ä¾èµ–ã€</a> ä¸€è‡´ï¼Œè§ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-batch/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ã€‚</p>
<h2 id="4-2-åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#4-2-åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="4.2 åº”ç”¨é…ç½®æ–‡ä»¶"></a>4.2 åº”ç”¨é…ç½®æ–‡ä»¶</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch/src/main/resources"><code>resources</code></a> ç›®å½•ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-batch/src/main/resources/application.yaml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># Kafka é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProperties é…ç½®ç±»</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">bootstrap-servers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">    <span class="comment"># Kafka Producer é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">producer:</span></span><br><span class="line">      <span class="attr">acks:</span> <span class="number">1</span> <span class="comment"># 0-ä¸åº”ç­”ã€‚1-leader åº”ç­”ã€‚all-æ‰€æœ‰ leader å’Œ follower åº”ç­”ã€‚</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span> <span class="comment"># å‘é€å¤±è´¥æ—¶ï¼Œé‡è¯•å‘é€çš„æ¬¡æ•°</span></span><br><span class="line">      <span class="attr">key-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span> <span class="comment"># æ¶ˆæ¯çš„ key çš„åºåˆ—åŒ–</span></span><br><span class="line">      <span class="attr">value-serializer:</span> <span class="string">org.springframework.kafka.support.serializer.JsonSerializer</span> <span class="comment"># æ¶ˆæ¯çš„ value çš„åºåˆ—åŒ–</span></span><br><span class="line">      <span class="attr">batch-size:</span> <span class="number">16384</span> <span class="comment"># æ¯æ¬¡æ‰¹é‡å‘é€æ¶ˆæ¯çš„æœ€å¤§æ•°é‡</span></span><br><span class="line">      <span class="attr">buffer-memory:</span> <span class="number">33554432</span> <span class="comment"># æ¯æ¬¡æ‰¹é‡å‘é€æ¶ˆæ¯çš„æœ€å¤§å†…å­˜</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">linger:</span></span><br><span class="line">          <span class="attr">ms:</span> <span class="number">30000</span> <span class="comment"># æ‰¹å¤„ç†å»¶è¿Ÿæ—¶é—´ä¸Šé™ã€‚è¿™é‡Œé…ç½®ä¸º 30 * 1000 ms è¿‡åï¼Œä¸ç®¡æ˜¯å¦æ¶ˆæ¯æ•°é‡æ˜¯å¦åˆ°è¾¾ batch-size æˆ–è€…æ¶ˆæ¯å¤§å°åˆ°è¾¾ buffer-memory åï¼Œéƒ½ç›´æ¥å‘é€ä¸€æ¬¡è¯·æ±‚ã€‚</span></span><br><span class="line">    <span class="comment"># Kafka Consumer é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">consumer:</span></span><br><span class="line">      <span class="attr">auto-offset-reset:</span> <span class="string">earliest</span> <span class="comment"># è®¾ç½®æ¶ˆè´¹è€…åˆ†ç»„æœ€åˆçš„æ¶ˆè´¹è¿›åº¦ä¸º earliest ã€‚å¯å‚è€ƒåšå®¢ https://blog.csdn.net/lishuangzhe7047/article/details/74530417 ç†è§£</span></span><br><span class="line">      <span class="attr">key-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="attr">value-deserializer:</span> <span class="string">org.springframework.kafka.support.serializer.JsonDeserializer</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">spring:</span></span><br><span class="line">          <span class="attr">json:</span></span><br><span class="line">            <span class="attr">trusted:</span></span><br><span class="line">              <span class="attr">packages:</span> <span class="string">cn.iocoder.springboot.lab03.kafkademo.message</span></span><br><span class="line">    <span class="comment"># Kafka Consumer Listener ç›‘å¬å™¨é…ç½®</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">missing-topics-fatal:</span> <span class="literal">false</span> <span class="comment"># æ¶ˆè´¹ç›‘å¬æ¥å£ç›‘å¬çš„ä¸»é¢˜ä¸å­˜åœ¨æ—¶ï¼Œé»˜è®¤ä¼šæŠ¥é”™ã€‚æ‰€ä»¥é€šè¿‡è®¾ç½®ä¸º false ï¼Œè§£å†³æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">springframework:</span></span><br><span class="line">        <span class="attr">kafka:</span> <span class="string">ERROR</span> <span class="comment"># spring-kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span></span><br><span class="line">      <span class="attr">apache:</span></span><br><span class="line">        <span class="attr">kafka:</span> <span class="string">ERROR</span> <span class="comment"># kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p>ç›¸æ¯”</p>
<p>ã€Œ3.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€</p>
<p>æ¥è¯´ï¼Œé¢å¤–ä¸‰ä¸ªå‚æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬è¯´çš„ Producer æ‰¹é‡å‘é€çš„ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li><code>spring.kafka.producer.batch-size</code></li>
<li><code>spring.kafka.producer.buffer-memory</code></li>
<li><code>spring.kafka.producer.properties.linger.ms</code></li>
</ul>
</li>
<li><p>å…·ä½“çš„æ•°å€¼é…ç½®å¤šå°‘ï¼Œæ ¹æ®è‡ªå·±çš„åº”ç”¨æ¥ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ•…æ„å°† <code>linger.ms</code> é…ç½®æˆäº† 30 ç§’ï¼Œä¸»è¦ä¸ºäº†æ¼”ç¤ºä¹‹ç”¨ã€‚</p>
</li>
</ul>
<h2 id="4-3-Demo02Message"><a href="#4-3-Demo02Message" class="headerlink" title="4.3 Demo02Message"></a>4.3 Demo02Message</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message"><code>cn.iocoder.springboot.lab03.kafkademo.message</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-batch/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message/Demo02Message.java">Demo02Message</a> æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// Demo02Message.java</span><br><span class="line"></span><br><span class="line">public class Demo02Message &#123;</span><br><span class="line"></span><br><span class="line">    public static final String TOPIC = &quot;DEMO_012&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * ç¼–å·</span><br><span class="line">     */</span><br><span class="line">    private Integer id;</span><br><span class="line"></span><br><span class="line">    // ... çœç•¥ set/get/toString æ–¹æ³•</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>TOPIC</code> é™æ€å±æ€§ï¼Œæˆ‘ä»¬è®¾ç½®è¯¥æ¶ˆæ¯ç±»å¯¹åº” Topic ä¸º <code>&quot;DEMO_02&quot;</code> ã€‚</li>
<li>å…¶å®ƒéƒ½å’Œ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.4 Demo01Messageã€</a> æ˜¯ä¸€æ ·çš„ã€‚</li>
</ul>
<h2 id="4-4-Demo02Producer"><a href="#4-4-Demo02Producer" class="headerlink" title="4.4 Demo02Producer"></a>4.4 Demo02Producer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer"><code>cn.iocoder.springboot.lab03.kafkademo.producer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo02Producer.java">Demo02Producer</a> ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Kafka-Spring å°è£…æä¾›çš„ KafkaTemplate ï¼Œå®ç°ä¸€ä¸ªå¼‚æ­¥å‘é€æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo02Producer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02Producer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;Object, Object&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ListenableFuture&lt;SendResult&lt;Object, Object&gt;&gt; <span class="title function_">asyncSend</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Demo02Message æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Demo02Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo02Message</span>();</span><br><span class="line">        message.setId(id);</span><br><span class="line">        <span class="comment">// å¼‚æ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> kafkaTemplate.send(Demo02Message.TOPIC, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>çœ‹èµ·æ¥å’Œæˆ‘ä»¬åœ¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.5 Demo01Producerã€</a>æä¾›çš„å¼‚æ­¥å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œé™¤äº†æ¢æˆäº† Demo02Message æ¶ˆæ¯å¯¹è±¡ï¼Œå…¶å®ƒéƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚ğŸ˜ˆ å¯¹çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè‰¿è‰¿åœ¨ä¸Šæ–‡è¯´åˆ°ï¼ŒKafka æ˜¯â€œ<strong>å·å·</strong>â€æ”¶é›†æ¥å®ç°æ‰¹é‡å‘é€ï¼Œå¯¹äºæˆ‘ä»¬ä½¿ç”¨å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œè¿˜æ˜¯ä¸€è‡´çš„ã€‚</li>
<li>å› ä¸ºæˆ‘ä»¬å‘é€çš„æ¶ˆæ¯ Topic æ˜¯è‡ªåŠ¨åˆ›å»ºçš„ï¼Œæ‰€ä»¥å…¶ Partition åˆ†åŒºå¤§å°æ˜¯ <strong>1</strong> ã€‚è¿™æ ·ï¼Œå°±èƒ½ä¿è¯æˆ‘æ¯æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ»¡è¶³æ‰¹é‡å‘é€æ¶ˆæ¯çš„ä¸€ä¸ªå‰æï¼Œ<strong>ç›¸åŒ Topic çš„ç›¸åŒ Partition åˆ†åŒºçš„æ¶ˆæ¯ä»¬</strong>ã€‚</li>
</ul>
<h2 id="4-5-Demo02Consumer"><a href="#4-5-Demo02Consumer" class="headerlink" title="4.5 Demo02Consumer"></a>4.5 Demo02Consumer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer"><code>cn.iocoder.springboot.lab03.kafkademo.consumer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-batch/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/Demo02Consumer.java">Demo02Consumer</a> ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo02Consumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo02Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo02-consumer-group-&quot; + Demo02Message.TOPIC)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Demo02Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.6 Demo01Consumerã€</a>åŸºæœ¬ä¸€ç›´ï¼Œé™¤äº†æ˜¯ä¸åŒçš„æ¶ˆè´¹è€…åˆ†ç»„ï¼Œæ¶ˆè´¹äº†ä¸åŒçš„ Topic ã€‚</li>
</ul>
<h2 id="4-6-ç®€å•æµ‹è¯•"><a href="#4-6-ç®€å•æµ‹è¯•" class="headerlink" title="4.6 ç®€å•æµ‹è¯•"></a>4.6 ç®€å•æµ‹è¯•</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-batch/src/test/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo02ProducerTest.java">Demo02ProducerTest</a> æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯• Producer æ‰¹é‡å‘é€æ¶ˆæ¯çš„æ•ˆæœã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo02ProducerTest.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02ProducerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Demo02Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testASyncSend</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[testASyncSend][å¼€å§‹æ‰§è¡Œ]&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> (<span class="type">int</span>) (System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">            producer.asyncSend(id).addCallback(<span class="keyword">new</span> <span class="title class_">ListenableFutureCallback</span>&lt;SendResult&lt;Object, Object&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">                    logger.info(<span class="string">&quot;[testASyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€å¼‚å¸¸]]&quot;</span>, id, e);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(SendResult&lt;Object, Object&gt; result)</span> &#123;</span><br><span class="line">                    logger.info(<span class="string">&quot;[testASyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[&#123;&#125;]]&quot;</span>, id, result);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ•…æ„æ¯æ¡æ¶ˆæ¯ä¹‹é—´ï¼Œéš”ç¦» 10 ç§’</span></span><br><span class="line">            Thread.sleep(<span class="number">10</span> * <span class="number">1000L</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>å¼‚æ­¥å‘é€ä¸‰æ¡æ¶ˆæ¯ï¼Œæ¯æ¬¡å‘é€æ¶ˆæ¯ä¹‹é—´ï¼Œéƒ½æ•…æ„ sleep 10 ç§’ã€‚ğŸ˜ˆ ç›®çš„æ˜¯ï¼Œæ°å¥½æ»¡è¶³æˆ‘ä»¬é…ç½®çš„ <code>linger.ms</code> æœ€å¤§ç­‰å¾…æ—¶é•¿ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥æ‰§è¡Œ <code>#testASyncSend()</code> æ–¹æ³•ï¼Œæµ‹è¯•æ‰¹é‡å‘é€æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># æ‰“å° testASyncSend æ–¹æ³•å¼€å§‹æ‰§è¡Œçš„æ—¥å¿—</span><br><span class="line">2019-12-08 21:43:02.330  INFO 94957 --- [           main] c.i.s.l.k.producer.Demo02ProducerTest    : [testASyncSend][å¼€å§‹æ‰§è¡Œ]</span><br><span class="line"></span><br><span class="line"># 30 ç§’åï¼Œæ»¡è¶³æ‰¹é‡æ¶ˆæ¯çš„æœ€å¤§ç­‰å¾…æ—¶é•¿ï¼Œæ‰€ä»¥ 3 æ¡æ¶ˆæ¯è¢« Producer æ‰¹é‡å‘é€ã€‚</span><br><span class="line"># å› æ­¤æˆ‘ä»¬é…ç½®çš„æ˜¯ acks=1 ï¼Œéœ€è¦ç­‰å¾…å‘é€æˆåŠŸåï¼Œæ‰ä¼šå›è°ƒ ListenableFutureCallback çš„æ–¹æ³•ã€‚</span><br><span class="line">2019-12-08 21:43:32.424  INFO 94957 --- [ad | producer-1] c.i.s.l.k.producer.Demo02ProducerTest    : [testASyncSend][å‘é€ç¼–å·ï¼š[1575639782] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_02, partition=null, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [99, 110, 46, 105, 111, 99, 111, 100, 101, 114, 46, 115, 112, 114, 105, 110, 103, 98, 111, 111, 116, 46, 108, 97, 98, 48, 51, 46, 107, 97, 102, 107, 97, 100, 101, 109, 111, 46, 109, 101, 115, 115, 97, 103, 101, 46, 68, 101, 109, 111, 48, 50, 77, 101, 115, 115, 97, 103, 101])], isReadOnly = true), key=null, value=Demo01Message&#123;id=1575639782&#125;, timestamp=null), recordMetadata=DEMO_02-0@37]]]</span><br><span class="line">2019-12-08 21:43:32.425  INFO 94957 --- [ad | producer-1] c.i.s.l.k.producer.Demo02ProducerTest    : [testASyncSend][å‘é€ç¼–å·ï¼š[1575639792] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_02, partition=null, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [99, 110, 46, 105, 111, 99, 111, 100, 101, 114, 46, 115, 112, 114, 105, 110, 103, 98, 111, 111, 116, 46, 108, 97, 98, 48, 51, 46, 107, 97, 102, 107, 97, 100, 101, 109, 111, 46, 109, 101, 115, 115, 97, 103, 101, 46, 68, 101, 109, 111, 48, 50, 77, 101, 115, 115, 97, 103, 101])], isReadOnly = true), key=null, value=Demo01Message&#123;id=1575639792&#125;, timestamp=null), recordMetadata=DEMO_02-0@38]]]</span><br><span class="line">2019-12-08 21:43:32.425  INFO 94957 --- [ad | producer-1] c.i.s.l.k.producer.Demo02ProducerTest    : [testASyncSend][å‘é€ç¼–å·ï¼š[1575639802] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_02, partition=null, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [99, 110, 46, 105, 111, 99, 111, 100, 101, 114, 46, 115, 112, 114, 105, 110, 103, 98, 111, 111, 116, 46, 108, 97, 98, 48, 51, 46, 107, 97, 102, 107, 97, 100, 101, 109, 111, 46, 109, 101, 115, 115, 97, 103, 101, 46, 68, 101, 109, 111, 48, 50, 77, 101, 115, 115, 97, 103, 101])], isReadOnly = true), key=null, value=Demo01Message&#123;id=1575639802&#125;, timestamp=null), recordMetadata=DEMO_02-0@39]]]</span><br><span class="line"></span><br><span class="line"># å› ä¸º Producer æ‰¹é‡å‘é€å®Œæˆï¼Œæ‰€ä»¥ Demo02Consumer æ¶ˆè´¹åˆ°æ¶ˆæ¯</span><br><span class="line">2019-12-08 21:43:32.475  INFO 94957 --- [ntainer#0-0-C-1] c.i.s.l.k.consumer.Demo02Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:16 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=1575639782&#125;]</span><br><span class="line">2019-12-08 21:43:32.475  INFO 94957 --- [ntainer#0-0-C-1] c.i.s.l.k.consumer.Demo02Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:16 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=1575639792&#125;]</span><br><span class="line">2019-12-08 21:43:32.475  INFO 94957 --- [ntainer#0-0-C-1] c.i.s.l.k.consumer.Demo02Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:16 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=1575639802&#125;]</span><br></pre></td></tr></table></figure>



<ul>
<li>ğŸ˜ˆ èƒ–å‹è®¤çœŸçœ‹ä¸‹è‰¿è‰¿åœ¨æ—¥å¿—ä¸­çš„æ³¨é‡Šï¼Œç†è§£ä¸‹æ•´ä¸ªæ‰¹é‡å‘é€æ¶ˆæ¯çš„è¿‡ç¨‹ã€‚ä¸è¿‡è¿˜æ˜¯é‚£å¥è¯ï¼Œå®é™…åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸å¤ªä¼šæŠŠ <code>linger.ms</code> é…ç½®çš„è¿™ä¹ˆé•¿æ—¶é—´ï¼Œè¿™é‡Œä»…ä»…æ˜¯æ¼”ç¤ºã€‚</li>
</ul>
<h1 id="5-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯"><a href="#5-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="5. æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯"></a>5. æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch-consume">lab-03-kafka-demo-batch-consume</a> ã€‚</p>
</blockquote>
<p>åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Consumer æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦ã€‚è¦æ³¨æ„ï¼ŒConsumer çš„æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ï¼Œå’Œ Producer çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€</a> æ²¡æœ‰ç›´æ¥å…³è”å“ˆã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Consumer æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€</a> çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch">lab-03-kafka-demo-batch</a> é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œå¤åˆ¶å‡ºä¸€ä¸ª <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-batch-consume">lab-03-kafka-demo-batch-consume</a> é¡¹ç›®ã€‚ğŸ˜ˆ é…±ç´«ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å°‘å†™ç‚¹ä»£ç ï¼Œå“ˆå“ˆå“ˆ~</p>
<h2 id="5-1-åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#5-1-åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="5.1 åº”ç”¨é…ç½®æ–‡ä»¶"></a>5.1 åº”ç”¨é…ç½®æ–‡ä»¶</h2><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-batch-consume/src/main/resources/application.yaml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># Kafka é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProperties é…ç½®ç±»</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">bootstrap-servers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">    <span class="comment"># Kafka Producer é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">producer:</span></span><br><span class="line">      <span class="attr">acks:</span> <span class="number">1</span> <span class="comment"># 0-ä¸åº”ç­”ã€‚1-leader åº”ç­”ã€‚all-æ‰€æœ‰ leader å’Œ follower åº”ç­”ã€‚</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span> <span class="comment"># å‘é€å¤±è´¥æ—¶ï¼Œé‡è¯•å‘é€çš„æ¬¡æ•°</span></span><br><span class="line">      <span class="attr">key-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span> <span class="comment"># æ¶ˆæ¯çš„ key çš„åºåˆ—åŒ–</span></span><br><span class="line">      <span class="attr">value-serializer:</span> <span class="string">org.springframework.kafka.support.serializer.JsonSerializer</span> <span class="comment"># æ¶ˆæ¯çš„ value çš„åºåˆ—åŒ–</span></span><br><span class="line">      <span class="attr">batch-size:</span> <span class="number">16384</span> <span class="comment"># æ¯æ¬¡æ‰¹é‡å‘é€æ¶ˆæ¯çš„æœ€å¤§æ•°é‡</span></span><br><span class="line">      <span class="attr">buffer-memory:</span> <span class="number">33554432</span> <span class="comment"># æ¯æ¬¡æ‰¹é‡å‘é€æ¶ˆæ¯çš„æœ€å¤§å†…å­˜</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">linger:</span></span><br><span class="line">          <span class="attr">ms:</span> <span class="number">30000</span> <span class="comment"># æ‰¹å¤„ç†å»¶è¿Ÿæ—¶é—´ä¸Šé™ã€‚è¿™é‡Œé…ç½®ä¸º 30 * 1000 ms è¿‡åï¼Œä¸ç®¡æ˜¯å¦æ¶ˆæ¯æ•°é‡æ˜¯å¦åˆ°è¾¾ batch-size æˆ–è€…æ¶ˆæ¯å¤§å°åˆ°è¾¾ buffer-memory åï¼Œéƒ½ç›´æ¥å‘é€ä¸€æ¬¡è¯·æ±‚ã€‚</span></span><br><span class="line">    <span class="comment"># Kafka Consumer é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">consumer:</span></span><br><span class="line">      <span class="attr">auto-offset-reset:</span> <span class="string">earliest</span> <span class="comment"># è®¾ç½®æ¶ˆè´¹è€…åˆ†ç»„æœ€åˆçš„æ¶ˆè´¹è¿›åº¦ä¸º earliest ã€‚å¯å‚è€ƒåšå®¢ https://blog.csdn.net/lishuangzhe7047/article/details/74530417 ç†è§£</span></span><br><span class="line">      <span class="attr">key-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="attr">value-deserializer:</span> <span class="string">org.springframework.kafka.support.serializer.JsonDeserializer</span></span><br><span class="line">      <span class="attr">fetch-max-wait:</span> <span class="number">10000</span> <span class="comment"># poll ä¸€æ¬¡æ‹‰å–çš„é˜»å¡çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚è¿™é‡ŒæŒ‡çš„æ˜¯é˜»å¡æ‹‰å–éœ€è¦æ»¡è¶³è‡³å°‘ fetch-min-size å¤§å°çš„æ¶ˆæ¯</span></span><br><span class="line">      <span class="attr">fetch-min-size:</span> <span class="number">10</span> <span class="comment"># poll ä¸€æ¬¡æ¶ˆæ¯æ‹‰å–çš„æœ€å°æ•°æ®é‡ï¼Œå•ä½ï¼šå­—èŠ‚</span></span><br><span class="line">      <span class="attr">max-poll-records:</span> <span class="number">100</span> <span class="comment"># poll ä¸€æ¬¡æ¶ˆæ¯æ‹‰å–çš„æœ€å¤§æ•°é‡</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">spring:</span></span><br><span class="line">          <span class="attr">json:</span></span><br><span class="line">            <span class="attr">trusted:</span></span><br><span class="line">              <span class="attr">packages:</span> <span class="string">cn.iocoder.springboot.lab03.kafkademo.message</span></span><br><span class="line">    <span class="comment"># Kafka Consumer Listener ç›‘å¬å™¨é…ç½®</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">BATCH</span> <span class="comment"># ç›‘å¬å™¨ç±»å‹ï¼Œé»˜è®¤ä¸º SINGLE ï¼Œåªç›‘å¬å•æ¡æ¶ˆæ¯ã€‚è¿™é‡Œæˆ‘ä»¬é…ç½® BATCH ï¼Œç›‘å¬å¤šæ¡æ¶ˆæ¯ï¼Œæ‰¹é‡æ¶ˆè´¹</span></span><br><span class="line">      <span class="attr">missing-topics-fatal:</span> <span class="literal">false</span> <span class="comment"># æ¶ˆè´¹ç›‘å¬æ¥å£ç›‘å¬çš„ä¸»é¢˜ä¸å­˜åœ¨æ—¶ï¼Œé»˜è®¤ä¼šæŠ¥é”™ã€‚æ‰€ä»¥é€šè¿‡è®¾ç½®ä¸º false ï¼Œè§£å†³æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">springframework:</span></span><br><span class="line">        <span class="attr">kafka:</span> <span class="string">ERROR</span> <span class="comment"># spring-kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span></span><br><span class="line">      <span class="attr">apache:</span></span><br><span class="line">        <span class="attr">kafka:</span> <span class="string">ERROR</span> <span class="comment"># kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p>ç›¸æ¯”</p>
<p>ã€Œ3.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€</p>
<p>æ¥è¯´ï¼Œå¢åŠ äº†å››ä¸ªé…ç½®é¡¹ï¼Œèƒ–å‹è‡ªå·±æ ¹æ®æ³¨é‡Šï¼Œè‡ªå·±ç†è§£ä¸‹å™¢ã€‚</p>
<ul>
<li><code>spring.kafka.listener.type</code></li>
<li><code>spring.kafka.consumer.max-poll-records</code></li>
<li><code>spring.kafka.consumer.fetch-min-size</code></li>
<li><code>spring.kafka.consumer.fetch-max-wait</code></li>
</ul>
</li>
</ul>
<h2 id="5-2-Demo02Consumer"><a href="#5-2-Demo02Consumer" class="headerlink" title="5.2 Demo02Consumer"></a>5.2 Demo02Consumer</h2><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-batch-consume/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/Demo02Consumer.java">Demo02Consumer</a> æ¶ˆè´¹è€…ï¼Œæ”¹æˆæ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo02Consumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo02Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo02-consumer-group-&quot; + Demo02Message.TOPIC)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(List&lt;Demo02Message&gt; messages)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯æ•°é‡ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), messages.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>ç›¸æ¯”<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ4.5 Demo02Consumerã€</a>æ¥è¯´ï¼Œæ–¹æ³•ä¸Šçš„å‚æ•°å˜æˆäº† List æ•°ç»„ã€‚</li>
</ul>
<h2 id="5-3-ç®€å•æµ‹è¯•"><a href="#5-3-ç®€å•æµ‹è¯•" class="headerlink" title="5.3 ç®€å•æµ‹è¯•"></a>5.3 ç®€å•æµ‹è¯•</h2><p>è¿˜æ˜¯ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-batch-consume/src/test/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo02ProducerTest.java">Demo02ProducerTest</a> æµ‹è¯•ç±»ï¼Œæ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">12</span>-08 <span class="number">23</span>:<span class="number">00</span>:<span class="number">14.274</span>  INFO <span class="number">98637</span> --- [           main] c.i.s.l.k.producer.Demo02ProducerTest    : [testASyncSend][å¼€å§‹æ‰§è¡Œ]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-08 <span class="number">23</span>:<span class="number">00</span>:<span class="number">44.385</span>  INFO <span class="number">98637</span> --- [ad | producer-<span class="number">1</span>] c.i.s.l.k.producer.Demo02ProducerTest    : [testASyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1575644414</span>] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_02, partition=<span class="literal">null</span>, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [<span class="number">99</span>, <span class="number">110</span>, <span class="number">46</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">112</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">98</span>, <span class="number">111</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">46</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">68</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">48</span>, <span class="number">50</span>, <span class="number">77</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>])], isReadOnly = <span class="literal">true</span>), key=<span class="literal">null</span>, value=Demo01Message&#123;id=<span class="number">1575644414</span>&#125;, timestamp=<span class="literal">null</span>), recordMetadata=DEMO_02-<span class="number">0</span>@<span class="number">55</span>]]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-08 <span class="number">23</span>:<span class="number">00</span>:<span class="number">44.386</span>  INFO <span class="number">98637</span> --- [ad | producer-<span class="number">1</span>] c.i.s.l.k.producer.Demo02ProducerTest    : [testASyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1575644424</span>] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_02, partition=<span class="literal">null</span>, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [<span class="number">99</span>, <span class="number">110</span>, <span class="number">46</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">112</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">98</span>, <span class="number">111</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">46</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">68</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">48</span>, <span class="number">50</span>, <span class="number">77</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>])], isReadOnly = <span class="literal">true</span>), key=<span class="literal">null</span>, value=Demo01Message&#123;id=<span class="number">1575644424</span>&#125;, timestamp=<span class="literal">null</span>), recordMetadata=DEMO_02-<span class="number">0</span>@<span class="number">56</span>]]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-08 <span class="number">23</span>:<span class="number">00</span>:<span class="number">44.387</span>  INFO <span class="number">98637</span> --- [ad | producer-<span class="number">1</span>] c.i.s.l.k.producer.Demo02ProducerTest    : [testASyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1575644434</span>] å‘é€æˆåŠŸï¼Œç»“æœä¸ºï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_02, partition=<span class="literal">null</span>, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [<span class="number">99</span>, <span class="number">110</span>, <span class="number">46</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">112</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">98</span>, <span class="number">111</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">46</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">68</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">48</span>, <span class="number">50</span>, <span class="number">77</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>])], isReadOnly = <span class="literal">true</span>), key=<span class="literal">null</span>, value=Demo01Message&#123;id=<span class="number">1575644434</span>&#125;, timestamp=<span class="literal">null</span>), recordMetadata=DEMO_02-<span class="number">0</span>@<span class="number">57</span>]]]</span><br><span class="line"></span><br><span class="line"># æ‰¹é‡æ¶ˆè´¹äº† <span class="number">3</span> æ¡æ¶ˆæ¯</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-08 <span class="number">23</span>:<span class="number">00</span>:<span class="number">44.425</span>  INFO <span class="number">98637</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo02Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯æ•°é‡ï¼š<span class="number">3</span>]</span><br></pre></td></tr></table></figure>



<ul>
<li>ä»æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå‘é€çš„ 3 æ¡æ¶ˆæ¯è¢« Demo02Consumer æ‰¹é‡æ¶ˆè´¹äº†ã€‚</li>
<li>ğŸ˜ˆ ä¸ºäº†æ›´å¥½çš„åšå¯¹æ¯”ï¼Œèƒ–å‹å¯ä»¥å°è¯•è‡ªè¡ŒæŠŠé…ç½®æ”¹æˆ <code>spring.kafka.listener.type=SINGLE</code> ï¼Œå°±ä¼šå‘ç° Demo02Consumer åªä¼šå•æ¡æ¶ˆè´¹äº†ã€‚</li>
</ul>
<h1 id="6-å®šæ—¶æ¶ˆæ¯"><a href="#6-å®šæ—¶æ¶ˆæ¯" class="headerlink" title="6. å®šæ—¶æ¶ˆæ¯"></a>6. å®šæ—¶æ¶ˆæ¯</h1><p><strong>Kafka å¹¶æœªæä¾›å®šæ—¶æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œéœ€è¦æˆ‘ä»¬è‡ªè¡Œæ‹“å±•</strong>ã€‚</p>
<p>ä¾‹å¦‚è¯´<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Fight/delayed-message-consume-service-use-kafka/?self">ã€ŠåŸºäº Kafka çš„å®šæ—¶æ¶ˆæ¯&#x2F;ä»»åŠ¡æœã€‹</a>æ–‡ç« ï¼Œæä¾›çš„æ–¹æ¡ˆã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åŸºäº MySQL å­˜å‚¨å®šæ—¶æ¶ˆæ¯ï¼ŒJob æ‰«æåˆ°è¾¾æ—¶é—´çš„å®šæ—¶æ¶ˆæ¯ï¼Œå‘é€ç»™ Kafka ã€‚</p>
<h1 id="7-æ¶ˆè´¹é‡è¯•"><a href="#7-æ¶ˆè´¹é‡è¯•" class="headerlink" title="7. æ¶ˆè´¹é‡è¯•"></a>7. æ¶ˆè´¹é‡è¯•</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo">lab-31-kafka-demo</a> ã€‚</p>
</blockquote>
<p>Spring-Kafka æä¾›<strong>æ¶ˆè´¹é‡è¯•</strong>çš„æœºåˆ¶ã€‚åœ¨æ¶ˆæ¯<strong>æ¶ˆè´¹å¤±è´¥</strong>çš„æ—¶å€™ï¼ŒSpring-Kafka ä¼šé€šè¿‡<strong>æ¶ˆè´¹é‡è¯•</strong>æœºåˆ¶ï¼Œé‡æ–°æŠ•é€’è¯¥æ¶ˆæ¯ç»™ Consumer ï¼Œè®© Consumer æœ‰æœºä¼šé‡æ–°æ¶ˆè´¹æ¶ˆæ¯ï¼Œå®ç°æ¶ˆè´¹æˆåŠŸã€‚</p>
<p>å½“ç„¶ï¼ŒSpring-Kafka å¹¶ä¸ä¼šæ— é™é‡æ–°æŠ•é€’æ¶ˆæ¯ç»™ Consumer é‡æ–°æ¶ˆè´¹ï¼Œè€Œæ˜¯åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾¾åˆ° N æ¬¡é‡è¯•æ¬¡æ•°æ—¶ï¼ŒConsumer è¿˜æ˜¯æ¶ˆè´¹å¤±è´¥æ—¶ï¼Œè¯¥æ¶ˆæ¯å°±ä¼šè¿›å…¥åˆ°<strong>æ­»ä¿¡é˜Ÿåˆ—</strong>ã€‚</p>
<blockquote>
<p>æ­»ä¿¡é˜Ÿåˆ—ç”¨äºå¤„ç†æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚å½“ä¸€æ¡æ¶ˆæ¯åˆæ¬¡æ¶ˆè´¹å¤±è´¥ï¼ŒSpring-Kafka ä¼šè‡ªåŠ¨è¿›è¡Œæ¶ˆæ¯é‡è¯•ï¼›è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œè‹¥æ¶ˆè´¹ä¾ç„¶å¤±è´¥ï¼Œåˆ™è¡¨æ˜æ¶ˆè´¹è€…åœ¨æ­£å¸¸æƒ…å†µä¸‹æ— æ³•æ­£ç¡®åœ°æ¶ˆè´¹è¯¥æ¶ˆæ¯ï¼Œæ­¤æ—¶ï¼ŒSpring-Kafka ä¸ä¼šç«‹åˆ»å°†æ¶ˆæ¯ä¸¢å¼ƒï¼Œè€Œæ˜¯å°†å…¶å‘é€åˆ°è¯¥æ¶ˆè´¹è€…å¯¹åº”çš„ç‰¹æ®Šé˜Ÿåˆ—ä¸­ã€‚</p>
<p>Spring-Kafka å°†è¿™ç§æ­£å¸¸æƒ…å†µä¸‹æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ç§°ä¸ºæ­»ä¿¡æ¶ˆæ¯ï¼ˆDead-Letter Messageï¼‰ï¼Œå°†å­˜å‚¨æ­»ä¿¡æ¶ˆæ¯çš„ç‰¹æ®Šé˜Ÿåˆ—ç§°ä¸ºæ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead-Letter Queueï¼‰ã€‚åç»­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è¿›è¡Œé‡å‘ï¼Œæ¥ä½¿å¾—æ¶ˆè´¹è€…å®ä¾‹å†æ¬¡è¿›è¡Œæ¶ˆè´¹ã€‚</p>
</blockquote>
<ul>
<li>åœ¨<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/RocketMQ/?self">ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— RocketMQ å…¥é—¨ã€‹</a>çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ6. æ¶ˆè´¹é‡è¯•ã€</a>å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆè´¹é‡è¯•å’Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ˜¯ RocketMQ è‡ªå¸¦çš„åŠŸèƒ½ã€‚</li>
<li>è€Œåœ¨ Kafka ä¸­ï¼Œæ¶ˆè´¹é‡è¯•å’Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ˜¯ç”± Spring-Kafka æ‰€å°è£…æä¾›çš„ã€‚</li>
</ul>
<p>æ¯æ¡æ¶ˆæ¯çš„å¤±è´¥é‡è¯•ï¼Œæ˜¯å¯ä»¥é…ç½®ä¸€å®šçš„<strong>é—´éš”æ—¶é—´</strong>ã€‚å…·ä½“ï¼Œæˆ‘ä»¬åœ¨ç¤ºä¾‹çš„ä»£ç ä¸­ï¼Œæ¥è¿›è¡Œå…·ä½“çš„è§£é‡Šã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æœ¬å°èŠ‚çš„ç¤ºä¾‹ã€‚è¯¥ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä¼šåœ¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo">lab-31-kafka-demo</a> é¡¹ç›®ä¸­ï¼Œç»§ç»­æ”¹é€ ã€‚</p>
<h2 id="7-1-KafkaConfiguration"><a href="#7-1-KafkaConfiguration" class="headerlink" title="7.1 KafkaConfiguration"></a>7.1 KafkaConfiguration</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/config"><code>cn.iocoder.springboot.lab03.kafkademo.config</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/config/KafkaConfiguration.java">KafkaConfiguration</a> é…ç½®ç±»ï¼Œå¢åŠ æ¶ˆè´¹å¼‚å¸¸çš„ ErrorHandler å¤„ç†å™¨ ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// KafkaConfiguration.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> ErrorHandler <span class="title function_">kafkaErrorHandler</span><span class="params">(KafkaTemplate&lt;?, ?&gt; template)</span> &#123;</span><br><span class="line">        <span class="comment">// &lt;1&gt; åˆ›å»º DeadLetterPublishingRecoverer å¯¹è±¡</span></span><br><span class="line">        <span class="type">ConsumerRecordRecoverer</span> <span class="variable">recoverer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeadLetterPublishingRecoverer</span>(template);</span><br><span class="line">        <span class="comment">// &lt;2&gt; åˆ›å»º FixedBackOff å¯¹è±¡</span></span><br><span class="line">        <span class="type">BackOff</span> <span class="variable">backOff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FixedBackOff</span>(<span class="number">10</span> * <span class="number">1000L</span>, <span class="number">3L</span>);</span><br><span class="line">        <span class="comment">// &lt;3&gt; åˆ›å»º SeekToCurrentErrorHandler å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SeekToCurrentErrorHandler</span>(recoverer, backOff);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>Spring-Kafka çš„æ¶ˆè´¹é‡è¯•åŠŸèƒ½ï¼Œé€šè¿‡å®ç°è‡ªå®šä¹‰çš„</p>
<p>SeekToCurrentErrorHandler</p>
<p>ï¼Œåœ¨ Consumer æ¶ˆè´¹æ¶ˆæ¯å¼‚å¸¸çš„æ—¶å€™ï¼Œè¿›è¡Œæ‹¦æˆªå¤„ç†ï¼š</p>
<ul>
<li>åœ¨é‡è¯•å°äºæœ€å¤§æ¬¡æ•°æ—¶ï¼Œé‡æ–°æŠ•é€’è¯¥æ¶ˆæ¯ç»™ Consumer ï¼Œè®© Consumer æœ‰æœºä¼šé‡æ–°æ¶ˆè´¹æ¶ˆæ¯ï¼Œå®ç°æ¶ˆè´¹æˆåŠŸã€‚</li>
<li>åœ¨é‡è¯•åˆ°è¾¾æœ€å¤§æ¬¡æ•°æ—¶ï¼ŒConsumer è¿˜æ˜¯æ¶ˆè´¹å¤±è´¥æ—¶ï¼Œè¯¥æ¶ˆæ¯å°±ä¼šå‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚ä¾‹å¦‚è¯´ï¼Œæœ¬å°èŠ‚æˆ‘ä»¬æµ‹è¯•çš„ Topic æ˜¯ <code>&quot;DEMO_04&quot;</code> ï¼Œåˆ™å…¶å¯¹åº”çš„æ­»ä¿¡é˜Ÿåˆ—çš„ Topic å°±æ˜¯ <code>&quot;DEMO_04.DLT&quot;</code> ï¼Œå³åœ¨åŸæœ‰ Topic åŠ ä¸Š <code>.DLT</code> åç¼€ï¼Œå°±æ˜¯å…¶æ­»ä¿¡é˜Ÿåˆ—çš„ Topic ã€‚</li>
</ul>
</li>
<li><p><code>&lt;1&gt;</code> å¤„ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/listener/DeadLetterPublishingRecoverer.java">DeadLetterPublishingRecoverer</a> å¯¹è±¡ï¼Œå®ƒè´Ÿè´£å®ç°ï¼Œåœ¨é‡è¯•åˆ°è¾¾æœ€å¤§æ¬¡æ•°æ—¶ï¼ŒConsumer è¿˜æ˜¯æ¶ˆè´¹å¤±è´¥æ—¶ï¼Œè¯¥æ¶ˆæ¯å°±ä¼šå‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚</p>
</li>
<li><p><code>&lt;2&gt;</code> å¤„ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/util/backoff/FixedBackOff.java">FixedBackOff</a> å¯¹è±¡ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é…ç½®äº†é‡è¯• 3 æ¬¡ï¼Œæ¯æ¬¡å›ºå®šé—´éš” 30 ç§’ã€‚å½“ç„¶ï¼Œèƒ–å‹å¯ä»¥é€‰æ‹© <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/util/backoff/BackOff.java">BackOff</a> çš„å¦ä¸€ä¸ªå­ç±» <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/util/backoff/ExponentialBackOff.java">ExponentialBackOff</a> å®ç°ï¼Œæä¾›<a target="_blank" rel="noopener" href="http://note.huangz.me/algorithm/arithmetic/exponential-backoff.html">æŒ‡æ•°é€’å¢çš„é—´éš”æ—¶é—´</a>ã€‚</p>
</li>
<li><p><code>&lt;3&gt;</code> å¤„ï¼Œåˆ›å»º SeekToCurrentErrorHandler å¯¹è±¡ï¼Œè´Ÿè´£å¤„ç†å¼‚å¸¸ï¼Œä¸²è”æ•´ä¸ªæ¶ˆè´¹é‡è¯•çš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p>
</li>
</ul>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬æ¥ç®€å•è¯´è¯´ SeekToCurrentErrorHandler æ˜¯æ€ä¹ˆæä¾›æ¶ˆè´¹é‡è¯•çš„åŠŸèƒ½çš„ã€‚</p>
<ul>
<li><p>åœ¨æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥æ—¶ï¼ŒSeekToCurrentErrorHandler ä¼šå°† è°ƒç”¨ Kafka Consumer çš„ <a target="_blank" rel="noopener" href="https://github.com/axbaretto/kafka/blob/master/clients/src/main/java/org/apache/kafka/clients/consumer/Consumer.java#L124-L132"><code>#seek(TopicPartition partition, long offset)</code></a> æ–¹æ³•ï¼Œå°† Consumer å¯¹äºè¯¥æ¶ˆæ¯å¯¹åº”çš„ TopicPartition åˆ†åŒºçš„<strong>æœ¬åœ°</strong>è¿›åº¦è®¾ç½®æˆ<strong>è¯¥æ¶ˆæ¯çš„ä½ç½®</strong>ã€‚è¿™æ ·ï¼ŒConsumer åœ¨ä¸‹æ¬¡ä» Kafka Broker æ‹‰å–æ¶ˆæ¯çš„æ—¶å€™ï¼Œåˆèƒ½é‡æ–°æ‹‰å–åˆ°è¿™æ¡æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”æ˜¯ç¬¬ä¸€æ¡ã€‚</p>
</li>
<li><p>åŒæ—¶ï¼ŒSpring-Kafka ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/listener/FailedRecordTracker.java">FailedRecordTracker</a> å¯¹æ¯ä¸ª Topic çš„æ¯ä¸ª TopicPartition æ¶ˆè´¹å¤±è´¥æ¬¡æ•°è¿›è¡Œ<strong>è®¡æ•°</strong>ï¼Œè¿™æ ·ç›¸å½“äºå¯¹è¯¥ TopicPartition çš„<strong>ç¬¬ä¸€æ¡</strong>æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯çš„æ¶ˆè´¹å¤±è´¥æ¬¡æ•°è¿›è¡Œ<strong>è®¡æ•°</strong>ã€‚ğŸ˜ˆ è¿™é‡Œï¼Œèƒ–å‹å¥½å¥½æ€è€ƒä¸‹ï¼Œç»“åˆè‰¿è‰¿åœ¨ä¸Šä¸€ç‚¹çš„æè¿°ã€‚</p>
</li>
<li><p>å¦å¤–ï¼Œåœ¨ FailedRecordTracker ä¸­ï¼Œä¼šè°ƒç”¨ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/util/backoff/BackOff.java">BackOff</a> æ¥è¿›è¡Œè®¡ç®—ï¼Œè¯¥æ¶ˆæ¯çš„<strong>ä¸‹ä¸€æ¬¡é‡æ–°æ¶ˆè´¹çš„æ—¶é—´</strong>ï¼Œé€šè¿‡ <code>Thread#sleep(...)</code> æ–¹æ³•ï¼Œå®ç°é‡æ–°æ¶ˆè´¹çš„æ—¶é—´é—´éš”ã€‚</p>
</li>
<li><p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒFailedRecordTracker æä¾›çš„è®¡æ•°æ˜¯<strong>å®¢æˆ·ç«¯</strong>çº§åˆ«çš„ï¼Œé‡å¯ JVM åº”ç”¨åï¼Œè®¡æ•°æ˜¯ä¼šä¸¢å¤±çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³è¦è®¡æ•°è¿›è¡ŒæŒä¹…åŒ–ï¼Œéœ€è¦è‡ªå·±é‡æ–°å®ç°ä¸‹ FailedRecordTracker ç±»ï¼Œé€šè¿‡ ZooKeeper å­˜å‚¨è®¡æ•°ã€‚</p>
<blockquote>
<p>ğŸ˜ˆ RocketMQ æä¾›çš„æ¶ˆè´¹é‡è¯•çš„è®¡æ•°ï¼Œç›®å‰æ˜¯<strong>æœåŠ¡ç«¯</strong>çº§åˆ«ï¼Œå·²ç»è¿›è¡ŒæŒä¹…åŒ–ã€‚</p>
</blockquote>
</li>
</ul>
<p>å¯¹äº†ï¼ŒSeekToCurrentErrorHandler æ˜¯åª<strong>é’ˆå¯¹</strong>æ¶ˆæ¯çš„<strong>å•æ¡</strong>æ¶ˆè´¹å¤±è´¥çš„æ¶ˆè´¹é‡è¯•å¤„ç†ã€‚å¦‚æœèƒ–å‹æƒ³è¦æœ‰æ¶ˆæ¯çš„<strong>æ‰¹é‡</strong>æ¶ˆè´¹å¤±è´¥çš„æ¶ˆè´¹é‡è¯•å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/listener/SeekToCurrentBatchErrorHandler.java">SeekToCurrentBatchErrorHandler</a> ã€‚é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> BatchErrorHandler <span class="title function_">kafkaBatchErrorHandler</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º SeekToCurrentBatchErrorHandler å¯¹è±¡</span></span><br><span class="line">    <span class="type">SeekToCurrentBatchErrorHandler</span> <span class="variable">batchErrorHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeekToCurrentBatchErrorHandler</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»º FixedBackOff å¯¹è±¡</span></span><br><span class="line">    <span class="type">BackOff</span> <span class="variable">backOff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FixedBackOff</span>(<span class="number">10</span> * <span class="number">1000L</span>, <span class="number">3L</span>);</span><br><span class="line">    batchErrorHandler.setBackOff(backOff);</span><br><span class="line">    <span class="comment">// è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> batchErrorHandler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¹¶æ²¡æœ‰è®¾ç½® DeadLetterPublishingRecoverer å¯¹è±¡ã€‚å› ä¸º SeekToCurrentBatchErrorHandler æš‚æ—¶ä¸æ”¯æŒæ­»ä¿¡é˜Ÿåˆ—çš„æœºåˆ¶ã€‚</li>
</ul>
<p>å¦å¤–ï¼Œå¦‚æœèƒ–å‹æƒ³è¦è‡ªå®šä¹‰ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/listener/ErrorHandler.java">ErrorHandler</a> æˆ– <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/listener/BatchErrorHandler.java">BatchErrorHandler</a> å®ç°ç±»ï¼Œå®ç°å¯¹æ¶ˆè´¹å¼‚å¸¸çš„è‡ªå®šä¹‰çš„é€»è¾‘ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<ul>
<li>å®ç°çš„ä»£ç çš„ç¤ºä¾‹ï¼Œå¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/listener/LoggingErrorHandler.java">LoggingErrorHandler</a> ç±»ã€‚</li>
<li>é…ç½®çš„æ–¹å¼ï¼Œå’Œæœ¬å°èŠ‚é…ç½® SeekToCurrentErrorHandler æˆ– SeekToCurrentBatchErrorHandler æ˜¯ä¸€æ ·çš„ã€‚</li>
<li>å½“ç„¶ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ SeekToCurrentErrorHandler æˆ– SeekToCurrentBatchErrorHandler æ˜¯è¶³å¤Ÿçš„ã€‚</li>
</ul>
<blockquote>
<p>è‰¿è‰¿ï¼šè²Œä¼¼æœ¬å°èŠ‚ä¿¡æ¯é‡ï¼Œç•¥å¾®æœ‰ä¸€ç‚¹ç‚¹å¤§ï¼Œèƒ–å‹å¯ä»¥è‡ªå·±å¥½å¥½æ¶ˆåŒ–ä¸‹ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥è°ƒè¯•ä¸‹æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°çš„æºç ï¼Œæ›´åŠ å…·è±¡ä¸‹ã€‚ã€Œæºç ä¹‹å‰ï¼Œäº†æ— ç§˜å¯†ã€ã€‚</p>
</blockquote>
<h2 id="7-2-Demo04Message"><a href="#7-2-Demo04Message" class="headerlink" title="7.2 Demo04Message"></a>7.2 Demo04Message</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message"><code>cn.iocoder.springboot.lab03.kafkademo.message</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message/Demo04Message.java">Demo04Message</a> æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo04Message.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04Message</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC</span> <span class="operator">=</span> <span class="string">&quot;DEMO_04&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–å·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... çœç•¥ set/get/toString æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>TOPIC</code> é™æ€å±æ€§ï¼Œæˆ‘ä»¬è®¾ç½®è¯¥æ¶ˆæ¯ç±»å¯¹åº” Topic ä¸º <code>&quot;DEMO_04&quot;</code> ã€‚</li>
</ul>
<h2 id="7-3-Demo04Producer"><a href="#7-3-Demo04Producer" class="headerlink" title="7.3 Demo04Producer"></a>7.3 Demo04Producer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer"><code>cn.iocoder.springboot.lab03.kafkademo.producer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo04Producer.java">Demo04Producer</a> ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Kafka-Spring å°è£…æä¾›çš„ KafkaTemplate ï¼ŒåŒæ­¥å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo04Producer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04Producer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;Object, Object&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SendResult <span class="title function_">syncSend</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Demo04Message æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Demo04Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo04Message</span>();</span><br><span class="line">        message.setId(id);</span><br><span class="line">        <span class="comment">// åŒæ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> kafkaTemplate.send(Demo04Message.TOPIC, message).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.5 Demo01Producerã€</a>çš„åŒæ­¥å‘é€æ¶ˆæ¯çš„ä»£ç æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯æ¢æˆäº† Demo04Message ã€‚</li>
</ul>
<h2 id="7-4-Demo04Consumer"><a href="#7-4-Demo04Consumer" class="headerlink" title="7.4 Demo04Consumer"></a>7.4 Demo04Consumer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/"><code>cn.iocoder.springboot.lab03.kafkademo.consumer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/Demo04Consumer.java">Demo04Consumer</a> ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo04Consumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo04Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo04-consumer-group-&quot; + Demo04Message.TOPIC)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Demo04Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">        <span class="comment">// &lt;X&gt; æ³¨æ„ï¼Œæ­¤å¤„æŠ›å‡ºä¸€ä¸ª RuntimeException å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿæ¶ˆè´¹å¤±è´¥</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æˆ‘å°±æ˜¯æ•…æ„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>åœ¨ <code>&lt;X&gt;</code> å¤„ï¼Œæˆ‘ä»¬åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶å€™ï¼ŒæŠ›å‡ºä¸€ä¸ª RuntimeException å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿæ¶ˆè´¹å¤±è´¥ã€‚</li>
</ul>
<h2 id="7-5-ç®€å•æµ‹è¯•"><a href="#7-5-ç®€å•æµ‹è¯•" class="headerlink" title="7.5 ç®€å•æµ‹è¯•"></a>7.5 ç®€å•æµ‹è¯•</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo/src/test/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo04ProducerTest.java">Demo04ProducerTest</a> æµ‹è¯•ç±»ï¼Œç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo04Producer åŒæ­¥å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo04ProducerTest.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo04ProducerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Demo04Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSyncSend</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> (<span class="type">int</span>) (System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">        <span class="type">SendResult</span> <span class="variable">result</span> <span class="operator">=</span> producer.syncSend(id);</span><br><span class="line">        logger.info(<span class="string">&quot;[testSyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€ç»“æœï¼š[&#123;&#125;]]&quot;</span>, id, result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬æ¥æ‰§è¡Œ <code>#testSyncSend()</code> æ–¹æ³•ï¼ŒåŒæ­¥å‘é€æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸ</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">10</span>:<span class="number">24</span>:<span class="number">18.851</span>  INFO <span class="number">11359</span> --- [           main] c.i.s.l.k.producer.Demo04ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1575685458</span>] å‘é€ç»“æœï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_04, partition=<span class="literal">null</span>, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [<span class="number">99</span>, <span class="number">110</span>, <span class="number">46</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">112</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">98</span>, <span class="number">111</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">46</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">68</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">48</span>, <span class="number">52</span>, <span class="number">77</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>])], isReadOnly = <span class="literal">true</span>), key=<span class="literal">null</span>, value=Demo04Message&#123;id=<span class="number">1575685458</span>&#125;, timestamp=<span class="literal">null</span>), recordMetadata=DEMO_04-<span class="number">0</span>@<span class="number">0</span>]]]</span><br><span class="line"></span><br><span class="line"># Consumer04 é¦–æ¬¡æ¶ˆè´¹</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">10</span>:<span class="number">24</span>:<span class="number">18.918</span>  INFO <span class="number">11359</span> --- [ntainer#<span class="number">2</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo04Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo04Message&#123;id=<span class="number">1575685458</span>&#125;]</span><br><span class="line"># æ‰“å°å¼‚å¸¸</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">10</span>:<span class="number">24</span>:<span class="number">28.927</span> ERROR <span class="number">11359</span> --- [ntainer#<span class="number">2</span>-<span class="number">0</span>-C-<span class="number">1</span>] essageListenerContainer$ListenerConsumer : Error handler threw an exception</span><br><span class="line"></span><br><span class="line"># Consumer04 ç¬¬ä¸€æ¬¡é‡è¯•æ¶ˆè´¹</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">10</span>:<span class="number">24</span>:<span class="number">28.929</span>  INFO <span class="number">11359</span> --- [ntainer#<span class="number">2</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo04Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo04Message&#123;id=<span class="number">1575685458</span>&#125;]</span><br><span class="line"># æ‰“å°å¼‚å¸¸</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">10</span>:<span class="number">24</span>:<span class="number">38.932</span> ERROR <span class="number">11359</span> --- [ntainer#<span class="number">2</span>-<span class="number">0</span>-C-<span class="number">1</span>] essageListenerContainer$ListenerConsumer : Error handler threw an exception</span><br><span class="line"></span><br><span class="line"># Consumer04 ç¬¬äºŒæ¬¡é‡è¯•æ¶ˆè´¹</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">10</span>:<span class="number">24</span>:<span class="number">38.934</span>  INFO <span class="number">11359</span> --- [ntainer#<span class="number">2</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo04Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo04Message&#123;id=<span class="number">1575685458</span>&#125;]</span><br><span class="line"># æ‰“å°å¼‚å¸¸</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">10</span>:<span class="number">24</span>:<span class="number">48.939</span> ERROR <span class="number">11359</span> --- [ntainer#<span class="number">2</span>-<span class="number">0</span>-C-<span class="number">1</span>] essageListenerContainer$ListenerConsumer : Error handler threw an exception</span><br><span class="line"></span><br><span class="line"># Consumer04 ç¬¬ä¸‰æ¬¡é‡è¯•æ¶ˆè´¹</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">10</span>:<span class="number">24</span>:<span class="number">48.941</span>  INFO <span class="number">11359</span> --- [ntainer#<span class="number">2</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo04Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo04Message&#123;id=<span class="number">1575685458</span>&#125;]</span><br><span class="line"># è¿™æ¬¡ä¸ä¼šæ‰“å°å¼‚å¸¸æ—¥å¿—ï¼Œç›´æ¥å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—</span><br></pre></td></tr></table></figure>



<ul>
<li>ä»æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå‘é€çš„è¿™æ¡æ¶ˆæ¯è¢« Demo04Consumer é¦–æ¬¡æ¶ˆè´¹å¤±è´¥åï¼Œæ¯é—´éš” 10 ç§’ï¼Œåˆæ¶ˆè´¹é‡è¯• 3 æ¬¡ã€‚</li>
</ul>
<h1 id="8-å¹¿æ’­æ¶ˆè´¹"><a href="#8-å¹¿æ’­æ¶ˆè´¹" class="headerlink" title="8. å¹¿æ’­æ¶ˆè´¹"></a>8. å¹¿æ’­æ¶ˆè´¹</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-broadcast">lab-03-kafka-demo-broadcast</a> ã€‚</p>
</blockquote>
<p>åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„éƒ½æ˜¯ä½¿ç”¨é›†ç¾¤æ¶ˆè´¹ã€‚è€Œåœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<strong>å¹¿æ’­æ¶ˆè´¹</strong>ã€‚</p>
<blockquote>
<p>å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒ Consumer Group çš„æ¯ä¸ª Consumer å®ä¾‹éƒ½æ¥æ”¶å…¨é‡çš„æ¶ˆæ¯ã€‚</p>
</blockquote>
<ul>
<li>ä¸è¿‡ Kafka å¹¶ä¸ç›´æ¥æä¾›<strong>å†…ç½®çš„</strong>å¹¿æ’­æ¶ˆè´¹çš„åŠŸèƒ½ï¼ï¼ï¼æ­¤æ—¶ï¼Œæˆ‘ä»¬åªèƒ½é€€è€Œæ±‚å…¶æ¬¡ï¼Œæ¯ä¸ª Consumer <strong>ç‹¬æœ‰</strong>ä¸€ä¸ª Consumer Group ï¼Œä»è€Œä¿è¯éƒ½èƒ½æ¥æ”¶åˆ°å…¨é‡çš„æ¶ˆæ¯ã€‚</li>
</ul>
<p>ä¾‹å¦‚è¯´ï¼Œåœ¨åº”ç”¨ä¸­ï¼Œç¼“å­˜äº†æ•°æ®å­—å…¸ç­‰é…ç½®è¡¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥é€šè¿‡ Kafka å¹¿æ’­æ¶ˆè´¹ï¼Œå®ç°æ¯ä¸ªåº”ç”¨èŠ‚ç‚¹éƒ½æ¶ˆè´¹æ¶ˆæ¯ï¼Œåˆ·æ–°æœ¬åœ°å†…å­˜çš„ç¼“å­˜ã€‚</p>
<p>åˆä¾‹å¦‚è¯´ï¼Œæˆ‘ä»¬åŸºäº WebSocket å®ç°äº† IM èŠå¤©ï¼Œåœ¨æˆ‘ä»¬ç»™ç”¨æˆ·ä¸»åŠ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ç”¨æˆ·è¿æ¥çš„æ˜¯å“ªä¸ªæä¾› WebSocket çš„åº”ç”¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ Kafka å¹¿æ’­æ¶ˆè´¹ï¼Œæ¯ä¸ªåº”ç”¨åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯å’Œè‡ªå·±æä¾›çš„ WebSocket æœåŠ¡è¿æ¥ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ¨é€æ¶ˆæ¯ç»™ç”¨æˆ·ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æœ¬å°èŠ‚çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-broadcast">lab-03-kafka-demo-broadcast</a> é¡¹ç›®ã€‚</p>
<h2 id="8-1-å¼•å…¥ä¾èµ–"><a href="#8-1-å¼•å…¥ä¾èµ–" class="headerlink" title="8.1 å¼•å…¥ä¾èµ–"></a>8.1 å¼•å…¥ä¾èµ–</h2><p>å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.1 å¼•å…¥ä¾èµ–ã€ã€</a>ä¸€è‡´ï¼Œè§ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-broadcast/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ã€‚</p>
<h2 id="8-2-åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#8-2-åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="8.2 åº”ç”¨é…ç½®æ–‡ä»¶"></a>8.2 åº”ç”¨é…ç½®æ–‡ä»¶</h2><p>åœ¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€</a> æ˜¯ä¸€è‡´çš„è®¢å•ï¼Œå°±æ˜¯ä¿®æ”¹äº†é…ç½®é¡¹ <code>spring.kafka.consumer.auto-offset-reset=latest</code> ã€‚å› ä¸ºåœ¨å¹¿æ’­è®¢é˜…ä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ— éœ€æ¶ˆè´¹å†å²çš„æ¶ˆæ¯ï¼Œè€Œæ˜¯ä»è®¢é˜…çš„ Topic çš„é˜Ÿåˆ—çš„å°¾éƒ¨å¼€å§‹æ¶ˆè´¹å³å¯ï¼Œæ‰€ä»¥é…ç½®ä¸º <code>latest</code> ã€‚</p>
<p>å®Œæ•´çš„é…ç½®æ–‡ä»¶ï¼Œè§ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-broadcast/src/main/resources/application.yaml"><code>application.yaml</code></a> ã€‚</p>
<h2 id="8-3-Demo05Message"><a href="#8-3-Demo05Message" class="headerlink" title="8.3 Demo05Message"></a>8.3 Demo05Message</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-broadcast/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message"><code>cn.iocoder.springboot.lab03.kafkademo.message</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-broadcast/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message/Demo05Message.java">Demo05Message</a> æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo05Message.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo05Message</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC</span> <span class="operator">=</span> <span class="string">&quot;DEMO_05&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–å·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... çœç•¥ set/get/toString æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>TOPIC</code> é™æ€å±æ€§ï¼Œæˆ‘ä»¬è®¾ç½®è¯¥æ¶ˆæ¯ç±»å¯¹åº” Topic ä¸º <code>&quot;DEMO_05&quot;</code> ã€‚</li>
</ul>
<h2 id="8-4-Demo05Producer"><a href="#8-4-Demo05Producer" class="headerlink" title="8.4 Demo05Producer"></a>8.4 Demo05Producer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-broadcast/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer"><code>cn.iocoder.springboot.lab03.kafkademo.producer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-broadcast/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo05Producer.java">Demo05Producer</a> ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Kafka-Spring å°è£…æä¾›çš„ KafkaTemplate ï¼ŒåŒæ­¥å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo04Producer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo05Producer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;Object, Object&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SendResult <span class="title function_">syncSend</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Demo05Message æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Demo05Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo05Message</span>();</span><br><span class="line">        message.setId(id);</span><br><span class="line">        <span class="comment">// åŒæ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> kafkaTemplate.send(Demo05Message.TOPIC, message).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.5 Demo01Producerã€</a>çš„åŒæ­¥å‘é€æ¶ˆæ¯çš„ä»£ç æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯æ¢æˆäº† Demo05Message ã€‚</li>
</ul>
<h2 id="8-5-Demo05Consumer"><a href="#8-5-Demo05Consumer" class="headerlink" title="8.5 Demo05Consumer"></a>8.5 Demo05Consumer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-broadcast/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer"><code>cn.iocoder.springboot.lab03.kafkademo.consumer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-broadcast/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/Demo05Consumer.java">Demo05Consumer</a> ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo04Consumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo05Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo05Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo05-consumer-group-&quot; + Demo05Message.TOPIC + &quot;-&quot; + &quot;#&#123;T(java.util.UUID).randomUUID()&#125;&quot;)</span> <span class="comment">// &lt;X&gt;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Demo05Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>åœ¨ <code>&lt;X&gt;</code> å¤„ï¼Œæˆ‘ä»¬é€šè¿‡ Spring EL è¡¨è¾¾å¼ï¼Œåœ¨æ¯ä¸ªæ¶ˆè´¹è€…åˆ†ç»„çš„åå­—ä¸Šï¼Œä½¿ç”¨ UUID ç”Ÿæˆå…¶åç¼€ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½ä¿è¯æ¯ä¸ªé¡¹ç›®å¯åŠ¨çš„æ¶ˆè´¹è€…åˆ†ç»„ä¸åŒï¼Œä»¥è¾¾åˆ°å¹¿æ’­æ¶ˆè´¹çš„ç›®çš„ã€‚</li>
</ul>
<h2 id="8-6-ç®€å•æµ‹è¯•"><a href="#8-6-ç®€å•æµ‹è¯•" class="headerlink" title="8.6 ç®€å•æµ‹è¯•"></a>8.6 ç®€å•æµ‹è¯•</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-broadcast/src/test/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo05ProducerTest.java">Demo05ProducerTest</a> æµ‹è¯•ç±»ï¼Œç”¨äºæµ‹è¯•å¹¿æ’­æ¶ˆè´¹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo05ProducerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Demo05Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSyncSend</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> (<span class="type">int</span>) (System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">        <span class="type">SendResult</span> <span class="variable">result</span> <span class="operator">=</span> producer.syncSend(id);</span><br><span class="line">        logger.info(<span class="string">&quot;[testSyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€ç»“æœï¼š[&#123;&#125;]]&quot;</span>, id, result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>é¦–å…ˆï¼Œæ‰§è¡Œ <code>#test()</code> æµ‹è¯•æ–¹æ³•ï¼Œå…ˆå¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†ç»„ <code>&quot;demo05-consumer-group-DEMO_05-$&#123;UUID1&#125;&quot;</code> çš„ Consumer èŠ‚ç‚¹ã€‚</p>
<p>ç„¶åï¼Œæ‰§è¡Œ <code>#testSyncSend()</code> æµ‹è¯•æ–¹æ³•ï¼Œå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†ç»„ <code>&quot;demo05-consumer-group-DEMO_05-$&#123;UUID2&#125;&quot;</code> çš„ Consumer èŠ‚ç‚¹ã€‚åŒæ—¶ï¼Œè¯¥æµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ <code>Demo05ProducerTest#syncSend(id)</code> æ–¹æ³•ï¼ŒåŒæ­¥å‘é€äº†ä¸€æ¡æ¶ˆæ¯ã€‚æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #### testSyncSend æ–¹æ³•å¯¹åº”çš„æ§åˆ¶å° ####</span></span><br><span class="line"></span><br><span class="line"># Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸ</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">42.578</span>  INFO <span class="number">16077</span> --- [           main] c.i.s.l.k.producer.Demo05ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1575702042</span>] å‘é€ç»“æœï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_05, partition=<span class="literal">null</span>, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [<span class="number">99</span>, <span class="number">110</span>, <span class="number">46</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">112</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">98</span>, <span class="number">111</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">46</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">68</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">48</span>, <span class="number">53</span>, <span class="number">77</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>])], isReadOnly = <span class="literal">true</span>), key=<span class="literal">null</span>, value=Demo05Message&#123;id=<span class="number">1575702042</span>&#125;, timestamp=<span class="literal">null</span>), recordMetadata=DEMO_05-<span class="number">0</span>@<span class="number">0</span>]]]</span><br><span class="line"></span><br><span class="line"># Demo05Consumer æ¶ˆè´¹äº†è¯¥æ¶ˆæ¯</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">42.618</span>  INFO <span class="number">16077</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo05Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo05Message&#123;id=<span class="number">1575702042</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// ### test æ–¹æ³•å¯¹åº”çš„æ§åˆ¶å° ####</span></span><br><span class="line"></span><br><span class="line"># Demo05Consumer ä¹Ÿæ¶ˆè´¹äº†è¯¥æ¶ˆæ¯</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">15</span>:<span class="number">00</span>:<span class="number">42.644</span>  INFO <span class="number">16067</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo05Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo05Message&#123;id=<span class="number">1575702042</span>&#125;]</span><br></pre></td></tr></table></figure>



<ul>
<li>æ¶ˆè´¹è€…åˆ†ç»„ <code>&quot;demo05-consumer-group-DEMO_05-$&#123;UUID1&#125;&quot;</code> å’Œ <code>demo05-consumer-group-DEMO_05-$&#123;UUID2&#125;</code> çš„<strong>ä¸¤ä¸ª</strong> Consumer èŠ‚ç‚¹ï¼Œéƒ½æ¶ˆè´¹äº†è¿™æ¡å‘é€çš„æ¶ˆæ¯ã€‚ç¬¦åˆå¹¿æ’­æ¶ˆè´¹çš„é¢„æœŸ~</li>
</ul>
<h1 id="9-å¹¶å‘æ¶ˆè´¹"><a href="#9-å¹¶å‘æ¶ˆè´¹" class="headerlink" title="9. å¹¶å‘æ¶ˆè´¹"></a>9. å¹¶å‘æ¶ˆè´¹</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-concurrency">lab-03-kafka-demo-concurrency</a> ã€‚</p>
</blockquote>
<p>åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é…ç½®çš„æ¯ä¸€ä¸ª Spring-Kafka <code>@KafkaListener</code> ï¼Œéƒ½æ˜¯<strong>ä¸²è¡Œ</strong>æ¶ˆè´¹çš„ã€‚æ˜¾ç„¶ï¼Œè¿™åœ¨ç›‘å¬çš„ Topic æ¯ç§’æ¶ˆæ¯é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹ä¸åŠæ—¶ï¼Œå¯¼è‡´æ¶ˆæ¯ç§¯å‹çš„é—®é¢˜ã€‚</p>
<p>è™½ç„¶è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯åŠ¨å¤šä¸ª JVM è¿›ç¨‹ï¼Œå®ç°<strong>å¤šè¿›ç¨‹çš„å¹¶å‘æ¶ˆè´¹</strong>ï¼Œä»è€ŒåŠ é€Ÿæ¶ˆè´¹çš„é€Ÿåº¦ã€‚ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œå¦èƒ½å¤Ÿå®ç°<strong>å¤šçº¿ç¨‹</strong>çš„å¹¶å‘æ¶ˆè´¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>æœ‰</strong>ã€‚</p>
<p>åœ¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.9 @KafkaListenerã€</a>å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥æ³¨è§£æœ‰ <code>concurrency</code> å±æ€§ï¼Œå®ƒå¯ä»¥æŒ‡å®šå¹¶å‘æ¶ˆè´¹çš„çº¿ç¨‹æ•°ã€‚ä¾‹å¦‚è¯´ï¼Œå¦‚æœè®¾ç½® <code>concurrency=4</code> æ—¶ï¼ŒSpring-Kafka å°±ä¼šä¸º<strong>è¯¥</strong> <code>@KafkaListener</code> åˆ›å»º 4 ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ¶ˆè´¹ã€‚</p>
<p>è€ƒè™‘åˆ°è®©èƒ–å‹èƒ½å¤Ÿæ›´å¥½çš„ç†è§£ <code>concurrency</code> å±æ€§ï¼Œæˆ‘ä»¬æ¥ç®€å•è¯´è¯´ Spring-Kafka åœ¨è¿™å—çš„å®ç°æ–¹å¼ã€‚æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª Topic ä¸º <code>&quot;DEMO_06&quot;</code> ï¼Œå¹¶ä¸”è®¾ç½®å…¶ Partition åˆ†åŒºæ•°ä¸º <strong>10</strong> ã€‚</li>
<li>ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Demo06Consumer ç±»ï¼Œå¹¶åœ¨å…¶æ¶ˆè´¹æ–¹æ³•ä¸Šï¼Œæ·»åŠ  <code>@KafkaListener(concurrency=2)</code> æ³¨è§£ã€‚</li>
<li>å†ç„¶åï¼Œæˆ‘ä»¬å¯åŠ¨é¡¹ç›®ã€‚Spring-Kafka ä¼šæ ¹æ® <code>@KafkaListener(concurrency=2)</code> æ³¨è§£ï¼Œåˆ›å»º <strong>2</strong> ä¸ª Kafka Consumer ã€‚æ³¨æ„å™¢ï¼Œæ˜¯ <strong>2</strong> ä¸ª Kafka Consumer å‘¢ï¼ï¼ï¼åç»­ï¼Œæ¯ä¸ª Kafka Consumer ä¼šè¢«<strong>å•ç‹¬</strong>åˆ†é…åˆ°ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè¿›è¡Œæ‹‰å–æ¶ˆæ¯ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚</li>
<li>ä¹‹åï¼ŒKafka Broker ä¼šå°† Topic ä¸º <code>&quot;DEMO_06&quot;</code> åˆ†é…ç»™åˆ›å»ºçš„ <strong>2</strong> ä¸ª Kafka Consumer å„ <strong>5</strong> ä¸ª Partition ã€‚ğŸ˜ˆ å¦‚æœä¸äº†è§£ Kafka Broker â€œåˆ†é…åŒºåˆ†â€æœºåˆ¶å•ç‹¬èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ <a target="_blank" rel="noopener" href="http://www.iocoder.cn/Fight/How-do-Kafka-consumers-allocate-partitions/?self">ã€ŠKafka æ¶ˆè´¹è€…å¦‚ä½•åˆ†é…åˆ†åŒºã€‹</a> æ–‡ç« ã€‚</li>
<li>è¿™æ ·ï¼Œå› ä¸º <code>@KafkaListener(concurrency=2)</code> æ³¨è§£ï¼Œåˆ›å»º <strong>2</strong> ä¸ª Kafka Consumer ï¼Œå°±åœ¨<strong>å„è‡ªçš„çº¿ç¨‹ä¸­</strong>ï¼Œæ‹‰å–å„è‡ªçš„ Topic ä¸º <code>&quot;DEMO_06&quot;</code> çš„ Partition çš„æ¶ˆæ¯ï¼Œå„è‡ª<strong>ä¸²è¡Œ</strong>æ¶ˆè´¹ã€‚ä»è€Œï¼Œå®ç°<strong>å¤šçº¿ç¨‹</strong>çš„å¹¶å‘æ¶ˆè´¹ã€‚</li>
</ul>
<p>é…±ç´«è®²è§£ä¸€ä¸‹ï¼Œèƒ–å‹å¯¹ Spring-Kafka å®ç°<strong>å¤šçº¿ç¨‹</strong>çš„å¹¶å‘æ¶ˆè´¹çš„æœºåˆ¶ï¼Œæ˜¯å¦ç†è§£äº†ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œä¸è¦é…ç½® <code>concurrency</code> å±æ€§è¿‡å¤§ï¼Œåˆ™åˆ›å»ºçš„ Kafka Consumer åˆ†é…ä¸åˆ°æ¶ˆè´¹ Topic çš„ Partition åˆ†åŒºï¼Œå¯¼è‡´ä¸æ–­çš„ç©ºè½®è¯¢ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå¯ä»¥é€‰æ‹©ä¸çœ‹ã€‚</p>
<p>åœ¨ç†è§£ Spring-Kafka æä¾›çš„<strong>å¹¶å‘æ¶ˆè´¹</strong>æœºåˆ¶ï¼ŒèŠ±è´¹äº†å¥½å‡ ä¸ªå°æ—¶ï¼Œä¸»è¦é™·å…¥åˆ°äº†ä¸€ä¸ªè¯¯åŒºã€‚</p>
<p>å¦‚æœèƒ–å‹æœ‰ä½¿ç”¨è¿‡ RocketMQ çš„å¹¶å‘æ¶ˆè´¹ï¼Œä¼šå‘ç°åªè¦åˆ›å»ºä¸€ä¸ª RocketMQ Consumer å¯¹è±¡ï¼Œç„¶å Consumer æ‹‰å–å®Œæ¶ˆæ¯ä¹‹åï¼Œä¸¢åˆ° Consumer çš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œæ¶ˆè´¹ï¼Œä»è€Œå®ç°å¹¶å‘æ¶ˆè´¹ã€‚</p>
<p>è€Œåœ¨ Spring-Kafka æä¾›çš„å¹¶å‘æ¶ˆè´¹ï¼Œä¼šå‘ç°éœ€è¦åˆ›å»ºå¤šä¸ª Kafka Consumer å¯¹è±¡ï¼Œå¹¶ä¸”æ¯ä¸ª Consumer éƒ½å•ç‹¬åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶å Consumer æ‹‰å–å®Œæ¶ˆæ¯ä¹‹åï¼Œåœ¨å„è‡ªçš„çº¿ç¨‹ä¸­æ‰§è¡Œæ¶ˆè´¹ã€‚</p>
<p>åˆæˆ–è€…è¯´ï¼ŒSpring-Kafka æä¾›çš„å¹¶å‘æ¶ˆè´¹ï¼Œå¾ˆåƒ RocketMQ çš„é¡ºåºæ¶ˆè´¹ã€‚ğŸ˜ˆ ä»æ„Ÿå—ä¸Šæ¥è¯´ï¼ŒSpring-Kafka çš„å¹¶å‘æ¶ˆè´¹åƒ BIO ï¼ŒRocketMQ çš„å¹¶å‘æ¶ˆè´¹åƒ NIO ã€‚</p>
<p>ä¸è¿‡ï¼Œç†è®ºæ¥è¯´ï¼Œåœ¨åŸç”Ÿçš„ Kafka å®¢æˆ·ç«¯ï¼Œä¹Ÿæ˜¯èƒ½å°è£…å‡ºå’Œ RocketMQ Consumer ä¸€æ ·çš„å¹¶å‘æ¶ˆè´¹çš„æœºåˆ¶ã€‚</p>
<p>ä¹Ÿå› æ­¤ï¼Œåœ¨ä½¿ç”¨ Kafka çš„æ—¶å€™ï¼Œæ¯ä¸ª Topic çš„ Partition åœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™ï¼Œè¦æ³¨æ„è®¾ç½®çš„ç›¸å¯¹å¤§ä¸€äº›ã€‚</p>
</blockquote>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æœ¬å°èŠ‚çš„ç¤ºä¾‹ã€‚æœ¬ç¤ºä¾‹å°±æ˜¯ä¸Šè¿°ä¸¾ä¾‹çš„å…·ä½“å®ç°ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-concurrency">lab-03-kafka-demo-concurrency</a> é¡¹ç›®ã€‚</p>
<h2 id="9-1-å¼•å…¥ä¾èµ–"><a href="#9-1-å¼•å…¥ä¾èµ–" class="headerlink" title="9.1 å¼•å…¥ä¾èµ–"></a>9.1 å¼•å…¥ä¾èµ–</h2><p>å’Œ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">3.1 å¼•å…¥ä¾èµ–ã€</a> ä¸€è‡´ï¼Œè§ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ã€‚</p>
<h2 id="9-2-åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#9-2-åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="9.2 åº”ç”¨é…ç½®æ–‡ä»¶"></a>9.2 åº”ç”¨é…ç½®æ–‡ä»¶</h2><p>å’Œ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">3.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€</a> ä¸€è‡´ï¼Œè§ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/main/resources/application.yaml"><code>application.yaml</code></a> æ–‡ä»¶ã€‚</p>
<p>å®é™…ä¸Šï¼Œå¯ä»¥é€šè¿‡ <code>spring.kafka.listener.concurrency</code> é…ç½®é¡¹ï¼Œå…¨å±€è®¾ç½®æ¯ä¸ª <code>@KafkaListener</code> çš„å¹¶å‘æ¶ˆè´¹çš„çº¿ç¨‹æ•°ã€‚ä¸è¿‡ä¸ªäººå»ºè®®ï¼Œè¿˜æ˜¯æ¯ä¸ª <code>@KafkaListener</code> å„è‡ªé…ç½®ï¼Œæ¯•ç«Ÿæ¯ä¸ª Topic çš„ Partition çš„æ•°é‡ï¼Œéƒ½æ˜¯ä¸åŒçš„ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç»“åˆä½¿ç”¨ ğŸ˜ˆ ã€‚</p>
<h2 id="9-3-Demo06Message"><a href="#9-3-Demo06Message" class="headerlink" title="9.3 Demo06Message"></a>9.3 Demo06Message</h2><p>åœ¨ <a href="ttps://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message"><code>cn.iocoder.springboot.lab03.kafkademo.message</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message/Demo06Message.java">Demo06Message</a> æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo06Message.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo06Message</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC</span> <span class="operator">=</span> <span class="string">&quot;DEMO_06&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–å·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... çœç•¥ set/get/toString æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>TOPIC</code> é™æ€å±æ€§ï¼Œæˆ‘ä»¬è®¾ç½®è¯¥æ¶ˆæ¯ç±»å¯¹åº” Topic ä¸º <code>&quot;DEMO_06&quot;</code> ã€‚</li>
</ul>
<p>æ³¨æ„ï¼Œè®°å¾—æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª <code>&quot;DEMO_06&quot;</code> çš„ Partition å¤§å°ä¸º 10 ã€‚å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 10 --topic DEMO_06</span><br></pre></td></tr></table></figure>



<h2 id="9-4-Demo06Producer"><a href="#9-4-Demo06Producer" class="headerlink" title="9.4 Demo06Producer"></a>9.4 Demo06Producer</h2><p>åœ¨ <a href="ttps://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/"><code>cn.iocoder.springboot.lab03.kafkademo.producer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo06Producer.java">Demo06Producer</a> ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Kafka-Spring å°è£…æä¾›çš„ KafkaTemplate ï¼ŒåŒæ­¥å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo06Producer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo06Producer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;Object, Object&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SendResult <span class="title function_">syncSend</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Demo01Message æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Demo06Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo06Message</span>();</span><br><span class="line">        message.setId(id);</span><br><span class="line">        <span class="comment">// åŒæ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> kafkaTemplate.send(Demo06Message.TOPIC, message).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.5 Demo01Producerã€</a>çš„åŒæ­¥å‘é€æ¶ˆæ¯çš„ä»£ç æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯æ¢æˆäº† Demo06Message ã€‚</li>
</ul>
<h2 id="9-5-Demo06Consumer"><a href="#9-5-Demo06Consumer" class="headerlink" title="9.5 Demo06Consumer"></a>9.5 Demo06Consumer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer"><code>cn.iocoder.springboot.lab03.kafkademo.consumer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/Demo06Consumer.java">Demo06Consumer</a> ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo06Consumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo06Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo06Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo06-consumer-group-&quot; + Demo06Message.TOPIC,</span></span><br><span class="line"><span class="meta">            concurrency = &quot;2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Demo06Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>åœ¨ <code>&lt;X&gt;</code> å¤„ï¼Œæˆ‘ä»¬åœ¨ <code>@KafkaListener</code> æ³¨è§£ä¸Šï¼Œæ·»åŠ äº† <code>concurrency = &quot;2&quot;</code> å±æ€§ï¼Œåˆ›å»º 2 ä¸ªçº¿ç¨‹æ¶ˆè´¹ <code>&quot;DEMO_06&quot;</code> ä¸‹çš„æ¶ˆæ¯ã€‚</li>
</ul>
<h2 id="9-6-ç®€å•æµ‹è¯•"><a href="#9-6-ç®€å•æµ‹è¯•" class="headerlink" title="9.6 ç®€å•æµ‹è¯•"></a>9.6 ç®€å•æµ‹è¯•</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/test/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo06ProducerTest.java">Demo06ProducerTest</a> æµ‹è¯•ç±»ï¼Œç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œå‘é€ 10 æ¡æ¶ˆæ¯ï¼Œè§‚å¯Ÿå¹¶å‘æ¶ˆè´¹æƒ…å†µã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo06ProducerTest.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo06ProducerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Demo06Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSyncSend</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> (<span class="type">int</span>) (System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">            <span class="type">SendResult</span> <span class="variable">result</span> <span class="operator">=</span> producer.syncSend(id);</span><br><span class="line"><span class="comment">//        logger.info(&quot;[testSyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€ç»“æœï¼š[&#123;&#125;]]&quot;, id, result);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ‰§è¡Œ <code>#testSyncSend()</code> å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># çº¿ç¨‹ç¼–å·ä¸º <span class="number">16</span> </span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.365</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.369</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.369</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.369</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.369</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br><span class="line"></span><br><span class="line"># çº¿ç¨‹ç¼–å·ä¸º <span class="number">18</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.365</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.369</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.369</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.369</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">17</span>:<span class="number">21</span>:<span class="number">16.369</span>  INFO <span class="number">24303</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1575710476</span>&#125;]</span><br></pre></td></tr></table></figure>



<ul>
<li>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªçº¿ç¨‹åœ¨æ¶ˆè´¹ <code>&quot;DEMO_06&quot;</code> ä¸‹çš„æ¶ˆæ¯ã€‚</li>
<li>ğŸ˜ˆ ä¸ºäº†æ›´å¥½çš„åšå¯¹æ¯”ï¼Œèƒ–å‹å¯ä»¥å°è¯•è‡ªè¡ŒæŠŠé…ç½®æ”¹æˆ <code>@KafkaListner</code> çš„ <code>concurrency=1</code>ï¼Œå°±ä¼šå‘ç° Demo06Consumer åªä¼šå•çº¿ç¨‹æ¶ˆè´¹äº†ã€‚</li>
</ul>
<p>æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/yahoo/kafka-manager">Kafka Manager</a> æ¥æŸ¥çœ‹ <code>&quot;DEMO_06&quot;</code> çš„æ¶ˆè´¹è€…åˆ—è¡¨ï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F91abe663c506607c013c55a4222f3442.png" alt=" çš„æ¶ˆè´¹è€…åˆ—è¡¨"></p>
<h1 id="10-é¡ºåºæ¶ˆæ¯"><a href="#10-é¡ºåºæ¶ˆæ¯" class="headerlink" title="10. é¡ºåºæ¶ˆæ¯"></a>10. é¡ºåºæ¶ˆæ¯</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-concurrency">lab-03-kafka-demo-concurrency</a> ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆæ¥ä¸€èµ·äº†è§£ä¸‹é¡ºåºæ¶ˆæ¯çš„<strong>é¡ºåºæ¶ˆæ¯</strong>çš„å®šä¹‰ï¼š</p>
<ul>
<li>æ™®é€šé¡ºåºæ¶ˆæ¯ ï¼šProducer å°†ç›¸å…³è”çš„æ¶ˆæ¯å‘é€åˆ°ç›¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</li>
<li>å®Œå…¨ä¸¥æ ¼é¡ºåº ï¼šåœ¨ã€æ™®é€šé¡ºåºæ¶ˆæ¯ã€‘çš„åŸºç¡€ä¸Šï¼ŒConsumer ä¸¥æ ¼é¡ºåºæ¶ˆè´¹ã€‚</li>
</ul>
<p>åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° Spring-Kafka åœ¨ Consumer æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œ<strong>å¤©ç„¶</strong>å°±æ”¯æŒæŒ‰ç…§ Topic ä¸‹çš„ Partition ä¸‹çš„æ¶ˆæ¯ï¼Œ<strong>é¡ºåºæ¶ˆè´¹</strong>ã€‚å³ä½¿åœ¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ9. å¹¶å‘æ¶ˆè´¹ã€</a>æ—¶ï¼Œä¹Ÿèƒ½ä¿è¯å¦‚æ­¤ã€‚</p>
<p>é‚£ä¹ˆæ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘å°† Producer å°†ç›¸å…³è”çš„æ¶ˆæ¯å‘é€åˆ° Topic ä¸‹çš„ç›¸åŒçš„ Partition å³å¯ã€‚å¦‚æœèƒ–å‹äº†è§£ Producer å‘é€æ¶ˆæ¯çš„åˆ†åŒºç­–ç•¥çš„è¯ï¼Œåªè¦æˆ‘ä»¬å‘é€æ¶ˆæ¯æ—¶ï¼ŒæŒ‡å®šäº†æ¶ˆæ¯çš„ key ï¼ŒProducer åˆ™ä¼šæ ¹æ® key çš„å“ˆå¸Œå€¼å–æ¨¡æ¥è·å–åˆ°å…¶åœ¨ Topic ä¸‹å¯¹åº”çš„ Partition ã€‚å®Œç¾~~ä¸äº†è§£çš„ Producer åˆ†åŒºé€‰æ‹©ç­–ç•¥çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ <a target="_blank" rel="noopener" href="https://leokongwq.github.io/2017/02/27/mq-kafka-producer-partitioner.html">ã€ŠKafka å‘é€æ¶ˆæ¯åˆ†åŒºé€‰æ‹©ç­–ç•¥è¯¦è§£ã€‹</a> æ–‡ç« ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æœ¬å°èŠ‚çš„ç¤ºä¾‹ã€‚è¯¥ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä¼šåœ¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ9. å¹¶å‘æ¶ˆè´¹ã€</a>çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-concurrency">lab-03-kafka-demo-concurrency</a> é¡¹ç›®ä¸­ï¼Œç»§ç»­æ”¹é€ ã€‚</p>
<h2 id="10-1-Demo06Producer"><a href="#10-1-Demo06Producer" class="headerlink" title="10.1 Demo06Producer"></a>10.1 Demo06Producer</h2><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo06Producer.java">Demo06Producer</a> ç±»ï¼Œå¢åŠ é¡ºåºå‘é€æ¶ˆæ¯æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo06Producer.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> SendResult <span class="title function_">syncSendOrderly</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º Demo01Message æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">Demo06Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo06Message</span>();</span><br><span class="line">    message.setId(id);</span><br><span class="line">    <span class="comment">// åŒæ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">// å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ String çš„æ–¹å¼åºåˆ—åŒ– key ï¼Œæ‰€ä»¥éœ€è¦å°† id è½¬æ¢æˆ String</span></span><br><span class="line">    <span class="keyword">return</span> kafkaTemplate.send(Demo06Message.TOPIC, String.valueOf(id), message).get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>è°ƒç”¨ KafkaTemplate åŒæ­¥å‘é€æ¶ˆæ¯æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¤šä¼ å…¥äº† <code>id</code> ä½œä¸ºæ¶ˆæ¯çš„ key ï¼Œä»è€Œå®ç°å‘é€åˆ° <code>DEMO_06</code> è¿™ä¸ª Topic ä¸‹çš„ç›¸åŒ Partition ä¸­ã€‚</li>
</ul>
<h2 id="10-2-ç®€å•æµ‹è¯•"><a href="#10-2-ç®€å•æµ‹è¯•" class="headerlink" title="10.2 ç®€å•æµ‹è¯•"></a>10.2 ç®€å•æµ‹è¯•</h2><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-concurrency/src/test/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo06ProducerTest.java">Demo06ProducerTest</a> æµ‹è¯•ç±»ï¼Œæ–°å¢ä¸€ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œé¡ºåºå‘é€ 10 æ¡æ¶ˆæ¯ï¼Œè§‚å¯Ÿæ¶ˆè´¹æƒ…å†µã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo06ProducerTest.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSyncSendOrderly</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">SendResult</span> <span class="variable">result</span> <span class="operator">=</span> producer.syncSendOrderly(id);</span><br><span class="line">        logger.info(<span class="string">&quot;[testSyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€é˜Ÿåˆ—ï¼š[&#123;&#125;]]&quot;</span>, id, result.getRecordMetadata().partition());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ‰§è¡Œ <code>#testSyncSendOrderly()</code> å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Producer åŒæ­¥å‘é€ <span class="number">10</span> æ¡é¡ºåºæ¶ˆæ¯æˆåŠŸï¼Œéƒ½å‘é€åˆ°äº† Topic ä¸º DEMO_06 ï¼Œé˜Ÿåˆ—ç¼–å·ä¸º <span class="number">9</span> çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸Š</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.866</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.867</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.869</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.870</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.871</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.872</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.873</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.875</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.876</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.877</span>  INFO <span class="number">31773</span> --- [           main] c.i.s.l.k.producer.Demo06ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€é˜Ÿåˆ—ï¼š[<span class="number">9</span>]]</span><br><span class="line"></span><br><span class="line"># Demo06Consumer åœ¨çº¿ç¨‹ç¼–å·ä¸º <span class="number">18</span> ä¸­ï¼Œé¡ºåºæ¶ˆè´¹</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.908</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.911</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.912</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.912</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.912</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.912</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.912</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.912</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.912</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">18</span>:<span class="number">48</span>:<span class="number">45.912</span>  INFO <span class="number">31773</span> --- [ntainer#<span class="number">0</span>-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo06Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">18</span> æ¶ˆæ¯å†…å®¹ï¼šDemo06Message&#123;id=<span class="number">1</span>&#125;]</span><br></pre></td></tr></table></figure>



<ul>
<li>ğŸ˜ˆ èƒ–å‹è®¤çœŸçœ‹ä¸‹è‰¿è‰¿åœ¨æ—¥å¿—ä¸­çš„æ³¨é‡Šï¼Œç†è§£ä¸‹æ•´ä¸ªé¡ºåºæ¶ˆæ¯çš„è¿‡ç¨‹ã€‚</li>
</ul>
<h1 id="11-äº‹åŠ¡æ¶ˆæ¯"><a href="#11-äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="11. äº‹åŠ¡æ¶ˆæ¯"></a>11. äº‹åŠ¡æ¶ˆæ¯</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-transaction">lab-03-kafka-demo-transaction</a> ã€‚</p>
</blockquote>
<p>Kafka å†…ç½®æä¾›äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒã€‚å¯¹äº‹åŠ¡æ¶ˆæ¯çš„æ¦‚å¿µä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ <a target="_blank" rel="noopener" href="http://www.iocoder.cn/Fight/longyb-transaction_mq/?self">ã€Šäº‹åŠ¡æ¶ˆæ¯ç»„ä»¶çš„å¥—è·¯ã€‹</a> æ–‡ç« ã€‚</p>
<p>ä¸è¿‡ Kafka æä¾›çš„å¹¶ä¸æ˜¯<strong>å®Œæ•´çš„</strong>çš„äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒï¼Œç¼ºå°‘äº†<strong>å›æŸ¥æœºåˆ¶</strong>ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œåˆšæ¨èçš„æ–‡ç« ä¹Ÿæœ‰è®²åˆ°ã€‚ç›®å‰ï¼Œå¸¸ç”¨çš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªæœ‰ RocketMQ æä¾›äº†å®Œæ•´çš„äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒï¼Œå…·ä½“çš„å¯ä»¥çœ‹çœ‹<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/RocketMQ/?self">ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— RocketMQ å…¥é—¨ã€‹</a> çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ9. äº‹åŠ¡æ¶ˆæ¯ã€</a>å°èŠ‚ï¼ŒğŸ˜ˆ æš‚æ—¶ä¸æ‹“å±•å¼€æ¥è®²ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æœ¬å°èŠ‚çš„ç¤ºä¾‹ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-transaction">lab-03-kafka-demo-transaction</a> é¡¹ç›®ã€‚</p>
<h2 id="11-1-å¼•å…¥ä¾èµ–"><a href="#11-1-å¼•å…¥ä¾èµ–" class="headerlink" title="11.1 å¼•å…¥ä¾èµ–"></a>11.1 å¼•å…¥ä¾èµ–</h2><p>å’Œ <a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">3.1 å¼•å…¥ä¾èµ–ã€</a> ä¸€è‡´ï¼Œè§ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-transaction/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ã€‚</p>
<h2 id="11-2-åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#11-2-åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="11.2 åº”ç”¨é…ç½®æ–‡ä»¶"></a>11.2 åº”ç”¨é…ç½®æ–‡ä»¶</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-transaction/src/main/resources"><code>resources</code></a> ç›®å½•ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-transaction/src/main/resources/application.yaml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># Kafka é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProperties é…ç½®ç±»</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">bootstrap-servers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">    <span class="comment"># Kafka Producer é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">producer:</span></span><br><span class="line">      <span class="attr">acks:</span> <span class="string">all</span> <span class="comment"># 0-ä¸åº”ç­”ã€‚1-leader åº”ç­”ã€‚all-æ‰€æœ‰ leader å’Œ follower åº”ç­”ã€‚</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span> <span class="comment"># å‘é€å¤±è´¥æ—¶ï¼Œé‡è¯•å‘é€çš„æ¬¡æ•°</span></span><br><span class="line">      <span class="attr">key-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span> <span class="comment"># æ¶ˆæ¯çš„ key çš„åºåˆ—åŒ–</span></span><br><span class="line">      <span class="attr">value-serializer:</span> <span class="string">org.springframework.kafka.support.serializer.JsonSerializer</span> <span class="comment"># æ¶ˆæ¯çš„ value çš„åºåˆ—åŒ–</span></span><br><span class="line">      <span class="attr">transaction-id-prefix:</span> <span class="string">demo.</span> <span class="comment"># äº‹åŠ¡ç¼–å·å‰ç¼€</span></span><br><span class="line">    <span class="comment"># Kafka Consumer é…ç½®é¡¹</span></span><br><span class="line">    <span class="attr">consumer:</span></span><br><span class="line">      <span class="attr">auto-offset-reset:</span> <span class="string">earliest</span> <span class="comment"># è®¾ç½®æ¶ˆè´¹è€…åˆ†ç»„æœ€åˆçš„æ¶ˆè´¹è¿›åº¦ä¸º earliest ã€‚å¯å‚è€ƒåšå®¢ https://blog.csdn.net/lishuangzhe7047/article/details/74530417 ç†è§£</span></span><br><span class="line">      <span class="attr">key-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="attr">value-deserializer:</span> <span class="string">org.springframework.kafka.support.serializer.JsonDeserializer</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">spring:</span></span><br><span class="line">          <span class="attr">json:</span></span><br><span class="line">            <span class="attr">trusted:</span></span><br><span class="line">              <span class="attr">packages:</span> <span class="string">cn.iocoder.springboot.lab03.kafkademo.message</span></span><br><span class="line">        <span class="attr">isolation:</span></span><br><span class="line">          <span class="attr">level:</span> <span class="string">read_committed</span> <span class="comment"># è¯»å–å·²æäº¤çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment"># Kafka Consumer Listener ç›‘å¬å™¨é…ç½®</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">missing-topics-fatal:</span> <span class="literal">false</span> <span class="comment"># æ¶ˆè´¹ç›‘å¬æ¥å£ç›‘å¬çš„ä¸»é¢˜ä¸å­˜åœ¨æ—¶ï¼Œé»˜è®¤ä¼šæŠ¥é”™ã€‚æ‰€ä»¥é€šè¿‡è®¾ç½®ä¸º false ï¼Œè§£å†³æŠ¥é”™</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org:</span></span><br><span class="line">      <span class="attr">springframework:</span></span><br><span class="line">        <span class="attr">kafka:</span> <span class="string">ERROR</span> <span class="comment"># spring-kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span></span><br><span class="line">      <span class="attr">apache:</span></span><br><span class="line">        <span class="attr">kafka:</span> <span class="string">ERROR</span> <span class="comment"># kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p>ç›¸æ¯”</p>
<p>ã€Œ3.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€</p>
<p>æ¥è¯´ï¼Œä¿®æ”¹æˆ–å¢åŠ å¦‚ä¸‹ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>ä¿®æ”¹ <code>spring.kafka.producer.acks=all</code> é…ç½®ï¼Œä¸ç„¶åœ¨å¯åŠ¨æ—¶ä¼šæŠ¥ <code>&quot;Must set acks to all in order to use the idempotent producer. Otherwise we cannot guarantee idempotence.&quot;</code> é”™è¯¯ã€‚å› ä¸ºï¼ŒKafka çš„äº‹åŠ¡æ¶ˆæ¯éœ€è¦åŸºäºå¹‚ç­‰æ€§æ¥å®ç°ï¼Œæ‰€ä»¥å¿…é¡»ä¿è¯æ‰€æœ‰èŠ‚ç‚¹éƒ½å†™å…¥æˆåŠŸã€‚</li>
<li>å¢åŠ  <code>transaction-id-prefix=demo.</code> é…ç½®ï¼Œäº‹åŠ¡ç¼–å·çš„å‰ç¼€ã€‚éœ€è¦ä¿è¯ç›¸åŒåº”ç”¨é…ç½®ç›¸åŒï¼Œä¸åŒåº”ç”¨é…ç½®ä¸åŒã€‚å…·ä½“å¯ä»¥çœ‹çœ‹<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/57179169/how-to-choose-kafka-transaction-id-for-several-applications-hosted-in-kubernete">ã€ŠHow to choose Kafka transaction id for several applicationsã€‹</a>çš„è®¨è®ºã€‚</li>
<li>å¢åŠ  <code>spring.kafka.consumer.properties.isolation.level=read_committed</code> é…ç½®ï¼ŒConsumer <strong>ä»…</strong>è¯»å–å·²æäº¤çš„æ¶ˆæ¯ã€‚ğŸ˜ˆ ä¸€å®šè¦é…ç½®ï¼ï¼ï¼è¢«å‘æƒ¨äº†ï¼Œå½“æ—¶ä»¥ä¸ºè‡ªå·±çš„äº‹åŠ¡æ¶ˆæ¯æ€ä¹ˆå°±æ˜¯ä¸ç”Ÿæ•ˆï¼ŒåŸæ¥å°‘åŠ äº†è¿™ä¸ªã€‚</li>
</ul>
</li>
</ul>
<h2 id="11-3-Demo07Producer"><a href="#11-3-Demo07Producer" class="headerlink" title="11.3 Demo07Producer"></a>11.3 Demo07Producer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-transaction/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/"><code>cn.iocoder.springboot.lab03.kafkademo.producer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-transaction/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo07Producer.java">Demo07Producer</a> ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Kafka-Spring å°è£…æä¾›çš„ KafkaTemplate ï¼Œå®ç°å‘é€<strong>äº‹åŠ¡</strong>æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo07Producer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo07Producer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">syncSendInTransaction</span><span class="params">(Integer id, Runnable runner)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="keyword">return</span> kafkaTemplate.executeInTransaction(<span class="keyword">new</span> <span class="title class_">KafkaOperations</span>.OperationsCallback&lt;Object, Object, String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">doInOperations</span><span class="params">(KafkaOperations&lt;Object, Object&gt; kafkaOperations)</span> &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»º Demo07Message æ¶ˆæ¯</span></span><br><span class="line">                <span class="type">Demo07Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo07Message</span>();</span><br><span class="line">                message.setId(id);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    SendResult&lt;Object, Object&gt; sendResult = kafkaOperations.send(Demo07Message.TOPIC, message).get();</span><br><span class="line">                    logger.info(<span class="string">&quot;[doInOperations][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€ç»“æœï¼š[&#123;&#125;]]&quot;</span>, id, sendResult);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æœ¬åœ°ä¸šåŠ¡é€»è¾‘... biubiubiu</span></span><br><span class="line">                runner.run();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>ä½¿ç”¨ kafkaTemplate æäº¤çš„</p>
<p><code>#executeInTransaction(OperationsCallback&lt;K, V, T&gt; callback)</code></p>
<p>æ¨¡æ¿æ–¹æ³•ï¼Œå®ç°åœ¨ Kafka äº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œè‡ªå®šä¹‰</p>
<p>KafkaOperations.OperationsCallback</p>
<p>æ“ä½œã€‚</p>
<ul>
<li>åœ¨ <code>#executeInTransaction(...)</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/core/KafkaOperations.java">KafkaOperations</a> æ¥æ‰§è¡Œå‘é€æ¶ˆæ¯ç­‰ Kafka ç›¸å…³çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>åœ¨ <code>#executeInTransaction(...)</code> æ–¹æ³•çš„å¼€å§‹ï¼Œå®ƒä¼šè‡ªåŠ¨åŠ¨åˆ›å»º Kafka çš„äº‹åŠ¡ï¼›ç„¶åæ‰§è¡Œæˆ‘ä»¬å®šä¹‰çš„ KafkaOperations çš„é€»è¾‘ï¼›å¦‚æœæˆåŠŸï¼Œåˆ™æäº¤ Kafka äº‹åŠ¡ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™å›æ»š Kafka äº‹åŠ¡ã€‚</li>
</ul>
</li>
<li><p>å¦å¤–ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>runner</code> å‚æ•°ï¼Œç”¨äºè¡¨ç¤ºæœ¬åœ°ä¸šåŠ¡é€»è¾‘~</p>
</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼Œå¦‚æœ Kafka Producer å¼€å¯äº†äº‹åŠ¡çš„åŠŸèƒ½ï¼Œåˆ™æ‰€æœ‰å‘é€çš„æ¶ˆæ¯ï¼Œéƒ½å¿…é¡»å¤„äº Kafka äº‹åŠ¡ä¹‹ä¸­ï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>&quot; No transaction is in process; possible solutions: run the template operation within the scope of a template.executeInTransaction() operation, start a transaction with @Transactional before invoking the template method, run in a transaction started by a listener container when consuming a record&quot;</code> å¼‚å¸¸ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœèƒ–å‹çš„ä¸šåŠ¡ä¸­ï¼Œå³å­˜åœ¨éœ€è¦äº‹åŠ¡çš„æƒ…å†µï¼Œä¹Ÿå­˜åœ¨ä¸éœ€è¦äº‹åŠ¡çš„æƒ…å†µï¼Œéœ€è¦åˆ†åˆ«å®šä¹‰ä¸¤ä¸ª KafkaTemplateï¼ˆKafka Producerï¼‰ã€‚</p>
<h2 id="11-4-Demo07Consumer"><a href="#11-4-Demo07Consumer" class="headerlink" title="11.4 Demo07Consumer"></a>11.4 Demo07Consumer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-transaction/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/"><code>cn.iocoder.springboot.lab03.kafkademo.consumer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-transaction/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/Demo07Consumer.java">Demo07Consumer</a> ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo07Consumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo07Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo07Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo07-consumer-group-&quot; + Demo07Message.TOPIC)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Demo07Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.6 Demo1Consumer.javaã€</a> ä¸€è‡´ï¼Œå·®åˆ«åªåœ¨äºæ¶ˆè´¹ Topic ä¸º <code>DEMO_07</code> çš„æ¶ˆæ¯ã€‚</li>
</ul>
<h2 id="11-5-ç®€å•æµ‹è¯•"><a href="#11-5-ç®€å•æµ‹è¯•" class="headerlink" title="11.5 ç®€å•æµ‹è¯•"></a>11.5 ç®€å•æµ‹è¯•</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-transaction/src/test/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo07ProducerTest.java">Demo07ProducerTest</a> æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œè°ƒç”¨ Demo07Producer å‘é€<strong>äº‹åŠ¡</strong>æ¶ˆæ¯çš„æ–¹å¼ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo07ProducerTest.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo07ProducerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Demo07Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSyncSendInTransaction</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> (<span class="type">int</span>) (System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">        producer.syncSendInTransaction(id, <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;[run][æˆ‘è¦å¼€å§‹ç¡è§‰äº†]&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">10</span> * <span class="number">1000L</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">                logger.info(<span class="string">&quot;[run][æˆ‘ç¡é†’äº†]&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>æ•…æ„åˆ›å»ºä¸€ä¸ªæ‰§è¡Œé€»è¾‘ä¸º sleep 10 ç§’çš„ Runnable å¯¹è±¡ï¼Œæ¥è®©æˆ‘ä»¬æµ‹è¯•éªŒè¯ï¼Œäº‹åŠ¡æ¶ˆæ¯åœ¨æäº¤åï¼Œæ‰ä¼šè¢« Consumer æ¶ˆè´¹åˆ°ã€‚</li>
</ul>
<p>æ‰§è¡Œ <code>#testSyncSendInTransaction()</code> å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Producer åŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸã€‚</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">21</span>:<span class="number">10</span>:<span class="number">20.496</span>  INFO <span class="number">37455</span> --- [           main] c.i.s.l.k.producer.Demo07Producer        : [doInOperations][å‘é€ç¼–å·ï¼š[<span class="number">1575724220</span>] å‘é€ç»“æœï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_07, partition=<span class="literal">null</span>, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [<span class="number">99</span>, <span class="number">110</span>, <span class="number">46</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">112</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">98</span>, <span class="number">111</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">46</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">68</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">48</span>, <span class="number">55</span>, <span class="number">77</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>])], isReadOnly = <span class="literal">true</span>), key=<span class="literal">null</span>, value=Demo07Message&#123;id=<span class="number">1575724220</span>&#125;, timestamp=<span class="literal">null</span>), recordMetadata=DEMO_07-<span class="number">0</span>@<span class="number">14</span>]]]</span><br><span class="line"></span><br><span class="line"># æ•…æ„ sleep <span class="number">10</span> ç§’ï¼Œå»¶è¿Ÿäº‹åŠ¡æ¶ˆæ¯çš„æäº¤</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">21</span>:<span class="number">10</span>:<span class="number">20.496</span>  INFO <span class="number">37455</span> --- [           main] c.i.s.l.k.producer.Demo07ProducerTest    : [run][æˆ‘è¦å¼€å§‹ç¡è§‰äº†]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">21</span>:<span class="number">10</span>:<span class="number">30.500</span>  INFO <span class="number">37455</span> --- [           main] c.i.s.l.k.producer.Demo07ProducerTest    : [run][æˆ‘ç¡é†’äº†]</span><br><span class="line"></span><br><span class="line"># åœ¨äº‹åŠ¡æ¶ˆæ¯æäº¤ä¹‹åï¼Œäº‹åŠ¡æ¶ˆæ¯æ‰è¢« Consumer æ¶ˆè´¹åˆ°</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">21</span>:<span class="number">10</span>:<span class="number">30.558</span>  INFO <span class="number">37455</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo07Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo07Message&#123;id=<span class="number">1575724220</span>&#125;]</span><br></pre></td></tr></table></figure>



<ul>
<li>æˆåŠŸè§‚å¯Ÿåˆ°ï¼Œå‘é€çš„äº‹åŠ¡æ¶ˆæ¯ï¼Œåœ¨æäº¤ä¹‹åæ‰è¢« Consumer æ¶ˆè´¹åˆ°ã€‚</li>
</ul>
<h2 id="11-6-é›†æˆåˆ°-Spring-Transaction-ä½“ç³»"><a href="#11-6-é›†æˆåˆ°-Spring-Transaction-ä½“ç³»" class="headerlink" title="11.6 é›†æˆåˆ° Spring Transaction ä½“ç³»"></a>11.6 é›†æˆåˆ° Spring Transaction ä½“ç³»</h2><p>Spring-Kafka æä¾›äº†å¯¹ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction">Spring Transaction</a> çš„é›†æˆï¼Œæ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦é…åˆä½¿ç”¨ <code>@Transactional</code> æ³¨è§£ï¼Œæ¥å£°æ˜äº‹åŠ¡å³å¯ï¼Œè€Œæ— éœ€ä½¿ç”¨ KafkaTemplate æä¾›çš„ <code>#executeInTransaction(...)</code> æ¨¡æ¿æ–¹æ³•ã€‚ğŸ˜ˆ æ˜¯ä¸æ˜¯ä¾¿æ·å¾ˆå¤šå‘¢!</p>
<p>å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œè‰¿è‰¿å°±æš‚æ—¶ä¸æä¾›äº†ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹å¯ä»¥çœ‹çœ‹ <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/59891ede5f90">ã€Šä½¿ç”¨Kafka äº‹åŠ¡çš„ä¸¤ç§æ–¹å¼ã€‹</a> æ–‡ç« ã€‚</p>
<h1 id="12-æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶"><a href="#12-æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶" class="headerlink" title="12. æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶"></a>12. æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-ack">lab-03-kafka-demo-ack</a> ã€‚</p>
</blockquote>
<p>åŸç”Ÿ Kafka Consumer æ¶ˆè´¹ç«¯ï¼Œæœ‰ä¸¤ç§æ¶ˆè´¹è¿›åº¦æäº¤çš„æäº¤æœºåˆ¶ï¼š</p>
<ul>
<li>ã€é»˜è®¤ã€‘è‡ªåŠ¨æäº¤ï¼Œé€šè¿‡é…ç½® <code>enable.auto.commit=true</code> ï¼Œæ¯è¿‡ <code>auto.commit.interval.ms</code> æ—¶é—´é—´éš”ï¼Œéƒ½ä¼šè‡ªåŠ¨æäº¤æ¶ˆè´¹æ¶ˆè´¹è¿›åº¦ã€‚è€Œæäº¤çš„æ—¶æœºï¼Œæ˜¯åœ¨ Consumer çš„ <code>#poll(...)</code> æ–¹æ³•çš„é€»è¾‘é‡Œå®Œæˆï¼Œåœ¨æ¯æ¬¡ä» Kafka Broker æ‹‰å–æ¶ˆæ¯æ—¶ï¼Œä¼šæ£€æŸ¥æ˜¯å¦åˆ°è¾¾è‡ªåŠ¨æäº¤çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå°±ä¼šæäº¤ä¸Šä¸€æ¬¡è½®è¯¢æ‹‰å–çš„ä½ç½®ã€‚</li>
<li>æ‰‹åŠ¨æäº¤ï¼Œé€šè¿‡é…ç½® <code>enable.auto.commit=false</code> ï¼Œåç»­é€šè¿‡ Consumer çš„ <code>#commitSync(...)</code> æˆ– <code>#commitAsync(...)</code> æ–¹æ³•ï¼ŒåŒæ­¥æˆ–å¼‚æ­¥æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</li>
</ul>
<p>Spring-Kafka Consumer æ¶ˆè´¹ç«¯ï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„æ¶ˆè´¹è€…è¿›åº¦çš„æäº¤æœºåˆ¶ï¼Œæ›´åŠ çµæ´»ã€‚å½“ç„¶ï¼Œä¹Ÿæ˜¯åˆ†æˆè‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤ä¸¤ä¸ªå¤§ç±»ã€‚åœ¨ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/listener/ContainerProperties.java#L44-L93">AckMode</a> æšä¸¾ç±»ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸€ç§å…·ä½“çš„æ–¹å¼ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ContainerProperties#AckMode.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AckMode</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== è‡ªåŠ¨æäº¤ ==========</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit after each record is processed by the listener.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	RECORD, <span class="comment">// æ¯æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆåï¼Œè‡ªåŠ¨æäº¤</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit whatever has already been processed before the next poll.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	BATCH, <span class="comment">// æ¯ä¸€æ¬¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆåï¼Œåœ¨ä¸‹æ¬¡æ‹‰å–æ¶ˆæ¯ä¹‹å‰ï¼Œè‡ªåŠ¨æäº¤</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit pending updates after</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> ContainerProperties#setAckTime(long) ackTime&#125; has elapsed.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	TIME, <span class="comment">// è¾¾åˆ°ä¸€å®šæ—¶é—´é—´éš”åï¼Œè‡ªåŠ¨æäº¤ã€‚</span></span><br><span class="line">	      <span class="comment">// ä¸è¿‡è¦æ³¨æ„ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€åˆ°å°±ç«‹é©¬æäº¤ï¼Œå¦‚æœæ­¤æ—¶æ­£åœ¨æ¶ˆè´¹æŸä¸€æ¡æ¶ˆæ¯ï¼Œéœ€è¦ç­‰è¿™æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆï¼Œæ‰èƒ½æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit pending updates after</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> ContainerProperties#setAckCount(int) ackCount&#125; has been</span></span><br><span class="line"><span class="comment">	 * exceeded.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	COUNT, <span class="comment">// æ¶ˆè´¹æˆåŠŸçš„æ¶ˆæ¯æ•°åˆ°è¾¾ä¸€å®šæ•°é‡åï¼Œè‡ªåŠ¨æäº¤ã€‚</span></span><br><span class="line">	      <span class="comment">// ä¸è¿‡è¦æ³¨æ„ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€åˆ°å°±ç«‹é©¬æäº¤ï¼Œå¦‚æœæ­¤æ—¶æ­£åœ¨æ¶ˆè´¹æŸä¸€æ¡æ¶ˆæ¯ï¼Œéœ€è¦ç­‰è¿™æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆï¼Œæ‰èƒ½æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit pending updates after</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> ContainerProperties#setAckCount(int) ackCount&#125; has been</span></span><br><span class="line"><span class="comment">	 * exceeded or after &#123;<span class="doctag">@link</span> ContainerProperties#setAckTime(long)</span></span><br><span class="line"><span class="comment">	 * ackTime&#125; has elapsed.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	COUNT_TIME, <span class="comment">// TIME å’Œ COUNT çš„ç»“åˆä½“ï¼Œæ»¡è¶³ä»»ä¸€éƒ½ä¼šè‡ªåŠ¨æäº¤ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== æ‰‹åŠ¨æäº¤ ==========</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * User takes responsibility for acks using an</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> AcknowledgingMessageListener&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	MANUAL, <span class="comment">// è°ƒç”¨æ—¶ï¼Œå…ˆæ ‡è®°æäº¤æ¶ˆè´¹è¿›åº¦ã€‚ç­‰åˆ°å½“å‰æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆï¼Œç„¶ååœ¨æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * User takes responsibility for acks using an</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> AcknowledgingMessageListener&#125;. The consumer</span></span><br><span class="line"><span class="comment">	 * immediately processes the commit.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	MANUAL_IMMEDIATE, <span class="comment">// è°ƒç”¨æ—¶ï¼Œç«‹å³æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>çœ‹ä¸‹æ¯ç§æ–¹å¼ï¼Œè‰¿è‰¿éƒ½æ·»åŠ äº†æ³¨é‡Šå“Ÿã€‚</li>
</ul>
<p>é‚£ä¹ˆï¼Œæ—¢ç„¶ç°åœ¨å­˜åœ¨åŸç”Ÿ Kafka å’Œ Spring-Kafka æä¾›çš„ä¸¤ç§æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆé…ç½®å‘¢ï¼Ÿ</p>
<ul>
<li>ä½¿ç”¨åŸç”Ÿ Kafka çš„æ–¹å¼ï¼Œé€šè¿‡é…ç½® <code>spring.kafka.consumer.enable-auto-commit=true</code> ã€‚ç„¶åï¼Œé€šè¿‡ <code>spring.kafka.consumer.auto-commit-interval</code> è®¾ç½®è‡ªåŠ¨æäº¤çš„é¢‘ç‡ã€‚</li>
<li>ä½¿ç”¨ Spring-Kafka çš„æ–¹å¼ï¼Œé€šè¿‡é…ç½® <code>spring.kafka.consumer.enable-auto-commit=false</code> ã€‚ç„¶åé€šè¿‡ <code>spring.kafka.listener.ack-mode</code> è®¾ç½®å…·ä½“æ¨¡å¼ã€‚å¦å¤–ï¼Œè¿˜æœ‰ <code>spring.kafka.listener.ack-time</code> å’Œ <code>spring.kafka.listener.ack-count</code> å¯ä»¥è®¾ç½®è‡ªåŠ¨æäº¤çš„æ—¶é—´é—´éš”å’Œæ¶ˆæ¯æ¡æ•°ã€‚</li>
</ul>
<p><strong>é»˜è®¤ä»€ä¹ˆéƒ½ä¸é…ç½®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Spring-Kafka çš„ BATCH æ¨¡å¼ï¼šæ¯ä¸€æ¬¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆåï¼Œåœ¨ä¸‹æ¬¡æ‹‰å–æ¶ˆæ¯ä¹‹å‰ï¼Œè‡ªåŠ¨æäº¤</strong>ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹æœ¬å°èŠ‚çš„ç¤ºä¾‹ï¼Œå®ç°ä¸€ä¸ª<strong>æ‰‹åŠ¨æäº¤æ¶ˆæ¯è¿›åº¦</strong>çš„æ¶ˆè´¹è€…ã€‚è€ƒè™‘åˆ°ä¸æ±¡æŸ“ä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ª <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-ack">lab-03-kafka-demo-ack</a> é¡¹ç›®ã€‚</p>
<h2 id="12-1-å¼•å…¥ä¾èµ–"><a href="#12-1-å¼•å…¥ä¾èµ–" class="headerlink" title="12.1 å¼•å…¥ä¾èµ–"></a>12.1 å¼•å…¥ä¾èµ–</h2><p>å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.1 å¼•å…¥ä¾èµ–ã€ã€</a>ä¸€è‡´ï¼Œè§ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-ack/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶</p>
<h2 id="12-2-åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#12-2-åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="12.2 åº”ç”¨é…ç½®æ–‡ä»¶"></a>12.2 åº”ç”¨é…ç½®æ–‡ä»¶</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-ack/src/main/resources"><code>resources</code></a> ç›®å½•ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-ack/src/main/resources/application.yaml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  # Kafka é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProperties é…ç½®ç±»</span><br><span class="line">  kafka:</span><br><span class="line">    bootstrap-servers: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9092</span> # æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span><br><span class="line">    # Kafka Producer é…ç½®é¡¹</span><br><span class="line">    producer:</span><br><span class="line">      acks: <span class="number">1</span> # <span class="number">0</span>-ä¸åº”ç­”ã€‚<span class="number">1</span>-leader åº”ç­”ã€‚all-æ‰€æœ‰ leader å’Œ follower åº”ç­”ã€‚</span><br><span class="line">      retries: <span class="number">3</span> # å‘é€å¤±è´¥æ—¶ï¼Œé‡è¯•å‘é€çš„æ¬¡æ•°</span><br><span class="line">      key-serializer: org.apache.kafka.common.serialization.StringSerializer # æ¶ˆæ¯çš„ key çš„åºåˆ—åŒ–</span><br><span class="line">      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer # æ¶ˆæ¯çš„ value çš„åºåˆ—åŒ–</span><br><span class="line">    # Kafka Consumer é…ç½®é¡¹</span><br><span class="line">    consumer:</span><br><span class="line">      auto-offset-reset: earliest # è®¾ç½®æ¶ˆè´¹è€…åˆ†ç»„æœ€åˆçš„æ¶ˆè´¹è¿›åº¦ä¸º earliest ã€‚å¯å‚è€ƒåšå®¢ https:<span class="comment">//blog.csdn.net/lishuangzhe7047/article/details/74530417 ç†è§£</span></span><br><span class="line">      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer</span><br><span class="line">      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer</span><br><span class="line">      enable-auto-commit: <span class="literal">false</span> # ä½¿ç”¨ Spring-Kafka çš„æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶</span><br><span class="line">      properties:</span><br><span class="line">        spring:</span><br><span class="line">          json:</span><br><span class="line">            trusted:</span><br><span class="line">              packages: cn.iocoder.springboot.lab03.kafkademo.message</span><br><span class="line">    # Kafka Consumer Listener ç›‘å¬å™¨é…ç½®</span><br><span class="line">    listener:</span><br><span class="line">      missing-topics-fatal: <span class="literal">false</span> # æ¶ˆè´¹ç›‘å¬æ¥å£ç›‘å¬çš„ä¸»é¢˜ä¸å­˜åœ¨æ—¶ï¼Œé»˜è®¤ä¼šæŠ¥é”™ã€‚æ‰€ä»¥é€šè¿‡è®¾ç½®ä¸º <span class="literal">false</span> ï¼Œè§£å†³æŠ¥é”™</span><br><span class="line">      ack-mode: MANUAL</span><br><span class="line"></span><br><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    org:</span><br><span class="line">      springframework:</span><br><span class="line">        kafka: ERROR # spring-kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span><br><span class="line">      apache:</span><br><span class="line">        kafka: ERROR # kafka INFO æ—¥å¿—å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é™åˆ¶åªæ‰“å° ERROR çº§åˆ«</span><br></pre></td></tr></table></figure>



<ul>
<li><p>ç›¸æ¯”</p>
<p>ã€Œ3.2 åº”ç”¨é…ç½®æ–‡ä»¶ã€</p>
<p>æ¥è¯´ï¼Œå¢åŠ å¦‚ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>æ·»åŠ  <code>spring.kafka.consumer.enable-auto-commit=false</code> é…ç½®ï¼Œä½¿ç”¨ Spring-Kafka çš„æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶ã€‚ğŸ˜ˆ è®¾è®¡æƒ…å†µä¸‹ï¼Œä¸æ·»åŠ è¯¥é…ç½®é¡¹ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸º <code>false</code> æ˜¯é»˜è®¤å€¼ã€‚</li>
<li>æ·»åŠ  <code>spring.kafka.listener.ack-mode=MANUAL</code> é…ç½®ï¼Œä½¿ç”¨ MANUAL æ¨¡å¼ï¼šè°ƒç”¨æ—¶ï¼Œå…ˆæ ‡è®°æäº¤æ¶ˆè´¹è¿›åº¦ã€‚ç­‰åˆ°å½“å‰æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆï¼Œç„¶ååœ¨æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</li>
</ul>
</li>
</ul>
<h2 id="12-3-Demo08Message"><a href="#12-3-Demo08Message" class="headerlink" title="12.3 Demo08Message"></a>12.3 Demo08Message</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-ack/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message"><code>cn.iocoder.springboot.lab03.kafkademo.message</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-ack/src/main/java/cn/iocoder/springboot/lab03/kafkademo/message/Demo08Message.java">Demo08Message</a> æ¶ˆæ¯ç±»ï¼Œæä¾›ç»™å½“å‰ç¤ºä¾‹ä½¿ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo04Message.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo08Message</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC</span> <span class="operator">=</span> <span class="string">&quot;DEMO_08&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–å·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... çœç•¥ set/get/toString æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>TOPIC</code> é™æ€å±æ€§ï¼Œæˆ‘ä»¬è®¾ç½®è¯¥æ¶ˆæ¯ç±»å¯¹åº” Topic ä¸º <code>&quot;DEMO_08&quot;</code> ã€‚</li>
</ul>
<h2 id="12-4-Demo08Producer"><a href="#12-4-Demo08Producer" class="headerlink" title="12.4 Demo08Producer"></a>12.4 Demo08Producer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-ack/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer"><code>cn.iocoder.springboot.lab03.kafkademo.producer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-ack/src/main/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo08Producer.java">Demo08Producer</a> ç±»ï¼Œå®ƒä¼šä½¿ç”¨ Kafka-Spring å°è£…æä¾›çš„ KafkaTemplate ï¼ŒåŒæ­¥å‘é€æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo08Producer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo08Producer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;Object, Object&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SendResult <span class="title function_">syncSend</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Demo08Message æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Demo08Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo08Message</span>();</span><br><span class="line">        message.setId(id);</span><br><span class="line">        <span class="comment">// åŒæ­¥å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> kafkaTemplate.send(Demo08Message.TOPIC, message).get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Boot/Kafka/#">ã€Œ3.5 Demo01Producerã€</a>çš„åŒæ­¥å‘é€æ¶ˆæ¯çš„ä»£ç æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯æ¢æˆäº† Demo08Message ã€‚</li>
</ul>
<h2 id="12-5-Demo08Consumer"><a href="#12-5-Demo08Consumer" class="headerlink" title="12.5 Demo08Consumer"></a>12.5 Demo08Consumer</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-ack/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/"><code>cn.iocoder.springboot.lab03.kafkademo.consumer</code></a> åŒ…ä¸‹ï¼Œåˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-03-kafka/lab-03-kafka-demo-ack/src/main/java/cn/iocoder/springboot/lab03/kafkademo/consumer/Demo08Consumer.java">Demo08Consumer</a> ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo08Consumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo08Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo08Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo08-consumer-group-&quot; + Demo08Message.TOPIC)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Demo08Message message, Acknowledgment acknowledgment)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">        <span class="comment">// æäº¤æ¶ˆè´¹è¿›åº¦</span></span><br><span class="line">        <span class="keyword">if</span> (message.getId() % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            acknowledgment.acknowledge();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>åœ¨æ¶ˆè´¹æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬å¢åŠ äº†ç¬¬äºŒä¸ªæ–¹æ³•å‚æ•°ï¼Œç±»å‹ä¸º <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/support/Acknowledgment.java">Acknowledgment</a> ç±»ã€‚é€šè¿‡è°ƒç”¨å…¶ <code>#acknowledge()</code> æ–¹æ³•ï¼Œå¯ä»¥æäº¤å½“å‰æ¶ˆæ¯çš„ Topic çš„ Partition çš„æ¶ˆè´¹è¿›åº¦ã€‚</li>
<li>åœ¨æ¶ˆè´¹é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬æ•…æ„åªæäº¤æ¶ˆè´¹çš„æ¶ˆæ¯çš„ <code>Demo08Message.id</code> ä¸º<strong>å¥‡æ•°</strong>çš„æ¶ˆæ¯ã€‚ğŸ˜ˆ è¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å‘é€ä¸€æ¡ <code>id=1</code> ï¼Œä¸€æ¡ <code>id=2</code> çš„æ¶ˆæ¯ï¼Œå¦‚æœç¬¬äºŒæ¡çš„æ¶ˆè´¹è¿›åº¦æ²¡æœ‰è¢«æäº¤ï¼Œå°±å¯ä»¥è¯´æ˜æ‰‹åŠ¨æäº¤æ¶ˆè´¹è¿›åº¦æˆåŠŸã€‚</li>
</ul>
<h2 id="12-6-ç®€å•æµ‹è¯•"><a href="#12-6-ç®€å•æµ‹è¯•" class="headerlink" title="12.6 ç®€å•æµ‹è¯•"></a>12.6 ç®€å•æµ‹è¯•</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-03-kafka/lab-03-kafka-demo-ack/src/test/java/cn/iocoder/springboot/lab03/kafkademo/producer/Demo08ProducerTest.java">Demo08ProducerTest</a> æµ‹è¯•ç±»ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯•æ‰‹åŠ¨æäº¤æ¶ˆè´¹è¿›åº¦ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo08ProducerTest.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo08ProducerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Demo08Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSyncSend</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1</span>; id &lt;= <span class="number">2</span>; id++) &#123;</span><br><span class="line">            <span class="type">SendResult</span> <span class="variable">result</span> <span class="operator">=</span> producer.syncSend(id);</span><br><span class="line">            logger.info(<span class="string">&quot;[testSyncSend][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€ç»“æœï¼š[&#123;&#125;]]&quot;</span>, id, result);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾…ï¼Œä¿è¯æ¶ˆè´¹</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ‰§è¡Œ <code>#testSyncSend()</code> å•å…ƒæµ‹è¯•ï¼Œè¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Producer åŒæ­¥å‘é€ 2 æ¡æ¶ˆæ¯æˆåŠŸ</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">23</span>:<span class="number">41</span>:<span class="number">20.914</span>  INFO <span class="number">43412</span> --- [           main] c.i.s.l.k.producer.Demo08ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">1</span>] å‘é€ç»“æœï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_08, partition=<span class="literal">null</span>, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [<span class="number">99</span>, <span class="number">110</span>, <span class="number">46</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">112</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">98</span>, <span class="number">111</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">46</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">68</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">48</span>, <span class="number">56</span>, <span class="number">77</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>])], isReadOnly = <span class="literal">true</span>), key=<span class="literal">null</span>, value=Demo08Message&#123;id=<span class="number">1</span>&#125;, timestamp=<span class="literal">null</span>), recordMetadata=DEMO_08-<span class="number">0</span>@<span class="number">0</span>]]]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">23</span>:<span class="number">41</span>:<span class="number">20.916</span>  INFO <span class="number">43412</span> --- [           main] c.i.s.l.k.producer.Demo08ProducerTest    : [testSyncSend][å‘é€ç¼–å·ï¼š[<span class="number">2</span>] å‘é€ç»“æœï¼š[SendResult [producerRecord=ProducerRecord(topic=DEMO_08, partition=<span class="literal">null</span>, headers=RecordHeaders(headers = [RecordHeader(key = __TypeId__, value = [<span class="number">99</span>, <span class="number">110</span>, <span class="number">46</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">112</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">98</span>, <span class="number">111</span>, <span class="number">111</span>, <span class="number">116</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">102</span>, <span class="number">107</span>, <span class="number">97</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">46</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>, <span class="number">46</span>, <span class="number">68</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">48</span>, <span class="number">56</span>, <span class="number">77</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">101</span>])], isReadOnly = <span class="literal">true</span>), key=<span class="literal">null</span>, value=Demo08Message&#123;id=<span class="number">2</span>&#125;, timestamp=<span class="literal">null</span>), recordMetadata=DEMO_08-<span class="number">0</span>@<span class="number">1</span>]]]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Demo08Consumer æ¶ˆè´¹ 2 æ¡æ¶ˆæ¯æˆåŠŸ</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">23</span>:<span class="number">41</span>:<span class="number">21.006</span>  INFO <span class="number">43412</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo08Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo08Message&#123;id=<span class="number">1</span>&#125;]</span><br><span class="line"><span class="number">2019</span>-<span class="number">12</span>-<span class="number">07</span> <span class="number">23</span>:<span class="number">41</span>:<span class="number">21.006</span>  INFO <span class="number">43412</span> --- [ntainer#<span class="number">0</span>-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.consumer.Demo08Consumer        : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">16</span> æ¶ˆæ¯å†…å®¹ï¼šDemo08Message&#123;id=<span class="number">2</span>&#125;]</span><br></pre></td></tr></table></figure>



<p>æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/yahoo/kafka-manager">Kafka Manager</a> æ¥æŸ¥çœ‹ <code>&quot;DEMO_08&quot;</code> çš„æ¶ˆè´¹è€…åˆ—è¡¨ï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F837ddfe7871e1cbaa4c1bf1c815e40ca.png" alt=" çš„æ¶ˆè´¹è€…åˆ—è¡¨"></p>
<ul>
<li>ç¬¬ 2 æ¡æ¶ˆæ¯çš„æ¶ˆè´¹è¿›åº¦ï¼Œæœªè¢«æäº¤ï¼Œç¬¦åˆé¢„æœŸ~</li>
</ul>
<h1 id="â€”â€”â€“-4"><a href="#â€”â€”â€“-4" class="headerlink" title="â€”â€”â€“"></a>â€”â€”â€“</h1><h1 id="SpringCloudä¸­çš„Kafka"><a href="#SpringCloudä¸­çš„Kafka" class="headerlink" title="SpringCloudä¸­çš„Kafka"></a>SpringCloudä¸­çš„Kafka</h1><h1 id="â€”â€”â€“-5"><a href="#â€”â€”â€“-5" class="headerlink" title="â€”â€”â€“"></a>â€”â€”â€“</h1><blockquote>
<p>æœ¬æ–‡åœ¨æä¾›å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œå¯è§ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs">https://github.com/YunaiV/SpringBoot-Labs</a> çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka">labx-11-spring-cloud-stream-kafka</a> ç›®å½•ã€‚</p>
<p>åŸåˆ›ä¸æ˜“ï¼Œç»™ç‚¹ä¸ª <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/stargazers">Star</a> å˜¿ï¼Œä¸€èµ·å†²é¸­ï¼</p>
</blockquote>
<h1 id="1-æ¦‚è¿°-2"><a href="#1-æ¦‚è¿°-2" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>æœ¬æ–‡æˆ‘ä»¬æ¥å­¦ä¹  <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka">Spring Cloud Stream Kafka</a> ç»„ä»¶ï¼ŒåŸºäº <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream">Spring Cloud Stream</a> çš„ç¼–ç¨‹æ¨¡å‹ï¼Œæ¥å…¥ <strong>Kafka</strong> ä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ç°æ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡ã€‚</p>
<blockquote>
<p>FROM <a target="_blank" rel="noopener" href="https://www.oschina.net/p/kafka">ã€Šåˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ Kafkaã€‹</a></p>
<p>Kafka æ˜¯ä¸€ç§é«˜ååé‡çš„åˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œå¥¹æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>é€šè¿‡ O(1) çš„ç£ç›˜æ•°æ®ç»“æ„æä¾›æ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œè¿™ç§ç»“æ„å¯¹äºå³ä½¿æ•°ä»¥TBçš„æ¶ˆæ¯å­˜å‚¨ä¹Ÿèƒ½å¤Ÿä¿æŒé•¿æ—¶é—´çš„ç¨³å®šæ€§èƒ½ã€‚</li>
<li>é«˜ååé‡ï¼šå³ä½¿æ˜¯éå¸¸æ™®é€šçš„ç¡¬ä»¶kafkaä¹Ÿå¯ä»¥æ”¯æŒæ¯ç§’æ•°åä¸‡çš„æ¶ˆæ¯ã€‚</li>
<li>æ”¯æŒé€šè¿‡ Kafka æœåŠ¡å™¨å’Œæ¶ˆè´¹æœºé›†ç¾¤æ¥åˆ†åŒºæ¶ˆæ¯ã€‚</li>
</ul>
</blockquote>
<p>åœ¨å¼€å§‹æœ¬æ–‡ä¹‹å‰ï¼Œèƒ–å‹éœ€è¦å¯¹ Kafka è¿›è¡Œç®€å•çš„å­¦ä¹ ã€‚å¯ä»¥é˜…è¯»<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Kafka/install/?self">ã€ŠKafka æç®€å…¥é—¨ã€‹</a>æ–‡ç« ï¼Œå°†ç¬¬<strong>ä¸€äºŒ</strong>å°èŠ‚çœ‹å®Œï¼Œåœ¨æœ¬æœºæ­å»ºä¸€ä¸ª Kafka æœåŠ¡ã€‚</p>
<h1 id="2-Spring-Cloud-Stream-ä»‹ç»"><a href="#2-Spring-Cloud-Stream-ä»‹ç»" class="headerlink" title="2. Spring Cloud Stream ä»‹ç»"></a>2. Spring Cloud Stream ä»‹ç»</h1><p><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream">Spring Cloud Stream</a> æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºåŸºäº<strong>æ¶ˆæ¯</strong>çš„å¾®æœåŠ¡åº”ç”¨æ¡†æ¶ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://www.oschina.net/p/spring+integration">Spring Integration</a> ä¸ Broker è¿›è¡Œè¿æ¥ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå¯èƒ½æœ‰èƒ–å‹å¯¹ Broker ä¸å¤ªäº†è§£ï¼Œæˆ‘ä»¬æ¥ç®€å•è§£é‡Šä¸‹ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶éƒ½æœ‰ä¸€ä¸ª <strong>Broker Server</strong>ï¼ˆä»£ç†æœåŠ¡å™¨ï¼‰ï¼Œæ¶ˆæ¯ä¸­è½¬è§’è‰²ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€è½¬å‘æ¶ˆæ¯ã€‚</p>
<p>ä¾‹å¦‚è¯´åœ¨ RocketMQ ä¸­ï¼ŒBroker è´Ÿè´£æ¥æ”¶ä»ç”Ÿäº§è€…å‘é€æ¥çš„æ¶ˆæ¯å¹¶å­˜å‚¨ã€åŒæ—¶ä¸ºæ¶ˆè´¹è€…çš„æ‹‰å–è¯·æ±‚ä½œå‡†å¤‡ã€‚å¦å¤–ï¼ŒBroker ä¹Ÿå­˜å‚¨æ¶ˆæ¯ç›¸å…³çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬æ¶ˆè´¹è€…ç»„ã€æ¶ˆè´¹è¿›åº¦åç§»å’Œä¸»é¢˜å’Œé˜Ÿåˆ—æ¶ˆæ¯ç­‰ã€‚</p>
</blockquote>
<p>Spring Cloud Stream æä¾›äº†æ¶ˆæ¯ä¸­é—´ä»¶çš„<strong>ç»Ÿä¸€æŠ½è±¡</strong>ï¼Œæ¨å‡ºäº† publish-subscribeã€consumer groupsã€partition è¿™äº›ç»Ÿä¸€çš„æ¦‚å¿µã€‚</p>
<p>Spring Cloud Stream å†…éƒ¨æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼š<strong>Binder</strong> å’Œ <strong>Binding</strong>ã€‚</p>
<p>â‘  **<a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/binder/Binder.java">Binder</a>**ï¼Œè·Ÿæ¶ˆæ¯ä¸­é—´ä»¶é›†æˆçš„ç»„ä»¶ï¼Œç”¨æ¥åˆ›å»ºå¯¹åº”çš„ Bindingã€‚å„æ¶ˆæ¯ä¸­é—´ä»¶éƒ½æœ‰è‡ªå·±çš„ Binder å…·ä½“å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Binder</span>&lt;T, </span><br><span class="line">    C <span class="keyword">extends</span> <span class="title class_">ConsumerProperties</span>, <span class="comment">// æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line">    P <span class="keyword">extends</span> <span class="title class_">ProducerProperties</span>&gt; &#123; <span class="comment">// ç”Ÿäº§è€…é…ç½®</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºæ¶ˆè´¹è€…çš„ Binding</span></span><br><span class="line">    Binding&lt;T&gt; <span class="title function_">bindConsumer</span><span class="params">(String name, String group, T inboundBindTarget, C consumerProperties)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç”Ÿäº§è€…çš„ Binding</span></span><br><span class="line">    Binding&lt;T&gt; <span class="title function_">bindProducer</span><span class="params">(String name, T outboundBindTarget, P producerProperties)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>Kafka å®ç°äº† <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka/blob/master/spring-cloud-stream-binder-kafka/src/main/java/org/springframework/cloud/stream/binder/kafka/KafkaMessageChannelBinder.java">KafkaMessageChannelBinder</a></li>
<li>RabbitMQ å®ç°äº† <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream-binder-rabbit/blob/master/spring-cloud-stream-binder-rabbit/src/main/java/org/springframework/cloud/stream/binder/rabbit/RabbitMessageChannelBinder.java">RabbitMessageChannelBinder</a></li>
<li>RocketMQ å®ç°äº† <a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-stream-binder-rocketmq/src/main/java/com/alibaba/cloud/stream/binder/rocketmq/RocketMQMessageChannelBinder.java">RocketMQMessageChannelBinder</a></li>
</ul>
<p>â‘¡ **<a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/binder/Binding.java">Binding</a>**ï¼ŒåŒ…æ‹¬ Input Binding å’Œ Output Bindingã€‚Binding åœ¨æ¶ˆæ¯ä¸­é—´ä»¶ä¸åº”ç”¨ç¨‹åºæä¾›çš„ Provider å’Œ Consumer ä¹‹é—´æä¾›äº†ä¸€ä¸ªæ¡¥æ¢ï¼Œå®ç°äº†å¼€å‘è€…åªéœ€ä½¿ç”¨åº”ç”¨ç¨‹åºçš„ Provider æˆ– Consumer ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®å³å¯ï¼Œå±è”½äº†å¼€å‘è€…ä¸åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„æ¥è§¦ã€‚</p>
<p>æœ€ç»ˆæ•´ä½“äº¤äº’å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F47e3a32ab66c617b0bb0a831760570c3.png" alt="Spring Cloud Stream Application"></p>
<p>å¯èƒ½çœ‹å®Œä¹‹åï¼Œèƒ–å‹å¯¹ Spring Cloud Stream è¿˜æ˜¯æœ‰ç‚¹æ‡µé€¼ï¼Œå¹¶ä¸”è§‰å¾—æ¦‚å¿µæ€ä¹ˆè¿™ä¹ˆå¤šå‘¢ï¼Ÿä¸è¦æ…Œï¼Œæˆ‘ä»¬å…ˆæ¥å¿«é€Ÿå…¥ä¸ªé—¨ï¼Œä¼šæœ‰æ›´åŠ å…·è±¡çš„æ„Ÿå—ã€‚</p>
<h1 id="3-å¿«é€Ÿå…¥é—¨-1"><a href="#3-å¿«é€Ÿå…¥é—¨-1" class="headerlink" title="3. å¿«é€Ÿå…¥é—¨"></a>3. å¿«é€Ÿå…¥é—¨</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a></li>
</ul>
<p>å‹æƒ…æç¤ºï¼šè¿™å¯èƒ½æ˜¯ä¸€ä¸ªä¿¡æ¯é‡æœ‰ç‚¹å¤§çš„å…¥é—¨å†…å®¹ï¼Œè¯·ä¿æŒè€å¿ƒ~</p>
</blockquote>
<p>æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å¿«é€Ÿå…¥é—¨ä¸‹ï¼Œä¼šåˆ›å»º 2 ä¸ªé¡¹ç›®ï¼Œåˆ†åˆ«ä½œä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F7c137d39b5a094ef9e804aa389cf5e1e.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="3-1-æ­å»ºç”Ÿäº§è€…"><a href="#3-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="3.1 æ­å»ºç”Ÿäº§è€…"></a>3.1 æ­å»ºç”Ÿäº§è€…</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®ï¼Œä½œä¸ºç”Ÿäº§è€…ã€‚</p>
<h3 id="3-1-1-å¼•å…¥ä¾èµ–"><a href="#3-1-1-å¼•å…¥ä¾èµ–" class="headerlink" title="3.1.1 å¼•å…¥ä¾èµ–"></a>3.1.1 å¼•å…¥ä¾èµ–</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ Spring Cloud Stream Kafka ç›¸å…³ä¾èµ–ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>labx-11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.iocoder.springboot.labs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>labx-11-sc-stream-kafka-producer-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.boot.version</span>&gt;</span>2.2.4.RELEASE<span class="tag">&lt;/<span class="name">spring.boot.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.cloud.version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">spring.cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        å¼•å…¥ Spring Bootã€Spring Cloudã€Spring Cloud Alibaba ä¸‰è€… BOM æ–‡ä»¶ï¼Œè¿›è¡Œä¾èµ–ç‰ˆæœ¬çš„ç®¡ç†ï¼Œé˜²æ­¢ä¸å…¼å®¹ã€‚</span></span><br><span class="line"><span class="comment">        åœ¨ https://dwz.cn/mcLIfNKt æ–‡ç« ä¸­ï¼ŒSpring Cloud Alibaba å¼€å‘å›¢é˜Ÿæ¨èäº†ä¸‰è€…çš„ä¾èµ–å…³ç³»</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥ SpringMVC ç›¸å…³ä¾èµ–ï¼Œå¹¶å®ç°å¯¹å…¶çš„è‡ªåŠ¨é…ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥ Spring Cloud Stream Kafka ç›¸å…³ä¾èµ–ï¼Œå°† Kafka ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶å®ç°å¯¹å…¶çš„è‡ªåŠ¨é…ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>é€šè¿‡å¼•å…¥ <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-stream-kafka"><code>spring-cloud-starter-stream-kafka</code></a> ä¾èµ–ï¼Œå¼•å…¥å¹¶å®ç° Stream Kafka çš„è‡ªåŠ¨é…ç½®ã€‚åœ¨è¯¥ä¾èµ–ä¸­ï¼Œå·²ç»å¸®æˆ‘ä»¬è‡ªåŠ¨å¼•å…¥ Kafka çš„å¤§é‡ä¾èµ–ï¼Œéå¸¸æ–¹ä¾¿ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F9d2db5b41ce3cbc563710dbbfcf3713b.png" alt="img"></p>
<h3 id="3-1-2-é…ç½®æ–‡ä»¶"><a href="#3-1-2-é…ç½®æ–‡ä»¶" class="headerlink" title="3.1.2 é…ç½®æ–‡ä»¶"></a>3.1.2 é…ç½®æ–‡ä»¶</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/src/main/resources/application.yml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  Spring Cloud Stream Kafka ç›¸å…³é…ç½®ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-producer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-output:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">        <span class="comment"># Kafka è‡ªå®šä¹‰ Binding é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBindingProperties Map</span></span><br><span class="line">        <span class="attr">bindings:</span></span><br><span class="line">          <span class="attr">demo01-output:</span></span><br><span class="line">            <span class="comment"># Kafka Producer é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProducerProperties ç±»</span></span><br><span class="line">            <span class="attr">producer:</span></span><br><span class="line">              <span class="attr">sync:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦åŒæ­¥å‘é€æ¶ˆæ¯ï¼Œé»˜è®¤ä¸º false å¼‚æ­¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18080</span></span><br></pre></td></tr></table></figure>



<p>â‘  <code>spring.cloud.stream</code> ä¸º Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/config/BindingServiceProperties.java">BindingServiceProperties</a> ç±»ã€‚é…ç½®çš„å±‚çº§æœ‰ç‚¹æ·±ï¼Œæˆ‘ä»¬ä¸€å±‚ä¸€å±‚æ¥çœ‹çœ‹ã€‚</p>
<p>â‘¡ <code>spring.cloud.stream.bindings</code> ä¸º Binding é…ç½®é¡¹ï¼Œå¯¹åº” <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/config/BindingProperties.java">BindingProperties</a> Mapã€‚å…¶ä¸­ï¼Œ<em>key</em> ä¸º Binding çš„åå­—ã€‚è¦æ³¨æ„ï¼Œè™½ç„¶è¯´ Binding åˆ†æˆ Input å’Œ Output ä¸¤ç§ç±»å‹ï¼Œä½†æ˜¯åœ¨é…ç½®é¡¹ä¸­å¹¶ä¸ä¼šä½“ç°å‡ºæ¥ï¼Œè€Œæ˜¯è¦åœ¨ç¨åæ­é… <code>@Input</code> è¿˜æ˜¯ <code>@Output</code> æ³¨è§£ï¼Œæ‰ä¼šæœ‰å…·ä½“çš„åŒºåˆ†ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬é…ç½®äº†ä¸€ä¸ªåå­—ä¸º <code>demo01-output</code> çš„ Bindingã€‚ä»å‘½åä¸Šï¼Œæˆ‘ä»¬çš„æ„å›¾æ˜¯æƒ³ä½œä¸º Output Bindingï¼Œç”¨äºç”Ÿäº§è€…å‘é€æ¶ˆæ¯ã€‚</p>
<ul>
<li><p><code>destination</code>ï¼šç›®çš„åœ°ã€‚åœ¨ Kafka ä¸­ï¼Œä½¿ç”¨ Topic ä½œä¸ºç›®çš„åœ°ã€‚è¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸º <code>DEMO-TOPIC-01</code>ã€‚</p>
<blockquote>
<p><strong>Topicï¼ˆä¸»é¢˜ï¼‰</strong>ï¼šæ¯æ¡å‘å¸ƒåˆ° Kafka çš„æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªç±»åˆ«ï¼Œè¿™ä¸ªç±»åˆ«è¢«ç§°ä¸º Topicã€‚</p>
</blockquote>
</li>
<li><p><code>content-type</code>ï¼šå†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON æ ¼å¼ï¼Œå› ä¸ºç¨åæˆ‘ä»¬å°†å‘é€æ¶ˆæ¯çš„ç±»å‹ä¸º POJOï¼Œä½¿ç”¨ JSON è¿›è¡Œåºåˆ—åŒ–ã€‚</p>
</li>
</ul>
<p>â‘¢ <code>spring.cloud.stream.kafka</code> ä¸º Spring Cloud Stream Kafka é…ç½®é¡¹ã€‚</p>
<p>â‘£ <code>spring.cloud.stream.kafka.binder</code> ä¸º Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka/blob/master/spring-cloud-stream-binder-kafka-core/src/main/java/org/springframework/cloud/stream/binder/kafka/properties/KafkaBinderConfigurationProperties.java">KafkaBinderConfigurationProperties</a> ç±»ã€‚</p>
<ul>
<li><p><code>brokers</code>ï¼šæŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”ã€‚</p>
<blockquote>
<p><strong>Broker</strong>ï¼šKafka é›†ç¾¤ä¸­çš„ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ç»Ÿç§°ä¸º Brokerã€‚</p>
</blockquote>
</li>
</ul>
<p>â‘¤ <code>spring.cloud.stream.kafka.bindings</code> ä¸º Kafka <strong>è‡ªå®šä¹‰</strong> Binding é…ç½®é¡¹ï¼Œç”¨äºå¯¹<strong>é€šç”¨çš„</strong> <code>spring.cloud.stream.bindings</code> é…ç½®é¡¹çš„å¢å¼ºï¼Œå®ç° Kafka Binding ç‹¬ç‰¹çš„é…ç½®ã€‚è¯¥é…ç½®é¡¹å¯¹åº” <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka/blob/master/spring-cloud-stream-binder-kafka-core/src/main/java/org/springframework/cloud/stream/binder/kafka/properties/KafkaBindingProperties.java">KafkaBindingProperties</a> Mapï¼Œå…¶ä¸­ <em>key</em> ä¸º Binding çš„åå­—ï¼Œéœ€è¦å¯¹åº”ä¸Šå™¢ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹åå­—ä¸º <code>demo01-output</code> çš„ Binding è¿›è¡Œå¢å¼ºï¼Œè¿›è¡Œ Producer çš„é…ç½®ã€‚å…¶ä¸­ï¼Œ<code>producer</code> ä¸º Kafka Producer é…ç½®é¡¹ï¼Œå¯¹åº” <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka/blob/master/spring-cloud-stream-binder-kafka-core/src/main/java/org/springframework/cloud/stream/binder/kafka/properties/KafkaProducerProperties.java">KafkaProducerProperties</a> ç±»ã€‚</p>
<ul>
<li><code>sync</code>ï¼šæ˜¯å¦åŒæ­¥å‘é€æ¶ˆæ¯ï¼Œé»˜è®¤ä¸º <code>false</code> å¼‚æ­¥ã€‚ä¸€èˆ¬ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä½¿ç”¨åŒæ­¥å‘é€æ¶ˆæ¯è¾ƒå¤šï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸º <code>true</code> åŒæ­¥æ¶ˆæ¯ã€‚</li>
</ul>
<h3 id="3-1-3-MySource"><a href="#3-1-3-MySource" class="headerlink" title="3.1.3 MySource"></a>3.1.3 MySource</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/kafkademo/message/MySource.java">MySource</a> æ¥å£ï¼Œå£°æ˜åå­—ä¸º Output Bindingã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MySource</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Output(&quot;demo01-output&quot;)</span></span><br><span class="line">    MessageChannel <span class="title function_">demo01Output</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/annotation/Output.java"><code>@Output</code></a> æ³¨è§£ï¼Œå£°æ˜äº†ä¸€ä¸ªåå­—ä¸º <code>demo01-output</code> çš„ Output Bindingã€‚æ³¨æ„ï¼Œè¿™ä¸ªåå­—è¦å’Œæˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­çš„ <code>spring.cloud.stream.bindings</code> é…ç½®é¡¹å¯¹åº”ä¸Šã€‚</p>
<p>åŒæ—¶ï¼Œ<code>@Output</code> æ³¨è§£çš„æ–¹æ³•çš„è¿”å›ç»“æœä¸º <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-messaging/src/main/java/org/springframework/messaging/MessageChannel.java">MessageChannel</a> ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå‘é€æ¶ˆæ¯ã€‚MessageChannel æä¾›çš„å‘é€æ¶ˆæ¯çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MessageChannel</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">long</span> <span class="variable">INDEFINITE_TIMEOUT</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">send</span><span class="params">(Message&lt;?&gt; message)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> send(message, INDEFINITE_TIMEOUT);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">send</span><span class="params">(Message&lt;?&gt; message, <span class="type">long</span> timeout)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ˜¯å¦è¦å®ç° MySource æ¥å£å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>ä¸éœ€è¦</strong>ï¼Œå…¨éƒ¨äº¤ç»™ Spring Cloud Stream çš„ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/binding/BindableProxyFactory.java">BindableProxyFactory</a> æ¥è§£å†³ã€‚BindableProxyFactory ä¼šé€šè¿‡åŠ¨æ€ä»£ç†ï¼Œ<strong>è‡ªåŠ¨</strong>å®ç° MySource æ¥å£ã€‚ è€Œ <code>@Output</code> æ³¨è§£çš„æ–¹æ³•çš„è¿”å›å€¼ï¼ŒBindableProxyFactory ä¼šæ‰«æå¸¦æœ‰ <code>@Output</code> æ³¨è§£çš„æ–¹æ³•ï¼Œ<strong>è‡ªåŠ¨</strong>è¿›è¡Œåˆ›å»ºã€‚</p>
<p>ä¾‹å¦‚è¯´ï¼Œ<code>#demo01Output()</code> æ–¹æ³•è¢«<strong>è‡ªåŠ¨</strong>åˆ›å»ºè¿”å›ç»“æœä¸º <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/messaging/DirectWithAttributesChannel.java">DirectWithAttributesChannel</a>ï¼Œå®ƒæ˜¯ MessageChannel çš„å­ç±»ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥åœ¨ BindableProxyFactory çš„ <code>#afterPropertiesSet()</code> å’Œ <code>#invoke(MethodInvocation invocation)</code> æ–¹æ³•ä¸Šï¼Œéƒ½æ‰“ä¸Šä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åè¿›è¡Œæ„‰å¿«çš„è°ƒè¯•ã€‚</p>
</blockquote>
<h3 id="3-1-4-Demo01Message"><a href="#3-1-4-Demo01Message" class="headerlink" title="3.1.4 Demo01Message"></a>3.1.4 Demo01Message</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/kafkademo/message/Demo01Message.java">Demo01Message</a> ç±»ï¼Œç¤ºä¾‹ Message æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Message</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¼–å·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... çœç•¥ setter/getter/toString æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-1-5-Demo01Controller"><a href="#3-1-5-Demo01Controller" class="headerlink" title="3.1.5 Demo01Controller"></a>3.1.5 Demo01Controller</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/kafkademo/controller/Demo01Controller.java">Demo01Controller</a> ç±»ï¼Œæä¾›å‘é€æ¶ˆæ¯çš„ HTTP æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/demo01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Controller</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MySource mySource; <span class="comment">// &lt;X&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/send&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">send</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// &lt;1&gt; åˆ›å»º Message</span></span><br><span class="line">        <span class="type">Demo01Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo01Message</span>()</span><br><span class="line">                .setId(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt());</span><br><span class="line">        <span class="comment">// &lt;2&gt; åˆ›å»º Spring Message å¯¹è±¡</span></span><br><span class="line">        Message&lt;Demo01Message&gt; springMessage = MessageBuilder.withPayload(message)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// &lt;3&gt; å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">return</span> mySource.demo01Output().send(springMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><code>&lt;X&gt;</code> å¤„ï¼Œä½¿ç”¨ <code>@Autowired</code> æ³¨è§£ï¼Œæ³¨å…¥ MySource Beanã€‚</li>
<li><code>&lt;1&gt;</code> å¤„ï¼Œåˆ›å»º Demo01Message å¯¹è±¡ã€‚</li>
<li><code>&lt;2&gt;</code> å¤„ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-messaging/src/main/java/org/springframework/messaging/support/MessageBuilder.java">MessageBuilder</a> åˆ›å»º Spring <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-messaging/src/main/java/org/springframework/messaging/Message.java">Message</a> å¯¹è±¡ï¼Œå¹¶è®¾ç½®æ¶ˆæ¯å†…å®¹ä¸º Demo01Message å¯¹è±¡ã€‚</li>
<li><code>&lt;3&gt;</code> å¤„ï¼Œé€šè¿‡ MySource è·å¾— MessageChannel å¯¹è±¡ï¼Œç„¶åå‘é€æ¶ˆæ¯ã€‚</li>
</ul>
<h3 id="3-1-6-ProducerApplication"><a href="#3-1-6-ProducerApplication" class="headerlink" title="3.1.6 ProducerApplication"></a>3.1.6 ProducerApplication</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/kafkademo/ProducerApplication.java">ProducerApplication</a> ç±»ï¼Œå¯åŠ¨åº”ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableBinding(MySource.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ProducerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/annotation/EnableBinding.java"><code>@EnableBinding</code></a> æ³¨è§£ï¼Œå£°æ˜æŒ‡å®šæ¥å£å¼€å¯ Binding åŠŸèƒ½ï¼Œæ‰«æå…¶ <code>@Input</code> å’Œ <code>@Output</code> æ³¨è§£ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®ä¸º MySource æ¥å£ã€‚</p>
<h2 id="3-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#3-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="3.2 æ­å»ºæ¶ˆè´¹è€…"></a>3.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="3-2-1-å¼•å…¥ä¾èµ–"><a href="#3-2-1-å¼•å…¥ä¾èµ–" class="headerlink" title="3.2.1 å¼•å…¥ä¾èµ–"></a>3.2.1 å¼•å…¥ä¾èµ–</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ Spring Cloud Alibaba Kafka ç›¸å…³ä¾èµ–ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3.1.1 å¼•å…¥ä¾èµ–ã€</a>åŸºæœ¬ä¸€æ ·ï¼Œç‚¹å‡» <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/pom.xml">é“¾æ¥</a> æŸ¥çœ‹ã€‚</p>
</blockquote>
<h3 id="3-2-2-é…ç½®æ–‡ä»¶"><a href="#3-2-2-é…ç½®æ–‡ä»¶" class="headerlink" title="3.2.2 é…ç½®æ–‡ä»¶"></a>3.2.2 é…ç½®æ–‡ä»¶</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/src/main/resources/application.yml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  Spring Cloud Stream Kafka ç›¸å…³é…ç½®ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-consumer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-input:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">demo01-consumer-group</span> <span class="comment"># æ¶ˆè´¹è€…åˆ†ç»„</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;random.int[10000,19999]&#125;</span> <span class="comment"># éšæœºç«¯å£ï¼Œæ–¹ä¾¿å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…</span></span><br></pre></td></tr></table></figure>



<p>æ€»ä½“æ¥è¯´ï¼Œå’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3.1.2 é…ç½®æ–‡ä»¶ã€</a>æ˜¯æ¯”è¾ƒæ¥è¿‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¯´å·®å¼‚ç‚¹å™¢ã€‚</p>
<p>â‘  <code>spring.cloud.stream.bindings</code> ä¸º Binding é…ç½®é¡¹ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬é…ç½®äº†ä¸€ä¸ªåå­—ä¸º <code>demo01-input</code> çš„ Bindingã€‚ä»å‘½åä¸Šï¼Œæˆ‘ä»¬çš„æ„å›¾æ˜¯æƒ³ä½œä¸º Input Bindingï¼Œç”¨äºæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€‚</p>
<ul>
<li><p><code>group</code>ï¼šæ¶ˆè´¹è€…åˆ†ç»„ã€‚</p>
<blockquote>
<p><strong>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</strong>ï¼šåŒä¸€ç±» Consumer çš„é›†åˆï¼Œè¿™ç±» Consumer é€šå¸¸æ¶ˆè´¹åŒä¸€ç±»æ¶ˆæ¯ä¸”æ¶ˆè´¹é€»è¾‘ä¸€è‡´ã€‚æ¶ˆè´¹è€…ç»„ä½¿å¾—åœ¨æ¶ˆæ¯æ¶ˆè´¹æ–¹é¢ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’Œå®¹é”™çš„ç›®æ ‡å˜å¾—éå¸¸å®¹æ˜“ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…å®ä¾‹å¿…é¡»è®¢é˜…å®Œå…¨ç›¸åŒçš„ Topicã€‚</p>
</blockquote>
</li>
</ul>
<p>å¯¹äºæ¶ˆè´¹é˜Ÿåˆ—çš„æ¶ˆè´¹è€…ï¼Œä¼šæœ‰ä¸¤ç§æ¶ˆè´¹æ¨¡å¼ï¼šé›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰å’Œå¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰ã€‚</p>
<blockquote>
<ul>
<li><strong>é›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰</strong>ï¼šé›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹,ç›¸åŒ Consumer Group çš„æ¯ä¸ª Consumer å®ä¾‹å¹³å‡åˆ†æ‘Šæ¶ˆæ¯ã€‚</li>
<li><strong>å¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰</strong>ï¼šå¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒ Consumer Group çš„æ¯ä¸ª Consumer å®ä¾‹éƒ½æ¥æ”¶å…¨é‡çš„æ¶ˆæ¯ã€‚</li>
</ul>
</blockquote>
<p>Kafka çš„æ¶ˆè´¹è€…<strong>ä¸¤ç§æ¨¡å¼éƒ½æ”¯æŒ</strong>ã€‚å› ä¸ºè¿™é‡Œæˆ‘ä»¬é…ç½®äº†æ¶ˆè´¹è€…ç»„ï¼Œæ‰€ä»¥é‡‡ç”¨<strong>é›†ç¾¤æ¶ˆè´¹</strong>ã€‚è‡³äºå¦‚ä½•ä½¿ç”¨å¹¿æ’­æ¶ˆè´¹ï¼Œæˆ‘ä»¬ç¨åä¸¾ä¾‹å­ã€‚</p>
<p>è¿™é‡Œä¸€ç‚¹è¦æ³¨æ„ï¼ï¼ï¼è‰¿è‰¿åŠ äº†ä¸‰ä¸ªæ„Ÿå¹å·ï¼Œä¸€å®šè¦ç†è§£é›†ç¾¤æ¶ˆè´¹å’Œå¹¿æ’­æ¶ˆè´¹çš„å·®å¼‚ã€‚æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼Œä»¥æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…åˆ†ç»„ A å’Œ B çš„åœºæ™¯ä¸¾ä¾‹å­ï¼š</p>
<ul>
<li>å‡è®¾æ¯ä¸ªæ¶ˆè´¹è€…åˆ†ç»„å„å¯åŠ¨<strong>ä¸€ä¸ª</strong>å®ä¾‹ï¼Œæ­¤æ—¶æˆ‘ä»¬å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯ä¼šè¢«ä¸¤ä¸ªæ¶ˆè´¹è€…åˆ†ç»„ <code>&quot;consumer_group_01&quot;</code> å’Œ <code>&quot;consumer_group_02&quot;</code> éƒ½å„è‡ªæ¶ˆè´¹ä¸€æ¬¡ã€‚</li>
<li>å‡è®¾æ¯ä¸ªæ¶ˆè´¹è€…åˆ†ç»„å„å¯åŠ¨<strong>ä¸€ä¸ª</strong>å®ä¾‹ï¼Œæ­¤æ—¶æˆ‘ä»¬å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯ä¼šè¢«åˆ†ç»„ A çš„<strong>æŸä¸ª</strong>å®ä¾‹æ¶ˆè´¹ä¸€æ¬¡ï¼Œè¢«åˆ†ç»„ B çš„<strong>æŸä¸ª</strong>å®ä¾‹ä¹Ÿæ¶ˆè´¹ä¸€æ¬¡</li>
</ul>
<p>é€šè¿‡<strong>é›†ç¾¤æ¶ˆè´¹</strong>çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°é’ˆå¯¹ç›¸åŒ Topic ï¼Œä¸åŒæ¶ˆè´¹è€…åˆ†ç»„å®ç°å„è‡ªçš„ä¸šåŠ¡é€»è¾‘ã€‚ä¾‹å¦‚è¯´ï¼šç”¨æˆ·æ³¨å†ŒæˆåŠŸæ—¶ï¼Œå‘é€ä¸€æ¡ Topic ä¸º <code>&quot;USER_REGISTER&quot;</code> çš„æ¶ˆæ¯ã€‚ç„¶åï¼Œä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„æ¶ˆè´¹è€…åˆ†ç»„ï¼Œè®¢é˜…è¯¥ Topic ï¼Œå®ç°å„è‡ªçš„æ‹“å±•é€»è¾‘ï¼š</p>
<ul>
<li>ç§¯åˆ†æ¨¡å—ï¼šåˆ¤æ–­å¦‚æœæ˜¯æ‰‹æœºæ³¨å†Œï¼Œç»™ç”¨æˆ·å¢åŠ  20 ç§¯åˆ†ã€‚</li>
<li>ä¼˜æƒ åŠµæ¨¡å—ï¼šå› ä¸ºæ˜¯æ–°ç”¨æˆ·ï¼Œæ‰€ä»¥å‘æ”¾æ–°ç”¨æˆ·ä¸“äº«ä¼˜æƒ åŠµã€‚</li>
<li>ç«™å†…ä¿¡æ¨¡å—ï¼šå› ä¸ºæ˜¯æ–°ç”¨æˆ·ï¼Œæ‰€ä»¥å‘é€æ–°ç”¨æˆ·çš„æ¬¢è¿è¯­çš„ç«™å†…ä¿¡ã€‚</li>
<li>â€¦ ç­‰ç­‰</li>
</ul>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æ³¨å†ŒæˆåŠŸåçš„ä¸šåŠ¡æ‹“å±•é€»è¾‘ï¼Œå®ç°ä¸šåŠ¡ä¸Šçš„<strong>è§£è€¦</strong>ï¼Œæœªæ¥ä¹Ÿæ›´åŠ å®¹æ˜“æ‹“å±•ã€‚åŒæ—¶ï¼Œä¹Ÿæé«˜äº†æ³¨å†Œæ¥å£çš„æ€§èƒ½ï¼Œé¿å…ç”¨æˆ·éœ€è¦ç­‰å¾…ä¸šåŠ¡æ‹“å±•é€»è¾‘æ‰§è¡Œå®Œæˆåï¼Œæ‰å“åº”æ³¨å†ŒæˆåŠŸã€‚</p>
<p>åŒæ—¶ï¼Œç›¸åŒæ¶ˆè´¹è€…åˆ†ç»„çš„å¤šä¸ªå®ä¾‹ï¼Œå¯ä»¥å®ç°<strong>é«˜å¯ç”¨</strong>ï¼Œä¿è¯åœ¨ä¸€ä¸ªå®ä¾‹æ„å¤–æŒ‚æ‰çš„æƒ…å†µä¸‹ï¼Œå…¶å®ƒå®ä¾‹èƒ½å¤Ÿé¡¶ä¸Šã€‚å¹¶ä¸”ï¼Œå¤šä¸ªå®ä¾‹éƒ½è¿›è¡Œæ¶ˆè´¹ï¼Œèƒ½å¤Ÿæå‡<strong>æ¶ˆè´¹é€Ÿåº¦</strong>ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå¦‚æœè¿˜ä¸ç†è§£çš„è¯ï¼Œæ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬ä¸‹é¢ä¼šæ¼”ç¤ºä¸‹æˆ‘ä»¬ä¸Šé¢ä¸¾çš„ä¾‹å­ã€‚</p>
</blockquote>
<p>â‘¡ è€ƒè™‘åˆ°ç¨åæˆ‘ä»¬è¦æµ‹è¯•é›†ç¾¤æ¶ˆè´¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç»™ <code>DEMO-TOPIC-01</code> Topic åˆ›å»ºå¤šä¸ª Partitionã€‚åœ¨ Kafka ä¸­ï¼ŒTopic æ˜¯åŸºäº Partition åˆ†é…åˆ°ç›¸åŒæ¶ˆè´¹ç»„ä¸‹çš„æ¶ˆè´¹è€…ï¼Œä»è€Œè¿›è¡Œæ¶ˆè´¹æ¶ˆæ¯çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F10942550a4f09160875fadab05545655.png" alt="æ¶ˆè´¹è€…åˆ†åŒº"></p>
<blockquote>
<p><strong>Partitionï¼ˆåˆ†åŒºï¼‰</strong>ï¼šTopic ç‰©ç†ä¸Šçš„åˆ†ç»„ï¼Œä¸€ä¸ª Topic å¯ä»¥åˆ†ä¸ºå¤šä¸ª Partition ï¼Œæ¯ä¸ª Partition æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ã€‚Partition ä¸­çš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªæœ‰åºçš„ idï¼ˆoffsetï¼‰ã€‚</p>
</blockquote>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬ç»™ <code>DEMO-TOPIC-01</code> Topic åˆ›å»º Partition å¤§å°ä¸º 10ã€‚æ“ä½œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æƒ…å†µä¸€ï¼Œå¦‚æœ `DEMO-TOPIC-<span class="number">01</span>` Topic æœªåˆ›å»ºï¼Œåˆ™è¿›è¡Œåˆ›å»ºï¼š</span><br><span class="line">$ bin/kafka-topics.sh --zookeeper <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span> --create --topic my-topic --partitions <span class="number">10</span> --replication-factor <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># æƒ…å†µäºŒï¼Œå¦‚æœ `DEMO-TOPIC-<span class="number">01</span>` Topic æœªåˆ›å»ºï¼Œåˆ™è¿›è¡Œä¿®æ”¹ Partition å¤§å°ï¼š</span><br><span class="line">$ bin/kafka-topics.sh --zookeeper <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">2181</span> -alter --partitions <span class="number">10</span> --topic DEMO-TOPIC-<span class="number">01</span></span><br></pre></td></tr></table></figure>



<h3 id="3-2-3-MySink"><a href="#3-2-3-MySink" class="headerlink" title="3.2.3 MySink"></a>3.2.3 MySink</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/listener/MySink.java">MySink</a> æ¥å£ï¼Œå£°æ˜åå­—ä¸º Input Bindingã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MySink</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">DEMO01_INPUT</span> <span class="operator">=</span> <span class="string">&quot;demo01-input&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Input(DEMO01_INPUT)</span></span><br><span class="line">    SubscribableChannel <span class="title function_">demo01Input</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/annotation/Input.java"><code>@Input</code></a> æ³¨è§£ï¼Œå£°æ˜äº†ä¸€ä¸ªåå­—ä¸º <code>demo01-input</code> çš„ Input Bindingã€‚æ³¨æ„ï¼Œè¿™ä¸ªåå­—è¦å’Œæˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­çš„ <code>spring.cloud.stream.bindings</code> é…ç½®é¡¹å¯¹åº”ä¸Šã€‚</p>
<p>åŒæ—¶ï¼Œ<code>@Input</code> æ³¨è§£çš„æ–¹æ³•çš„è¿”å›ç»“æœä¸º <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-messaging/src/main/java/org/springframework/messaging/SubscribableChannel.java">SubscribableChannel</a> ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å®ƒè®¢é˜…æ¶ˆæ¯æ¥æ¶ˆè´¹ã€‚MessageChannel æä¾›çš„è®¢é˜…æ¶ˆæ¯çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SubscribableChannel</span> <span class="keyword">extends</span> <span class="title class_">MessageChannel</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">subscribe</span><span class="params">(MessageHandler handler)</span>; <span class="comment">// è®¢é˜…</span></span><br><span class="line"></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">unsubscribe</span><span class="params">(MessageHandler handler)</span>; <span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ˜¯å¦è¦å®ç° MySink æ¥å£å‘¢ï¼Ÿç­”æ¡ˆä¹Ÿæ˜¯<strong>ä¸éœ€è¦</strong>ï¼Œè¿˜æ˜¯å…¨éƒ¨äº¤ç»™ Spring Cloud Stream çš„ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/binding/BindableProxyFactory.java">BindableProxyFactory</a> å¤§å…„å¼Ÿæ¥è§£å†³ã€‚BindableProxyFactory ä¼šé€šè¿‡åŠ¨æ€ä»£ç†ï¼Œ<strong>è‡ªåŠ¨</strong>å®ç° MySink æ¥å£ã€‚ è€Œ <code>@Input</code> æ³¨è§£çš„æ–¹æ³•çš„è¿”å›å€¼ï¼ŒBindableProxyFactory ä¼šæ‰«æå¸¦æœ‰ <code>@Input</code> æ³¨è§£çš„æ–¹æ³•ï¼Œ<strong>è‡ªåŠ¨</strong>è¿›è¡Œåˆ›å»ºã€‚</p>
<p>ä¾‹å¦‚è¯´ï¼Œ<code>#demo01Input()</code> æ–¹æ³•è¢«<strong>è‡ªåŠ¨</strong>åˆ›å»ºè¿”å›ç»“æœä¸º <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/messaging/DirectWithAttributesChannel.java">DirectWithAttributesChannel</a>ï¼Œå®ƒä¹Ÿæ˜¯ SubscribableChannel çš„å­ç±»ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥åœ¨ BindableProxyFactory çš„ <code>#afterPropertiesSet()</code> å’Œ <code>#invoke(MethodInvocation invocation)</code> æ–¹æ³•ä¸Šï¼Œéƒ½æ‰“ä¸Šä¸€ä¸ªæ–­ç‚¹ï¼Œç„¶åè¿›è¡Œæ„‰å¿«çš„è°ƒè¯•ã€‚</p>
</blockquote>
<h3 id="3-2-4-Demo01Message"><a href="#3-2-4-Demo01Message" class="headerlink" title="3.2.4 Demo01Message"></a>3.2.4 Demo01Message</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/message/Demo01Message.java">Demo01Message</a> ç±»ï¼Œç¤ºä¾‹ Message æ¶ˆæ¯ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3.1.4 Demo01Messageã€</a>åŸºæœ¬ä¸€æ ·ï¼Œç‚¹å‡» <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/message/Demo01Message.java">é“¾æ¥</a> æŸ¥çœ‹ã€‚</p>
</blockquote>
<h3 id="3-2-5-Demo01Consumer"><a href="#3-2-5-Demo01Consumer" class="headerlink" title="3.2.5 Demo01Consumer"></a>3.2.5 Demo01Consumer</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/listener/Demo01Consumer.java">Demo01Consumer</a> ç±»ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(MySink.DEMO01_INPUT)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Payload</span> Demo01Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åœ¨æ–¹æ³•ä¸Šï¼Œæ·»åŠ  <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/annotation/StreamListener.java"><code>@StreamListener</code></a> æ³¨è§£ï¼Œå£°æ˜å¯¹åº”çš„ <strong>Input</strong> Bindingã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>MySink.DEMO01_INPUT</code>ã€‚</p>
<p>åˆå› ä¸ºæˆ‘ä»¬æ¶ˆè´¹çš„æ¶ˆæ¯æ˜¯ POJO ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ  <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-messaging/src/main/java/org/springframework/messaging/handler/annotation/Payload.java"><code>@Payload</code></a> æ³¨è§£ï¼Œå£°æ˜éœ€è¦è¿›è¡Œååºåˆ—åŒ–æˆ POJO å¯¹è±¡ã€‚</p>
<h3 id="3-2-6-ConsumerApplication"><a href="#3-2-6-ConsumerApplication" class="headerlink" title="3.2.6 ConsumerApplication"></a>3.2.6 ConsumerApplication</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/ConsumerApplication.java">ConsumerApplication</a> ç±»ï¼Œå¯åŠ¨åº”ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableBinding(MySink.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConsumerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/annotation/EnableBinding.java"><code>@EnableBinding</code></a> æ³¨è§£ï¼Œå£°æ˜æŒ‡å®šæ¥å£å¼€å¯ Binding åŠŸèƒ½ï¼Œæ‰«æå…¶ <code>@Input</code> å’Œ <code>@Output</code> æ³¨è§£ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®ä¸º MySink æ¥å£ã€‚</p>
<h2 id="3-3-æµ‹è¯•å•é›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯"><a href="#3-3-æµ‹è¯•å•é›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯" class="headerlink" title="3.3 æµ‹è¯•å•é›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯"></a>3.3 æµ‹è¯•å•é›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯</h2><p>æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬ä¼šåœ¨<strong>ä¸€ä¸ª</strong>æ¶ˆè´¹è€…é›†ç¾¤å¯åŠ¨<strong>ä¸¤ä¸ª</strong>å®ä¾‹ï¼Œæµ‹è¯•åœ¨é›†ç¾¤æ¶ˆè´¹çš„æƒ…å†µä¸‹çš„è¡¨ç°ã€‚</p>
<p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Application ä¸¤æ¬¡ï¼Œå¯åŠ¨ä¸¤ä¸ª<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ï¼Œä»è€Œå®ç°åœ¨æ¶ˆè´¹è€…åˆ†ç»„ <code>demo01-consumer-group</code> ä¸‹æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…å®ä¾‹ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå› ä¸º IDEA é»˜è®¤åŒä¸€ä¸ªç¨‹åºåªå…è®¸å¯åŠ¨ 1 æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é…ç½® DemoProviderApplication ä¸º <code>Allow parallel run</code>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F1f4cf03d2094060a2c939d78883a69aa.png" alt="Allow parallel run"></p>
</blockquote>
<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send">http://127.0.0.1:18080/demo01/send</a> æ¥å£åæ¬¡ï¼Œå‘é€åæ¡æ¶ˆæ¯ã€‚æ­¤æ—¶åœ¨ IDEA æ§åˆ¶å°çœ‹åˆ°æ¶ˆè´¹è€…æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConsumerApplication æ§åˆ¶å° 01</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">50.461</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">1983864145</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">53.081</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">2014337623</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">53.475</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">250644839</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">53.844</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">2143820238</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">54.289</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">1421045645</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// ConsumerApplication æ§åˆ¶å° 02</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">51.009</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">132504622</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">51.416</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">2052532135</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">51.824</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">223534414</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">52.262</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">1525635094</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">20</span>:<span class="number">59</span>:<span class="number">52.666</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">688399661</span>&#125;]</span><br></pre></td></tr></table></figure>



<p><strong>ç¬¦åˆé¢„æœŸ</strong>ã€‚ä»æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œæ¯æ¡æ¶ˆæ¯ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚</p>
<h2 id="3-4-æµ‹è¯•å¤šé›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯"><a href="#3-4-æµ‹è¯•å¤šé›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯" class="headerlink" title="3.4 æµ‹è¯•å¤šé›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯"></a>3.4 æµ‹è¯•å¤šé›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯</h2><p>æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬ä¼šåœ¨<strong>äºŒä¸ª</strong>æ¶ˆè´¹è€…é›†ç¾¤<strong>å„</strong>å¯åŠ¨<strong>ä¸¤ä¸ª</strong>å®ä¾‹ï¼Œæµ‹è¯•åœ¨é›†ç¾¤æ¶ˆè´¹çš„æƒ…å†µä¸‹çš„è¡¨ç°ã€‚</p>
<p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Application ä¸¤æ¬¡ï¼Œå¯åŠ¨ä¸¤ä¸ª<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ï¼Œä»è€Œå®ç°åœ¨æ¶ˆè´¹è€…åˆ†ç»„ <code>demo01-consumer-group</code> ä¸‹æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…å®ä¾‹ã€‚</p>
<p>â‘¡ ä¿®æ”¹ <code>labx-11-sc-stream-kafka-consumer-demo</code> é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ <code>spring.cloud.stream.bindings.demo01-input.group</code> é…ç½®é¡¹ï¼Œå°†æ¶ˆè´¹è€…åˆ†ç»„æ”¹æˆ <code>demo02-consumer-group</code>ã€‚</p>
<p>ç„¶åï¼Œæ‰§è¡Œ <strong>Consumer</strong>Application ä¸¤æ¬¡ï¼Œå†å¯åŠ¨ä¸¤ä¸ª<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ï¼Œä»è€Œå®ç°åœ¨æ¶ˆè´¹è€…åˆ†ç»„ <code>demo02-consumer-group</code> ä¸‹æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…å®ä¾‹ã€‚</p>
<p>â‘¢ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send">http://127.0.0.1:18080/demo01/send</a> æ¥å£åæ¬¡ï¼Œå‘é€åæ¡æ¶ˆæ¯ã€‚æ­¤æ—¶åœ¨ IDEA æ§åˆ¶å°çœ‹åˆ°æ¶ˆè´¹è€…æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆè´¹è€…åˆ†ç»„ `demo01-consumer-group` çš„ ConsumerApplication æ§åˆ¶å° 01</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">34.728</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1737808914</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">37.728</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">2140451405</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">38.203</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">813702607</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">38.601</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1028557655</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">39.024</span>  INFO <span class="number">65124</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">399853121</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…åˆ†ç»„ `demo01-consumer-group` çš„ ConsumerApplication æ§åˆ¶å° 02</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">35.196</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1461873560</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">35.717</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1947944757</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">36.176</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">151575160</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">36.789</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">88228856</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">37.272</span>  INFO <span class="number">65177</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">790199000</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…åˆ†ç»„ `demo02-consumer-group` çš„ ConsumerApplication æ§åˆ¶å° 01</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">35.196</span>  INFO <span class="number">65419</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1461873560</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">35.717</span>  INFO <span class="number">65419</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1947944757</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">36.176</span>  INFO <span class="number">65419</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">151575160</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">36.789</span>  INFO <span class="number">65419</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">88228856</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">37.272</span>  INFO <span class="number">65419</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">790199000</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…åˆ†ç»„ `demo02-consumer-group` çš„ ConsumerApplication æ§åˆ¶å° 02</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">34.728</span>  INFO <span class="number">65422</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1737808914</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">37.728</span>  INFO <span class="number">65422</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">2140451405</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">38.204</span>  INFO <span class="number">65422</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">813702607</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">38.601</span>  INFO <span class="number">65422</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1028557655</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">21</span>:<span class="number">07</span>:<span class="number">39.024</span>  INFO <span class="number">65422</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">399853121</span>&#125;]</span><br></pre></td></tr></table></figure>



<p><strong>ç¬¦åˆé¢„æœŸ</strong>ã€‚ä»æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œæ¯æ¡æ¶ˆæ¯è¢«<strong>æ¯ä¸ª</strong>æ¶ˆè´¹è€…é›†ç¾¤éƒ½è¿›è¡Œäº†æ¶ˆè´¹ï¼Œä¸”ä»…è¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚</p>
<h2 id="3-5-å°ç»“"><a href="#3-5-å°ç»“" class="headerlink" title="3.5 å°ç»“"></a>3.5 å°ç»“</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº† Stream Kafka çš„å¿«é€Ÿå…¥é—¨ï¼Œæ˜¯ä¸æ˜¯è¿˜æ˜¯è›®ç®€ç­”çš„å™¢ã€‚ç°åœ¨èƒ–å‹å¯ä»¥åœ¨å›è¿‡å¤´çœ‹çœ‹ Binder å’Œ Binding çš„æ¦‚å¿µï¼Œæ˜¯ä¸æ˜¯å°±æ¸…æ™°ä¸€äº›äº†ã€‚</p>
<h1 id="4-å®šæ—¶æ¶ˆæ¯"><a href="#4-å®šæ—¶æ¶ˆæ¯" class="headerlink" title="4. å®šæ—¶æ¶ˆæ¯"></a>4. å®šæ—¶æ¶ˆæ¯</h1><p><strong>Kafka å¹¶æœªæä¾›å®šæ—¶æ¶ˆæ¯çš„åŠŸèƒ½ï¼Œéœ€è¦æˆ‘ä»¬è‡ªè¡Œæ‹“å±•</strong>ã€‚</p>
<p>ä¾‹å¦‚è¯´<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Fight/delayed-message-consume-service-use-kafka/?self">ã€ŠåŸºäº Kafka çš„å®šæ—¶æ¶ˆæ¯&#x2F;ä»»åŠ¡æœã€‹</a>æ–‡ç« ï¼Œæä¾›çš„æ–¹æ¡ˆã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åŸºäº MySQL å­˜å‚¨å®šæ—¶æ¶ˆæ¯ï¼ŒJob æ‰«æåˆ°è¾¾æ—¶é—´çš„å®šæ—¶æ¶ˆæ¯ï¼Œå‘é€ç»™ Kafka ã€‚</p>
<h1 id="5-æ¶ˆè´¹é‡è¯•"><a href="#5-æ¶ˆè´¹é‡è¯•" class="headerlink" title="5. æ¶ˆè´¹é‡è¯•"></a>5. æ¶ˆè´¹é‡è¯•</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/"><code>labx-11-sc-stream-kafka-producer-demo</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-retry/"><code>labx-11-sc-stream-kafka-consumer-retry</code></a></li>
</ul>
</blockquote>
<p>Spring-Kafka æä¾›<strong>æ¶ˆè´¹é‡è¯•</strong>çš„æœºåˆ¶ã€‚åœ¨æ¶ˆæ¯<strong>æ¶ˆè´¹å¤±è´¥</strong>çš„æ—¶å€™ï¼ŒSpring-Kafka ä¼šé€šè¿‡<strong>æ¶ˆè´¹é‡è¯•</strong>æœºåˆ¶ï¼Œé‡æ–°æŠ•é€’è¯¥æ¶ˆæ¯ç»™ Consumer ï¼Œè®© Consumer æœ‰æœºä¼šé‡æ–°æ¶ˆè´¹æ¶ˆæ¯ï¼Œå®ç°æ¶ˆè´¹æˆåŠŸã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šSpring Cloud Stream Kafka æ˜¯åŸºäº <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka">Spring-Kafka</a> æ“ä½œ Kafkaï¼Œå®ƒä»…ä»…æ˜¯ä¸Šå±‚çš„å°è£…å“Ÿã€‚</p>
</blockquote>
<p>å½“ç„¶ï¼ŒSpring-Kafka å¹¶ä¸ä¼šæ— é™é‡æ–°æŠ•é€’æ¶ˆæ¯ç»™ Consumer é‡æ–°æ¶ˆè´¹ï¼Œè€Œæ˜¯åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾¾åˆ° N æ¬¡é‡è¯•æ¬¡æ•°æ—¶ï¼ŒConsumer è¿˜æ˜¯æ¶ˆè´¹å¤±è´¥æ—¶ï¼Œè¯¥æ¶ˆæ¯å°±ä¼šè¿›å…¥åˆ°<strong>æ­»ä¿¡é˜Ÿåˆ—</strong>ã€‚</p>
<blockquote>
<p>æ­»ä¿¡é˜Ÿåˆ—ç”¨äºå¤„ç†æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯ã€‚å½“ä¸€æ¡æ¶ˆæ¯åˆæ¬¡æ¶ˆè´¹å¤±è´¥ï¼ŒSpring-Kafka ä¼šè‡ªåŠ¨è¿›è¡Œæ¶ˆæ¯é‡è¯•ï¼›è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°åï¼Œè‹¥æ¶ˆè´¹ä¾ç„¶å¤±è´¥ï¼Œåˆ™è¡¨æ˜æ¶ˆè´¹è€…åœ¨æ­£å¸¸æƒ…å†µä¸‹æ— æ³•æ­£ç¡®åœ°æ¶ˆè´¹è¯¥æ¶ˆæ¯ï¼Œæ­¤æ—¶ï¼ŒSpring-Kafka ä¸ä¼šç«‹åˆ»å°†æ¶ˆæ¯ä¸¢å¼ƒï¼Œè€Œæ˜¯å°†å…¶å‘é€åˆ°è¯¥æ¶ˆè´¹è€…å¯¹åº”çš„ç‰¹æ®Šé˜Ÿåˆ—ä¸­ã€‚</p>
<p>Spring-Kafka å°†è¿™ç§æ­£å¸¸æƒ…å†µä¸‹æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ç§°ä¸ºæ­»ä¿¡æ¶ˆæ¯ï¼ˆDead-Letter Messageï¼‰ï¼Œå°†å­˜å‚¨æ­»ä¿¡æ¶ˆæ¯çš„ç‰¹æ®Šé˜Ÿåˆ—ç§°ä¸ºæ­»ä¿¡é˜Ÿåˆ—ï¼ˆDead-Letter Queueï¼‰ã€‚åç»­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹æ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è¿›è¡Œé‡å‘ï¼Œæ¥ä½¿å¾—æ¶ˆè´¹è€…å®ä¾‹å†æ¬¡è¿›è¡Œæ¶ˆè´¹ã€‚</p>
</blockquote>
<ul>
<li>åœ¨<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/RocketMQ/?self">ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— RocketMQ å…¥é—¨ã€‹</a>çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ6. æ¶ˆè´¹é‡è¯•ã€</a>å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆè´¹é‡è¯•å’Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ˜¯ RocketMQ è‡ªå¸¦çš„åŠŸèƒ½ã€‚</li>
<li>è€Œåœ¨ Kafka ä¸­ï¼Œæ¶ˆè´¹é‡è¯•å’Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œæ˜¯ç”± Spring-Kafka æ‰€å°è£…æä¾›çš„ã€‚</li>
</ul>
<p>æ¯æ¡æ¶ˆæ¯çš„å¤±è´¥é‡è¯•ï¼Œæ˜¯å¯ä»¥é…ç½®ä¸€å®šçš„<strong>é—´éš”æ—¶é—´</strong>ã€‚å…·ä½“ï¼Œæˆ‘ä»¬åœ¨ç¤ºä¾‹çš„ä»£ç ä¸­ï¼Œæ¥è¿›è¡Œå…·ä½“çš„è§£é‡Šã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Consumer æ¶ˆè´¹é‡è¯•çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F8e3c8812b8a1c0abc2aada0b3d195e61.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="5-1-æ­å»ºç”Ÿäº§è€…"><a href="#5-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="5.1 æ­å»ºç”Ÿäº§è€…"></a>5.1 æ­å»ºç”Ÿäº§è€…</h2><p>ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®å³å¯ã€‚</p>
<h2 id="5-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#5-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="5.2 æ­å»ºæ¶ˆè´¹è€…"></a>5.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-retry/"><code>labx-11-sc-stream-kafka-consumer-retry</code></a> é¡¹ç›®ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="5-2-1-é…ç½®æ–‡ä»¶"><a href="#5-2-1-é…ç½®æ–‡ä»¶" class="headerlink" title="5.2.1 é…ç½®æ–‡ä»¶"></a>5.2.1 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-retry/src/main/resources/application.yml"><code>application.yml</code></a> é…ç½®æ–‡ä»¶ï¼Œå¢åŠ <strong>æ¶ˆè´¹é‡è¯•</strong>ç›¸å…³çš„é…ç½®é¡¹ã€‚æœ€ç»ˆé…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-consumer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-input:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">demo01-consumer-group</span> <span class="comment"># æ¶ˆè´¹è€…åˆ†ç»„</span></span><br><span class="line">          <span class="comment"># Consumer é…ç½®é¡¹ï¼Œå¯¹åº” ConsumerProperties ç±»</span></span><br><span class="line">          <span class="attr">consumer:</span></span><br><span class="line">            <span class="attr">max-attempts:</span> <span class="number">3</span> <span class="comment"># é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 3 æ¬¡ã€‚</span></span><br><span class="line">            <span class="attr">back-off-initial-interval:</span> <span class="number">3000</span> <span class="comment"># é‡è¯•é—´éš”çš„åˆå§‹å€¼ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤ä¸º 1000</span></span><br><span class="line">            <span class="attr">back-off-multiplier:</span> <span class="number">2.0</span> <span class="comment"># é‡è¯•é—´éš”çš„é€’ä¹˜ç³»æ•°ï¼Œé»˜è®¤ä¸º 2.0</span></span><br><span class="line">            <span class="attr">back-off-max-interval:</span> <span class="number">10000</span> <span class="comment"># é‡è¯•é—´éš”çš„æœ€å¤§å€¼ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤ä¸º 10000</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">        <span class="comment"># Kafka Binding é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBindingProperties ç±»</span></span><br><span class="line">        <span class="attr">bindings:</span></span><br><span class="line">          <span class="attr">demo01-input:</span></span><br><span class="line">            <span class="comment"># Kafka Consumer é…ç½®é¡¹ï¼Œå¯¹åº” KafkaConsumerProperties ç±»</span></span><br><span class="line">            <span class="attr">consumer:</span></span><br><span class="line">              <span class="attr">enable-dlq:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¼€å¯æ­»ä¿¡é˜Ÿåˆ—ï¼Œé»˜è®¤ä¸º false å…³é—­</span></span><br><span class="line">              <span class="attr">dlq-name:</span> <span class="comment"># æ­»ä¿¡é˜Ÿåˆ—åï¼Œé»˜è®¤ä¸º `errors.&#123;topicName&#125;.&#123;consumerGroup&#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;random.int[10000,19999]&#125;</span> <span class="comment"># éšæœºç«¯å£ï¼Œæ–¹ä¾¿å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…</span></span><br></pre></td></tr></table></figure>



<p>â‘  <code>spring.cloud.stream.bindings.&lt;bindingName&gt;.consumer</code> ä¸º Spring Cloud Stream Consumer <strong>é€šç”¨</strong>é…ç½®é¡¹ï¼Œå¯¹åº” <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/binder/ConsumerProperties.java">ConsumerProperties</a> ç±»ã€‚</p>
<ul>
<li><p><code>max-attempts</code>ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 3 æ¬¡ã€‚å¦‚æœæƒ³è¦ç¦ç”¨æ‰é‡è¯•ï¼Œå¯ä»¥è®¾ç½®ä¸º 1ã€‚</p>
<blockquote>
<p><code>max-attempts</code> é…ç½®é¡¹è¦æ³¨æ„ï¼Œæ˜¯ä¸€æ¡æ¶ˆæ¯ä¸€å…±å°è¯•æ¶ˆè´¹æ€»å…± <code>max-attempts</code> æ¬¡ï¼ŒåŒ…æ‹¬é¦–æ¬¡çš„æ­£å¸¸æ¶ˆè´¹ã€‚</p>
</blockquote>
</li>
<li><p><code>back-off-initial-interval</code>ï¼šé‡è¯•é—´éš”çš„åˆå§‹å€¼ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤ä¸º 1000ã€‚</p>
</li>
<li><p><code>back-off-multiplier</code>ï¼šé‡è¯•é—´éš”çš„é€’ä¹˜ç³»æ•°ï¼Œé»˜è®¤ä¸º 2.0ã€‚</p>
</li>
<li><p><code>back-off-max-interval</code>ï¼šé‡è¯•é—´éš”çš„æœ€å¤§å€¼ï¼Œå•ä½æ¯«ç§’ï¼Œé»˜è®¤ä¸º 10000ã€‚</p>
</li>
</ul>
<p>å°†å››ä¸ªå‚æ•°ç»„åˆåœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ¶ˆè´¹é‡è¯•çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡ 00:00:00ï¼šé¦–æ¬¡æ¶ˆè´¹ï¼Œå¤±è´¥ã€‚</li>
<li>ç¬¬äºŒæ¬¡ 00:00:03ï¼š3 ç§’åé‡è¯•ï¼Œå› ä¸ºé‡è¯•é—´éš”çš„åˆå§‹å€¼ä¸º <code>back-off-initial-interval</code>ï¼Œç­‰äº 3000 æ¯«ç§’ã€‚</li>
<li>ç¬¬ä¸‰æ¬¡ 00:00:09ï¼š6 ç§’åé‡è¯•ï¼Œå› ä¸ºæœ‰é‡è¯•é—´éš”çš„é€’ä¹˜ç³»æ•° <code>back-off-multiplier</code>ï¼Œæ‰€ä»¥æ˜¯ <code>2.0 * 3000</code> ç­‰äº 6000 æ¯«ç§’ã€‚</li>
<li>ç¬¬å››æ¬¡ï¼Œæ²¡æœ‰ï¼Œå› ä¸ºåˆ°è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œç­‰äº 3ã€‚</li>
</ul>
<p>â‘¡ <code>spring.cloud.stream.kafka.bindings.&lt;bindingName&gt;.consumer</code> ä¸º Spring Cloud Stream Kafka Consumer <strong>ä¸“å±</strong>é…ç½®é¡¹ï¼Œæˆ‘ä»¬æ–°å¢äº†ä¸¤ä¸ªé…ç½®é¡¹ï¼š</p>
<ul>
<li><code>enable-dlq</code>ï¼šæ˜¯å¦å¼€å¯æ­»ä¿¡é˜Ÿåˆ—ï¼Œé»˜è®¤ä¸º <code>false</code> å…³é—­ã€‚è¿™é‡Œï¼Œé—®é—®ä»¬è®¾ç½®ä¸º <code>true</code> æ¥è¿›è¡Œå¼€å¯ã€‚</li>
<li><code>dlq-name</code>ï¼šæ­»ä¿¡é˜Ÿåˆ—åï¼Œé»˜è®¤ä¸º <code>errors.&#123;topicName&#125;.&#123;consumerGroup&#125;</code>ã€‚è¿™é‡Œæˆ‘ä»¬å¹¶æœªè®¾ç½®ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤ï¼Œå³æœ¬å°èŠ‚çš„ç¤ºä¾‹å¯¹åº” <code>errors.DEMO-TOPIC-01.demo01-consumer-group</code>ã€‚</li>
</ul>
<h3 id="5-2-2-Demo01Consumer"><a href="#5-2-2-Demo01Consumer" class="headerlink" title="5.2.2 Demo01Consumer"></a>5.2.2 Demo01Consumer</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-retry/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/listener/Demo01Consumer.java">Demo01Consumer</a> ç±»ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ¨¡æ‹Ÿæ¶ˆè´¹å¤±è´¥ï¼Œä»è€Œæ¼”ç¤ºæ¶ˆè´¹é‡è¯•çš„åŠŸèƒ½ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(MySink.DEMO01_INPUT)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Payload</span> Demo01Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">        <span class="comment">// &lt;X&gt; æ³¨æ„ï¼Œæ­¤å¤„æŠ›å‡ºä¸€ä¸ª RuntimeException å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿæ¶ˆè´¹å¤±è´¥</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æˆ‘å°±æ˜¯æ•…æ„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-3-ç®€å•æµ‹è¯•-1"><a href="#5-3-ç®€å•æµ‹è¯•-1" class="headerlink" title="5.3 ç®€å•æµ‹è¯•"></a>5.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Applicationï¼Œå¯åŠ¨ä¸€ä¸ª<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>æˆ‘ä»¬æ‰“å¼€ Kafka è¿ç»´ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ª <code>errors.DEMO-TOPIC-01.demo01-consumer-group</code> Topicï¼Œå³æœ¬å°èŠ‚çš„æ­»ä¿¡é˜Ÿåˆ—ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F96a5da899c1e3fb6863a5c9f8757edc3.png" alt=" Topic"></p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šKafka è¿ç»´ç•Œé¢ï¼Œå¯ä»¥çœ‹çœ‹<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Kafka/install/?self">ã€ŠèŠ‹é“ Kafka æç®€å…¥é—¨ã€‹</a>æ–‡ç« çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ4. Kafka Managerã€</a>å°èŠ‚ã€‚</p>
</blockquote>
<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send">http://127.0.0.1:18080/demo01/send</a> æ¥å£ï¼Œå‘é€æ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡æ¶ˆè´¹</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">22</span>:<span class="number">14</span>:<span class="number">55.465</span>  INFO <span class="number">67252</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1264911073</span>&#125;]</span><br><span class="line"><span class="comment">// ç¬¬äºŒæ¬¡æ¶ˆè´¹ï¼Œ3 ç§’å</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">22</span>:<span class="number">14</span>:<span class="number">58.467</span>  INFO <span class="number">67252</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1264911073</span>&#125;]</span><br><span class="line"><span class="comment">// ç¬¬ä¸‰æ¬¡æ¶ˆè´¹ï¼Œ6 ç§’å</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">22</span>:<span class="number">15</span>:<span class="number">04.471</span>  INFO <span class="number">67252</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1264911073</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…ç½®çš„ LoggingHandler æ‰“å°å¼‚å¸¸æ—¥å¿—</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">22</span>:<span class="number">15</span>:<span class="number">04.473</span> ERROR <span class="number">67252</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] o.s.integration.handler.LoggingHandler   : org.springframework.messaging.MessagingException: Exception thrown <span class="keyword">while</span> invoking Demo01Consumer#onMessage[<span class="number">1</span> args]; nested exception is java.lang.RuntimeException: æˆ‘å°±æ˜¯æ•…æ„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ <span class="comment">// ... çœç•¥å¼‚å¸¸å †æ ˆ</span></span><br><span class="line">Caused by: java.lang.RuntimeException: æˆ‘å°±æ˜¯æ•…æ„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ <span class="comment">// ... çœç•¥å¼‚å¸¸å †æ ˆ</span></span><br></pre></td></tr></table></figure>



<p>æµ‹è¯• Consumer æ¶ˆè´¹é‡è¯•æˆåŠŸ~</p>
<p>ä¸è¿‡è¦<strong>æ³¨æ„</strong>ï¼Œç›®å‰æˆ‘ä»¬çœ‹åˆ°çš„é‡è¯•æ–¹æ¡ˆï¼Œæ˜¯é€šè¿‡ <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-retry/docs/api/current/org/springframework/retry/support/RetryTemplate.html">RetryTemplate</a> æ¥å®ç°<strong>å®¢æˆ·ç«¯çº§åˆ«</strong>çš„æ¶ˆè´¹å†²æ°´ã€‚è€Œ RetryTemplate åˆæ˜¯é€šè¿‡ <strong>sleep</strong> æ¥å®ç°æ¶ˆè´¹é—´éš”çš„æ—¶å€™ï¼Œè¿™æ ·å°†å½±å“ Consumer çš„æ•´ä½“æ¶ˆè´¹é€Ÿåº¦ï¼Œæ¯•ç«Ÿ sleep ä¼šå ç”¨æ‰çº¿ç¨‹ã€‚</p>
<h1 id="6-æ¶ˆè´¹å¼‚å¸¸å¤„ç†æœºåˆ¶"><a href="#6-æ¶ˆè´¹å¼‚å¸¸å¤„ç†æœºåˆ¶" class="headerlink" title="6. æ¶ˆè´¹å¼‚å¸¸å¤„ç†æœºåˆ¶"></a>6. æ¶ˆè´¹å¼‚å¸¸å¤„ç†æœºåˆ¶</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-error-handler/"><code>labx-11-sc-stream-kafka-consumer-error-handler</code></a></li>
</ul>
</blockquote>
<p>åœ¨ Spring Cloud Stream ä¸­ï¼Œæä¾›äº†<strong>é€šç”¨</strong>çš„æ¶ˆè´¹å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥æ‹¦æˆªåˆ°æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ—¶å‘ç”Ÿçš„å¼‚å¸¸ï¼Œè¿›è¡Œè‡ªå®šä¹‰çš„å¤„ç†é€»è¾‘ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ª Spring Cloud Stream æ¶ˆè´¹å¼‚å¸¸å¤„ç†æœºåˆ¶çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Fb7a0fbeef788a195540c64c0a63f187e.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="6-1-æ­å»ºç”Ÿäº§è€…"><a href="#6-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="6.1 æ­å»ºç”Ÿäº§è€…"></a>6.1 æ­å»ºç”Ÿäº§è€…</h2><p>ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®å³å¯ã€‚</p>
<h2 id="6-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#6-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="6.2 æ­å»ºæ¶ˆè´¹è€…"></a>6.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ5. æ¶ˆè´¹é‡è¯•ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-retry/"><code>labx-11-sc-stream-kafka-consumer-retry</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-error-handler/"><code>labx-11-sc-stream-kafka-consumer-error-handler</code></a> é¡¹ç›®ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="6-2-1-Demo01Consumer"><a href="#6-2-1-Demo01Consumer" class="headerlink" title="6.2.1 Demo01Consumer"></a>6.2.1 Demo01Consumer</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-error-handler/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/listener/Demo01Consumer.java">Demo01Consumer</a> ç±»ï¼Œå¢åŠ æ¶ˆè´¹å¼‚å¸¸å¤„ç†æ–¹æ³•ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(MySink.DEMO01_INPUT)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Payload</span> Demo01Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">        <span class="comment">// &lt;X&gt; æ³¨æ„ï¼Œæ­¤å¤„æŠ›å‡ºä¸€ä¸ª RuntimeException å¼‚å¸¸ï¼Œæ¨¡æ‹Ÿæ¶ˆè´¹å¤±è´¥</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æˆ‘å°±æ˜¯æ•…æ„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ServiceActivator(inputChannel = &quot;DEMO-TOPIC-01.demo01-consumer-group.errors&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleError</span><span class="params">(ErrorMessage errorMessage)</span> &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;[handleError][payloadï¼š&#123;&#125;]&quot;</span>, errorMessage.getPayload().getMessage());</span><br><span class="line">        logger.error(<span class="string">&quot;[handleError][originalMessageï¼š&#123;&#125;]&quot;</span>, errorMessage.getOriginalMessage());</span><br><span class="line">        logger.error(<span class="string">&quot;[handleError][headersï¼š&#123;&#125;]&quot;</span>, errorMessage.getHeaders());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(IntegrationContextUtils.ERROR_CHANNEL_BEAN_NAME)</span> <span class="comment">// errorChannel</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">globalHandleError</span><span class="params">(ErrorMessage errorMessage)</span> &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;[globalHandleError][payloadï¼š&#123;&#125;]&quot;</span>, errorMessage.getPayload().getMessage());</span><br><span class="line">        logger.error(<span class="string">&quot;[globalHandleError][originalMessageï¼š&#123;&#125;]&quot;</span>, errorMessage.getOriginalMessage());</span><br><span class="line">        logger.error(<span class="string">&quot;[globalHandleError][headersï¼š&#123;&#125;]&quot;</span>, errorMessage.getHeaders());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>â‘  åœ¨ Spring Integration çš„è®¾å®šä¸­ï¼Œè‹¥ <code>#onMessage(@Payload Demo01Message message)</code> æ–¹æ³•æ¶ˆè´¹æ¶ˆæ¯å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šå‘é€é”™è¯¯æ¶ˆæ¯ï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-messaging/src/main/java/org/springframework/messaging/support/ErrorMessage.java">ErrorMessage</a>ï¼‰åˆ°å¯¹åº”çš„**é”™è¯¯ Channelï¼ˆ<code>&lt;destination&gt;.&lt;group&gt;.errors</code>ï¼‰**ä¸­ã€‚åŒæ—¶ï¼Œæ‰€æœ‰é”™è¯¯ Channel éƒ½æ¡¥æ¥åˆ°äº† Spring Integration å®šä¹‰çš„**å…¨å±€é”™è¯¯ Channel(<code>errorChannel</code>)**ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå…ˆæš‚æ—¶è®°ä½ Spring Integration è¿™æ ·çš„è®¾å®šï¼Œè‰¿è‰¿ä¹Ÿæ²¡å»æ·±ç©¶ T Tï¼Œä¹Ÿæ˜¯ä¸€è„¸æ‡µé€¼ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æœ‰<strong>ä¸¤ç§</strong>æ–¹å¼æ¥å®ç°å¼‚å¸¸å¤„ç†ï¼š</p>
<ul>
<li><strong>å±€éƒ¨</strong>çš„å¼‚å¸¸å¤„ç†ï¼šé€šè¿‡è®¢é˜…æŒ‡å®š<strong>é”™è¯¯ Channel</strong></li>
<li><strong>å…¨å±€</strong>çš„å¼‚å¸¸å¤„ç†ï¼šé€šè¿‡è®¢é˜…<strong>å…¨å±€é”™è¯¯ Channel</strong></li>
</ul>
<p>â‘¡ åœ¨ <code>#handleError(ErrorMessage errorMessage)</code> æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬å£°æ˜äº† <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-integration/blob/master/spring-integration-core/src/main/java/org/springframework/integration/annotation/ServiceActivator.java"><code>@ServiceActivator</code></a> æ³¨è§£ï¼Œè®¢é˜…<strong>æŒ‡å®šé”™è¯¯ Channel</strong>çš„é”™è¯¯æ¶ˆæ¯ï¼Œå®ç° <code>#onMessage(@Payload Demo01Message message)</code> æ–¹æ³•çš„<strong>å±€éƒ¨</strong>å¼‚å¸¸å¤„ç†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Fb6c58f403ca177f11cc89b8c8d2f3800.png" alt="å¯¹åº”å…³ç³»"></p>
<p>â‘¢ åœ¨ <code>#globalHandleError(ErrorMessage errorMessage)</code> æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬å£°æ˜äº† <code>@StreamListener</code> æ³¨è§£ï¼Œè®¢é˜…<strong>å…¨å±€é”™è¯¯ Channel</strong>çš„é”™è¯¯æ¶ˆæ¯ï¼Œå®ç°<strong>å…¨å±€</strong>å¼‚å¸¸å¤„ç†ã€‚</p>
<p>â‘£ åœ¨<strong>å…¨å±€</strong>å’Œ<strong>å±€éƒ¨</strong>å¼‚å¸¸å¤„ç†éƒ½å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œé”™è¯¯æ¶ˆæ¯ä»…ä¼šè¢«<strong>ç¬¦åˆæ¡ä»¶</strong>çš„<strong>å±€éƒ¨</strong>é”™è¯¯å¼‚å¸¸å¤„ç†ã€‚å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ï¼Œé”™è¯¯æ¶ˆæ¯æ‰ä¼šè¢«<strong>å…¨å±€</strong>å¼‚å¸¸å¤„ç†ã€‚</p>
<h2 id="6-3-ç®€å•æµ‹è¯•"><a href="#6-3-ç®€å•æµ‹è¯•" class="headerlink" title="6.3 ç®€å•æµ‹è¯•"></a>6.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Applicationï¼Œå¯åŠ¨<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send">http://127.0.0.1:18080/demo01/send</a> æ¥å£ï¼Œå‘é€ä¸€æ¡æ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onMessage æ–¹æ³•ï¼Œä¸€å…± 3 æ¬¡ï¼ŒåŒ…æ‹¬é‡è¯•</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">07</span>:<span class="number">38</span>:<span class="number">23.037</span>  INFO <span class="number">68126</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1512001860</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">07</span>:<span class="number">38</span>:<span class="number">26.045</span>  INFO <span class="number">68126</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1512001860</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">07</span>:<span class="number">38</span>:<span class="number">32.046</span>  INFO <span class="number">68126</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1512001860</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// handleError æ–¹æ³•</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">07</span>:<span class="number">38</span>:<span class="number">32.054</span> ERROR <span class="number">68126</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [handleError][payloadï¼šException thrown <span class="keyword">while</span> invoking Demo01Consumer#onMessage[<span class="number">1</span> args]; nested exception is java.lang.RuntimeException: æˆ‘å°±æ˜¯æ•…æ„æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">07</span>:<span class="number">38</span>:<span class="number">32.054</span> ERROR <span class="number">68126</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [handleError][originalMessageï¼šGenericMessage [payload=<span class="type">byte</span>[<span class="number">18</span>], headers=&#123;kafka_offset=<span class="number">45</span>, scst_nativeHeadersPresent=<span class="literal">true</span>, kafka_consumer=org.apache.kafka.clients.consumer.KafkaConsumer<span class="meta">@e32f669</span>, deliveryAttempt=<span class="number">3</span>, kafka_timestampType=CREATE_TIME, kafka_receivedMessageKey=<span class="literal">null</span>, kafka_receivedPartitionId=<span class="number">0</span>, contentType=application/json, kafka_receivedTopic=DEMO-TOPIC-<span class="number">01</span>, kafka_receivedTimestamp=<span class="number">1583710702910</span>, kafka_groupId=demo01-consumer-group&#125;]]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">07</span>:<span class="number">38</span>:<span class="number">32.054</span> ERROR <span class="number">68126</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [handleError][headersï¼š&#123;kafka_data=ConsumerRecord(topic = DEMO-TOPIC-<span class="number">01</span>, partition = <span class="number">0</span>, leaderEpoch = <span class="number">0</span>, offset = <span class="number">45</span>, CreateTime = <span class="number">1583710702910</span>, serialized <span class="type">key</span> <span class="variable">size</span> <span class="operator">=</span> -<span class="number">1</span>, serialized <span class="type">value</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">18</span>, headers = RecordHeaders(headers = [RecordHeader(key = contentType, value = [<span class="number">34</span>, <span class="number">97</span>, <span class="number">112</span>, <span class="number">112</span>, <span class="number">108</span>, <span class="number">105</span>, <span class="number">99</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">47</span>, <span class="number">106</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">34</span>]), RecordHeader(key = spring_json_header_types, value = [<span class="number">123</span>, <span class="number">34</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">101</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">84</span>, <span class="number">121</span>, <span class="number">112</span>, <span class="number">101</span>, <span class="number">34</span>, <span class="number">58</span>, <span class="number">34</span>, <span class="number">106</span>, <span class="number">97</span>, <span class="number">118</span>, <span class="number">97</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">46</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">34</span>, <span class="number">125</span>])], isReadOnly = <span class="literal">false</span>), key = <span class="literal">null</span>, value = [B@57ae40f0), id=e6852311-62b5-cc85-1f63-cef9a01847a2, sourceData=ConsumerRecord(topic = DEMO-TOPIC-<span class="number">01</span>, partition = <span class="number">0</span>, leaderEpoch = <span class="number">0</span>, offset = <span class="number">45</span>, CreateTime = <span class="number">1583710702910</span>, serialized <span class="type">key</span> <span class="variable">size</span> <span class="operator">=</span> -<span class="number">1</span>, serialized <span class="type">value</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">18</span>, headers = RecordHeaders(headers = [RecordHeader(key = contentType, value = [<span class="number">34</span>, <span class="number">97</span>, <span class="number">112</span>, <span class="number">112</span>, <span class="number">108</span>, <span class="number">105</span>, <span class="number">99</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">105</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">47</span>, <span class="number">106</span>, <span class="number">115</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">34</span>]), RecordHeader(key = spring_json_header_types, value = [<span class="number">123</span>, <span class="number">34</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">101</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">84</span>, <span class="number">121</span>, <span class="number">112</span>, <span class="number">101</span>, <span class="number">34</span>, <span class="number">58</span>, <span class="number">34</span>, <span class="number">106</span>, <span class="number">97</span>, <span class="number">118</span>, <span class="number">97</span>, <span class="number">46</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">46</span>, <span class="number">83</span>, <span class="number">116</span>, <span class="number">114</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">34</span>, <span class="number">125</span>])], isReadOnly = <span class="literal">false</span>), key = <span class="literal">null</span>, value = [B@57ae40f0), timestamp=<span class="number">1583710712046</span>&#125;]</span><br></pre></td></tr></table></figure>



<p>ğŸ˜† ä¸è¿‡è¦æ³¨æ„ï¼Œå¦‚æœå¼‚å¸¸å¤„ç†æ–¹æ³•æˆåŠŸï¼Œæ²¡æœ‰é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œä¼šè®¤å®šä¸ºè¯¥æ¶ˆæ¯è¢«<strong>æ¶ˆè´¹æˆåŠŸ</strong>ï¼Œæ‰€ä»¥å°±ä¸ä¼šå‘åˆ°æ­»ä¿¡é˜Ÿåˆ—äº†å™¢ã€‚</p>
<h1 id="7-å¹¿æ’­æ¶ˆè´¹"><a href="#7-å¹¿æ’­æ¶ˆè´¹" class="headerlink" title="7. å¹¿æ’­æ¶ˆè´¹"></a>7. å¹¿æ’­æ¶ˆè´¹</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-broadcasting/"><code>labx-11-sc-stream-kafka-consumer-broadcasting</code></a></li>
</ul>
</blockquote>
<p>åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„éƒ½æ˜¯ä½¿ç”¨é›†ç¾¤æ¶ˆè´¹ã€‚è€Œåœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<strong>å¹¿æ’­æ¶ˆè´¹</strong>ã€‚</p>
<blockquote>
<p>å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒ Consumer Group çš„æ¯ä¸ª Consumer å®ä¾‹éƒ½æ¥æ”¶å…¨é‡çš„æ¶ˆæ¯ã€‚</p>
</blockquote>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼Ÿ</strong></p>
<p>ä¾‹å¦‚è¯´ï¼Œåœ¨åº”ç”¨ä¸­ï¼Œç¼“å­˜äº†æ•°æ®å­—å…¸ç­‰é…ç½®è¡¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥é€šè¿‡ Kafka å¹¿æ’­æ¶ˆè´¹ï¼Œå®ç°æ¯ä¸ªåº”ç”¨èŠ‚ç‚¹éƒ½æ¶ˆè´¹æ¶ˆæ¯ï¼Œåˆ·æ–°æœ¬åœ°å†…å­˜çš„ç¼“å­˜ã€‚</p>
<p>åˆä¾‹å¦‚è¯´ï¼Œæˆ‘ä»¬åŸºäº WebSocket å®ç°äº† IM èŠå¤©ï¼Œåœ¨æˆ‘ä»¬ç»™ç”¨æˆ·ä¸»åŠ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“ç”¨æˆ·è¿æ¥çš„æ˜¯å“ªä¸ªæä¾› WebSocket çš„åº”ç”¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ Kafka å¹¿æ’­æ¶ˆè´¹ï¼Œæ¯ä¸ªåº”ç”¨åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯å’Œè‡ªå·±æä¾›çš„ WebSocket æœåŠ¡è¿æ¥ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ¨é€æ¶ˆæ¯ç»™ç”¨æˆ·ã€‚</p>
<p><strong>å¦‚ä½•å®ç°ï¼Ÿ</strong></p>
<p>ä¸è¿‡ Kafka å¹¶ä¸ç›´æ¥æä¾›<strong>å†…ç½®çš„</strong>å¹¿æ’­æ¶ˆè´¹çš„åŠŸèƒ½ï¼ï¼ï¼æ­¤æ—¶ï¼Œæˆ‘ä»¬åªèƒ½é€€è€Œæ±‚å…¶æ¬¡ï¼Œæ¯ä¸ª Consumer <strong>ç‹¬æœ‰</strong>ä¸€ä¸ª Consumer Group ï¼Œä»è€Œä¿è¯éƒ½èƒ½æ¥æ”¶åˆ°å…¨é‡çš„æ¶ˆæ¯</p>
<p>æ°å¥½ï¼ŒSpring Cloud Stream RabbitMQ åœ¨è®¾ç½® Consumer çš„æ¶ˆè´¹è€…åˆ†ç»„ä¸ºç©ºæ—¶ï¼Œä¼šä¸ºè¯¥ Consumer ç”Ÿæˆä¸€ä¸ª<strong>ç‹¬æœ‰</strong>çš„<strong>éšæœº</strong>çš„æ¶ˆè´¹è€…åˆ†ç»„ï¼Œä»è€Œå®ç°<strong>å¹¿æ’­æ¶ˆè´¹</strong>çš„åŠŸèƒ½ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Consumer å¹¿æ’­æ¶ˆè´¹çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Fcd95d1edcda75f7acc74a164c7d0dfc1.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="7-1-æ­å»ºç”Ÿäº§è€…"><a href="#7-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="7.1 æ­å»ºç”Ÿäº§è€…"></a>7.1 æ­å»ºç”Ÿäº§è€…</h2><p>ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®å³å¯ã€‚</p>
<h2 id="7-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#7-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="7.2 æ­å»ºæ¶ˆè´¹è€…"></a>7.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-broadcasting/"><code>labx-11-sc-stream-kafka-consumer-broadcasting</code></a> é¡¹ç›®ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="7-2-1-é…ç½®æ–‡ä»¶"><a href="#7-2-1-é…ç½®æ–‡ä»¶" class="headerlink" title="7.2.1 é…ç½®æ–‡ä»¶"></a>7.2.1 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-error-handler/src/main/resources/application.yml"><code>application.yml</code></a> é…ç½®æ–‡ä»¶ï¼Œåˆ é™¤ Consumer çš„æ¶ˆè´¹è€…åˆ†ç»„é…ç½®é¡¹ <code>group</code> å³å¯ã€‚å®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-consumer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-input:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line"><span class="comment">#          group: demo01-consumer-group # æ¶ˆè´¹è€…åˆ†ç»„</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;random.int[10000,19999]&#125;</span> <span class="comment"># éšæœºç«¯å£ï¼Œæ–¹ä¾¿å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…</span></span><br></pre></td></tr></table></figure>



<h2 id="7-3-ç®€å•æµ‹è¯•"><a href="#7-3-ç®€å•æµ‹è¯•" class="headerlink" title="7.3 ç®€å•æµ‹è¯•"></a>7.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Application ä¸¤æ¬¡ï¼Œå¯åŠ¨ä¸¤ä¸ª<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>æˆ‘ä»¬æ‰“å¼€ Kafka è¿ç»´ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ° Spring Cloud Stream Kafka ç”Ÿæˆçš„ä»¥ <code>anonymous.</code> å¼€å¤´çš„æ¶ˆè´¹è€…åˆ†ç»„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F36633b9dc9558f98d50a2d1bc9c1a285.png" alt="è¿ç»´ç•Œé¢"></p>
<p>åŒæ—¶æˆ‘ä»¬åœ¨ IDEA æ§åˆ¶å°çš„æ—¥å¿—ä¸­ï¼Œä¹Ÿå¯ä»¥çœ‹ Spring Cloud Stream Kafka ç”Ÿæˆçš„ä»¥ <code>anonymous.</code> å¼€å¤´çš„æ¶ˆè´¹è€…åˆ†ç»„ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConsumerApplication æ§åˆ¶å° 01</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">13</span>:<span class="number">54.091</span>  INFO <span class="number">68839</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1092051199</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">13</span>:<span class="number">54.422</span>  INFO <span class="number">68839</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">618964293</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">13</span>:<span class="number">54.721</span>  INFO <span class="number">68839</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">94760781</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// ConsumerApplication æ§åˆ¶å° 02</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">13</span>:<span class="number">54.092</span>  INFO <span class="number">68852</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">26</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1092051199</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">13</span>:<span class="number">54.422</span>  INFO <span class="number">68852</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">26</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">618964293</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">13</span>:<span class="number">54.721</span>  INFO <span class="number">68852</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">26</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">94760781</span>&#125;]</span><br></pre></td></tr></table></figure>



<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send">http://127.0.0.1:18080/demo01/send</a> æ¥å£ä¸‰æ¬¡ï¼Œå‘é€ä¸‰æ¡æ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConsumerApplication æ§åˆ¶å° 01</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">07</span> <span class="number">15</span>:<span class="number">43</span>:<span class="number">35.883</span>  INFO <span class="number">46486</span> --- [Z-_87KO2Pl-WQ-<span class="number">1</span>] c.i.s.l.r.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">2084635466</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">07</span> <span class="number">15</span>:<span class="number">43</span>:<span class="number">37.278</span>  INFO <span class="number">46486</span> --- [Z-_87KO2Pl-WQ-<span class="number">1</span>] c.i.s.l.r.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">2118253111</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">07</span> <span class="number">15</span>:<span class="number">43</span>:<span class="number">37.652</span>  INFO <span class="number">46486</span> --- [Z-_87KO2Pl-WQ-<span class="number">1</span>] c.i.s.l.r.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">1956010289</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// ConsumerApplication æ§åˆ¶å° 02</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">07</span> <span class="number">15</span>:<span class="number">43</span>:<span class="number">35.884</span>  INFO <span class="number">46527</span> --- [2e8iPDhSVKdcg-<span class="number">1</span>] c.i.s.l.r.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">2084635466</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">07</span> <span class="number">15</span>:<span class="number">43</span>:<span class="number">37.278</span>  INFO <span class="number">46527</span> --- [2e8iPDhSVKdcg-<span class="number">1</span>] c.i.s.l.r.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">2118253111</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">07</span> <span class="number">15</span>:<span class="number">43</span>:<span class="number">37.652</span>  INFO <span class="number">46527</span> --- [2e8iPDhSVKdcg-<span class="number">1</span>] c.i.s.l.r.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">1956010289</span>&#125;]</span><br></pre></td></tr></table></figure>



<p><strong>ç¬¦åˆé¢„æœŸ</strong>ã€‚ä»æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œæ¯æ¡æ¶ˆæ¯ä»…è¢«æ¯ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹äº†ä¸€æ¬¡ã€‚</p>
<h1 id="8-å¹¶å‘æ¶ˆè´¹"><a href="#8-å¹¶å‘æ¶ˆè´¹" class="headerlink" title="8. å¹¶å‘æ¶ˆè´¹"></a>8. å¹¶å‘æ¶ˆè´¹</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-concurrency/"><code>labx-11-sc-stream-kafka-consumer-concurrency</code></a></li>
</ul>
</blockquote>
<p>åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é…ç½®çš„æ¯ä¸€ä¸ª Binding çš„ Consumerï¼Œéƒ½æ˜¯<strong>ä¸²è¡Œ</strong>æ¶ˆè´¹çš„ã€‚æ˜¾ç„¶ï¼Œè¿™åœ¨ç›‘å¬çš„ Topic æ¯ç§’æ¶ˆæ¯é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹ä¸åŠæ—¶ï¼Œå¯¼è‡´æ¶ˆæ¯ç§¯å‹çš„é—®é¢˜ã€‚</p>
<p>è™½ç„¶è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯åŠ¨å¤šä¸ª JVM è¿›ç¨‹ï¼Œå®ç°<strong>å¤šè¿›ç¨‹çš„å¹¶å‘æ¶ˆè´¹</strong>ï¼Œä»è€ŒåŠ é€Ÿæ¶ˆè´¹çš„é€Ÿåº¦ã€‚ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œå¦èƒ½å¤Ÿå®ç°<strong>å¤šçº¿ç¨‹</strong>çš„å¹¶å‘æ¶ˆè´¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>æœ‰</strong>ã€‚</p>
<p>é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­çš„ <code>spring.cloud.stream.bindings.&lt;bindingName&gt;.consumer.concurrency</code> é…ç½®é¡¹ï¼Œå¯ä»¥æŒ‡å®šè¯¥ Binder å¹¶å‘æ¶ˆè´¹çš„çº¿ç¨‹æ•°ã€‚ä¾‹å¦‚è¯´ï¼Œå¦‚æœè®¾ç½® <code>concurrency=10</code> æ—¶ï¼ŒSpring Cloud Stream Kafka å°±ä¼šä¸º<strong>è¯¥</strong> Binder åˆ›å»º 10 ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ¶ˆè´¹ã€‚</p>
<p>è€ƒè™‘åˆ°è®©èƒ–å‹èƒ½å¤Ÿæ›´å¥½çš„ç†è§£ <code>concurrency</code> å±æ€§ï¼Œæˆ‘ä»¬æ¥ç®€å•è¯´è¯´ Spring-Kafka åœ¨è¿™å—çš„å®ç°æ–¹å¼ã€‚æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª Topic ä¸º <code>&quot;DEMO-TOPIC-01&quot;</code> ï¼Œå¹¶ä¸”è®¾ç½®å…¶ Partition åˆ†åŒºæ•°ä¸º <strong>10</strong> ã€‚</li>
<li>ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨äº Consumer çš„ Binding é…ç½®ï¼Œå¹¶è®¾ç½® <code>concurrency</code> é…ç½®é¡¹ä¸º 2ã€‚</li>
<li>å†ç„¶åï¼Œæˆ‘ä»¬å¯åŠ¨é¡¹ç›®ã€‚Spring-Kafka ä¼šæ ¹æ® Binding çš„ <code>concurrency</code> é…ç½®é¡¹ä¸º 2ï¼Œä¸ºè¯¥ Binding åˆ›å»º <strong>2</strong> ä¸ª Kafka Consumer ã€‚æ³¨æ„å™¢ï¼Œæ˜¯ <strong>2</strong> ä¸ª Kafka Consumer å‘¢ï¼ï¼ï¼åç»­ï¼Œæ¯ä¸ª Kafka Consumer ä¼šè¢«<strong>å•ç‹¬</strong>åˆ†é…åˆ°ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè¿›è¡Œæ‹‰å–æ¶ˆæ¯ï¼Œæ¶ˆè´¹æ¶ˆæ¯ã€‚</li>
<li>ä¹‹åï¼ŒKafka Broker ä¼šå°† Topic ä¸º <code>&quot;DEMO-TOPIC-01&quot;</code> åˆ†é…ç»™åˆ›å»ºçš„ <strong>2</strong> ä¸ª Kafka Consumer å„ <strong>5</strong> ä¸ª Partition ã€‚ğŸ˜ˆ å¦‚æœä¸äº†è§£ Kafka Broker â€œåˆ†é…åŒºåˆ†â€æœºåˆ¶å•ç‹¬èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ <a target="_blank" rel="noopener" href="http://www.iocoder.cn/Fight/How-do-Kafka-consumers-allocate-partitions/?self">ã€ŠKafka æ¶ˆè´¹è€…å¦‚ä½•åˆ†é…åˆ†åŒºã€‹</a> æ–‡ç« ã€‚</li>
<li>è¿™æ ·ï¼Œå› ä¸ºç”¨äº Consumer çš„ Binding çš„ <code>concurrency</code> é…ç½®é¡¹ä¸º 2ï¼Œåˆ›å»º <strong>2</strong> ä¸ª Kafka Consumer ï¼Œå°±åœ¨<strong>å„è‡ªçš„çº¿ç¨‹ä¸­</strong>ï¼Œæ‹‰å–å„è‡ªçš„ Topic ä¸º <code>&quot;DEMO-TOPIC-01&quot;</code> çš„ Partition çš„æ¶ˆæ¯ï¼Œå„è‡ª<strong>ä¸²è¡Œ</strong>æ¶ˆè´¹ã€‚ä»è€Œï¼Œå®ç°<strong>å¤šçº¿ç¨‹</strong>çš„å¹¶å‘æ¶ˆè´¹ã€‚</li>
</ul>
<p>é…±ç´«è®²è§£ä¸€ä¸‹ï¼Œèƒ–å‹å¯¹ Spring-Kafka å®ç°<strong>å¤šçº¿ç¨‹</strong>çš„å¹¶å‘æ¶ˆè´¹çš„æœºåˆ¶ï¼Œæ˜¯å¦ç†è§£äº†ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œä¸è¦é…ç½® <code>concurrency</code> å±æ€§è¿‡å¤§ï¼Œåˆ™åˆ›å»ºçš„ Kafka Consumer åˆ†é…ä¸åˆ°æ¶ˆè´¹ Topic çš„ Partition åˆ†åŒºï¼Œå¯¼è‡´ä¸æ–­çš„ç©ºè½®è¯¢ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå¯ä»¥é€‰æ‹©ä¸çœ‹ã€‚</p>
<p>åœ¨ç†è§£ Spring-Kafka æä¾›çš„<strong>å¹¶å‘æ¶ˆè´¹</strong>æœºåˆ¶ï¼ŒèŠ±è´¹äº†å¥½å‡ ä¸ªå°æ—¶ï¼Œä¸»è¦é™·å…¥åˆ°äº†ä¸€ä¸ªè¯¯åŒºã€‚</p>
<p>å¦‚æœèƒ–å‹æœ‰ä½¿ç”¨è¿‡ RocketMQ çš„å¹¶å‘æ¶ˆè´¹ï¼Œä¼šå‘ç°åªè¦åˆ›å»ºä¸€ä¸ª RocketMQ Consumer å¯¹è±¡ï¼Œç„¶å Consumer æ‹‰å–å®Œæ¶ˆæ¯ä¹‹åï¼Œä¸¢åˆ° Consumer çš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œæ¶ˆè´¹ï¼Œä»è€Œå®ç°å¹¶å‘æ¶ˆè´¹ã€‚</p>
<p>è€Œåœ¨ Spring-Kafka æä¾›çš„å¹¶å‘æ¶ˆè´¹ï¼Œä¼šå‘ç°éœ€è¦åˆ›å»ºå¤šä¸ª Kafka Consumer å¯¹è±¡ï¼Œå¹¶ä¸”æ¯ä¸ª Consumer éƒ½å•ç‹¬åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶å Consumer æ‹‰å–å®Œæ¶ˆæ¯ä¹‹åï¼Œåœ¨å„è‡ªçš„çº¿ç¨‹ä¸­æ‰§è¡Œæ¶ˆè´¹ã€‚</p>
<p>åˆæˆ–è€…è¯´ï¼ŒSpring-Kafka æä¾›çš„å¹¶å‘æ¶ˆè´¹ï¼Œå¾ˆåƒ RocketMQ çš„é¡ºåºæ¶ˆè´¹ã€‚ğŸ˜ˆ ä»æ„Ÿå—ä¸Šæ¥è¯´ï¼ŒSpring-Kafka çš„å¹¶å‘æ¶ˆè´¹åƒ BIO ï¼ŒRocketMQ çš„å¹¶å‘æ¶ˆè´¹åƒ NIO ã€‚</p>
<p>ä¸è¿‡ï¼Œç†è®ºæ¥è¯´ï¼Œåœ¨åŸç”Ÿçš„ Kafka å®¢æˆ·ç«¯ï¼Œä¹Ÿæ˜¯èƒ½å°è£…å‡ºå’Œ RocketMQ Consumer ä¸€æ ·çš„å¹¶å‘æ¶ˆè´¹çš„æœºåˆ¶ã€‚</p>
<p>ä¹Ÿå› æ­¤ï¼Œåœ¨ä½¿ç”¨ Kafka çš„æ—¶å€™ï¼Œæ¯ä¸ª Topic çš„ Partition åœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™ï¼Œè¦æ³¨æ„è®¾ç½®çš„ç›¸å¯¹å¤§ä¸€äº›ã€‚</p>
</blockquote>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Consumer å¹¶å‘æ¶ˆè´¹çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F1384b78f74f9165363bf2eb371925dcc.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="8-1-æ­å»ºç”Ÿäº§è€…"><a href="#8-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="8.1 æ­å»ºç”Ÿäº§è€…"></a>8.1 æ­å»ºç”Ÿäº§è€…</h2><p>ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®å³å¯ã€‚</p>
<h2 id="8-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#8-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="8.2 æ­å»ºæ¶ˆè´¹è€…"></a>8.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-concurrency/"><code>labx-11-sc-stream-kafka-consumer-concurrency</code></a> é¡¹ç›®ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="8-2-1-é…ç½®æ–‡ä»¶"><a href="#8-2-1-é…ç½®æ–‡ä»¶" class="headerlink" title="8.2.1 é…ç½®æ–‡ä»¶"></a>8.2.1 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-concurrency/src/main/resources/application.yml"><code>application.yml</code></a> é…ç½®æ–‡ä»¶ï¼Œå¢åŠ å¹¶å‘æ¶ˆè´¹çš„é…ç½®é¡¹ã€‚å®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-consumer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-input:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">demo01-consumer-group</span> <span class="comment"># æ¶ˆè´¹è€…åˆ†ç»„</span></span><br><span class="line">          <span class="comment"># Consumer é…ç½®é¡¹ï¼Œå¯¹åº” ConsumerProperties ç±»</span></span><br><span class="line">          <span class="attr">consumer:</span></span><br><span class="line">            <span class="attr">concurrency:</span> <span class="number">2</span> <span class="comment"># æ¯ä¸ª Consumer æ¶ˆè´¹çº¿ç¨‹æ•°çš„åˆå§‹å¤§å°ï¼Œé»˜è®¤ä¸º 1</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;random.int[10000,19999]&#125;</span> <span class="comment"># éšæœºç«¯å£ï¼Œæ–¹ä¾¿å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…</span></span><br></pre></td></tr></table></figure>



<p><code>spring.cloud.stream.bindings.&lt;bindingName&gt;.consumer.concurrency</code> é…ç½®é¡¹ï¼ŒæŒ‡å®šè¯¥ Binder çš„ Consumer æ¶ˆè´¹çº¿ç¨‹æ•°çš„<strong>åˆå§‹</strong>å¤§å°ï¼Œé»˜è®¤ä¸º 1ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸º 2ï¼Œè¡¨ç¤ºè¯¥ Consumer <strong>åˆå§‹</strong>ä½¿ç”¨ 2 ä¸ªçº¿ç¨‹å¹¶å‘æ¶ˆè´¹ã€‚</p>
<h2 id="8-3-ç®€å•æµ‹è¯•"><a href="#8-3-ç®€å•æµ‹è¯•" class="headerlink" title="8.3 ç®€å•æµ‹è¯•"></a>8.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Applicationï¼Œå¯åŠ¨<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>æ­¤æ—¶æˆ‘ä»¬åœ¨ IDEA æ§åˆ¶å°çš„æ—¥å¿—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åˆ›å»ºäº†ä¸¤ä¸ª Kafka Consumer å’Œå®ƒä»¬æ‰€åˆ†é…åˆ°çš„ Partitionï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Spring-Kafka æ‰“å°çš„æ—¥å¿—ï¼Œä¸¤ä¸ª Consumer åˆ†åˆ«æ¶ˆè´¹çš„ Partition</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.039</span>  INFO <span class="number">69381</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">2</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">1</span> to the committed offset FetchPosition&#123;offset=<span class="number">7</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.039</span>  INFO <span class="number">69381</span> --- [container-<span class="number">1</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">3</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">9</span> to the committed offset FetchPosition&#123;offset=<span class="number">7</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.040</span>  INFO <span class="number">69381</span> --- [container-<span class="number">1</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">3</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">7</span> to the committed offset FetchPosition&#123;offset=<span class="number">6</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.040</span>  INFO <span class="number">69381</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">2</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">2</span> to the committed offset FetchPosition&#123;offset=<span class="number">6</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.040</span>  INFO <span class="number">69381</span> --- [container-<span class="number">1</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">3</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">8</span> to the committed offset FetchPosition&#123;offset=<span class="number">5</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.040</span>  INFO <span class="number">69381</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">2</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">0</span> to the committed offset FetchPosition&#123;offset=<span class="number">47</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.040</span>  INFO <span class="number">69381</span> --- [container-<span class="number">1</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">3</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">5</span> to the committed offset FetchPosition&#123;offset=<span class="number">5</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.040</span>  INFO <span class="number">69381</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">2</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">3</span> to the committed offset FetchPosition&#123;offset=<span class="number">5</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.040</span>  INFO <span class="number">69381</span> --- [container-<span class="number">1</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">3</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">6</span> to the committed offset FetchPosition&#123;offset=<span class="number">5</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.040</span>  INFO <span class="number">69381</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] o.a.k.c.c.internals.ConsumerCoordinator  : [Consumer clientId=consumer-<span class="number">2</span>, groupId=demo01-consumer-group] Setting offset <span class="keyword">for</span> partition DEMO-TOPIC-<span class="number">01</span>-<span class="number">4</span> to the committed offset FetchPosition&#123;offset=<span class="number">6</span>, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch&#123;leader=localhost:<span class="number">9092</span> (id: <span class="number">0</span> rack: <span class="literal">null</span>), epoch=<span class="number">0</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Spring Cloud Stream Kafka æ‰“å°çš„æ—¥å¿—ï¼Œä¸¤ä¸ª Consumer åˆ†åˆ«æ¶ˆè´¹çš„ Partition</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.045</span>  INFO <span class="number">69381</span> --- [container-<span class="number">1</span>-C-<span class="number">1</span>] o.s.c.s.b.k.KafkaMessageChannelBinder$<span class="number">1</span>  : demo01-consumer-group: partitions assigned: [DEMO-TOPIC-<span class="number">01</span>-<span class="number">9</span>, DEMO-TOPIC-<span class="number">01</span>-<span class="number">7</span>, DEMO-TOPIC-<span class="number">01</span>-<span class="number">8</span>, DEMO-TOPIC-<span class="number">01</span>-<span class="number">5</span>, DEMO-TOPIC-<span class="number">01</span>-<span class="number">6</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">34</span>:<span class="number">42.045</span>  INFO <span class="number">69381</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] o.s.c.s.b.k.KafkaMessageChannelBinder$<span class="number">1</span>  : demo01-consumer-group: partitions assigned: [DEMO-TOPIC-<span class="number">01</span>-<span class="number">3</span>, DEMO-TOPIC-<span class="number">01</span>-<span class="number">4</span>, DEMO-TOPIC-<span class="number">01</span>-<span class="number">1</span>, DEMO-TOPIC-<span class="number">01</span>-<span class="number">2</span>, DEMO-TOPIC-<span class="number">01</span>-<span class="number">0</span>]</span><br></pre></td></tr></table></figure>



<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send">http://127.0.0.1:18080/demo01/send</a> æ¥å£å››æ¬¡ï¼Œå‘é€å››æ¡æ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çº¿ç¨‹ç¼–å·ä¸º 26</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">43</span>:<span class="number">07.450</span>  INFO <span class="number">69381</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">26</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">1381530661</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">43</span>:<span class="number">08.239</span>  INFO <span class="number">69381</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">26</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1440386434</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹ç¼–å·ä¸º 28</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">43</span>:<span class="number">08.626</span>  INFO <span class="number">69381</span> --- [container-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">279884815</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 08:<span class="number">43</span>:<span class="number">08.907</span>  INFO <span class="number">69381</span> --- [container-<span class="number">1</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">28</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1848103858</span>&#125;]</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªçº¿ç¨‹åœ¨æ¶ˆè´¹ <code>DEMO-TOPIC-01</code> Topic ä¸‹çš„æ¶ˆæ¯ã€‚</p>
<h1 id="9-é¡ºåºæ¶ˆæ¯"><a href="#9-é¡ºåºæ¶ˆæ¯" class="headerlink" title="9. é¡ºåºæ¶ˆæ¯"></a>9. é¡ºåºæ¶ˆæ¯</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-partitioning"><code>labx-11-sc-stream-kafka-producer-partitioning</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-concurrency/"><code>labx-11-sc-stream-kafka-consumer-concurrency</code></a></li>
</ul>
</blockquote>
<p>æˆ‘ä»¬å…ˆæ¥ä¸€èµ·äº†è§£ä¸‹é¡ºåºæ¶ˆæ¯çš„<strong>é¡ºåºæ¶ˆæ¯</strong>çš„å®šä¹‰ï¼š</p>
<ul>
<li>æ™®é€šé¡ºåºæ¶ˆæ¯ ï¼šProducer å°†ç›¸å…³è”çš„æ¶ˆæ¯å‘é€åˆ°ç›¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</li>
<li>å®Œå…¨ä¸¥æ ¼é¡ºåº ï¼šåœ¨ã€æ™®é€šé¡ºåºæ¶ˆæ¯ã€‘çš„åŸºç¡€ä¸Šï¼ŒConsumer ä¸¥æ ¼é¡ºåºæ¶ˆè´¹ã€‚</li>
</ul>
<blockquote>
<p>æ¶ˆæ¯æœ‰åºï¼ŒæŒ‡çš„æ˜¯ä¸€ç±»æ¶ˆæ¯æ¶ˆè´¹æ—¶ï¼Œèƒ½æŒ‰ç…§å‘é€çš„é¡ºåºæ¥æ¶ˆè´¹ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªè®¢å•äº§ç”Ÿäº†ä¸‰æ¡æ¶ˆæ¯åˆ†åˆ«æ˜¯è®¢å•åˆ›å»ºã€è®¢å•ä»˜æ¬¾ã€è®¢å•å®Œæˆã€‚æ¶ˆè´¹æ—¶è¦æŒ‰ç…§è¿™ä¸ªé¡ºåºæ¶ˆè´¹æ‰èƒ½æœ‰æ„ä¹‰ï¼Œä½†æ˜¯åŒæ—¶è®¢å•ä¹‹é—´æ˜¯å¯ä»¥å¹¶è¡Œæ¶ˆè´¹çš„ã€‚RocketMQ å¯ä»¥ä¸¥æ ¼çš„ä¿è¯æ¶ˆæ¯æœ‰åºã€‚</p>
<p>é¡ºåºæ¶ˆæ¯åˆ†ä¸ºå…¨å±€é¡ºåºæ¶ˆæ¯ä¸åˆ†åŒºé¡ºåºæ¶ˆæ¯ï¼Œå…¨å±€é¡ºåºæ˜¯æŒ‡æŸä¸ª Topic ä¸‹çš„æ‰€æœ‰æ¶ˆæ¯éƒ½è¦ä¿è¯é¡ºåºï¼›éƒ¨åˆ†é¡ºåºæ¶ˆæ¯åªè¦ä¿è¯æ¯ä¸€ç»„æ¶ˆæ¯è¢«é¡ºåºæ¶ˆè´¹å³å¯ã€‚</p>
<ul>
<li>å…¨å±€é¡ºåºï¼šå¯¹äºæŒ‡å®šçš„ä¸€ä¸ª Topicï¼Œæ‰€æœ‰æ¶ˆæ¯æŒ‰ç…§ä¸¥æ ¼çš„å…ˆå…¥å…ˆå‡ºï¼ˆFIFOï¼‰çš„é¡ºåºè¿›è¡Œå‘å¸ƒå’Œæ¶ˆè´¹ã€‚é€‚ç”¨åœºæ™¯ï¼šæ€§èƒ½è¦æ±‚ä¸é«˜ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯ä¸¥æ ¼æŒ‰ç…§ FIFO åŸåˆ™è¿›è¡Œæ¶ˆæ¯å‘å¸ƒå’Œæ¶ˆè´¹çš„åœºæ™¯</li>
<li>åˆ†åŒºé¡ºåºï¼šå¯¹äºæŒ‡å®šçš„ä¸€ä¸ª Topicï¼Œæ‰€æœ‰æ¶ˆæ¯æ ¹æ® Sharding key è¿›è¡ŒåŒºå—åˆ†åŒºã€‚ åŒä¸€ä¸ªåˆ†åŒºå†…çš„æ¶ˆæ¯æŒ‰ç…§ä¸¥æ ¼çš„ FIFO é¡ºåºè¿›è¡Œå‘å¸ƒå’Œæ¶ˆè´¹ã€‚Sharding key æ˜¯é¡ºåºæ¶ˆæ¯ä¸­ç”¨æ¥åŒºåˆ†ä¸åŒåˆ†åŒºçš„å…³é”®å­—æ®µï¼Œå’Œæ™®é€šæ¶ˆæ¯çš„ Key æ˜¯å®Œå…¨ä¸åŒçš„æ¦‚å¿µã€‚é€‚ç”¨åœºæ™¯ï¼šæ€§èƒ½è¦æ±‚é«˜ï¼Œä»¥ Sharding key ä½œä¸ºåˆ†åŒºå­—æ®µï¼Œåœ¨åŒä¸€ä¸ªåŒºå—ä¸­ä¸¥æ ¼çš„æŒ‰ç…§ FIFO åŸåˆ™è¿›è¡Œæ¶ˆæ¯å‘å¸ƒå’Œæ¶ˆè´¹çš„åœºæ™¯ã€‚</li>
</ul>
</blockquote>
<p>æ³¨æ„ï¼Œ<strong>åˆ†åŒº</strong>é¡ºåºå°±æ˜¯<strong>æ™®é€š</strong>é¡ºåºæ¶ˆæ¯ï¼Œ<strong>å…¨å±€</strong>é¡ºåºå°±æ˜¯<strong>å®Œå…¨</strong>ä¸¥æ ¼é¡ºåºã€‚</p>
<p><strong>ğŸ“š å¦‚ä½•å®ç°ï¼Ÿ ğŸ“š</strong></p>
<p>åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ° Spring-Kafka åœ¨ Consumer æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œ<strong>å¤©ç„¶</strong>å°±æ”¯æŒæŒ‰ç…§ Topic ä¸‹çš„ Partition ä¸‹çš„æ¶ˆæ¯ï¼Œ<strong>é¡ºåºæ¶ˆè´¹</strong>ã€‚å³ä½¿åœ¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ8. å¹¶å‘æ¶ˆè´¹ã€</a>æ—¶ï¼Œä¹Ÿèƒ½ä¿è¯å¦‚æ­¤ã€‚</p>
<p>é‚£ä¹ˆæ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘å°† Producer å°†ç›¸å…³è”çš„æ¶ˆæ¯å‘é€åˆ° Topic ä¸‹çš„ç›¸åŒçš„ Partition å³å¯ã€‚åœ¨ Spring Cloud Stream ä¸­ï¼Œæ”¯æŒä»æ¶ˆæ¯ä¸­è·å– Sharding keyï¼Œä»è€Œå‘é€æ¶ˆæ¯åˆ° Topic ä¸‹å¯¹åº”çš„ Partition ä¸­ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Spring Cloud Stream RabbitMQ ä¸‹çš„<strong>é¡ºåºæ¶ˆæ¯</strong>çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F3982bd28f85a41a70bde4c96edcad9c3.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="9-1-æ­å»ºç”Ÿäº§è€…"><a href="#9-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="9.1 æ­å»ºç”Ÿäº§è€…"></a>9.1 æ­å»ºç”Ÿäº§è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-partitioning"><code>labx-11-sc-stream-kafka-producer-partitioning</code></a> é¡¹ç›®ä½œä¸ºç”Ÿäº§è€…ã€‚</p>
<h3 id="9-1-1-é…ç½®æ–‡ä»¶"><a href="#9-1-1-é…ç½®æ–‡ä»¶" class="headerlink" title="9.1.1 é…ç½®æ–‡ä»¶"></a>9.1.1 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-partitioning/src/main/resources/application.yml"><code>application.yml</code></a> é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  <code>partition-key-expression</code> é…ç½®é¡¹ï¼Œè®¾ç½® Producer å‘é€é¡ºåºæ¶ˆæ¯çš„ Sharding keyã€‚å®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-producer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-output:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">          <span class="comment"># Producer é…ç½®é¡¹ï¼Œå¯¹åº” ProducerProperties ç±»</span></span><br><span class="line">          <span class="attr">producer:</span></span><br><span class="line">            <span class="attr">partition-key-expression:</span> <span class="string">payload[&#x27;id&#x27;]</span> <span class="comment"># åˆ†åŒº key è¡¨è¾¾å¼ã€‚è¯¥è¡¨è¾¾å¼åŸºäº Spring ELï¼Œä»æ¶ˆæ¯ä¸­è·å¾—åˆ†åŒº keyã€‚</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">        <span class="comment"># Kafka è‡ªå®šä¹‰ Binding é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBindingProperties Map</span></span><br><span class="line">        <span class="attr">bindings:</span></span><br><span class="line">          <span class="attr">demo01-output:</span></span><br><span class="line">            <span class="comment"># Kafka Producer é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProducerProperties ç±»</span></span><br><span class="line">            <span class="attr">producer:</span></span><br><span class="line">              <span class="attr">sync:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦åŒæ­¥å‘é€æ¶ˆæ¯ï¼Œé»˜è®¤ä¸º false å¼‚æ­¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18080</span></span><br></pre></td></tr></table></figure>



<p>â‘  <code>spring.cloud.stream.bindings.&lt;bindingName&gt;.producer.partition-key-expression</code> é…ç½®é¡¹ï¼Œè¯¥è¡¨è¾¾å¼åŸºäº <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html">Spring EL</a>ï¼Œä»æ¶ˆæ¯ä¸­è·å¾— Sharding keyã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šSharding Key å’Œ Partition Key æ˜¯ç­‰ä»·çš„ï¼Œæœ‰äº›æ–‡ç« å–œæ¬¢å«åˆ†ç‰‡é”®ï¼Œæœ‰äº›æ–‡ç« å–œæ¬¢å«åˆ†åŒºé”®ã€‚</p>
<p>è‰¿è‰¿è‡ªå·±çš„ä¹ æƒ¯ï¼Œæ˜¯å« Sharding Keyï¼Œå¥ˆä½• Spring Cloud Stream æ˜¯ Partition Keyï¼Œæ‰€ä»¥ä¸‹æ–‡èƒ–å‹çœ‹åˆ°ä¸¤ä¸ªè¯å­˜åœ¨æ··ç”¨çš„æƒ…å†µï¼ŒçŸ¥é“æ˜¯ä¸€ä¸ªæ„æ€å“ˆ~</p>
</blockquote>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®è¯¥é…ç½®é¡¹ä¸º <code>payload[&#39;id&#39;]</code>ï¼Œè¡¨ç¤ºä» Spring <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-messaging/src/main/java/org/springframework/messaging/Message.java">Message</a> çš„ payload çš„ <code>id</code>ã€‚ç¨åæˆ‘ä»¬å‘é€çš„æ¶ˆæ¯çš„ payload ä¸º Demo01Messageï¼Œé‚£ä¹ˆ <code>id</code> å°±æ˜¯ <code>Demo01Message.id</code>ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³ä»æ¶ˆæ¯çš„ headers ä¸­è·å¾— Sharding keyï¼Œå¯ä»¥è®¾ç½®ä¸º <code>headers[&#39;partitionKey&#39;]</code>ã€‚</p>
<p>â‘¡ Spring Cloud Stream ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/binder/PartitionHandler.java">PartitionHandler</a> è¿›è¡Œ Sharding key çš„è·å¾—ä¸è®¡ç®—ï¼Œæœ€ç»ˆ Sharding key çš„ç»“æœä¸º <code>key.hashCode() % partitionCount</code>ã€‚</p>
<blockquote>
<p>æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥é˜…è¯» PartitionHandler çš„ <code>#determinePartition(Message&lt;?&gt; message)</code> æ–¹æ³•ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬ä»¥å‘é€ä¸€æ¡ <code>id</code> ä¸º 1 çš„ Demo01Message æ¶ˆæ¯ä¸ºç¤ºä¾‹ï¼Œæœ€ç»ˆä¼šå‘é€åˆ°å¯¹åº” Kafka Topic çš„ Partition ä¸º 1ã€‚è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€æ­¥ï¼ŒPartitionHandler ä½¿ç”¨ `partition-key-expression` è¡¨è¾¾å¼ï¼Œä» Message ä¸­è·å¾— Sharding key</span></span><br><span class="line">key =&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ­¥ï¼ŒPartitionHandler è®¡ç®—æœ€ç»ˆçš„ Sharding key</span></span><br><span class="line"><span class="comment">// è¿™é‡Œ Partition æ•°é‡ä¸º 10 çš„åŸå› æ˜¯ï¼Œåœ¨ã€Œ3. å¿«é€Ÿå…¥é—¨ã€å°èŠ‚ï¼Œæˆ‘è®¾ç½® `DEMO-TOPIC-01` Topic çš„ Partition å¤§å°ä¸º 10.</span></span><br><span class="line">key =&gt; key.hashCode() % partitionCount = <span class="number">1.</span>hashCode() % <span class="number">10</span> = <span class="number">1</span> % <span class="number">10</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸‰æ­¥ï¼ŒKafka å‘é€åˆ° `DEMO-TOPIC-01` Topic çš„é¡ºåºä¸º key Partition ä¸­</span></span><br><span class="line"><span class="comment">// è¿™é‡Œï¼Œå› ä¸º key ä¸º 1ï¼Œæ‰€ä»¥ Partition é¡ºåºä¸º 1ã€‚</span></span><br></pre></td></tr></table></figure>



<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½ä¿è¯<strong>ç›¸åŒ Sharding Key</strong> çš„æ¶ˆæ¯ï¼Œå‘é€åˆ°<strong>ç›¸åŒçš„å¯¹åº” Kafka Topic çš„ Partition</strong> ä¸­ã€‚å½“å‰ï¼Œå‰ææ˜¯è¯¥ Topic çš„ Partition æ€»æ•°ä¸èƒ½å˜å™¢ï¼Œä¸ç„¶è®¡ç®—çš„ Sharding Key ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<h3 id="9-1-2-Demo01Controller"><a href="#9-1-2-Demo01Controller" class="headerlink" title="9.1.2 Demo01Controller"></a>9.1.2 Demo01Controller</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-partitioning/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/kafkademo/controller/Demo01Controller.java">Demo01Controller</a> ç±»ï¼Œå¢åŠ å‘é€ 3 æ¡<strong>é¡ºåº</strong>æ¶ˆæ¯çš„ HTTP æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/send_orderly&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">sendOrderly</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å‘é€ 3 æ¡ç›¸åŒ id çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Message</span></span><br><span class="line">        <span class="type">Demo01Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo01Message</span>().setId(id);</span><br><span class="line">        <span class="comment">// åˆ›å»º Spring Message å¯¹è±¡</span></span><br><span class="line">        Message&lt;Demo01Message&gt; springMessage = MessageBuilder.withPayload(message)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        mySource.demo01Output().send(springMessage);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>æ¯æ¬¡å‘é€çš„ 3 æ¡æ¶ˆæ¯ä½¿ç”¨ç›¸åŒçš„ <code>id</code>ï¼Œé…åˆä¸Šæˆ‘ä»¬ä½¿ç”¨å®ƒä½œä¸º Sharding keyï¼Œå°±å¯ä»¥å‘é€å¯¹åº” Topic çš„<strong>ç›¸åŒ Partition</strong> ä¸­ã€‚</p>
<p>å¦å¤–ï¼Œæ•´åˆ—å‘é€çš„è™½ç„¶æ˜¯<strong>é¡ºåº</strong>æ¶ˆæ¯ï¼Œä½†æ˜¯å’Œå‘é€<strong>æ™®é€š</strong>æ¶ˆæ¯çš„ä»£ç æ˜¯<strong>ä¸€æ¨¡ä¸€æ ·</strong>çš„ã€‚</p>
<h2 id="9-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#9-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="9.2 æ­å»ºæ¶ˆè´¹è€…"></a>9.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ8. å¹¶å‘æ¶ˆè´¹ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-concurrency/"><code>labx-11-sc-stream-kafka-consumer-concurrency</code></a> é¡¹ç›®å³å¯ã€‚</p>
<h2 id="9-3-ç®€å•æµ‹è¯•"><a href="#9-3-ç®€å•æµ‹è¯•" class="headerlink" title="9.3 ç®€å•æµ‹è¯•"></a>9.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Applicationï¼Œå¯åŠ¨<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send_orderly">http://127.0.0.1:18080/demo01/send_orderly</a> æ¥å£ï¼Œå‘é€é¡ºåºæ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">10</span>:<span class="number">37</span>:<span class="number">05.351</span>  INFO <span class="number">71912</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">26</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">1414772641</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">10</span>:<span class="number">37</span>:<span class="number">05.354</span>  INFO <span class="number">71912</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">26</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">1414772641</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-08 <span class="number">10</span>:<span class="number">37</span>:<span class="number">05.358</span>  INFO <span class="number">71912</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">26</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">1414772641</span>&#125;]</span><br></pre></td></tr></table></figure>



<p><code>id</code> ä¸º 1414772641 çš„æ¶ˆæ¯è¢«å‘é€åˆ° Kafka Topic çš„ Partition ä¸º 1ï¼Œå¹¶ä¸”åœ¨çº¿ç¨‹ç¼–å·ä¸º 26 çš„çº¿ç¨‹ä¸­æ¶ˆè´¹ã€‚ğŸ˜ˆ èƒ–å‹å¯ä»¥è‡ªå·±åœ¨å¤šè°ƒç”¨å‡ æ¬¡æ¥å£ï¼Œç»§ç»­å°è¯•ã€‚</p>
<h1 id="10-æ¶ˆæ¯è¿‡æ»¤"><a href="#10-æ¶ˆæ¯è¿‡æ»¤" class="headerlink" title="10. æ¶ˆæ¯è¿‡æ»¤"></a>10. æ¶ˆæ¯è¿‡æ»¤</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/"><code>labx-11-sc-stream-kafka-producer-demo</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-filter"><code>labx-11-sc-stream-kafka-consumer-filter</code></a></li>
</ul>
</blockquote>
<p>Spring Cloud Stream æä¾›äº†<strong>é€šç”¨</strong>çš„ <strong>Consumer</strong> çº§åˆ«çš„æ•ˆç‡è¿‡æ»¤å™¨æœºåˆ¶ã€‚æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <code>@StreamListener</code> æ³¨è§£çš„ <code>condition</code> å±æ€§ï¼Œè®¾ç½®æ¶ˆæ¯æ»¡è¶³æŒ‡å®š Spring EL è¡¨è¾¾å¼çš„æƒ…å†µä¸‹ï¼Œæ‰è¿›è¡Œæ¶ˆè´¹ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Spring Cloud Stream Kafka ä¸‹çš„<strong>æ¶ˆæ¯è¿‡æ»¤</strong>çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<a target="_blank" rel="noopener" href="https://static.iocoder.cn/images/Spring-Cloud/2020-11-01/61.png">é¡¹ç›®ç»“æ„</a></p>
<h2 id="10-1-æ­å»ºç”Ÿäº§è€…"><a href="#10-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="10.1 æ­å»ºç”Ÿäº§è€…"></a>10.1 æ­å»ºç”Ÿäº§è€…</h2><p>ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®å³å¯ã€‚</p>
<h3 id="10-1-1-Demo01Controller"><a href="#10-1-1-Demo01Controller" class="headerlink" title="10.1.1 Demo01Controller"></a>10.1.1 Demo01Controller</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/kafkademo/controller/Demo01Controller.java">Demo01Controller</a> ç±»ï¼Œå¢åŠ å‘é€ 3 æ¡<strong>å¸¦ <code>tag</code> æ¶ˆæ¯å¤´çš„</strong>æ¶ˆæ¯çš„ HTTP æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/send_tag&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">sendTag</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (String tag : <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;yunai&quot;</span>, <span class="string">&quot;yutou&quot;</span>, <span class="string">&quot;tudou&quot;</span>&#125;) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Message</span></span><br><span class="line">        <span class="type">Demo01Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo01Message</span>()</span><br><span class="line">                .setId(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt());</span><br><span class="line">        <span class="comment">// åˆ›å»º Spring Message å¯¹è±¡</span></span><br><span class="line">        Message&lt;Demo01Message&gt; springMessage = MessageBuilder.withPayload(message)</span><br><span class="line">                .setHeader(<span class="string">&quot;tag&quot;</span>, tag) <span class="comment">// &lt;X&gt; è®¾ç½® Tag</span></span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        mySource.demo01Output().send(springMessage);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åœ¨ <code>&lt;X&gt;</code> å¤„ï¼Œè®¾ç½®å‘é€æ¶ˆæ¯çš„ <code>tag</code> æ¶ˆæ¯å¤´ã€‚</p>
<h2 id="10-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#10-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="10.2 æ­å»ºæ¶ˆè´¹è€…"></a>10.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-filter"><code>labx-11-sc-stream-kafka-consumer-filter</code></a> é¡¹ç›®ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="10-2-1-Demo01Consumer"><a href="#10-2-1-Demo01Consumer" class="headerlink" title="10.2.1 Demo01Consumer"></a>10.2.1 Demo01Consumer</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-filter/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/listener/Demo01Consumer.java">Demo01Consumer</a> ç±»ï¼Œä½¿ç”¨ <code>@StreamListener</code> æ³¨è§£çš„ <code>condition</code> å±æ€§æ¥è¿‡æ»¤æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(value = MySink.DEMO01_INPUT, condition = &quot;headers[&#x27;tag&#x27;] == &#x27;yunai&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Payload</span> Demo01Message message)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®æ¶ˆæ¯çš„ Header å¸¦æœ‰çš„ <code>tag</code> å€¼ä¸º <code>yunai</code> æ—¶ï¼Œæ‰è¿›è¡Œæ¶ˆè´¹ã€‚</p>
<h2 id="10-3-ç®€å•æµ‹è¯•"><a href="#10-3-ç®€å•æµ‹è¯•" class="headerlink" title="10.3 ç®€å•æµ‹è¯•"></a>10.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Applicationï¼Œå¯åŠ¨<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send_tag">http://127.0.0.1:18080/demo01/send_tag</a> æ¥å£ï¼Œå‘é€å¸¦æœ‰ Tag çš„æ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆæ¯å¤´ tag ä¸º `yunai` çš„æ¶ˆæ¯è¢«æ¶ˆè´¹</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">19</span>:<span class="number">25</span>:<span class="number">28.495</span>  INFO <span class="number">80717</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">25</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">8065193</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆæ¯å¤´ tag ä¸º `yutou` å’Œ `tudou` çš„æ¶ˆæ¯è¢«è¿‡æ»¤</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">19</span>:<span class="number">25</span>:<span class="number">28.500</span>  WARN <span class="number">80717</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] .DispatchingStreamListenerMessageHandler : Cannot find a <span class="meta">@StreamListener</span> matching <span class="keyword">for</span> message with id: <span class="literal">null</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">19</span>:<span class="number">25</span>:<span class="number">28.502</span>  WARN <span class="number">80717</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] .DispatchingStreamListenerMessageHandler : Cannot find a <span class="meta">@StreamListener</span> matching <span class="keyword">for</span> message with id: <span class="literal">null</span></span><br></pre></td></tr></table></figure>



<p>åªæ¶ˆè´¹äº†ä¸€æ¡æ¶ˆæ¯å¤´ä¸º <code>yunai</code> çš„æ¶ˆæ¯ï¼Œè€Œæ¶ˆæ¯å¤´ä¸º <code>yutou</code> å’Œ <code>tudou</code> çš„æ¶ˆæ¯è¢« Consumer è¿‡æ»¤ã€‚è¦<strong>æ³¨æ„</strong>ï¼Œè¢«è¿‡æ»¤æ‰çš„æ¶ˆæ¯ï¼Œåç»­æ˜¯æ— æ³•è¢«æ¶ˆè´¹æ‰äº†ï¼Œæ•ˆæœå’Œæ¶ˆè´¹æˆåŠŸæ˜¯ä¸€æ ·çš„ã€‚</p>
<h1 id="11-äº‹åŠ¡æ¶ˆæ¯-1"><a href="#11-äº‹åŠ¡æ¶ˆæ¯-1" class="headerlink" title="11. äº‹åŠ¡æ¶ˆæ¯"></a>11. äº‹åŠ¡æ¶ˆæ¯</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-transaction"><code>labx-11-sc-stream-kafka-producer-transaction</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-transaction/"><code>labx-11-sc-stream-kafka-consumer-transaction</code></a></li>
</ul>
</blockquote>
<p>Kafka å†…ç½®æä¾›äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒã€‚å¯¹äº‹åŠ¡æ¶ˆæ¯çš„æ¦‚å¿µä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ <a target="_blank" rel="noopener" href="http://www.iocoder.cn/Fight/longyb-transaction_mq/?self">ã€Šäº‹åŠ¡æ¶ˆæ¯ç»„ä»¶çš„å¥—è·¯ã€‹</a> æ–‡ç« ã€‚</p>
<p>ä¸è¿‡ Kafka æä¾›çš„å¹¶ä¸æ˜¯<strong>å®Œæ•´çš„</strong>çš„äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒï¼Œç¼ºå°‘äº†<strong>å›æŸ¥æœºåˆ¶</strong>ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œåˆšæ¨èçš„æ–‡ç« ä¹Ÿæœ‰è®²åˆ°ã€‚ç›®å‰ï¼Œå¸¸ç”¨çš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåªæœ‰ RocketMQ æä¾›äº†å®Œæ•´çš„äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒï¼Œå…·ä½“çš„å¯ä»¥çœ‹çœ‹<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/RocketMQ/?self">ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— RocketMQ å…¥é—¨ã€‹</a> çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ9. äº‹åŠ¡æ¶ˆæ¯ã€</a>å°èŠ‚ï¼ŒğŸ˜ˆ æš‚æ—¶ä¸æ‹“å±•å¼€æ¥è®²ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Spring Cloud Stream Kafka ä¸‹çš„<strong>äº‹åŠ¡æ¶ˆæ¯</strong>çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F43ca8d0d650ee5a6618c11c8809614da.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="11-1-æ­å»ºç”Ÿäº§è€…"><a href="#11-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="11.1 æ­å»ºç”Ÿäº§è€…"></a>11.1 æ­å»ºç”Ÿäº§è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-transaction"><code>labx-11-sc-stream-kafka-producer-transaction</code></a> é¡¹ç›®ä½œä¸ºç”Ÿäº§è€…ã€‚</p>
<h3 id="11-1-1-é…ç½®æ–‡ä»¶"><a href="#11-1-1-é…ç½®æ–‡ä»¶" class="headerlink" title="11.1.1 é…ç½®æ–‡ä»¶"></a>11.1.1 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-transaction/src/main/resources/application.yml"><code>application.yml</code></a> é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ äº‹åŠ¡ç›¸å…³é…ç½®é¡¹ï¼Œå¼€å¯å‘é€äº‹åŠ¡æ¶ˆæ¯çš„åŠŸèƒ½ã€‚å®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-producer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-output:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">          <span class="attr">transaction:</span></span><br><span class="line">            <span class="attr">transaction-id-prefix:</span> <span class="string">demo.</span> <span class="comment"># äº‹åŠ¡ç¼–å·å‰ç¼€</span></span><br><span class="line">            <span class="attr">producer:</span></span><br><span class="line">              <span class="attr">configuration:</span></span><br><span class="line">                <span class="attr">retries:</span> <span class="number">1</span> <span class="comment"># å‘é€å¤±è´¥æ—¶ï¼Œé‡è¯•å‘é€çš„æ¬¡æ•°</span></span><br><span class="line">                <span class="attr">acks:</span> <span class="string">all</span> <span class="comment"># 0-ä¸åº”ç­”ã€‚1-leader åº”ç­”ã€‚all-æ‰€æœ‰ leader å’Œ follower åº”ç­”ã€‚</span></span><br><span class="line">        <span class="comment"># Kafka è‡ªå®šä¹‰ Binding é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBindingProperties Map</span></span><br><span class="line">        <span class="attr">bindings:</span></span><br><span class="line">          <span class="attr">demo01-output:</span></span><br><span class="line">            <span class="comment"># Kafka Producer é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProducerProperties ç±»</span></span><br><span class="line">            <span class="attr">producer:</span></span><br><span class="line">              <span class="attr">sync:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦åŒæ­¥å‘é€æ¶ˆæ¯ï¼Œé»˜è®¤ä¸º false å¼‚æ­¥ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18080</span></span><br></pre></td></tr></table></figure>



<p><code>spring.cloud.stream.kafka.binder.transaction</code> ä¸º Spring Cloud Stream Kafka <strong>äº‹åŠ¡</strong>é…ç½®é¡¹ï¼Œå¯¹åº” <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka/blob/master/spring-cloud-stream-binder-kafka-core/src/main/java/org/springframework/cloud/stream/binder/kafka/properties/KafkaBinderConfigurationProperties.java#L366-L387"><code>KafkaBinderConfigurationProperties.Transaction</code></a> ç±»ã€‚</p>
<ul>
<li><p><code>transaction-id-prefix</code> é…ç½®é¡¹ï¼Œäº‹åŠ¡ç¼–å·çš„å‰ç¼€ã€‚éœ€è¦ä¿è¯ç›¸åŒåº”ç”¨é…ç½®ç›¸åŒï¼Œä¸åŒåº”ç”¨é…ç½®ä¸åŒã€‚å…·ä½“å¯ä»¥çœ‹çœ‹<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/57179169/how-to-choose-kafka-transaction-id-for-several-applications-hosted-in-kubernete">ã€ŠHow to choose Kafka transaction id for several applicationsã€‹</a>çš„è®¨è®ºã€‚</p>
</li>
<li><pre><code>producer
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">  é…ç½®é¡¹ï¼ŒProducer åœ¨äº‹åŠ¡ä¸­çš„</span><br><span class="line"></span><br><span class="line">  é™„åŠ </span><br><span class="line"></span><br><span class="line">  é…ç½®é¡¹ã€‚</span><br><span class="line"></span><br><span class="line">  - `retries` é…ç½®é¡¹ï¼Œå‘é€å¤±è´¥æ—¶ï¼Œé‡è¯•å‘é€çš„æ¬¡æ•°ã€‚</span><br><span class="line">  - `acks` é…ç½®é¡¹ï¼Œå¿…é¡»è®¾ç½®ä¸º `all`ï¼Œä¸ç„¶åœ¨å¯åŠ¨æ—¶ä¼šæŠ¥ `&quot;Must set acks to all in order to use the idempotent producer. Otherwise we cannot guarantee idempotence.&quot;` é”™è¯¯ã€‚å› ä¸ºï¼ŒKafka çš„äº‹åŠ¡æ¶ˆæ¯éœ€è¦åŸºäºå¹‚ç­‰æ€§æ¥å®ç°ï¼Œæ‰€ä»¥å¿…é¡»ä¿è¯æ‰€æœ‰èŠ‚ç‚¹éƒ½å†™å…¥æˆåŠŸã€‚</span><br><span class="line"></span><br><span class="line">### 11.1.2 TransactionConfig</span><br><span class="line"></span><br><span class="line">åˆ›å»º [TransactionConfig](https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-transaction/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/kafkademo/config/TransactionConfig.java) ç±»ï¼Œåˆ›å»º [KafkaTransactionManager](https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/transaction/KafkaTransactionManager.java) Beanï¼ŒKafka çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œé›†æˆåˆ° Spring çš„äº‹åŠ¡ä½“ç³»ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ `@Transactional` å£°æ˜å¼äº‹åŠ¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Configuration</span><br><span class="line">@EnableTransactionManagement</span><br><span class="line">public class TransactionConfig &#123;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public PlatformTransactionManager transactionManager(BinderFactory binders) &#123;</span><br><span class="line">        // è·å¾— Kafka ProducerFactory å¯¹è±¡</span><br><span class="line">        ProducerFactory&lt;byte[], byte[]&gt; pf = ((KafkaMessageChannelBinder) binders.getBinder(null,</span><br><span class="line">                MessageChannel.class)).getTransactionalProducerFactory();</span><br><span class="line">        // åˆ›å»º KafkaTransactionManager äº‹åŠ¡ç®¡ç†å™¨</span><br><span class="line">        assert pf != null;</span><br><span class="line">        return new KafkaTransactionManager&lt;&gt;(pf);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h3 id="11-1-3-Demo01Controller"><a href="#11-1-3-Demo01Controller" class="headerlink" title="11.1.3 Demo01Controller"></a>11.1.3 Demo01Controller</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-transaction/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/kafkademo/controller/Demo01Controller.java">Demo01Controller</a> ç±»ï¼Œå¢åŠ å‘é€<strong>äº‹åŠ¡</strong>æ¶ˆæ¯çš„ HTTP æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo01Controller .java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/send_transaction&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendTransaction</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º Message</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt();</span><br><span class="line">    <span class="type">Demo01Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo01Message</span>()</span><br><span class="line">            .setId(id);</span><br><span class="line">    <span class="comment">// åˆ›å»º Spring Message å¯¹è±¡</span></span><br><span class="line">    Message&lt;Demo01Message&gt; springMessage = MessageBuilder.withPayload(message)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">    mySource.demo01Output().send(springMessage);</span><br><span class="line">    logger.info(<span class="string">&quot;[sendTransaction][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€æˆåŠŸ]&quot;</span>, id);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// &lt;X&gt; ç­‰å¾…</span></span><br><span class="line">    Thread.sleep(<span class="number">10</span> * <span class="number">1000L</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åœ¨å‘é€æ¶ˆæ¯æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬æ·»åŠ äº† <code>@Transactional</code> æ³¨è§£ï¼Œå£°æ˜äº‹åŠ¡ã€‚å› ä¸ºæˆ‘ä»¬åˆ›å»ºäº† KafkaTransactionManager äº‹åŠ¡ç®¡ç†å™¨ï¼Œæ‰€ä»¥è¿™é‡Œä¼šåˆ›å»º Kafka äº‹åŠ¡ã€‚</p>
<p>åœ¨ <code>&lt;X&gt;</code> å¤„ï¼Œæˆ‘ä»¬æ•…æ„ç­‰å¾… <code>Thread#sleep(long millis)</code> 10 ç§’ï¼Œåˆ¤æ–­ Kafka äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆã€‚</p>
<ul>
<li>å¦‚æœåŒæ­¥å‘é€æ¶ˆæ¯æˆåŠŸåï¼ŒConsumer ç«‹å³æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ï¼Œè¯´æ˜æœªç”Ÿæ•ˆã€‚</li>
<li>å¦‚æœ Consumer æ˜¯ 10 ç§’ä¹‹åï¼Œæ‰æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ï¼Œè¯´æ˜å·²ç”Ÿæ•ˆã€‚</li>
</ul>
<h2 id="11-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#11-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="11.2 æ­å»ºæ¶ˆè´¹è€…"></a>11.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-transaction/"><code>labx-11-sc-stream-kafka-consumer-transaction</code></a> é¡¹ç›®ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="11-2-1-é…ç½®æ–‡ä»¶"><a href="#11-2-1-é…ç½®æ–‡ä»¶" class="headerlink" title="11.2.1 é…ç½®æ–‡ä»¶"></a>11.2.1 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-transaction/src/main/resources/application.yml"><code>application.yml</code></a> é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ äº‹åŠ¡ç›¸å…³é…ç½®é¡¹ï¼Œä»…æ¶ˆè´¹<strong>å·²æäº¤</strong>çš„æ¶ˆæ¯ã€‚å®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-consumer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-input:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">demo01-consumer-group</span> <span class="comment"># æ¶ˆè´¹è€…åˆ†ç»„</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">        <span class="comment"># Kafka Binding é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBindingProperties ç±»</span></span><br><span class="line">        <span class="attr">bindings:</span></span><br><span class="line">          <span class="attr">demo01-input:</span></span><br><span class="line">            <span class="comment"># Kafka Consumer é…ç½®é¡¹ï¼Œå¯¹åº” KafkaConsumerProperties ç±»</span></span><br><span class="line">            <span class="attr">consumer:</span></span><br><span class="line">              <span class="attr">configuration:</span></span><br><span class="line">                <span class="attr">isolation:</span></span><br><span class="line">                  <span class="attr">level:</span> <span class="string">read_committed</span> <span class="comment"># è¯»å–å·²æäº¤çš„æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;random.int[10000,19999]&#125;</span> <span class="comment"># éšæœºç«¯å£ï¼Œæ–¹ä¾¿å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…</span></span><br></pre></td></tr></table></figure>



<p>æ·»åŠ  <code>spring.cloud.stream.kafka.bindings.&lt;bindingName&gt;.consumer.configuration.isolation.level</code> ä¸º <code>read_committed</code>ï¼Œè®¾ç½® Consumer <strong>ä»…</strong>è¯»å–å·²æäº¤çš„æ¶ˆæ¯ã€‚ğŸ˜ˆ ä¸€å®šè¦é…ç½®ï¼ï¼ï¼è¢«å‘æƒ¨äº†ï¼Œå½“æ—¶ä»¥ä¸ºè‡ªå·±çš„äº‹åŠ¡æ¶ˆæ¯æ€ä¹ˆå°±æ˜¯ä¸ç”Ÿæ•ˆï¼ŒåŸæ¥å°‘åŠ äº†è¿™ä¸ªã€‚</p>
<h2 id="11-3-ç®€å•æµ‹è¯•"><a href="#11-3-ç®€å•æµ‹è¯•" class="headerlink" title="11.3 ç®€å•æµ‹è¯•"></a>11.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Applicationï¼Œå¯åŠ¨<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send_transaction">http://127.0.0.1:18080/demo01/send_transaction</a> æ¥å£ï¼Œå‘é€äº‹åŠ¡æ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Producer æˆåŠŸåŒæ­¥å‘é€äº† 1 æ¡æ¶ˆæ¯ã€‚æ­¤æ—¶ï¼Œäº‹åŠ¡å¹¶æœªæäº¤</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">22</span>:<span class="number">31</span>:<span class="number">34.863</span>  INFO <span class="number">84414</span> --- [io-<span class="number">18080</span>-exec-<span class="number">1</span>] c.i.s.l.k.k.controller.Demo01Controller  : [send_transaction][å‘é€ç¼–å·ï¼š[<span class="number">629326486</span>] å‘é€æˆåŠŸ]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10 ç§’åï¼ŒProducer æäº¤äº‹åŠ¡ã€‚</span></span><br><span class="line"><span class="comment">// æ­¤æ—¶ï¼ŒConsumer æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-09 <span class="number">22</span>:<span class="number">31</span>:<span class="number">44.952</span>  INFO <span class="number">84408</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">629326486</span>&#125;]</span><br></pre></td></tr></table></figure>



<p>Consumer åœ¨äº‹åŠ¡æ¶ˆæ¯æäº¤åï¼Œæ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ã€‚ç¬¦åˆé¢„æœŸ~</p>
<h1 id="12-æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶-1"><a href="#12-æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶-1" class="headerlink" title="12. æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶"></a>12. æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/"><code>labx-11-sc-stream-kafka-producer-demo</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-ack/"><code>labx-11-sc-stream-kafka-consumer-ack</code></a></li>
</ul>
</blockquote>
<p><strong>ğŸ“š åŸç”Ÿ Kafka çš„æäº¤æœºåˆ¶</strong></p>
<p>åŸç”Ÿ Kafka Consumer æ¶ˆè´¹ç«¯ï¼Œæœ‰ä¸¤ç§æ¶ˆè´¹è¿›åº¦æäº¤çš„æäº¤æœºåˆ¶ï¼š</p>
<ul>
<li>ã€é»˜è®¤ã€‘è‡ªåŠ¨æäº¤ï¼Œé€šè¿‡é…ç½® <code>enable.auto.commit=true</code> ï¼Œæ¯è¿‡ <code>auto.commit.interval.ms</code> æ—¶é—´é—´éš”ï¼Œéƒ½ä¼šè‡ªåŠ¨æäº¤æ¶ˆè´¹æ¶ˆè´¹è¿›åº¦ã€‚è€Œæäº¤çš„æ—¶æœºï¼Œæ˜¯åœ¨ Consumer çš„ <code>#poll(...)</code> æ–¹æ³•çš„é€»è¾‘é‡Œå®Œæˆï¼Œåœ¨æ¯æ¬¡ä» Kafka Broker æ‹‰å–æ¶ˆæ¯æ—¶ï¼Œä¼šæ£€æŸ¥æ˜¯å¦åˆ°è¾¾è‡ªåŠ¨æäº¤çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå°±ä¼šæäº¤ä¸Šä¸€æ¬¡è½®è¯¢æ‹‰å–çš„ä½ç½®ã€‚</li>
<li>æ‰‹åŠ¨æäº¤ï¼Œé€šè¿‡é…ç½® <code>enable.auto.commit=false</code> ï¼Œåç»­é€šè¿‡ Consumer çš„ <code>#commitSync(...)</code> æˆ– <code>#commitAsync(...)</code> æ–¹æ³•ï¼ŒåŒæ­¥æˆ–å¼‚æ­¥æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</li>
</ul>
<p><strong>ğŸ“š Spring-Kafka çš„æäº¤æœºåˆ¶</strong></p>
<p>Spring-Kafka Consumer æ¶ˆè´¹ç«¯ï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„æ¶ˆè´¹è€…è¿›åº¦çš„æäº¤æœºåˆ¶ï¼Œæ›´åŠ çµæ´»ã€‚å½“ç„¶ï¼Œä¹Ÿæ˜¯åˆ†æˆè‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤ä¸¤ä¸ªå¤§ç±»ã€‚åœ¨ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/listener/ContainerProperties.java#L44-L93">AckMode</a> æšä¸¾ç±»ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸€ç§å…·ä½“çš„æ–¹å¼ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ContainerProperties#AckMode.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AckMode</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== è‡ªåŠ¨æäº¤ ==========</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit after each record is processed by the listener.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	RECORD, <span class="comment">// æ¯æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆåï¼Œè‡ªåŠ¨æäº¤</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit whatever has already been processed before the next poll.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	BATCH, <span class="comment">// æ¯ä¸€æ¬¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆåï¼Œåœ¨ä¸‹æ¬¡æ‹‰å–æ¶ˆæ¯ä¹‹å‰ï¼Œè‡ªåŠ¨æäº¤</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit pending updates after</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> ContainerProperties#setAckTime(long) ackTime&#125; has elapsed.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	TIME, <span class="comment">// è¾¾åˆ°ä¸€å®šæ—¶é—´é—´éš”åï¼Œè‡ªåŠ¨æäº¤ã€‚</span></span><br><span class="line">	      <span class="comment">// ä¸è¿‡è¦æ³¨æ„ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€åˆ°å°±ç«‹é©¬æäº¤ï¼Œå¦‚æœæ­¤æ—¶æ­£åœ¨æ¶ˆè´¹æŸä¸€æ¡æ¶ˆæ¯ï¼Œéœ€è¦ç­‰è¿™æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆï¼Œæ‰èƒ½æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit pending updates after</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> ContainerProperties#setAckCount(int) ackCount&#125; has been</span></span><br><span class="line"><span class="comment">	 * exceeded.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	COUNT, <span class="comment">// æ¶ˆè´¹æˆåŠŸçš„æ¶ˆæ¯æ•°åˆ°è¾¾ä¸€å®šæ•°é‡åï¼Œè‡ªåŠ¨æäº¤ã€‚</span></span><br><span class="line">	      <span class="comment">// ä¸è¿‡è¦æ³¨æ„ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€åˆ°å°±ç«‹é©¬æäº¤ï¼Œå¦‚æœæ­¤æ—¶æ­£åœ¨æ¶ˆè´¹æŸä¸€æ¡æ¶ˆæ¯ï¼Œéœ€è¦ç­‰è¿™æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆï¼Œæ‰èƒ½æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Commit pending updates after</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> ContainerProperties#setAckCount(int) ackCount&#125; has been</span></span><br><span class="line"><span class="comment">	 * exceeded or after &#123;<span class="doctag">@link</span> ContainerProperties#setAckTime(long)</span></span><br><span class="line"><span class="comment">	 * ackTime&#125; has elapsed.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	COUNT_TIME, <span class="comment">// TIME å’Œ COUNT çš„ç»“åˆä½“ï¼Œæ»¡è¶³ä»»ä¸€éƒ½ä¼šè‡ªåŠ¨æäº¤ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ========== æ‰‹åŠ¨æäº¤ ==========</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * User takes responsibility for acks using an</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> AcknowledgingMessageListener&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	MANUAL, <span class="comment">// è°ƒç”¨æ—¶ï¼Œå…ˆæ ‡è®°æäº¤æ¶ˆè´¹è¿›åº¦ã€‚ç­‰åˆ°å½“å‰æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆï¼Œç„¶ååœ¨æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * User takes responsibility for acks using an</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link</span> AcknowledgingMessageListener&#125;. The consumer</span></span><br><span class="line"><span class="comment">	 * immediately processes the commit.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	MANUAL_IMMEDIATE, <span class="comment">// è°ƒç”¨æ—¶ï¼Œç«‹å³æäº¤æ¶ˆè´¹è¿›åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>çœ‹ä¸‹æ¯ç§æ–¹å¼ï¼Œè‰¿è‰¿éƒ½æ·»åŠ äº†æ³¨é‡Šå“Ÿã€‚</li>
</ul>
<p>é‚£ä¹ˆï¼Œæ—¢ç„¶ç°åœ¨å­˜åœ¨åŸç”Ÿ Kafka å’Œ Spring-Kafka æä¾›çš„ä¸¤ç§æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆé…ç½®å‘¢ï¼Ÿ</p>
<ul>
<li>ä½¿ç”¨åŸç”Ÿ Kafka çš„æ–¹å¼ï¼Œé€šè¿‡é…ç½® <code>spring.kafka.consumer.enable-auto-commit=true</code> ã€‚ç„¶åï¼Œé€šè¿‡ <code>spring.kafka.consumer.auto-commit-interval</code> è®¾ç½®è‡ªåŠ¨æäº¤çš„é¢‘ç‡ã€‚</li>
<li>ä½¿ç”¨ Spring-Kafka çš„æ–¹å¼ï¼Œé€šè¿‡é…ç½® <code>spring.kafka.consumer.enable-auto-commit=false</code> ã€‚ç„¶åé€šè¿‡ <code>spring.kafka.listener.ack-mode</code> è®¾ç½®å…·ä½“æ¨¡å¼ã€‚å¦å¤–ï¼Œè¿˜æœ‰ <code>spring.kafka.listener.ack-time</code> å’Œ <code>spring.kafka.listener.ack-count</code> å¯ä»¥è®¾ç½®è‡ªåŠ¨æäº¤çš„æ—¶é—´é—´éš”å’Œæ¶ˆæ¯æ¡æ•°ã€‚</li>
</ul>
<p><strong>é»˜è®¤ä»€ä¹ˆéƒ½ä¸é…ç½®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Spring-Kafka çš„ BATCH æ¨¡å¼ï¼šæ¯ä¸€æ¬¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆåï¼Œåœ¨ä¸‹æ¬¡æ‹‰å–æ¶ˆæ¯ä¹‹å‰ï¼Œè‡ªåŠ¨æäº¤</strong>ã€‚</p>
<p><strong>ğŸ“š Spring Cloud Stream Kafka çš„æäº¤æœºåˆ¶</strong></p>
<p>Spring Cloud Stream Kafka åœ¨ Spring-Kafka ä¸Šè¿›ä¸€æ­¥å°è£…ï¼Œåœ¨ <code>spring.cloud.stream.kafka.bindings.&lt;bindingName&gt;.consumer</code> ä¸‹æä¾›äº†ä¸¤ä¸ªé…ç½®é¡¹ï¼š</p>
<ul>
<li><code>auto-commit-offset</code> é…ç½®é¡¹ï¼Œæ˜¯å¦è‡ªåŠ¨æäº¤æ¶ˆè´¹è¿›åº¦ï¼Œé»˜è®¤ä¸º <code>true</code> è‡ªåŠ¨æäº¤ã€‚</li>
<li><code>ack-each-record</code> é…ç½®é¡¹ï¼Œæ˜¯å¦æ¯ä¸€æ¡æ¶ˆæ¯éƒ½è¿›è¡Œæäº¤æ¶ˆè´¹è¿›åº¦ï¼Œé»˜è®¤ä¸º <code>false</code> åœ¨æ¯ä¸€æ‰¹æ¶ˆè´¹å®Œæˆåä¸€èµ·æäº¤ã€‚</li>
</ul>
<p>æˆ‘ä»¬è¿›è¡Œä¸‹æ•´ç†ï¼Œå°† Spring Cloud Stream Kafka è¿™ä¸¤ä¸ªé…ç½®é¡¹ï¼Œå’Œ Spring-Kafka çš„ AckMode å¯¹åº”ä¸Šï¼Œå¦‚ä¸‹è¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th align="left">AckMode</th>
<th align="left"><code>auto-commit-offset</code></th>
<th align="left"><code>ack-each-record</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">è‡ªåŠ¨ <code>RECORD</code></td>
<td align="left"><code>true</code></td>
<td align="left"><code>false</code></td>
</tr>
<tr>
<td align="left">è‡ªåŠ¨ <code>BATCH</code></td>
<td align="left"><code>true</code></td>
<td align="left"><code>true</code></td>
</tr>
<tr>
<td align="left">æ‰‹åŠ¨ <code>MANUAL</code></td>
<td align="left"><code>false</code></td>
<td align="left"><code>false</code></td>
</tr>
<tr>
<td align="left">æ‰‹åŠ¨ <code>MANUAL_IMMEDIATE</code></td>
<td align="left"><code>false</code></td>
<td align="left"><code>true</code></td>
</tr>
</tbody></table>
<p>å› æ­¤ï¼Œ<strong>é»˜è®¤ä»€ä¹ˆéƒ½ä¸é…ç½®çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä½¿ç”¨ Spring-Kafka çš„ BATCH æ¨¡å¼ï¼šæ¯ä¸€æ¬¡æ¶ˆæ¯è¢«æ¶ˆè´¹å®Œæˆåï¼Œåœ¨ä¸‹æ¬¡æ‹‰å–æ¶ˆæ¯ä¹‹å‰ï¼Œè‡ªåŠ¨æäº¤</strong>ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Spring Cloud Stream Kafka ä¸‹çš„<strong>æ‰‹åŠ¨æäº¤æ¶ˆè´¹è¿›åº¦</strong>çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F8f6ea4bf1de1625c00f3e487182eab5c.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="12-1-æ­å»ºç”Ÿäº§è€…"><a href="#12-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="12.1 æ­å»ºç”Ÿäº§è€…"></a>12.1 æ­å»ºç”Ÿäº§è€…</h2><p>ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®å³å¯ã€‚</p>
<h2 id="12-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#12-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="12.2 æ­å»ºæ¶ˆè´¹è€…"></a>12.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-ack/"><code>labx-11-sc-stream-kafka-consumer-ack</code></a> é¡¹ç›®ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="12-2-1-é…ç½®æ–‡ä»¶"><a href="#12-2-1-é…ç½®æ–‡ä»¶" class="headerlink" title="12.2.1 é…ç½®æ–‡ä»¶"></a>12.2.1 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-ack/src/main/resources/application.yml"><code>application.yml</code></a> é…ç½®æ–‡ä»¶ï¼Œè®¾ç½® <code>auto-commit-offset</code> é…ç½®é¡¹ä¸º <code>false</code>ï¼Œ<code>ack-each-record</code> é…ç½®é¡¹ä¸º <code>true</code>ï¼Œå³ä½¿ç”¨ Spring-Kafka çš„ <code>MANUAL</code> æ¨¡å¼ï¼Œæ‰‹åŠ¨æäº¤æ¶ˆè´¹è¿›åº¦ã€‚å®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-consumer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-input:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">demo01-consumer-group</span> <span class="comment"># æ¶ˆè´¹è€…åˆ†ç»„</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">        <span class="comment"># Kafka Binding é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBindingProperties ç±»</span></span><br><span class="line">        <span class="attr">bindings:</span></span><br><span class="line">          <span class="attr">demo01-input:</span></span><br><span class="line">            <span class="comment"># Kafka Consumer é…ç½®é¡¹ï¼Œå¯¹åº” KafkaConsumerProperties ç±»</span></span><br><span class="line">            <span class="attr">consumer:</span></span><br><span class="line">              <span class="attr">auto-commit-offset:</span> <span class="literal">false</span> <span class="comment"># æ˜¯å¦è‡ªåŠ¨æäº¤æ¶ˆè´¹è¿›åº¦ï¼Œé»˜è®¤ä¸º true è‡ªåŠ¨æäº¤ã€‚</span></span><br><span class="line">              <span class="attr">ack-each-record:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦æ¯ä¸€æ¡æ¶ˆæ¯éƒ½è¿›è¡Œæäº¤æ¶ˆè´¹è¿›åº¦ï¼Œé»˜è®¤ä¸º false åœ¨æ¯ä¸€æ‰¹æ¶ˆè´¹å®Œæˆåä¸€èµ·æäº¤ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;random.int[10000,19999]&#125;</span> <span class="comment"># éšæœºç«¯å£ï¼Œæ–¹ä¾¿å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…</span></span><br></pre></td></tr></table></figure>



<h3 id="12-2-2-Demo01Consumer"><a href="#12-2-2-Demo01Consumer" class="headerlink" title="12.2.2 Demo01Consumer"></a>12.2.2 Demo01Consumer</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-ack/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/listener/Demo01Consumer.java">Demo01Consumer</a> ç±»ï¼Œå¢åŠ æ‰‹åŠ¨æäº¤æ¶ˆè´¹è¿›åº¦çš„ä»£ç ã€‚ä»£ç å¦‚ä¸‹ï¼šä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo08Consumer.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo08Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = Demo08Message.TOPIC,</span></span><br><span class="line"><span class="meta">            groupId = &quot;demo08-consumer-group-&quot; + Demo08Message.TOPIC)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Demo08Message message, Acknowledgment acknowledgment)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), message);</span><br><span class="line">        <span class="comment">// æäº¤æ¶ˆè´¹è¿›åº¦</span></span><br><span class="line">        <span class="keyword">if</span> (message.getId() % <span class="number">2</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            acknowledgment.acknowledge();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>â‘  åœ¨æ¶ˆè´¹æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬å¢åŠ äº†ç¬¬äºŒä¸ªæ–¹æ³•å‚æ•°ï¼Œç±»å‹ä¸º <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-kafka/blob/master/spring-kafka/src/main/java/org/springframework/kafka/support/Acknowledgment.java">Acknowledgment</a> ç±»ã€‚é€šè¿‡è°ƒç”¨å…¶ <code>#acknowledge()</code> æ–¹æ³•ï¼Œå¯ä»¥æäº¤å½“å‰æ¶ˆæ¯çš„ Topic çš„ Partition çš„æ¶ˆè´¹è¿›åº¦ã€‚</p>
<p>â‘¡ åœ¨æ¶ˆè´¹é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬æ•…æ„åªæäº¤æ¶ˆè´¹çš„ç¬¬ä¸€æ¡æ¶ˆæ¯ã€‚ğŸ˜ˆ è¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å‘é€ä¸¤æ¡æ¶ˆæ¯ï¼Œå¦‚æœç¬¬äºŒæ¡çš„æ¶ˆè´¹è¿›åº¦æ²¡æœ‰è¢«æäº¤ï¼Œå°±å¯ä»¥è¯´æ˜æ‰‹åŠ¨æäº¤æ¶ˆè´¹è¿›åº¦æˆåŠŸã€‚</p>
<h2 id="12-3-ç®€å•æµ‹è¯•"><a href="#12-3-ç®€å•æµ‹è¯•" class="headerlink" title="12.3 ç®€å•æµ‹è¯•"></a>12.3 ç®€å•æµ‹è¯•</h2><blockquote>
<p>å‹æƒ…æç¤ºï¼šè¿™é‡Œä¸ºäº†æµ‹è¯•æ–¹ä¾¿ï¼Œé¿å…å…¶å®ƒç¤ºä¾‹æ±¡æŸ“ï¼Œå› æ­¤è‰¿è‰¿å…ˆç›´æ¥åˆ é™¤äº† <code>DEMO-TOPIC-01</code> Topicï¼Œç„¶åé‡æ–°åˆ›å»ºã€‚</p>
</blockquote>
<p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Applicationï¼Œå¯åŠ¨<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send">http://127.0.0.1:18080/demo01/send</a> æ¥å£ï¼Œå‘é€ä¸¤æ¡æ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// Consumer æ¶ˆè´¹ 2 æ¡æ¶ˆæ¯æˆåŠŸ</span><br><span class="line">2020-03-10 08:28:52.274  INFO 86430 --- [container-0-C-1] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:27 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-1390450417&#125;]</span><br><span class="line">2020-03-10 08:28:53.101  INFO 86430 --- [container-0-C-1] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:27 æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=34018866&#125;]</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬æ‰“å¼€ Kafka è¿ç»´ç•Œé¢ï¼ŒæŸ¥çœ‹ä¸‹ <code>DEMO-TOPIC-01</code> Topic çš„æ¶ˆæ¯è¿›åº¦æƒ…å†µï¼Œä¼šçœ‹åˆ°<strong>ä¸€æ¡æ¶ˆæ¯çš„æ¶ˆè´¹è¿›åº¦æœªè¢«æäº¤</strong>ï¼Œç¬¦åˆé¢„æœŸã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F635404bf56e9e987ca6be51686ee2c5d.png" alt=" Topic"></p>
<h1 id="13-æ‰¹é‡å‘é€æ¶ˆæ¯"><a href="#13-æ‰¹é‡å‘é€æ¶ˆæ¯" class="headerlink" title="13. æ‰¹é‡å‘é€æ¶ˆæ¯"></a>13. æ‰¹é‡å‘é€æ¶ˆæ¯</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-batch"><code>labx-11-sc-stream-kafka-producer-batch</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a></li>
</ul>
</blockquote>
<p>åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Producer æ‰¹é‡å‘é€æ¶ˆæ¯ï¼Œæé«˜å‘é€æ€§èƒ½ã€‚ä¸åŒäºæˆ‘ä»¬åœ¨<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/RocketMQ/?self">ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— RocketMQ å…¥é—¨ã€‹</a> çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ4. æ‰¹é‡å‘é€æ¶ˆæ¯ã€</a> åŠŸèƒ½ï¼ŒRocketMQ æ˜¯æä¾›äº†ä¸€ä¸ªå¯ä»¥æ‰¹é‡å‘é€å¤šæ¡æ¶ˆæ¯çš„ API ã€‚</p>
<p>è€Œ Kafka æä¾›çš„æ‰¹é‡å‘é€æ¶ˆæ¯ï¼Œå®ƒæä¾›äº†ä¸€ä¸ª <a target="_blank" rel="noopener" href="http://people.apache.org/~nehanarkhede/kafka-0.9-producer-javadoc/doc/org/apache/kafka/clients/producer/internals/RecordAccumulator.html">RecordAccumulator</a> æ¶ˆæ¯æ”¶é›†å™¨ï¼Œå°†å‘é€ç»™ç›¸åŒ Topic çš„ç›¸åŒ Partition åˆ†åŒºçš„æ¶ˆæ¯ä»¬ï¼Œâ€œ<strong>å·å·</strong>â€æ”¶é›†åœ¨ä¸€èµ·ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶å€™ï¼Œä¸€æ¬¡æ€§æ‰¹é‡å‘é€æäº¤ç»™ Kafka Broker ã€‚é€šè¿‡åœ¨ <code>spring.cloud.stream.kafka.bindings.&lt;bindingName&gt;.producer</code> ä¸‹æä¾›äº†ä¸¤ä¸ªé…ç½®é¡¹ï¼Œæ»¡è¶³<strong>ä»»ä¸€</strong>å³ä¼šæ‰¹é‡å‘é€ï¼š</p>
<ul>
<li>ã€æ—¶é—´ã€‘<code>batch-timeout</code> ï¼šè¶…è¿‡æ”¶é›†çš„æ—¶é—´çš„æœ€å¤§ç­‰å¾…æ—¶é•¿ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚</li>
<li>ã€ç©ºé—´ã€‘<code>buffer-memory</code> ï¼šè¶…è¿‡æ”¶é›†çš„æ¶ˆæ¯å ç”¨çš„æœ€å¤§å†…å­˜ã€‚</li>
</ul>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Spring Cloud Stream Kafka ä¸‹çš„<strong>æ‰¹é‡å‘é€æ¶ˆæ¯</strong>çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F51338ce21d434fa7142aca9f7fed538f.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="13-1-æ­å»ºç”Ÿäº§è€…"><a href="#13-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="13.1 æ­å»ºç”Ÿäº§è€…"></a>13.1 æ­å»ºç”Ÿäº§è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-batch"><code>labx-11-sc-stream-kafka-producer-batch</code></a> é¡¹ç›®ä½œä¸ºç”Ÿäº§è€…ã€‚</p>
<h3 id="13-1-1-é…ç½®æ–‡ä»¶"><a href="#13-1-1-é…ç½®æ–‡ä»¶" class="headerlink" title="13.1.1 é…ç½®æ–‡ä»¶"></a>13.1.1 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-batch/src/main/resources/application.yml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ï¼Œå¢åŠ æ‰¹é‡<strong>å‘é€</strong>æ¶ˆæ¯ç›¸å…³çš„é…ç½®é¡¹ã€‚å®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-producer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-output:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">        <span class="comment"># Kafka è‡ªå®šä¹‰ Binding é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBindingProperties Map</span></span><br><span class="line">        <span class="attr">bindings:</span></span><br><span class="line">          <span class="attr">demo01-output:</span></span><br><span class="line">            <span class="comment"># Kafka Producer é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProducerProperties ç±»</span></span><br><span class="line">            <span class="attr">producer:</span></span><br><span class="line">              <span class="attr">batch-timeout:</span> <span class="number">30000</span> <span class="comment"># æ‰¹å¤„ç†å»¶è¿Ÿæ—¶é—´ä¸Šé™ã€‚è¿™é‡Œé…ç½®ä¸º 30 * 1000 ms è¿‡åï¼Œä¸ç®¡æ˜¯å¦æ¶ˆæ¯æ•°é‡æ˜¯å¦åˆ°è¾¾ batch-size æˆ–è€…æ¶ˆæ¯å¤§å°åˆ°è¾¾ buffer-memory åï¼Œéƒ½ç›´æ¥å‘é€ä¸€æ¬¡è¯·æ±‚</span></span><br><span class="line">              <span class="attr">buffer-size:</span> <span class="number">33554432</span> <span class="comment"># æ¯æ¬¡æ‰¹é‡å‘é€æ¶ˆæ¯çš„æœ€å¤§å†…å­˜</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18080</span></span><br></pre></td></tr></table></figure>



<p>å…·ä½“ <code>batch-timeout</code> å’Œ <code>buffer-size</code> é…ç½®é¡¹çš„æ•°å€¼é…ç½®å¤šå°‘ï¼Œæ ¹æ®è‡ªå·±çš„åº”ç”¨æ¥ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ•…æ„å°† <code>batch-timeout</code> é…ç½®æˆäº† 30 ç§’ï¼Œä¸»è¦ä¸ºäº†æ¼”ç¤ºä¹‹ç”¨ã€‚</p>
<h3 id="13-1-2-Demo01Controller"><a href="#13-1-2-Demo01Controller" class="headerlink" title="13.1.2 Demo01Controller"></a>13.1.2 Demo01Controller</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-batch/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/kafkademo/controller/Demo01Controller.java">Demo01Controller</a> ç±»ï¼Œå¢åŠ å‘é€ä¸‰æ¡æ¶ˆæ¯çš„ HTTP æ¥å£ï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demo01Controller.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/send_batch&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">sendBatch</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º Message</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt();</span><br><span class="line">        <span class="type">Demo01Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo01Message</span>()</span><br><span class="line">                .setId(id);</span><br><span class="line">        <span class="comment">// åˆ›å»º Spring Message å¯¹è±¡</span></span><br><span class="line">        Message&lt;Demo01Message&gt; springMessage = MessageBuilder.withPayload(message)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">// å‘é€æ¶ˆæ¯</span></span><br><span class="line">        mySource.demo01Output().send(springMessage);</span><br><span class="line">        logger.info(<span class="string">&quot;[send_transaction][å‘é€ç¼–å·ï¼š[&#123;&#125;] å‘é€æˆåŠŸ]&quot;</span>, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å°±æ˜¯æ™®é€šçš„å‘é€æ¶ˆæ¯çš„ä»£ç ï¼Œå¤šå¥—äº†ä¸€å±‚å¾ªç¯~</p>
<h2 id="13-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#13-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="13.2 æ­å»ºæ¶ˆè´¹è€…"></a>13.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®å³å¯ã€‚</p>
<h2 id="13-3-ç®€å•æµ‹è¯•"><a href="#13-3-ç®€å•æµ‹è¯•" class="headerlink" title="13.3 ç®€å•æµ‹è¯•"></a>13.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Applicationï¼Œå¯åŠ¨<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send_batch">http://127.0.0.1:18080/demo01/send_batch</a> æ¥å£ï¼Œå‘é€ä¸‰æ¡æ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Producer å‘é€äº† 3 æ¡æ¶ˆæ¯ï¼Œè¢« RecordAccumulator æ”¶é›†</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> 08:<span class="number">58</span>:<span class="number">52.736</span>  INFO <span class="number">87258</span> --- [io-<span class="number">18080</span>-exec-<span class="number">1</span>] c.i.s.l.k.k.controller.Demo01Controller  : [send_batch][å‘é€ç¼–å·ï¼š[-<span class="number">936892120</span>] å‘é€æˆåŠŸ]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> 08:<span class="number">58</span>:<span class="number">52.736</span>  INFO <span class="number">87258</span> --- [io-<span class="number">18080</span>-exec-<span class="number">1</span>] c.i.s.l.k.k.controller.Demo01Controller  : [send_batch][å‘é€ç¼–å·ï¼š[<span class="number">128684651</span>] å‘é€æˆåŠŸ]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> 08:<span class="number">58</span>:<span class="number">52.737</span>  INFO <span class="number">87258</span> --- [io-<span class="number">18080</span>-exec-<span class="number">1</span>] c.i.s.l.k.k.controller.Demo01Controller  : [send_batch][å‘é€ç¼–å·ï¼š[-<span class="number">1940691507</span>] å‘é€æˆåŠŸ]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 30 ç§’åï¼ŒProducer æ‰¹é‡å‘é€æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="comment">// æ­¤æ—¶ï¼ŒConsumer æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> 08:<span class="number">59</span>:<span class="number">22.753</span>  INFO <span class="number">87236</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">936892120</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> 08:<span class="number">59</span>:<span class="number">22.753</span>  INFO <span class="number">87236</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=<span class="number">128684651</span>&#125;]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> 08:<span class="number">59</span>:<span class="number">22.753</span>  INFO <span class="number">87236</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">27</span> æ¶ˆæ¯å†…å®¹ï¼šDemo01Message&#123;id=-<span class="number">1940691507</span>&#125;]</span><br></pre></td></tr></table></figure>



<p>Consumer åœ¨æ¶ˆæ¯æ‰¹é‡å‘é€åï¼Œæ‰æ¶ˆè´¹åˆ°è¯¥æ¶ˆæ¯ã€‚ç¬¦åˆé¢„æœŸ~</p>
<h1 id="14-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯"><a href="#14-æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="14. æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯"></a>14. æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-producer-demo</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-batch/"><code>labx-11-sc-stream-kafka-consumer-batch</code></a></li>
</ul>
</blockquote>
<p>åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Consumer æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦ã€‚è¦æ³¨æ„ï¼ŒConsumer çš„æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ï¼Œå’Œ Producer çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ13. æ‰¹é‡å‘é€æ¶ˆæ¯ã€</a> æ²¡æœ‰ç›´æ¥å…³è”å“ˆã€‚</p>
<p>å…¶å®ç°æ–¹å¼æ˜¯ï¼ŒConsumer é˜»å¡ç­‰å¾…æœ€å¤š <code>fetch.max.wait.ms</code> æ¯«ç§’ï¼Œè‡³å°‘æ‹‰å– <code>fetch.min.bytes</code> æ•°æ®é‡çš„æ¶ˆæ¯ï¼Œè‡³å¤šæ‹‰å– <code>max.poll.records</code> æ•°é‡çš„æ¶ˆæ¯ï¼Œè¿›è¡Œæ‰¹é‡æ¶ˆè´¹ã€‚</p>
<ul>
<li>å¦‚æœåœ¨ <code>fetch.max.wait.ms</code> ç§’å†…å·²ç»æˆåŠŸæ‹‰å–åˆ° <code>max.poll.records</code> æ¡æ¶ˆæ¯ï¼Œåˆ™ç›´æ¥è¿›è¡Œæ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚</li>
<li>å¦‚æœåœ¨ <code>fetch.max.wait.ms</code> ç§’è¿˜æ²¡æ‹‰å–åˆ° <code>max.poll.records</code> æ¡æ¶ˆæ¯ï¼Œä¸å†ç­‰å¾…ï¼Œè€Œæ˜¯è¿›è¡Œæ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚</li>
</ul>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª Spring Cloud Stream Kafka ä¸‹çš„ <strong>Consumer çš„æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯</strong>çš„ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F5223da4354c67361041c1fe6b33d6b35.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="14-1-æ­å»ºç”Ÿäº§è€…"><a href="#14-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="14.1 æ­å»ºç”Ÿäº§è€…"></a>14.1 æ­å»ºç”Ÿäº§è€…</h2><p>ç›´æ¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo/"><code>labx-11-sc-stream-kafka-producer-demo</code></a> é¡¹ç›®å³å¯ã€‚</p>
<h2 id="14-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#14-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="14.2 æ­å»ºæ¶ˆè´¹è€…"></a>14.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo/"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-batch/"><code>labx-11-sc-stream-kafka-consumer-batch</code></a> é¡¹ç›®ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="14-2-1-é…ç½®æ–‡ä»¶"><a href="#14-2-1-é…ç½®æ–‡ä»¶" class="headerlink" title="14.2.1 é…ç½®æ–‡ä»¶"></a>14.2.1 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-batch/src/main/resources/application.yml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ï¼Œå¢åŠ æ‰¹é‡<strong>æ¶ˆè´¹</strong>æ¶ˆæ¯ç›¸å…³çš„é…ç½®é¡¹ã€‚å®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo-consumer-application</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="comment"># Spring Cloud Stream é…ç½®é¡¹ï¼Œå¯¹åº” BindingServiceProperties ç±»</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="comment"># Binder é…ç½®é¡¹ï¼Œå¯¹åº” BinderProperties Map</span></span><br><span class="line"><span class="comment">#      binders:</span></span><br><span class="line">      <span class="comment"># Binding é…ç½®é¡¹ï¼Œå¯¹åº” BindingProperties Map</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">demo01-input:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">DEMO-TOPIC-01</span> <span class="comment"># ç›®çš„åœ°ã€‚è¿™é‡Œä½¿ç”¨ Kafka Topic</span></span><br><span class="line">          <span class="attr">content-type:</span> <span class="string">application/json</span> <span class="comment"># å†…å®¹æ ¼å¼ã€‚è¿™é‡Œä½¿ç”¨ JSON</span></span><br><span class="line">          <span class="attr">group:</span> <span class="string">demo01-consumer-group</span> <span class="comment"># æ¶ˆè´¹è€…åˆ†ç»„</span></span><br><span class="line">          <span class="comment"># Consumer é…ç½®é¡¹ï¼Œå¯¹åº” ConsumerProperties ç±»</span></span><br><span class="line">          <span class="attr">consumer:</span></span><br><span class="line">            <span class="attr">batch-mode:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦æ‰¹é‡æ¶ˆè´¹é»˜è®¤ï¼Œé»˜è®¤ä¸º false</span></span><br><span class="line">      <span class="comment"># Spring Cloud Stream Kafka é…ç½®é¡¹</span></span><br><span class="line">      <span class="attr">kafka:</span></span><br><span class="line">        <span class="comment"># Kafka Binder é…ç½®é¡¹ï¼Œå¯¹åº” KafkaBinderConfigurationProperties ç±»</span></span><br><span class="line">        <span class="attr">binder:</span></span><br><span class="line">          <span class="attr">brokers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line">          <span class="attr">configuration:</span></span><br><span class="line">            <span class="attr">fetch.max.wait.ms:</span> <span class="number">10000</span> <span class="comment"># poll ä¸€æ¬¡æ‹‰å–çš„é˜»å¡çš„æœ€å¤§æ—¶é•¿ï¼Œå•ä½ï¼šæ¯«ç§’ã€‚è¿™é‡ŒæŒ‡çš„æ˜¯é˜»å¡æ‹‰å–éœ€è¦æ»¡è¶³è‡³å°‘ fetch-min-size å¤§å°çš„æ¶ˆæ¯</span></span><br><span class="line">            <span class="attr">fetch.min.bytes:</span> <span class="number">1024</span> <span class="comment"># poll ä¸€æ¬¡æ¶ˆæ¯æ‹‰å–çš„æœ€å°æ•°æ®é‡ï¼Œå•ä½ï¼šå­—èŠ‚</span></span><br><span class="line">            <span class="attr">max.poll.records:</span> <span class="number">100</span> <span class="comment"># poll ä¸€æ¬¡æ¶ˆæ¯æ‹‰å–çš„æœ€å¤§æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="string">$&#123;random.int[10000,19999]&#125;</span> <span class="comment"># éšæœºç«¯å£ï¼Œæ–¹ä¾¿å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…</span></span><br></pre></td></tr></table></figure>



<p>â‘  å…·ä½“ <code>fetch.max.wait.ms</code>ã€<code>fetch.min.bytes</code>ã€<code>max.poll.records</code> é…ç½®é¡¹çš„æ•°å€¼é…ç½®å¤šå°‘ï¼Œæ ¹æ®è‡ªå·±çš„åº”ç”¨æ¥ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ•…æ„å°† <code>fetch.max.wait.ms</code> é…ç½®æˆäº† 10 ç§’ï¼Œä¸»è¦ä¸ºäº†æ¼”ç¤ºä¹‹ç”¨ã€‚</p>
<p>â‘¡ è®¾ç½® <code>spring.cloud.stream.bindings.&lt;bindingName&gt;.consumer.batch-mode</code> é…ç½®é¡¹ä¸º <code>true</code>ï¼Œå¼€å¯ Consumer æ‰¹é‡æ¶ˆè´¹æ¨¡å¼ã€‚</p>
<h3 id="14-2-2-Demo01Consumer"><a href="#14-2-2-Demo01Consumer" class="headerlink" title="14.2.2 Demo01Consumer"></a>14.2.2 Demo01Consumer</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-batch/src/main/java/cn/iocoder/springcloud/labx11/kafkademo/consumerdemo/listener/Demo01Consumer.java">Demo01Consumer</a> ç±»ï¼Œå°†æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³•çš„å‚æ•°æ”¹ä¸º **<code>List&lt;?&gt;</code>**ï¼Œä»è€Œæ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Consumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener(MySink.DEMO01_INPUT)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Payload</span> List&lt;Demo01Message&gt; messages)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onMessage][çº¿ç¨‹ç¼–å·:&#123;&#125; æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;]&quot;</span>, Thread.currentThread().getId(), messages);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="14-3-ç®€å•æµ‹è¯•"><a href="#14-3-ç®€å•æµ‹è¯•" class="headerlink" title="14.3 ç®€å•æµ‹è¯•"></a>14.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ <strong>Consumer</strong>Applicationï¼Œå¯åŠ¨<strong>æ¶ˆè´¹è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>â‘¡ æ‰§è¡Œ <strong>Producer</strong>Applicationï¼Œå¯åŠ¨<strong>ç”Ÿäº§è€…</strong>çš„å®ä¾‹ã€‚</p>
<p>ä¹‹åï¼Œè¯·æ±‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/demo01/send">http://127.0.0.1:18080/demo01/send</a> æ¥å£ä¸‰æ¬¡ï¼Œå‘é€ä¸‰æ¡æ¶ˆæ¯ã€‚IDEA æ§åˆ¶å°è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Producer æˆåŠŸåŒæ­¥å‘é€äº† 3 æ¡æ¶ˆæ¯</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">42.630</span>  INFO <span class="number">92203</span> --- [io-<span class="number">18080</span>-exec-<span class="number">6</span>] c.i.s.l.k.k.controller.Demo01Controller  : [send][å‘é€ç¼–å·ï¼š[-<span class="number">536147214</span>] å‘é€æˆåŠŸ]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">42.877</span>  INFO <span class="number">92203</span> --- [io-<span class="number">18080</span>-exec-<span class="number">7</span>] c.i.s.l.k.k.controller.Demo01Controller  : [send][å‘é€ç¼–å·ï¼š[<span class="number">651899347</span>] å‘é€æˆåŠŸ]</span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">43.071</span>  INFO <span class="number">92203</span> --- [io-<span class="number">18080</span>-exec-<span class="number">8</span>] c.i.s.l.k.k.controller.Demo01Controller  : [send][å‘é€ç¼–å·ï¼š[-<span class="number">1217020146</span>] å‘é€æˆåŠŸ]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Consumer æ‹‰å– 30 ç§’è¶…æ—¶åï¼Œè·å–åˆ°å‘é€çš„ 3 æ¡æ¶ˆæ¯ï¼Œå¹¶æ‰¹é‡æ¶ˆè´¹äº† 3 æ¡æ¶ˆæ¯</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">03</span>-<span class="number">10</span> <span class="number">15</span>:<span class="number">36</span>:<span class="number">48.881</span>  INFO <span class="number">92667</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.k.c.listener.Demo01Consumer      : [onMessage][çº¿ç¨‹ç¼–å·:<span class="number">30</span> æ¶ˆæ¯å†…å®¹ï¼š[[B@5cb66abe, [B@66be19cc, [B@63f992da]]</span><br></pre></td></tr></table></figure>



<p>ä»æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå‘é€çš„ 3 æ¡æ¶ˆæ¯è¢« Demo01Consumer æ‰¹é‡æ¶ˆè´¹äº†ã€‚</p>
<h1 id="15-ç›‘æ§ç«¯ç‚¹"><a href="#15-ç›‘æ§ç«¯ç‚¹" class="headerlink" title="15. ç›‘æ§ç«¯ç‚¹"></a>15. ç›‘æ§ç«¯ç‚¹</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-actuator"><code>labx-11-sc-stream-kafka-producer-actuator</code></a></li>
<li>æ¶ˆè´¹è€…ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-actuator"><code>labx-11-sc-stream-kafka-consumer-actuator</code></a></li>
</ul>
</blockquote>
<p>Spring Cloud Stream çš„ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/endpoint/BindingsEndpoint.java"><code>endpoint</code></a> æ¨¡å—ï¼ŒåŸºäº Spring Boot Actuatorï¼Œæä¾›äº†è‡ªå®šä¹‰ç›‘æ§ç«¯ç‚¹ <a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-sentinel/src/main/java/com/alibaba/cloud/sentinel/endpoint/SentinelEndpoint.java"><code>bindings</code></a> å’Œ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream/blob/master/spring-cloud-stream/src/main/java/org/springframework/cloud/stream/endpoint/ChannelsEndpoint.java"><code>channels</code></a>ï¼Œç”¨äºè·å– Spring Cloud Stream çš„ Binding å’Œ Channel ä¿¡æ¯ã€‚</p>
<p>åŒæ—¶ï¼ŒSpring Cloud Stream Kafka æ‹“å±•äº† Spring Boot Actuator å†…ç½®çš„ <code>health</code> ç«¯ç‚¹ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka/blob/master/spring-cloud-stream-binder-kafka/src/main/java/org/springframework/cloud/stream/binder/kafka/KafkaBinderHealthIndicator.java">KafkaBinderHealthIndicator</a>ï¼Œè·å– Kafka å®¢æˆ·ç«¯çš„å¥åº·çŠ¶æ€ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå¯¹ Spring Boot Actuator ä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥åç»­é˜…è¯»<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/Actuator/?self">ã€ŠèŠ‹é“ Spring Boot ç›‘æ§ç«¯ç‚¹ Actuator å…¥é—¨ã€‹</a>æ–‡ç« ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ª Spring Cloud Stream RocketMQ <strong>ç›‘æ§ç«¯ç‚¹</strong>çš„ä½¿ç”¨ç¤ºä¾‹ã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F62e4adeb6f3baa2b67d74dc651fb23c2.png" alt="é¡¹ç›®ç»“æ„"></p>
<h2 id="15-1-æ­å»ºç”Ÿäº§è€…"><a href="#15-1-æ­å»ºç”Ÿäº§è€…" class="headerlink" title="15.1 æ­å»ºç”Ÿäº§è€…"></a>15.1 æ­å»ºç”Ÿäº§è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-demo"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-actuator"><code>labx-11-sc-stream-kafka-producer-actuator</code></a> é¡¹ç›®ä½œä¸ºç”Ÿäº§è€…ã€‚</p>
<h3 id="15-1-1-å¼•å…¥ä¾èµ–"><a href="#15-1-1-å¼•å…¥ä¾èµ–" class="headerlink" title="15.1.1 å¼•å…¥ä¾èµ–"></a>15.1.1 å¼•å…¥ä¾èµ–</h3><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-actuator/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ä¸­ï¼Œé¢å¤–å¼•å…¥ Spring Boot Actuator ç›¸å…³ä¾èµ–ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®ç°å¯¹ Actuator çš„è‡ªåŠ¨åŒ–é…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="15-1-2-é…ç½®æ–‡ä»¶"><a href="#15-1-2-é…ç½®æ–‡ä»¶" class="headerlink" title="15.1.2 é…ç½®æ–‡ä»¶"></a>15.1.2 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-producer-actuator/src/main/resources/application.yml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ï¼Œ<strong>é¢å¤–</strong>å¢åŠ  Spring Boot Actuator é…ç½®é¡¹ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># éœ€è¦å¼€æ”¾çš„ç«¯ç‚¹ã€‚é»˜è®¤å€¼åªæ‰“å¼€ health å’Œ info ä¸¤ä¸ªç«¯ç‚¹ã€‚é€šè¿‡è®¾ç½® * ï¼Œå¯ä»¥å¼€æ”¾æ‰€æœ‰ç«¯ç‚¹ã€‚</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="comment"># Health ç«¯ç‚¹é…ç½®é¡¹ï¼Œå¯¹åº” HealthProperties é…ç½®ç±»</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º true å¼€å¯ã€‚</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">ALWAYS</span> <span class="comment"># ä½•æ—¶æ˜¾ç¤ºå®Œæ•´çš„å¥åº·ä¿¡æ¯ã€‚é»˜è®¤ä¸º NEVER éƒ½ä¸å±•ç¤ºã€‚å¯é€‰ WHEN_AUTHORIZED å½“ç»è¿‡æˆæƒçš„ç”¨æˆ·ï¼›å¯é€‰ ALWAYS æ€»æ˜¯å±•ç¤ºã€‚</span></span><br></pre></td></tr></table></figure>



<p>æ¯ä¸ªé…ç½®é¡¹çš„ä½œç”¨ï¼Œèƒ–å‹çœ‹ä¸‹è‰¿è‰¿æ·»åŠ çš„æ³¨é‡Šã€‚å¦‚æœè¿˜ä¸ç†è§£çš„è¯ï¼Œåç»­çœ‹ä¸‹<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/Actuator/?self">ã€ŠèŠ‹é“ Spring Boot ç›‘æ§ç«¯ç‚¹ Actuator å…¥é—¨ã€‹</a>æ–‡ç« ã€‚</p>
<h3 id="15-1-3-ç®€å•æµ‹è¯•"><a href="#15-1-3-ç®€å•æµ‹è¯•" class="headerlink" title="15.1.3 ç®€å•æµ‹è¯•"></a>15.1.3 ç®€å•æµ‹è¯•</h3><p>â‘  ä½¿ç”¨ ProducerApplication å¯åŠ¨ç”Ÿäº§è€…ã€‚</p>
<p>â‘¡ è®¿é—®åº”ç”¨çš„ <code>bindings</code> ç›‘æ§ç«¯ç‚¹ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/actuator/bindings%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A![">http://127.0.0.1:18080/actuator/bindingsï¼Œè¿”å›ç»“æœå¦‚ä¸‹å›¾ï¼š![</a> ç›‘æ§ç«¯ç‚¹](<a target="_blank" rel="noopener" href="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0195e4f7088284d84213949c24cd2e7e.png">https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0195e4f7088284d84213949c24cd2e7e.png</a>)</p>
<p>â‘¢ è®¿é—®åº”ç”¨çš„ <code>channels</code> ç›‘æ§ç«¯ç‚¹ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/actuator/channels%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A![">http://127.0.0.1:18080/actuator/channelsï¼Œè¿”å›ç»“æœå¦‚ä¸‹å›¾ï¼š![</a> ç›‘æ§ç«¯ç‚¹](<a target="_blank" rel="noopener" href="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F1ddd85ff936b8971d4429648dc10af6c.png">https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F1ddd85ff936b8971d4429648dc10af6c.png</a>)</p>
<p>â‘£ è®¿é—®åº”ç”¨çš„ <code>health</code> ç›‘æ§ç«¯ç‚¹ <a target="_blank" rel="noopener" href="http://127.0.0.1:18080/actuator/health%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A![">http://127.0.0.1:18080/actuator/healthï¼Œè¿”å›ç»“æœå¦‚ä¸‹å›¾ï¼š![</a> ç›‘æ§ç«¯ç‚¹](<a target="_blank" rel="noopener" href="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0cc98de40045e3715475c92abda4e202.png">https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0cc98de40045e3715475c92abda4e202.png</a>)</p>
<h2 id="15-2-æ­å»ºæ¶ˆè´¹è€…"><a href="#15-2-æ­å»ºæ¶ˆè´¹è€…" class="headerlink" title="15.2 æ­å»ºæ¶ˆè´¹è€…"></a>15.2 æ­å»ºæ¶ˆè´¹è€…</h2><p>ä»<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Kafka/#">ã€Œ3. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-demo"><code>labx-11-sc-stream-kafka-consumer-demo</code></a> é¡¹ç›®ï¼Œå¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-actuator"><code>labx-11-sc-stream-kafka-consumer-actuator</code></a> é¡¹ç›®ä½œä¸ºæ¶ˆè´¹è€…ã€‚</p>
<h3 id="15-2-1-å¼•å…¥ä¾èµ–"><a href="#15-2-1-å¼•å…¥ä¾èµ–" class="headerlink" title="15.2.1 å¼•å…¥ä¾èµ–"></a>15.2.1 å¼•å…¥ä¾èµ–</h3><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-actuator/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ä¸­ï¼Œé¢å¤–å¼•å…¥ Spring Boot Actuator ç›¸å…³ä¾èµ–ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®ç°å¯¹ Actuator çš„è‡ªåŠ¨åŒ–é…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="15-2-2-é…ç½®æ–‡ä»¶"><a href="#15-2-2-é…ç½®æ–‡ä»¶" class="headerlink" title="15.2.2 é…ç½®æ–‡ä»¶"></a>15.2.2 é…ç½®æ–‡ä»¶</h3><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-11-spring-cloud-stream-kafka/labx-11-sc-stream-kafka-consumer-actuator/src/main/resources/application.yml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ï¼Œ<strong>é¢å¤–</strong>å¢åŠ  Spring Boot Actuator é…ç½®é¡¹ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># éœ€è¦å¼€æ”¾çš„ç«¯ç‚¹ã€‚é»˜è®¤å€¼åªæ‰“å¼€ health å’Œ info ä¸¤ä¸ªç«¯ç‚¹ã€‚é€šè¿‡è®¾ç½® * ï¼Œå¯ä»¥å¼€æ”¾æ‰€æœ‰ç«¯ç‚¹ã€‚</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="comment"># Health ç«¯ç‚¹é…ç½®é¡¹ï¼Œå¯¹åº” HealthProperties é…ç½®ç±»</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º true å¼€å¯ã€‚</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">ALWAYS</span> <span class="comment"># ä½•æ—¶æ˜¾ç¤ºå®Œæ•´çš„å¥åº·ä¿¡æ¯ã€‚é»˜è®¤ä¸º NEVER éƒ½ä¸å±•ç¤ºã€‚å¯é€‰ WHEN_AUTHORIZED å½“ç»è¿‡æˆæƒçš„ç”¨æˆ·ï¼›å¯é€‰ ALWAYS æ€»æ˜¯å±•ç¤ºã€‚</span></span><br></pre></td></tr></table></figure>



<p>æ¯ä¸ªé…ç½®é¡¹çš„ä½œç”¨ï¼Œèƒ–å‹çœ‹ä¸‹è‰¿è‰¿æ·»åŠ çš„æ³¨é‡Šã€‚å¦‚æœè¿˜ä¸ç†è§£çš„è¯ï¼Œåç»­çœ‹ä¸‹<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/Actuator/?self">ã€ŠèŠ‹é“ Spring Boot ç›‘æ§ç«¯ç‚¹ Actuator å…¥é—¨ã€‹</a>æ–‡ç« ã€‚</p>
<h3 id="15-2-3-ç®€å•æµ‹è¯•"><a href="#15-2-3-ç®€å•æµ‹è¯•" class="headerlink" title="15.2.3 ç®€å•æµ‹è¯•"></a>15.2.3 ç®€å•æµ‹è¯•</h3><p>â‘  ä½¿ç”¨ ConsumerApplication å¯åŠ¨æ¶ˆè´¹è€…ï¼Œéšæœºç«¯å£ä¸º 15748ã€‚</p>
<p>â‘¡ è®¿é—®åº”ç”¨çš„ <code>bindings</code> ç›‘æ§ç«¯ç‚¹ <a target="_blank" rel="noopener" href="http://127.0.0.1:15748/actuator/bindings%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A![">http://127.0.0.1:15748/actuator/bindingsï¼Œè¿”å›ç»“æœå¦‚ä¸‹å›¾ï¼š![</a> ç›‘æ§ç«¯ç‚¹](<a target="_blank" rel="noopener" href="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F8cbe61dd176634cb9f2450bfa9f8bd4f.png">https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F8cbe61dd176634cb9f2450bfa9f8bd4f.png</a>)</p>
<p>â‘¢ è®¿é—®åº”ç”¨çš„ <code>channels</code> ç›‘æ§ç«¯ç‚¹ <a target="_blank" rel="noopener" href="http://127.0.0.1:15748/actuator/channels%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A![">http://127.0.0.1:15748/actuator/channelsï¼Œè¿”å›ç»“æœå¦‚ä¸‹å›¾ï¼š![</a> ç›‘æ§ç«¯ç‚¹](<a target="_blank" rel="noopener" href="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F291400348a33ad5bf618c7a3fe6e55ee.png">https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F291400348a33ad5bf618c7a3fe6e55ee.png</a>)</p>
<p>â‘£ è®¿é—®åº”ç”¨çš„ <code>health</code> ç›‘æ§ç«¯ç‚¹ <a target="_blank" rel="noopener" href="http://127.0.0.1:15748/actuator/health%EF%BC%8C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A![">http://127.0.0.1:15748/actuator/healthï¼Œè¿”å›ç»“æœå¦‚ä¸‹å›¾ï¼š![</a> ç›‘æ§ç«¯ç‚¹](<a target="_blank" rel="noopener" href="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F291400348a33ad5bf618c7a3fe6e55ee.png">https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F291400348a33ad5bf618c7a3fe6e55ee.png</a>)</p>
<h1 id="â€”â€”â€“-6"><a href="#â€”â€”â€“-6" class="headerlink" title="â€”â€”â€“"></a>â€”â€”â€“</h1><h1 id="SpringCloudäº‹ä»¶æ€»çº¿ä¸­çš„Kafka"><a href="#SpringCloudäº‹ä»¶æ€»çº¿ä¸­çš„Kafka" class="headerlink" title="SpringCloudäº‹ä»¶æ€»çº¿ä¸­çš„Kafka"></a>SpringCloudäº‹ä»¶æ€»çº¿ä¸­çš„Kafka</h1><h1 id="â€”â€”â€“-7"><a href="#â€”â€”â€“-7" class="headerlink" title="â€”â€”â€“"></a>â€”â€”â€“</h1><h1 id="1-æ¦‚è¿°-3"><a href="#1-æ¦‚è¿°-3" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><blockquote>
<p>å‹æƒ…æç¤ºï¼šåœ¨å¼€å§‹æœ¬æ–‡ä¹‹å‰ï¼Œèƒ–å‹éœ€è¦å¯¹ Kafka è¿›è¡Œç®€å•çš„å­¦ä¹ ã€‚å¯ä»¥é˜…è¯»<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Kafka/install/?self">ã€ŠKafka æç®€å…¥é—¨ã€‹</a>æ–‡ç« ï¼Œå°†ç¬¬<strong>ä¸€äºŒ</strong>å°èŠ‚çœ‹å®Œï¼Œåœ¨æœ¬æœºæ­å»ºä¸€ä¸ª Kafka æœåŠ¡ã€‚</p>
<p>Kafka æ˜¯ä¸€ç§é«˜ååé‡çš„åˆ†å¸ƒå¼å‘å¸ƒè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œå¥¹æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>é€šè¿‡ O(1) çš„ç£ç›˜æ•°æ®ç»“æ„æä¾›æ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œè¿™ç§ç»“æ„å¯¹äºå³ä½¿æ•°ä»¥TBçš„æ¶ˆæ¯å­˜å‚¨ä¹Ÿèƒ½å¤Ÿä¿æŒé•¿æ—¶é—´çš„ç¨³å®šæ€§èƒ½ã€‚</li>
<li>é«˜ååé‡ï¼šå³ä½¿æ˜¯éå¸¸æ™®é€šçš„ç¡¬ä»¶kafkaä¹Ÿå¯ä»¥æ”¯æŒæ¯ç§’æ•°åä¸‡çš„æ¶ˆæ¯ã€‚</li>
<li>æ”¯æŒé€šè¿‡ Kafka æœåŠ¡å™¨å’Œæ¶ˆè´¹æœºé›†ç¾¤æ¥åˆ†åŒºæ¶ˆæ¯ã€‚</li>
</ul>
</blockquote>
<p>æœ¬æ–‡æˆ‘ä»¬æ¥å­¦ä¹  <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-starter-bus-kafka">Spring Cloud Bus Kafka</a> ç»„ä»¶ï¼ŒåŸºäº <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus">Spring Cloud Bus</a> çš„ç¼–ç¨‹æ¨¡å‹ï¼Œæ¥å…¥ Kafka æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°<strong>äº‹ä»¶æ€»çº¿</strong>çš„åŠŸèƒ½ã€‚</p>
<blockquote>
<p>Spring Cloud Bus æ˜¯<strong>äº‹ä»¶ã€æ¶ˆæ¯æ€»çº¿</strong>ï¼Œç”¨äºåœ¨é›†ç¾¤ï¼ˆä¾‹å¦‚ï¼Œé…ç½®å˜åŒ–äº‹ä»¶ï¼‰ä¸­ä¼ æ’­çŠ¶æ€å˜åŒ–ï¼Œå¯ä¸ <a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Cloud/Spring-Cloud-Config/?self">Spring Cloud Config</a> è”åˆå®ç°çƒ­éƒ¨ç½²ã€‚</p>
</blockquote>
<p>åœ¨<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/Event/?self">ã€ŠèŠ‹é“ Spring Boot äº‹ä»¶æœºåˆ¶ Event å…¥é—¨ã€‹</a>æ–‡ç« ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼ŒSpring å†…ç½®äº†äº‹ä»¶æœºåˆ¶ï¼Œå¯ä»¥å®ç° <strong>JVM è¿›ç¨‹å†…</strong>çš„äº‹ä»¶å‘å¸ƒä¸ç›‘å¬ã€‚ä½†æ˜¯å¦‚æœæƒ³è¦<strong>è·¨ JVM è¿›ç¨‹</strong>çš„äº‹ä»¶å‘å¸ƒä¸ç›‘å¬ï¼Œæ­¤æ—¶å®ƒå°±æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„è¯‰æ±‚äº†ã€‚</p>
<p>å› æ­¤ï¼ŒSpring Cloud Bus åœ¨ Spring äº‹ä»¶æœºåˆ¶çš„åŸºç¡€ä¹‹ä¸Šè¿›è¡Œ<strong>æ‹“å±•</strong>ï¼Œç»“åˆ RabbitMQã€Kafkaã€RocketMQ ç­‰ç­‰æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºäº‹ä»¶çš„<strong>â€œä¼ è¾“å™¨â€</strong>ï¼Œé€šè¿‡å‘é€äº‹ä»¶ï¼ˆæ¶ˆæ¯ï¼‰åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸Šï¼Œä»è€Œå¹¿æ’­åˆ°è®¢é˜…è¯¥äº‹ä»¶ï¼ˆæ¶ˆæ¯ï¼‰çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šã€‚æœ€ç»ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Ffa1a17b3cea554f6ce9859209569ca48.png" alt="æ•´ä½“æ¨¡å‹"></p>
<p>Spring Cloud Bus å®šä¹‰äº† <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/event/RemoteApplicationEvent.java">RemoteApplicationEvent</a> ç±»ï¼Œè¿œç¨‹çš„ ApplicationEvent çš„<strong>æŠ½è±¡åŸºç±»</strong>ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, property = &quot;type&quot;)</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(&quot;source&quot;)</span> <span class="comment">// &lt;2&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">RemoteApplicationEvent</span> <span class="keyword">extends</span> <span class="title class_">ApplicationEvent</span> &#123; <span class="comment">// &lt;1&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String originService;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String destinationService;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ... çœç•¥ä¸€å¤§æ’®ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ Spring Cloud Bus å‘é€çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¿…é¡»è¦<strong>ç»§æ‰¿</strong> RemoteApplicationEvent ç±»ã€‚</p>
</li>
<li><p><code>&lt;1&gt;</code> å¤„ï¼Œç»§æ‰¿ Spring äº‹ä»¶æœºåˆ¶å®šä¹‰çš„ <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework/blob/master/spring-context/src/main/java/org/springframework/context/ApplicationEvent.java">ApplicationEvent</a> æŠ½è±¡åŸºç±»ã€‚</p>
</li>
<li><p><code>&lt;2&gt;</code> å¤„ï¼Œé€šè¿‡ Jackson çš„ <code>@JsonIgnoreProperties</code> æ³¨è§£ï¼Œè®¾ç½®å¿½ç•¥ç»§æ‰¿è‡ª ApplicationEvent çš„ <code>source</code> å±æ€§ï¼Œé¿å…åºåˆ—åŒ–é—®é¢˜ã€‚</p>
</li>
<li><p><code>id</code> å±æ€§ï¼Œäº‹ä»¶ç¼–å·ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒRemoteApplicationEvent ä¼šä½¿ç”¨ <code>UUID.randomUUID().toString()</code> ä»£ç ï¼Œè‡ªåŠ¨ç”Ÿæˆ UUID å³å¯ã€‚</p>
</li>
<li><p><code>originService</code> å±æ€§ï¼Œæ¥æºæœåŠ¡ã€‚Spring Cloud Bus æä¾›å¥½äº† <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/ServiceMatcher.java"><code>ServiceMatcher#getServiceId()</code></a> æ–¹æ³•ï¼Œè·å–æœåŠ¡ç¼–å·ä½œä¸º <code>originService</code> å±æ€§çš„å€¼ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šè¿™ä¸ªå±æ€§éå¸¸å…³é”®ï¼Œè‰¿è‰¿ç¨åä¼šè¯¦ç»†è®²ä¸€ä¸‹ï¼Œéƒ½æ˜¯çœ¼æ³ªå•Šï¼ï¼ï¼</p>
</blockquote>
</li>
<li><p><code>destinationService</code> å±æ€§ï¼Œç›®æ ‡æœåŠ¡ã€‚è¯¥å±æ€§çš„æ ¼å¼æ˜¯ <code>&#123;æœåŠ¡å&#125;:&#123;æœåŠ¡å®ä¾‹ç¼–å·&#125;</code>ã€‚</p>
<blockquote>
<p>ä¸¾ä¸ªæ¿æ —ï¼š</p>
<ul>
<li>å¦‚æœæƒ³è¦å¹¿æ’­ç»™æ‰€æœ‰æœåŠ¡çš„æ‰€æœ‰å®ä¾‹ï¼Œåˆ™è®¾ç½®ä¸º <code>**:**</code>ã€‚</li>
<li>å¦‚æœæƒ³è¦å¹¿æ’­ç»™ <code>users</code> æœåŠ¡çš„æ‰€æœ‰å®ä¾‹ï¼Œåˆ™è®¾ç½®ä¸º <code>users:**</code>ã€‚</li>
<li>å¦‚å¦‚æœæƒ³è¦å¹¿æ’­ç»™ <code>users</code> æœåŠ¡çš„æŒ‡å®šå®ä¾‹ï¼Œåˆ™è®¾ç½®ä¸º <code>users:bc6d27d7-dc0f-4386-81fc-0b3363263a15</code>ã€‚</li>
</ul>
</blockquote>
</li>
</ul>
<h1 id="2-å¿«é€Ÿå…¥é—¨"><a href="#2-å¿«é€Ÿå…¥é—¨" class="headerlink" title="2. å¿«é€Ÿå…¥é—¨"></a>2. å¿«é€Ÿå…¥é—¨</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>äº‹ä»¶å‘å¸ƒå™¨ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-publisher/"><code>labx-19-sc-bus-kafka-demo-publisher</code></a></li>
<li>äº‹ä»¶ç›‘å¬å™¨ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/"><code>labx-19-sc-bus-kafka-demo-listener</code></a></li>
</ul>
</blockquote>
<p>å“”å“”å†å¤šï¼Œä¸å¦‚æ’¸ä¸ª Spring Cloud Bus å¿«é€Ÿå…¥é—¨çš„ç¤ºä¾‹ã€‚æˆ‘ä»¬ä¼šæ–°å»ºä¸¤ä¸ªé¡¹ç›®ï¼š</p>
<p><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F9c9b833d56140c3e724260c381e7abe6.png" alt="é¡¹ç›®ç»“æ„"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-publisher/"><code>labx-19-sc-bus-kafka-demo-publisher</code></a>ï¼šæ‰®æ¼”äº‹ä»¶<strong>å‘å¸ƒå™¨</strong>çš„è§’è‰²ï¼Œä½¿ç”¨ Spring Cloud Bus å‘é€äº‹ä»¶ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/"><code>labx-19-sc-bus-kafka-demo-listener</code></a>ï¼šæ‰®æ¼”äº‹ä»¶<strong>ç›‘å¬å™¨</strong>çš„è§’è‰²ï¼Œä½¿ç”¨ Spring Cloud Bus ç›‘å¬äº‹ä»¶ã€‚</li>
</ul>
<h2 id="2-1-äº‹ä»¶å‘å¸ƒå™¨é¡¹ç›®"><a href="#2-1-äº‹ä»¶å‘å¸ƒå™¨é¡¹ç›®" class="headerlink" title="2.1 äº‹ä»¶å‘å¸ƒå™¨é¡¹ç›®"></a>2.1 äº‹ä»¶å‘å¸ƒå™¨é¡¹ç›®</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-publisher/"><code>labx-19-sc-bus-kafka-demo-publisher</code></a> é¡¹ç›®ï¼Œæ‰®æ¼”äº‹ä»¶<strong>å‘å¸ƒå™¨</strong>çš„è§’è‰²ï¼Œä½¿ç”¨ Spring Cloud Bus å‘é€äº‹ä»¶ã€‚</p>
<h3 id="2-1-1-å¼•å…¥ä¾èµ–"><a href="#2-1-1-å¼•å…¥ä¾èµ–" class="headerlink" title="2.1.1 å¼•å…¥ä¾èµ–"></a>2.1.1 å¼•å…¥ä¾èµ–</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-publisher/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ï¼Œå¼•å…¥ Spring Cloud Bus ç›¸å…³ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>labx-19<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.iocoder.springboot.labs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>labx-19-sc-bus-kafka-demo-publisher<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.boot.version</span>&gt;</span>2.2.4.RELEASE<span class="tag">&lt;/<span class="name">spring.boot.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.cloud.version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">spring.cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        å¼•å…¥ Spring Bootã€Spring Cloudã€Spring Cloud Alibaba ä¸‰è€… BOM æ–‡ä»¶ï¼Œè¿›è¡Œä¾èµ–ç‰ˆæœ¬çš„ç®¡ç†ï¼Œé˜²æ­¢ä¸å…¼å®¹ã€‚</span></span><br><span class="line"><span class="comment">        åœ¨ https://dwz.cn/mcLIfNKt æ–‡ç« ä¸­ï¼ŒSpring Cloud Alibaba å¼€å‘å›¢é˜Ÿæ¨èäº†ä¸‰è€…çš„ä¾èµ–å…³ç³»</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥ SpringMVC ç›¸å…³ä¾èµ–ï¼Œå¹¶å®ç°å¯¹å…¶çš„è‡ªåŠ¨é…ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥åŸºäº Kafka çš„ Spring Cloud Bus çš„å®ç°çš„ä¾èµ–ï¼Œå¹¶å®ç°å¯¹å…¶çš„è‡ªåŠ¨é…ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-1-2-é…ç½®æ–‡ä»¶"><a href="#2-1-2-é…ç½®æ–‡ä»¶" class="headerlink" title="2.1.2 é…ç½®æ–‡ä»¶"></a>2.1.2 é…ç½®æ–‡ä»¶</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-publisher/src/main/resources/application.yml"><code>application.yml</code></a> é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  Spring Cloud Bus ç›¸å…³é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">publisher-demo</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Kafka é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProperties é…ç½®ç±»</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">bootstrap-servers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Bus ç›¸å…³é…ç½®é¡¹ï¼Œå¯¹åº” BusProperties</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">bus:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¼€å¯ï¼Œé»˜è®¤ä¸º true</span></span><br><span class="line">      <span class="attr">destination:</span> <span class="string">springCloudBus</span> <span class="comment"># ç›®æ ‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé»˜è®¤ä¸º springCloudBus</span></span><br></pre></td></tr></table></figure>



<p>â‘  <code>spring.kafka</code> é…ç½®é¡¹ï¼Œä¸º Kafka ç›¸å…³é…ç½®é¡¹ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥é˜…è¯»<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/Kafka/?self">ã€ŠèŠ‹é“ Spring Boot æ¶ˆæ¯é˜Ÿåˆ— Kafka å…¥é—¨ã€‹</a>æ–‡ç« ã€‚</p>
</blockquote>
<p>â‘¡ <code>spring.cloud.bus</code> é…ç½®é¡¹ï¼Œä¸º Spring Cloud Bus é…ç½®é¡¹ï¼Œå¯¹åº” <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/BusProperties.java">BusProperties</a> ç±»ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚</p>
<h3 id="2-1-3-UserRegisterEvent"><a href="#2-1-3-UserRegisterEvent" class="headerlink" title="2.1.3 UserRegisterEvent"></a>2.1.3 UserRegisterEvent</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-publisher/src/main/java/cn/iocoder/springcloud/labx19/publisherdemo/event/UserRegisterEvent.java">UserRegisterEvent</a> ç±»ï¼Œç”¨æˆ·æ³¨å†Œäº‹ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRegisterEvent</span> <span class="keyword">extends</span> <span class="title class_">RemoteApplicationEvent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserRegisterEvent</span><span class="params">()</span> &#123; <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserRegisterEvent</span><span class="params">(Object source, String originService, String destinationService, String username)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(source, originService);</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>â‘  ç»§æ‰¿ RemoteApplicationEvent æŠ½è±¡åŸºç±»ã€‚</p>
<p>â‘¡ åˆ›å»ºä¸€ä¸ªç©ºçš„æ„é€ æ–¹æ³•ï¼Œæ¯•ç«Ÿè¦åºåˆ—åŒ–ã€‚</p>
<h3 id="2-1-4-DemoController"><a href="#2-1-4-DemoController" class="headerlink" title="2.1.4 DemoController"></a>2.1.4 DemoController</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-publisher/src/main/java/cn/iocoder/springcloud/labx19/publisherdemo/controller/DemoController.java">DemoController</a> ç±»ï¼Œæä¾› <code>/demo/register</code> æ³¨å†Œæ¥å£ï¼Œå‘é€ UserRegisterEvent äº‹ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ServiceMatcher busServiceMatcher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">register</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="comment">// ... æ‰§è¡Œæ³¨å†Œé€»è¾‘</span></span><br><span class="line">        logger.info(<span class="string">&quot;[register][æ‰§è¡Œç”¨æˆ·(&#123;&#125;) çš„æ³¨å†Œé€»è¾‘]&quot;</span>, username);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ... &lt;2&gt; å‘å¸ƒ</span></span><br><span class="line">        applicationEventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">UserRegisterEvent</span>(<span class="built_in">this</span>, busServiceMatcher.getServiceId(),</span><br><span class="line">                <span class="literal">null</span>, username)); <span class="comment">// &lt;1&gt;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>&lt;1&gt;</code> å¤„ï¼Œåˆ›å»º UserRegisterEvent å¯¹è±¡ã€‚</p>
<ul>
<li><code>originService</code> å±æ€§ï¼Œé€šè¿‡ <code>ServiceMatcher#getServiceId()</code> æ–¹æ³•ï¼Œè·å¾—æœåŠ¡ç¼–å·ã€‚</li>
<li><code>destinationService</code> å±æ€§ï¼Œæˆ‘ä»¬ä¼ å…¥ <code>null</code> å€¼ã€‚RemoteApplicationEvent ä¼šè‡ªåŠ¨è½¬æ¢æˆ <code>**</code>ï¼Œè¡¨ç¤ºå¹¿æ’­ç»™æ‰€æœ‰ç›‘å¬è¯¥æ¶ˆæ¯çš„å®ä¾‹ã€‚</li>
</ul>
<p><code>&lt;2&gt;</code> å¤„ï¼Œå’Œ Spring äº‹ä»¶æœºåˆ¶<strong>ä¸€æ ·</strong>ï¼Œé€šè¿‡ ApplicationEventPublisher çš„ <code>#publishEvent(event)</code> æ–¹æ³•ï¼Œç›´æ¥å‘é€äº‹ä»¶åˆ° Spring Cloud Bus æ¶ˆæ¯æ€»çº¿ã€‚å¥½å¥‡çš„èƒ–å‹ï¼Œå¯ä»¥æ‰“å¼€ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/BusAutoConfiguration.java#L142-L151">BusAutoConfiguration</a> çš„ä»£ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Fae7294563e20ddf90e079320077fc56c.png" alt="BusAutoConfiguration æºç "></p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå¦‚æœèƒ–å‹ä»”ç»†çœ‹çš„è¯ï¼Œè¿˜å¯ä»¥å‘ç° Spring Cloud Bus æ˜¯ä½¿ç”¨ Spring Cloud Stream è¿›è¡Œæ¶ˆæ¯çš„æ”¶å‘çš„ã€‚</p>
</blockquote>
<h3 id="2-1-5-PublisherDemoApplication"><a href="#2-1-5-PublisherDemoApplication" class="headerlink" title="2.1.5 PublisherDemoApplication"></a>2.1.5 PublisherDemoApplication</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-publisher/src/main/java/cn/iocoder/springcloud/labx19/publisherdemo/PublisherDemoApplication.java">PublisherDemoApplication</a> ç±»ï¼Œä½œä¸ºå¯åŠ¨ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PublisherDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PublisherDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-2-äº‹ä»¶ç›‘å¬å™¨é¡¹ç›®"><a href="#2-2-äº‹ä»¶ç›‘å¬å™¨é¡¹ç›®" class="headerlink" title="2.2 äº‹ä»¶ç›‘å¬å™¨é¡¹ç›®"></a>2.2 äº‹ä»¶ç›‘å¬å™¨é¡¹ç›®</h2><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/"><code>labx-19-sc-bus-kafka-demo-listener</code></a> é¡¹ç›®ï¼Œæ‰®æ¼”äº‹ä»¶<strong>ç›‘å¬å™¨</strong>çš„è§’è‰²ï¼Œä½¿ç”¨ Spring Cloud Bus ç›‘å¬äº‹ä»¶ã€‚</p>
<h3 id="2-2-1-å¼•å…¥ä¾èµ–"><a href="#2-2-1-å¼•å…¥ä¾èµ–" class="headerlink" title="2.2.1 å¼•å…¥ä¾èµ–"></a>2.2.1 å¼•å…¥ä¾èµ–</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ï¼Œå¼•å…¥ç›¸å…³çš„ä¾èµ–ã€‚å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Bus-Kafka/?self#">ã€Œ2.1.1 å¼•å…¥ä¾èµ–ã€</a>æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¸é‡å¤â€œè´´â€å‡ºæ¥äº†ï¼Œèƒ–å‹ç‚¹å‡» <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶æŸ¥çœ‹ã€‚</p>
<h3 id="2-2-2-é…ç½®æ–‡ä»¶"><a href="#2-2-2-é…ç½®æ–‡ä»¶" class="headerlink" title="2.2.2 é…ç½®æ–‡ä»¶"></a>2.2.2 é…ç½®æ–‡ä»¶</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/src/main/resources/application.yml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ç›¸å…³çš„é…ç½®é¡¹ã€‚å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Bus-Kafka/?self#">ã€Œ2.1.2 é…ç½®æ–‡ä»¶ã€</a>æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¸é‡å¤â€œè´´â€å‡ºæ¥äº†ï¼Œèƒ–å‹ç‚¹å‡» <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/src/main/resources/application.yml"><code>application.yaml</code></a> æ–‡ä»¶æŸ¥çœ‹ã€‚</p>
<h3 id="2-2-3-UserRegisterEvent"><a href="#2-2-3-UserRegisterEvent" class="headerlink" title="2.2.3 UserRegisterEvent"></a>2.2.3 UserRegisterEvent</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/src/main/java/cn/iocoder/springcloud/labx19/listenerdemo/event/UserRegisterEvent.java">UserRegisterEvent</a> ç±»ï¼Œç”¨æˆ·æ³¨å†Œäº‹ä»¶ã€‚å’Œ<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Bus-Kafka/?self#">ã€Œ2.1.3 UserRegisterEventã€</a>æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¸é‡å¤â€œè´´â€å‡ºæ¥äº†ï¼Œèƒ–å‹ç‚¹å‡» <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/src/main/java/cn/iocoder/springcloud/labx19/listenerdemo/event/UserRegisterEvent.java">UserRegisterEvent</a> æ–‡ä»¶æŸ¥çœ‹ã€‚</p>
<h3 id="2-2-4-UserRegisterListener"><a href="#2-2-4-UserRegisterListener" class="headerlink" title="2.2.4 UserRegisterListener"></a>2.2.4 UserRegisterListener</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/src/main/java/cn/iocoder/springcloud/labx19/listenerdemo/listener/UserRegisterListener.java">UserRegisterListener</a> ç±»ï¼Œç›‘å¬ UserRegisterEvent äº‹ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·æ³¨å†Œäº‹ä»¶çš„ç›‘å¬å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRegisterListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;UserRegisterEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(UserRegisterEvent event)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;[onApplicationEvent][ç›‘å¬åˆ°ç”¨æˆ·(&#123;&#125;) æ³¨å†Œ]&quot;</span>, event.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å’Œ Spring äº‹ä»¶æœºåˆ¶<strong>ä¸€æ ·</strong>ï¼Œåªéœ€è¦ç›‘å¬æŒ‡å®šäº‹ä»¶å³å¯ã€‚å¥½å¥‡çš„èƒ–å‹ï¼Œå¯ä»¥æ‰“å¼€ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/BusAutoConfiguration.java#L153-L190">BusAutoConfiguration</a> çš„ä»£ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F3a9a4ba52f1c979013a62cf834abd21a.png" alt="BusAutoConfiguration æºç "></p>
<h3 id="2-2-5-ListenerDemoApplication"><a href="#2-2-5-ListenerDemoApplication" class="headerlink" title="2.2.5 ListenerDemoApplication"></a>2.2.5 ListenerDemoApplication</h3><p>åˆ›å»º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/src/main/java/cn/iocoder/springcloud/labx19/listenerdemo/ListenerDemoApplication.java">ListenerDemoApplication</a> ç±»ï¼Œä½œä¸ºå¯åŠ¨ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RemoteApplicationEventScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListenerDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ListenerDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åœ¨ç±»ä¸Šï¼Œæ·»åŠ  Spring Cloud Bus å®šä¹‰çš„ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/jackson/RemoteApplicationEventScan.java"><code>@RemoteApplicationEventScan</code></a> æ³¨è§£ï¼Œå£°æ˜è¦ä» Spring Cloud Bus ç›‘å¬ RemoteApplicationEvent äº‹ä»¶ã€‚</p>
<h2 id="2-3-ç®€å•æµ‹è¯•"><a href="#2-3-ç®€å•æµ‹è¯•" class="headerlink" title="2.3 ç®€å•æµ‹è¯•"></a>2.3 ç®€å•æµ‹è¯•</h2><p>â‘  æ‰§è¡Œ PublisherDemoApplication ä¸€æ¬¡ï¼Œå¯åŠ¨ä¸€ä¸ªäº‹ä»¶<strong>å‘å¸ƒå™¨</strong>ã€‚</p>
<p>â‘¡ æ‰§è¡Œ ListenerDemoApplication <strong>ä¸¤æ¬¡</strong>ï¼Œå¯åŠ¨ä¸¤ä¸ªäº‹ä»¶<strong>ç›‘å¬å™¨</strong>ã€‚éœ€è¦å°†ã€ŒAllow parallel runã€è¿›è¡Œå‹¾é€‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F8b66269c67c425a3f0e8c12750e69853.png" alt="IDEA"></p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Kafka è¿ç»´ç•Œé¢çœ‹åˆ° <strong>springCloudBus</strong> è¿™ä¸ª Topicï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<ul>
<li><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Faae41ac63dbcf5fa4c92b6e351076779.png" alt="Kafka è¿ç»´ç•Œé¢ - Topic"></li>
<li><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Ffd3fab2a275759cbc29586ac2893f581.png" alt="Kafka è¿ç»´ç•Œé¢ - Consumer"></li>
</ul>
<p>â‘¢ è°ƒç”¨ <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/demo/register?username=yudaoyuanma">http://127.0.0.1:8080/demo/register?username=yudaoyuanma</a> æ¥å£ï¼Œè¿›è¡Œæ³¨å†Œã€‚IDEA æ§åˆ¶å°æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># PublisherDemoApplication æ§åˆ¶å°</span><br><span class="line"><span class="number">2020</span>-<span class="number">04</span>-09 <span class="number">07</span>:<span class="number">42</span>:<span class="number">03.417</span>  INFO <span class="number">31050</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.i.s.l.p.controller.DemoController      : [register][æ‰§è¡Œç”¨æˆ·(haha) çš„æ³¨å†Œé€»è¾‘]</span><br><span class="line"></span><br><span class="line"># ListenerDemoApplication æ§åˆ¶å° <span class="number">01</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">04</span>-09 <span class="number">07</span>:<span class="number">42</span>:<span class="number">03.603</span>  INFO <span class="number">31027</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.l.listener.UserRegisterListener  : [onApplicationEvent][ç›‘å¬åˆ°ç”¨æˆ·(haha) æ³¨å†Œ]</span><br><span class="line"></span><br><span class="line"># ListenerDemoApplication æ§åˆ¶å° <span class="number">02</span></span><br><span class="line"><span class="number">2020</span>-<span class="number">04</span>-09 <span class="number">07</span>:<span class="number">42</span>:<span class="number">03.603</span>  INFO <span class="number">31040</span> --- [container-<span class="number">0</span>-C-<span class="number">1</span>] c.i.s.l.l.listener.UserRegisterListener  : [onApplicationEvent][ç›‘å¬åˆ°ç”¨æˆ·(haha) æ³¨å†Œ]</span><br></pre></td></tr></table></figure>



<p>å‘å¸ƒçš„ UserRegisterEvent äº‹ä»¶ï¼Œè¢«ä¸¤ä¸ªäº‹ä»¶ç›‘å¬å™¨çš„è¿›ç¨‹éƒ½ç›‘å¬æˆåŠŸã€‚</p>
<h1 id="3-ç›‘æ§ç«¯ç‚¹"><a href="#3-ç›‘æ§ç«¯ç‚¹" class="headerlink" title="3. ç›‘æ§ç«¯ç‚¹"></a>3. ç›‘æ§ç«¯ç‚¹</h1><blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener-actuator/"><code>labx-19-sc-bus-kafka-demo-listener-actuator</code></a></p>
</blockquote>
<p>Spring Cloud Bus çš„ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/endpoint/a"><code>endpoint</code></a> æ¨¡å—ï¼ŒåŸºäº Spring Boot Actuatorï¼Œæä¾›äº†ä¸¤ä¸ªè‡ªå®šä¹‰ç›‘æ§ç«¯ç‚¹ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/endpoint/EnvironmentBusEndpoint.java"><code>bus-env</code></a> ç«¯ç‚¹ï¼šå‘å¸ƒ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/event/EnvironmentChangeRemoteApplicationEvent.java">EnvironmentChangeRemoteApplicationEvent</a> äº‹ä»¶ï¼Œé…åˆ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/event/EnvironmentChangeListener.java">EnvironmentChangeListener</a> ç›‘å¬å™¨ï¼Œå®ç°é€šçŸ¥å¹¶ä¿®æ”¹è¿œç¨‹æœåŠ¡çš„æœ¬åœ°<strong>é…ç½®é¡¹</strong>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F02862a15c00a54ee56b917fd4f466c3c.png" alt="EnvironmentChangeRemoteApplicationEvent å‘å¸ƒä¸ç›‘å¬"></li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/endpoint/RefreshBusEndpoint.java"><code>bus-refresh</code></a> ç«¯ç‚¹ï¼šå‘å¸ƒ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/endpoint/RefreshBusEndpoint.java">RefreshRemoteApplicationEvent</a> äº‹ä»¶ï¼Œé…åˆ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/event/RefreshListener.java">RefreshListener</a> ç›‘å¬å™¨ï¼Œå®ç°é€šçŸ¥å¹¶åˆ·æ–°è¿œç¨‹æœåŠ¡çš„ <strong>Spring Context</strong>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Fc121a694f2f63f6f786fd8d397b2c81d.png" alt="RefreshRemoteApplicationEvent å‘å¸ƒä¸ç›‘å¬"></li>
</ul>
<p>åŒæ—¶ï¼ŒSpring Cloud Bus æ‹“å±•äº† Spring Boot Actuator å†…ç½®çš„ <code>httptrace</code> ç«¯ç‚¹ï¼Œä¼šç›‘å¬ Spring Cloud Bus <strong>å‘é€</strong>æ¶ˆæ¯æ—¶äº§ç”Ÿçš„ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/event/SentApplicationEvent.java">SentApplicationEvent</a> äº‹ä»¶å’Œ<strong>ç¡®è®¤</strong>æ¶ˆæ¯çš„äº§ç”Ÿ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/event/AckRemoteApplicationEvent.java">AckRemoteApplicationEvent</a> äº‹ä»¶ï¼Œé…åˆ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/blob/master/spring-cloud-bus/src/main/java/org/springframework/cloud/bus/event/TraceListener.java">TraceListener</a> ç›‘å¬å™¨ï¼Œè®°å½•ç›¸åº”çš„è·Ÿè¸ªä¿¡æ¯ã€‚ä¸è¿‡å› ä¸º <code>httptrace</code> ç«¯ç‚¹æ”¹ç‰ˆäº†ï¼Œæ‰€ä»¥ç›®å‰è¯¥åŠŸèƒ½å·²ç»å¤±æ•ˆï¼Œè€Œä¸”<a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-bus/commit/10c08c7a8450d84823a8cd82bc9b6e3f9d51be95">å¤±æ•ˆäº† 2 å¹´å¤šäº†</a>ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F71b962c174412c4d8026c92f1b04ea66.png" alt="TraceListener æºç "></p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå¯¹ Spring Boot Actuator ä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥åç»­é˜…è¯»<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/Actuator/?self">ã€ŠèŠ‹é“ Spring Boot ç›‘æ§ç«¯ç‚¹ Actuator å…¥é—¨ã€‹</a>æ–‡ç« ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ª Spring Cloud Bus ç›‘æ§ç«¯ç‚¹çš„ä½¿ç”¨ç¤ºä¾‹ã€‚è€ƒè™‘æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥å¤ç”¨<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Bus-Kafka/?self#">ã€Œ2. å¿«é€Ÿå…¥é—¨ã€</a>å°èŠ‚çš„é¡¹ç›®ï¼Œä» <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener/"><code>labx-19-sc-bus-kafka-demo-listener</code></a> å¤åˆ¶å‡º <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener-actuator/"><code>labx-19-sc-bus-kafka-demo-listener-actuator</code></a>ï¼Œæµ‹è¯• Spring Cloud Bus çš„ç›‘æ§ç«¯ç‚¹ç»“æœã€‚æœ€ç»ˆé¡¹ç›®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F1dce407b9d45f94a75649a4fe5938de6.png" alt="é¡¹ç›®ç»“æ„"></p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šä¸ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-publisher/"><code>labx-19-sc-bus-kafka-demo-publisher</code></a> çš„åŸå› æ˜¯ï¼Œæœªæ·»åŠ  <code>@RemoteApplicationEventScan</code> æ³¨è§£ï¼Œä¸ä¼šä» Spring Cloud Bus <strong>ä¸­</strong>ç›‘å¬ RemoteApplicationEvent äº‹ä»¶ã€‚</p>
</blockquote>
<h2 id="3-1-å¼•å…¥ä¾èµ–-1"><a href="#3-1-å¼•å…¥ä¾èµ–-1" class="headerlink" title="3.1 å¼•å…¥ä¾èµ–"></a>3.1 å¼•å…¥ä¾èµ–</h2><p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener-actuator/pom.xml"><code>pom.xml</code></a> æ–‡ä»¶ä¸­ï¼Œé¢å¤–å¼•å…¥ Spring Boot Actuator ç›¸å…³ä¾èµ–ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®ç°å¯¹ Actuator çš„è‡ªåŠ¨åŒ–é…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="3-2-é…ç½®æ–‡ä»¶"><a href="#3-2-é…ç½®æ–‡ä»¶" class="headerlink" title="3.2 é…ç½®æ–‡ä»¶"></a>3.2 é…ç½®æ–‡ä»¶</h2><p>ä¿®æ”¹ <a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-bus-kafka-demo-listener-actuator/src/main/resources/application.yml"><code>application.yaml</code></a> é…ç½®æ–‡ä»¶ï¼Œ<strong>é¢å¤–</strong>å¢åŠ  Spring Boot Actuator é…ç½®é¡¹ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">listener-demo</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Kafka é…ç½®é¡¹ï¼Œå¯¹åº” KafkaProperties é…ç½®ç±»</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">bootstrap-servers:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span> <span class="comment"># æŒ‡å®š Kafka Broker åœ°å€ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œä»¥é€—å·åˆ†éš”</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">18080</span> <span class="comment"># éšæœºç«¯å£ï¼Œæ–¹ä¾¿å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="comment"># Actuator HTTP é…ç½®é¡¹ï¼Œå¯¹åº” WebEndpointProperties é…ç½®ç±»</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># éœ€è¦å¼€æ”¾çš„ç«¯ç‚¹ã€‚é»˜è®¤å€¼åªæ‰“å¼€ health å’Œ info ä¸¤ä¸ªç«¯ç‚¹ã€‚é€šè¿‡è®¾ç½® * ï¼Œå¯ä»¥å¼€æ”¾æ‰€æœ‰ç«¯ç‚¹ã€‚</span></span><br></pre></td></tr></table></figure>



<p>æ–°å¢ <code>management</code> é…ç½®é¡¹ï¼Œè®¾ç½® Spring Boot Actuator é…ç½®é¡¹ã€‚è¿™é‡Œå…ˆä¸è¯¦ç»†è§£æï¼Œåç»­çœ‹ä¸‹<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Boot/Actuator/?self">ã€ŠèŠ‹é“ Spring Boot ç›‘æ§ç«¯ç‚¹ Actuator å…¥é—¨ã€‹</a>æ–‡ç« ã€‚</p>
<h2 id="3-3-ç®€å•æµ‹è¯•"><a href="#3-3-ç®€å•æµ‹è¯•" class="headerlink" title="3.3 ç®€å•æµ‹è¯•"></a>3.3 ç®€å•æµ‹è¯•</h2><p>æ‰§è¡Œ ListenerDemoApplication å¯åŠ¨é¡¹ç›®ã€‚</p>
<p>â‘  ä½¿ç”¨ Postman æ¨¡æ‹Ÿè¯·æ±‚ <code>bus-env</code> ç«¯ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F96438153bf4dbbf46b8a643b77aea86b.png" alt="Postman  ç«¯å£"></p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ° EnvironmentChangeListener æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼Œè¯´æ˜æˆåŠŸæ¥æ”¶åˆ° EnvironmentChangeRemoteApplicationEvent äº‹ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">04</span>-09 <span class="number">07</span>:<span class="number">53</span>:<span class="number">33.737</span>  INFO <span class="number">31712</span> --- [io-<span class="number">18080</span>-exec-<span class="number">1</span>] o.s.c.b.event.EnvironmentChangeListener  : Received remote environment change request. Keys/values to update &#123;test-property=test-value&#125;</span><br></pre></td></tr></table></figure>



<p>â‘¡ ä½¿ç”¨ Postman æ¨¡æ‹Ÿè¯·æ±‚ <code>bus-refresh</code> ç«¯ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Fb335201622ffba02385d5b22e04e10e3.png" alt="Postman  ç«¯å£"></p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ° RefreshListener æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼Œè¯´æ˜æˆåŠŸæ¥æ”¶åˆ° RefreshRemoteApplicationEvent äº‹ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">04</span>-09 <span class="number">07</span>:<span class="number">53</span>:<span class="number">46.409</span>  INFO <span class="number">31712</span> --- [io-<span class="number">18080</span>-exec-<span class="number">2</span>] o.s.cloud.bus.event.RefreshListener      : Received remote refresh request. Keys refreshed []</span><br></pre></td></tr></table></figure>



<h1 id="4-é›†æˆåˆ°-Spring-Cloud-Config"><a href="#4-é›†æˆåˆ°-Spring-Cloud-Config" class="headerlink" title="4. é›†æˆåˆ° Spring Cloud Config"></a>4. é›†æˆåˆ° Spring Cloud Config</h1><p>å®é™…ä¸Šï¼ŒSpring Cloud Bus åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œ<strong>åŸºæœ¬ä¸ä¼šä½¿ç”¨åˆ°</strong>ã€‚ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨ Spring Cloud Stream å³å¯å®ç°å®ƒæ‰€æœ‰çš„åŠŸèƒ½ï¼Œå¹¶ä¸”æ›´åŠ å¼ºå¤§å’Œçµæ´»ã€‚åŒæ—¶ï¼Œè‰¿è‰¿ä¹Ÿæ‰¾äº†ä¸€äº›åœ¨ä½¿ç”¨ Spring Cloud ä½œä¸ºå¾®æœåŠ¡è§£å†³æ–¹æ¡ˆçš„èƒ–å‹ï¼Œç¡®å®ä¸€ä¸ªéƒ½æ²¡æœ‰åœ¨ä½¿ç”¨ Spring Cloud Bus çš„ &#x3D; &#x3D;ã€‚</p>
<p>å€”å¼ºçš„è‰¿è‰¿åˆç¿»é˜…äº†ç½‘ä¸Šçš„ç›¸å…³èµ„æ–™ï¼Œç»å¤§å¤šæ•°éƒ½æ˜¯æåˆ°é€šè¿‡ Spring Cloud Busï¼Œå®ç° Spring Cloud Config é…ç½®ä¸­å¿ƒçš„<strong>è‡ªåŠ¨é…ç½®åˆ·æ–°</strong>çš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œå¯èƒ½æˆ‘ä»¬ä¸æ˜¯å¾ˆå¿…è¦å»å­¦ä¹ å®ƒï¼Œå“ˆå“ˆå“ˆã€‚</p>
<p>ä¸è¿‡è‰¯å¿ƒçš„è‰¿è‰¿ï¼Œè¿˜æ˜¯åœ¨<a target="_blank" rel="noopener" href="http://www.iocoder.cn/Spring-Cloud/Spring-Cloud-Config/?self">ã€ŠèŠ‹é“ Spring Cloud é…ç½®ä¸­å¿ƒ Spring Cloud Config å…¥é—¨ã€‹</a>æ–‡ç« çš„<a target="_blank" rel="noopener" href="https://www.iocoder.cn/Spring-Cloud/Bus-Kafka/?self#">ã€Œ5. è‡ªåŠ¨é…ç½®åˆ·æ–°ï¼ˆç¬¬äºŒå¼¹ï¼‰ã€</a>å°èŠ‚ä¸­ï¼Œå°† Spring Cloud Bus é›†æˆåˆ° Spring Cloud Config ä¸­ï¼Œå®ç°é…ç½®ä¸­å¿ƒçš„<strong>è‡ªåŠ¨é…ç½®åˆ·æ–°</strong>çš„åŠŸèƒ½ã€‚</p>
<p><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F25df2f8b1478ac242b7c7fa298a0cf0a.png" alt="Spring Cloud Config + Spring Cloud Bus"></p>
<blockquote>
<p>ç¤ºä¾‹ä»£ç å¯¹åº”ä»“åº“ï¼š</p>
<ul>
<li>é…ç½®ä¸­å¿ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-config-server-git-auto-refresh-by-bus/"><code>labx-19-sc-config-server-git-auto-refresh-by-bus</code></a></li>
<li>ç”¨æˆ·æœåŠ¡ï¼š<a target="_blank" rel="noopener" href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-19/labx-19-sc-config-user-application-auto-refresh-by-bus/pom.xml"><code>labx-19-sc-config-user-application-auto-refresh-by-bus</code></a></li>
</ul>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://blog.chenjiabin.xyz">Chen Jiabin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.chenjiabin.xyz/posts/14310/">https://blog.chenjiabin.xyz/posts/14310/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://blog.chenjiabin.xyz" target="_blank">é’å¢¨æŸ“çƒŸé›¨</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/">å…¥é—¨åˆ°ç²¾é€š</a></div><div class="post-share"><div class="social-share" data-image="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0325c825fa31fa6f45916f706a22cca4.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/202502282020504.jpg" target="_blank"><img class="post-qr-code-img" src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/202502282020504.jpg" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/202502282020503.png" target="_blank"><img class="post-qr-code-img" src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/202502282020503.png" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/10048/" title="Dockerå­¦ä¹ ç¬”è®°"><img class="cover" src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Faa90ae7420321f0930ea6719b29c828d.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">Dockerå­¦ä¹ ç¬”è®°</div></div><div class="info-2"><div class="info-item-1">Dockerçš„å®‰è£…å’Œæ‰«ç›²ï¼Œä»¥åŠå­¦ä¹ ç½‘ç«™</div></div></div></a><a class="pagination-related" href="/posts/52481/" title="ElasticSearchå…¥é—¨åˆ°ç²¾é€š"><img class="cover" src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Fe69b8f01e7d0f2581a3d4bfe20e93a23.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">ElasticSearchå…¥é—¨åˆ°ç²¾é€š</div></div><div class="info-2"><div class="info-item-1">ElasticSearchå…¥é—¨åˆ°ç²¾é€š</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/52481/" title="ElasticSearchå…¥é—¨åˆ°ç²¾é€š"><img class="cover" src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Fe69b8f01e7d0f2581a3d4bfe20e93a23.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-04</div><div class="info-item-2">ElasticSearchå…¥é—¨åˆ°ç²¾é€š</div></div><div class="info-2"><div class="info-item-1">ElasticSearchå…¥é—¨åˆ°ç²¾é€š</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div><div class="comment-switch"><span class="first-comment">Waline</span><span id="switch-btn"></span><span class="second-comment">Twikoo</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/202503011603481.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Chen Jiabin</div><div class="author-info-description">å›é¦–å‘æ¥è§ç‘Ÿå¤„,å½’å»,ä¹Ÿæ— é£é›¨ä¹Ÿæ— æ™´</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/qinmoranyanyu"><i class="fab fa-github"></i><span>My GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://www.cnblogs.com/chenjiabin" target="_blank" title="åšå®¢å›­"><i class="fa-solid fa-blog" style="color: #000000;"></i></a><a class="social-icon" href="https://gitee.com/forever-or-moment" target="_blank" title="gitee"><i class="fa-solid fa-rss" style="color: #000000;"></i></a><a class="social-icon" href="mailto:2948429338@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">åŸºäºhexoçš„åšå®¢ç½‘ç«™,ç»ˆäºæ­å¥½äº†!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%93"><span class="toc-number">1.</span> <span class="toc-text">â€”â€”â€“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">å¿«é€Ÿå…¥é—¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%93-1"><span class="toc-number">3.</span> <span class="toc-text">â€”â€”â€“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0"><span class="toc-number">4.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2"><span class="toc-number">5.</span> <span class="toc-text">2. å•æœºéƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E4%B8%8B%E8%BD%BD%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">5.1.</span> <span class="toc-text">2.1 ä¸‹è½½è½¯ä»¶åŒ…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">5.2.</span> <span class="toc-text">2.2 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%90%AF%E5%8A%A8-Kafka"><span class="toc-number">5.3.</span> <span class="toc-text">2.3 å¯åŠ¨ Kafka</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%88%9B%E5%BB%BA-Topic"><span class="toc-number">5.4.</span> <span class="toc-text">2.4 åˆ›å»º Topic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%B5%8B%E8%AF%95%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="toc-number">5.5.</span> <span class="toc-text">2.5 æµ‹è¯•å‘é€æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E6%B5%8B%E8%AF%95%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF"><span class="toc-number">5.6.</span> <span class="toc-text">2.6 æµ‹è¯•æ¶ˆè´¹æ¶ˆæ¯</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="toc-number">6.</span> <span class="toc-text">3. é›†ç¾¤éƒ¨ç½²</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Kafka-Manager"><span class="toc-number">7.</span> <span class="toc-text">4. Kafka Manager</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E4%B8%8B%E8%BD%BD%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">7.1.</span> <span class="toc-text">4.1 ä¸‹è½½è½¯ä»¶åŒ…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">7.2.</span> <span class="toc-text">4.2 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E5%90%AF%E5%8A%A8-Kafka-Manager"><span class="toc-number">7.3.</span> <span class="toc-text">4.3 å¯åŠ¨ Kafka Manager</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E6%B7%BB%E5%8A%A0-Kafka-%E9%9B%86%E7%BE%A4"><span class="toc-number">7.4.</span> <span class="toc-text">4.4 æ·»åŠ  Kafka é›†ç¾¤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">8.</span> <span class="toc-text">5. ç®€å•ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">8.1.</span> <span class="toc-text">5.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-ProducerMain"><span class="toc-number">8.2.</span> <span class="toc-text">5.2 ProducerMain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-ConsumerMain"><span class="toc-number">8.3.</span> <span class="toc-text">5.3 ConsumerMain</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%93-2"><span class="toc-number">9.</span> <span class="toc-text">â€”â€”â€“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot%E4%B8%AD%E7%9A%84Kafka"><span class="toc-number">10.</span> <span class="toc-text">SpringBootä¸­çš„Kafka</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%93-3"><span class="toc-number">11.</span> <span class="toc-text">â€”â€”â€“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0-1"><span class="toc-number">12.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Spring-Kafka"><span class="toc-number">13.</span> <span class="toc-text">2. Spring-Kafka</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">14.</span> <span class="toc-text">3. å¿«é€Ÿå…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">14.1.</span> <span class="toc-text">3.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">14.2.</span> <span class="toc-text">3.2 åº”ç”¨é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Application"><span class="toc-number">14.3.</span> <span class="toc-text">3.3 Application</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-Demo01Message"><span class="toc-number">14.4.</span> <span class="toc-text">3.4 Demo01Message</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-Demo01Producer"><span class="toc-number">14.5.</span> <span class="toc-text">3.5 Demo01Producer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-Demo01Consumer"><span class="toc-number">14.6.</span> <span class="toc-text">3.6 Demo01Consumer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-Demo01AConsumer"><span class="toc-number">14.7.</span> <span class="toc-text">3.7 Demo01AConsumer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">14.8.</span> <span class="toc-text">3.8 ç®€å•æµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-9-KafkaListener"><span class="toc-number">14.9.</span> <span class="toc-text">3.9 @KafkaListener</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%89%B9%E9%87%8F%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="toc-number">15.</span> <span class="toc-text">4. æ‰¹é‡å‘é€æ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">15.1.</span> <span class="toc-text">4.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">15.2.</span> <span class="toc-text">4.2 åº”ç”¨é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-Demo02Message"><span class="toc-number">15.3.</span> <span class="toc-text">4.3 Demo02Message</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-Demo02Producer"><span class="toc-number">15.4.</span> <span class="toc-text">4.4 Demo02Producer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-Demo02Consumer"><span class="toc-number">15.5.</span> <span class="toc-text">4.5 Demo02Consumer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">15.6.</span> <span class="toc-text">4.6 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%89%B9%E9%87%8F%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF"><span class="toc-number">16.</span> <span class="toc-text">5. æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">16.1.</span> <span class="toc-text">5.1 åº”ç”¨é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-Demo02Consumer"><span class="toc-number">16.2.</span> <span class="toc-text">5.2 Demo02Consumer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">16.3.</span> <span class="toc-text">5.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%AE%9A%E6%97%B6%E6%B6%88%E6%81%AF"><span class="toc-number">17.</span> <span class="toc-text">6. å®šæ—¶æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E6%B6%88%E8%B4%B9%E9%87%8D%E8%AF%95"><span class="toc-number">18.</span> <span class="toc-text">7. æ¶ˆè´¹é‡è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-KafkaConfiguration"><span class="toc-number">18.1.</span> <span class="toc-text">7.1 KafkaConfiguration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-Demo04Message"><span class="toc-number">18.2.</span> <span class="toc-text">7.2 Demo04Message</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-Demo04Producer"><span class="toc-number">18.3.</span> <span class="toc-text">7.3 Demo04Producer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-Demo04Consumer"><span class="toc-number">18.4.</span> <span class="toc-text">7.4 Demo04Consumer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">18.5.</span> <span class="toc-text">7.5 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%B9%BF%E6%92%AD%E6%B6%88%E8%B4%B9"><span class="toc-number">19.</span> <span class="toc-text">8. å¹¿æ’­æ¶ˆè´¹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">19.1.</span> <span class="toc-text">8.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">19.2.</span> <span class="toc-text">8.2 åº”ç”¨é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-Demo05Message"><span class="toc-number">19.3.</span> <span class="toc-text">8.3 Demo05Message</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-Demo05Producer"><span class="toc-number">19.4.</span> <span class="toc-text">8.4 Demo05Producer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-Demo05Consumer"><span class="toc-number">19.5.</span> <span class="toc-text">8.5 Demo05Consumer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-6-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">19.6.</span> <span class="toc-text">8.6 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E5%B9%B6%E5%8F%91%E6%B6%88%E8%B4%B9"><span class="toc-number">20.</span> <span class="toc-text">9. å¹¶å‘æ¶ˆè´¹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">20.1.</span> <span class="toc-text">9.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">20.2.</span> <span class="toc-text">9.2 åº”ç”¨é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-Demo06Message"><span class="toc-number">20.3.</span> <span class="toc-text">9.3 Demo06Message</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-Demo06Producer"><span class="toc-number">20.4.</span> <span class="toc-text">9.4 Demo06Producer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-Demo06Consumer"><span class="toc-number">20.5.</span> <span class="toc-text">9.5 Demo06Consumer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">20.6.</span> <span class="toc-text">9.6 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF"><span class="toc-number">21.</span> <span class="toc-text">10. é¡ºåºæ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-Demo06Producer"><span class="toc-number">21.1.</span> <span class="toc-text">10.1 Demo06Producer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">21.2.</span> <span class="toc-text">10.2 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF"><span class="toc-number">22.</span> <span class="toc-text">11. äº‹åŠ¡æ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">22.1.</span> <span class="toc-text">11.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">22.2.</span> <span class="toc-text">11.2 åº”ç”¨é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-Demo07Producer"><span class="toc-number">22.3.</span> <span class="toc-text">11.3 Demo07Producer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-4-Demo07Consumer"><span class="toc-number">22.4.</span> <span class="toc-text">11.4 Demo07Consumer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-5-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">22.5.</span> <span class="toc-text">11.5 ç®€å•æµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-6-%E9%9B%86%E6%88%90%E5%88%B0-Spring-Transaction-%E4%BD%93%E7%B3%BB"><span class="toc-number">22.6.</span> <span class="toc-text">11.6 é›†æˆåˆ° Spring Transaction ä½“ç³»</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E6%B6%88%E8%B4%B9%E8%BF%9B%E5%BA%A6%E7%9A%84%E6%8F%90%E4%BA%A4%E6%9C%BA%E5%88%B6"><span class="toc-number">23.</span> <span class="toc-text">12. æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">23.1.</span> <span class="toc-text">12.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">23.2.</span> <span class="toc-text">12.2 åº”ç”¨é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-Demo08Message"><span class="toc-number">23.3.</span> <span class="toc-text">12.3 Demo08Message</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-4-Demo08Producer"><span class="toc-number">23.4.</span> <span class="toc-text">12.4 Demo08Producer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-5-Demo08Consumer"><span class="toc-number">23.5.</span> <span class="toc-text">12.5 Demo08Consumer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-6-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">23.6.</span> <span class="toc-text">12.6 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%93-4"><span class="toc-number">24.</span> <span class="toc-text">â€”â€”â€“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringCloud%E4%B8%AD%E7%9A%84Kafka"><span class="toc-number">25.</span> <span class="toc-text">SpringCloudä¸­çš„Kafka</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%93-5"><span class="toc-number">26.</span> <span class="toc-text">â€”â€”â€“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0-2"><span class="toc-number">27.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Spring-Cloud-Stream-%E4%BB%8B%E7%BB%8D"><span class="toc-number">28.</span> <span class="toc-text">2. Spring Cloud Stream ä»‹ç»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-1"><span class="toc-number">29.</span> <span class="toc-text">3. å¿«é€Ÿå…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">29.1.</span> <span class="toc-text">3.1 æ­å»ºç”Ÿäº§è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">29.1.1.</span> <span class="toc-text">3.1.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">29.1.2.</span> <span class="toc-text">3.1.2 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-MySource"><span class="toc-number">29.1.3.</span> <span class="toc-text">3.1.3 MySource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4-Demo01Message"><span class="toc-number">29.1.4.</span> <span class="toc-text">3.1.4 Demo01Message</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-5-Demo01Controller"><span class="toc-number">29.1.5.</span> <span class="toc-text">3.1.5 Demo01Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-6-ProducerApplication"><span class="toc-number">29.1.6.</span> <span class="toc-text">3.1.6 ProducerApplication</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">29.2.</span> <span class="toc-text">3.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">29.2.1.</span> <span class="toc-text">3.2.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">29.2.2.</span> <span class="toc-text">3.2.2 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-MySink"><span class="toc-number">29.2.3.</span> <span class="toc-text">3.2.3 MySink</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-Demo01Message"><span class="toc-number">29.2.4.</span> <span class="toc-text">3.2.4 Demo01Message</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-Demo01Consumer"><span class="toc-number">29.2.5.</span> <span class="toc-text">3.2.5 Demo01Consumer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-6-ConsumerApplication"><span class="toc-number">29.2.6.</span> <span class="toc-text">3.2.6 ConsumerApplication</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E6%B5%8B%E8%AF%95%E5%8D%95%E9%9B%86%E7%BE%A4%E5%A4%9A%E5%AE%9E%E4%BE%8B%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">29.3.</span> <span class="toc-text">3.3 æµ‹è¯•å•é›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E6%B5%8B%E8%AF%95%E5%A4%9A%E9%9B%86%E7%BE%A4%E5%A4%9A%E5%AE%9E%E4%BE%8B%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">29.4.</span> <span class="toc-text">3.4 æµ‹è¯•å¤šé›†ç¾¤å¤šå®ä¾‹çš„åœºæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E5%B0%8F%E7%BB%93"><span class="toc-number">29.5.</span> <span class="toc-text">3.5 å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%AE%9A%E6%97%B6%E6%B6%88%E6%81%AF"><span class="toc-number">30.</span> <span class="toc-text">4. å®šæ—¶æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%B6%88%E8%B4%B9%E9%87%8D%E8%AF%95"><span class="toc-number">31.</span> <span class="toc-text">5. æ¶ˆè´¹é‡è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">31.1.</span> <span class="toc-text">5.1 æ­å»ºç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">31.2.</span> <span class="toc-text">5.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">31.2.1.</span> <span class="toc-text">5.2.1 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-Demo01Consumer"><span class="toc-number">31.2.2.</span> <span class="toc-text">5.2.2 Demo01Consumer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95-1"><span class="toc-number">31.3.</span> <span class="toc-text">5.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%B6%88%E8%B4%B9%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-number">32.</span> <span class="toc-text">6. æ¶ˆè´¹å¼‚å¸¸å¤„ç†æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">32.1.</span> <span class="toc-text">6.1 æ­å»ºç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">32.2.</span> <span class="toc-text">6.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-Demo01Consumer"><span class="toc-number">32.2.1.</span> <span class="toc-text">6.2.1 Demo01Consumer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">32.3.</span> <span class="toc-text">6.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%B9%BF%E6%92%AD%E6%B6%88%E8%B4%B9"><span class="toc-number">33.</span> <span class="toc-text">7. å¹¿æ’­æ¶ˆè´¹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">33.1.</span> <span class="toc-text">7.1 æ­å»ºç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">33.2.</span> <span class="toc-text">7.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">33.2.1.</span> <span class="toc-text">7.2.1 é…ç½®æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">33.3.</span> <span class="toc-text">7.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%B9%B6%E5%8F%91%E6%B6%88%E8%B4%B9"><span class="toc-number">34.</span> <span class="toc-text">8. å¹¶å‘æ¶ˆè´¹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">34.1.</span> <span class="toc-text">8.1 æ­å»ºç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">34.2.</span> <span class="toc-text">8.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">34.2.1.</span> <span class="toc-text">8.2.1 é…ç½®æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">34.3.</span> <span class="toc-text">8.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF"><span class="toc-number">35.</span> <span class="toc-text">9. é¡ºåºæ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">35.1.</span> <span class="toc-text">9.1 æ­å»ºç”Ÿäº§è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">35.1.1.</span> <span class="toc-text">9.1.1 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-2-Demo01Controller"><span class="toc-number">35.1.2.</span> <span class="toc-text">9.1.2 Demo01Controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">35.2.</span> <span class="toc-text">9.2 æ­å»ºæ¶ˆè´¹è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">35.3.</span> <span class="toc-text">9.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E6%B6%88%E6%81%AF%E8%BF%87%E6%BB%A4"><span class="toc-number">36.</span> <span class="toc-text">10. æ¶ˆæ¯è¿‡æ»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">36.1.</span> <span class="toc-text">10.1 æ­å»ºç”Ÿäº§è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-1-Demo01Controller"><span class="toc-number">36.1.1.</span> <span class="toc-text">10.1.1 Demo01Controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">36.2.</span> <span class="toc-text">10.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-Demo01Consumer"><span class="toc-number">36.2.1.</span> <span class="toc-text">10.2.1 Demo01Consumer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">36.3.</span> <span class="toc-text">10.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF-1"><span class="toc-number">37.</span> <span class="toc-text">11. äº‹åŠ¡æ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">37.1.</span> <span class="toc-text">11.1 æ­å»ºç”Ÿäº§è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">37.1.1.</span> <span class="toc-text">11.1.1 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-3-Demo01Controller"><span class="toc-number">37.1.2.</span> <span class="toc-text">11.1.3 Demo01Controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">37.2.</span> <span class="toc-text">11.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">37.2.1.</span> <span class="toc-text">11.2.1 é…ç½®æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">37.3.</span> <span class="toc-text">11.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E6%B6%88%E8%B4%B9%E8%BF%9B%E5%BA%A6%E7%9A%84%E6%8F%90%E4%BA%A4%E6%9C%BA%E5%88%B6-1"><span class="toc-number">38.</span> <span class="toc-text">12. æ¶ˆè´¹è¿›åº¦çš„æäº¤æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">38.1.</span> <span class="toc-text">12.1 æ­å»ºç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">38.2.</span> <span class="toc-text">12.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">38.2.1.</span> <span class="toc-text">12.2.1 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-2-Demo01Consumer"><span class="toc-number">38.2.2.</span> <span class="toc-text">12.2.2 Demo01Consumer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">38.3.</span> <span class="toc-text">12.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-%E6%89%B9%E9%87%8F%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF"><span class="toc-number">39.</span> <span class="toc-text">13. æ‰¹é‡å‘é€æ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">39.1.</span> <span class="toc-text">13.1 æ­å»ºç”Ÿäº§è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">39.1.1.</span> <span class="toc-text">13.1.1 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-2-Demo01Controller"><span class="toc-number">39.1.2.</span> <span class="toc-text">13.1.2 Demo01Controller</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">39.2.</span> <span class="toc-text">13.2 æ­å»ºæ¶ˆè´¹è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">39.3.</span> <span class="toc-text">13.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-%E6%89%B9%E9%87%8F%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF"><span class="toc-number">40.</span> <span class="toc-text">14. æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#14-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">40.1.</span> <span class="toc-text">14.1 æ­å»ºç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">40.2.</span> <span class="toc-text">14.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">40.2.1.</span> <span class="toc-text">14.2.1 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-2-Demo01Consumer"><span class="toc-number">40.2.2.</span> <span class="toc-text">14.2.2 Demo01Consumer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">40.3.</span> <span class="toc-text">14.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-%E7%9B%91%E6%8E%A7%E7%AB%AF%E7%82%B9"><span class="toc-number">41.</span> <span class="toc-text">15. ç›‘æ§ç«¯ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#15-1-%E6%90%AD%E5%BB%BA%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">41.1.</span> <span class="toc-text">15.1 æ­å»ºç”Ÿäº§è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">41.1.1.</span> <span class="toc-text">15.1.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">41.1.2.</span> <span class="toc-text">15.1.2 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">41.1.3.</span> <span class="toc-text">15.1.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-2-%E6%90%AD%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">41.2.</span> <span class="toc-text">15.2 æ­å»ºæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">41.2.1.</span> <span class="toc-text">15.2.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">41.2.2.</span> <span class="toc-text">15.2.2 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">41.2.3.</span> <span class="toc-text">15.2.3 ç®€å•æµ‹è¯•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%93-6"><span class="toc-number">42.</span> <span class="toc-text">â€”â€”â€“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringCloud%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF%E4%B8%AD%E7%9A%84Kafka"><span class="toc-number">43.</span> <span class="toc-text">SpringCloudäº‹ä»¶æ€»çº¿ä¸­çš„Kafka</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E2%80%94%E2%80%94%E2%80%93-7"><span class="toc-number">44.</span> <span class="toc-text">â€”â€”â€“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0-3"><span class="toc-number">45.</span> <span class="toc-text">1. æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">46.</span> <span class="toc-text">2. å¿«é€Ÿå…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E4%BA%8B%E4%BB%B6%E5%8F%91%E5%B8%83%E5%99%A8%E9%A1%B9%E7%9B%AE"><span class="toc-number">46.1.</span> <span class="toc-text">2.1 äº‹ä»¶å‘å¸ƒå™¨é¡¹ç›®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">46.1.1.</span> <span class="toc-text">2.1.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">46.1.2.</span> <span class="toc-text">2.1.2 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-UserRegisterEvent"><span class="toc-number">46.1.3.</span> <span class="toc-text">2.1.3 UserRegisterEvent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-DemoController"><span class="toc-number">46.1.4.</span> <span class="toc-text">2.1.4 DemoController</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5-PublisherDemoApplication"><span class="toc-number">46.1.5.</span> <span class="toc-text">2.1.5 PublisherDemoApplication</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8%E9%A1%B9%E7%9B%AE"><span class="toc-number">46.2.</span> <span class="toc-text">2.2 äº‹ä»¶ç›‘å¬å™¨é¡¹ç›®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">46.2.1.</span> <span class="toc-text">2.2.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">46.2.2.</span> <span class="toc-text">2.2.2 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-UserRegisterEvent"><span class="toc-number">46.2.3.</span> <span class="toc-text">2.2.3 UserRegisterEvent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-UserRegisterListener"><span class="toc-number">46.2.4.</span> <span class="toc-text">2.2.4 UserRegisterListener</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-5-ListenerDemoApplication"><span class="toc-number">46.2.5.</span> <span class="toc-text">2.2.5 ListenerDemoApplication</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">46.3.</span> <span class="toc-text">2.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E7%9B%91%E6%8E%A7%E7%AB%AF%E7%82%B9"><span class="toc-number">47.</span> <span class="toc-text">3. ç›‘æ§ç«¯ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96-1"><span class="toc-number">47.1.</span> <span class="toc-text">3.1 å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">47.2.</span> <span class="toc-text">3.2 é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">47.3.</span> <span class="toc-text">3.3 ç®€å•æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E9%9B%86%E6%88%90%E5%88%B0-Spring-Cloud-Config"><span class="toc-number">48.</span> <span class="toc-text">4. é›†æˆåˆ° Spring Cloud Config</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/3969/" title="Markdownè¯­æ³•å­¦ä¹ "><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F11cda97e6af907b5b2158e1dd78bdd6a.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Markdownè¯­æ³•å­¦ä¹ "/></a><div class="content"><a class="title" href="/posts/3969/" title="Markdownè¯­æ³•å­¦ä¹ ">Markdownè¯­æ³•å­¦ä¹ </a><time datetime="2025-03-06T15:42:14.000Z" title="å‘è¡¨äº 2025-03-06 23:42:14">2025-03-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/47929/" title="typoraå›¾åºŠæ­å»º+å®Œç¾è§£å†³PicGoå›¾ç‰‡ä¸Šä¼ é‡å‘½åé—®é¢˜"><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Ffb9b51a1bdaac4d95266344a1421aedf.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="typoraå›¾åºŠæ­å»º+å®Œç¾è§£å†³PicGoå›¾ç‰‡ä¸Šä¼ é‡å‘½åé—®é¢˜"/></a><div class="content"><a class="title" href="/posts/47929/" title="typoraå›¾åºŠæ­å»º+å®Œç¾è§£å†³PicGoå›¾ç‰‡ä¸Šä¼ é‡å‘½åé—®é¢˜">typoraå›¾åºŠæ­å»º+å®Œç¾è§£å†³PicGoå›¾ç‰‡ä¸Šä¼ é‡å‘½åé—®é¢˜</a><time datetime="2025-03-05T16:58:31.000Z" title="å‘è¡¨äº 2025-03-06 00:58:31">2025-03-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/60895/" title="æµ‹è¯•æ–‡ä»¶2"><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F546d1ae418f905dccc0f7b3674a0f6e0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æµ‹è¯•æ–‡ä»¶2"/></a><div class="content"><a class="title" href="/posts/60895/" title="æµ‹è¯•æ–‡ä»¶2">æµ‹è¯•æ–‡ä»¶2</a><time datetime="2025-03-05T16:00:00.000Z" title="å‘è¡¨äº 2025-03-06 00:00:00">2025-03-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/13423/" title="ç¦»æ•£æ•°å­¦å­¦ä¹ ç¬”è®°"><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F013f3144c6fd4dabceb0ff25ba9a35a4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç¦»æ•£æ•°å­¦å­¦ä¹ ç¬”è®°"/></a><div class="content"><a class="title" href="/posts/13423/" title="ç¦»æ•£æ•°å­¦å­¦ä¹ ç¬”è®°">ç¦»æ•£æ•°å­¦å­¦ä¹ ç¬”è®°</a><time datetime="2025-03-04T16:00:47.000Z" title="å‘è¡¨äº 2025-03-05 00:00:47">2025-03-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/52481/" title="ElasticSearchå…¥é—¨åˆ°ç²¾é€š"><img src="https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2Fe69b8f01e7d0f2581a3d4bfe20e93a23.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ElasticSearchå…¥é—¨åˆ°ç²¾é€š"/></a><div class="content"><a class="title" href="/posts/52481/" title="ElasticSearchå…¥é—¨åˆ°ç²¾é€š">ElasticSearchå…¥é—¨åˆ°ç²¾é€š</a><time datetime="2025-03-04T15:34:24.000Z" title="å‘è¡¨äº 2025-03-04 23:34:24">2025-03-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://typora-1329750222.cos.ap-chengdu.myqcloud.com/img/2025%2F03%2F0325c825fa31fa6f45916f706a22cca4.png);"><div id="footer-wrap"><div class="copyright">&copy;2025 By Chen Jiabin</div><div class="footer_custom_text">æˆ‘çš„å¿ƒæ˜¯ç°‡æ‹¥çƒˆæ—¥çš„èŠ±,åœ¨ä½ çš„çœ¼é‡Œæ‰¾åˆ°äº†å®¶</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.36/fancybox/fancybox.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.2.0/instantpage.min.js" type="module"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.1/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://blog.meng-project.top/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      comment: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://unpkg.com/@waline/client@v3/dist/waline.css')
        .then(() => import('https://unpkg.com/@waline/client@v3/dist/waline.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://lustrous-frangollo-1c41d7.netlify.app/.netlify/functions/twikoo',
      region: 'ap-chengdu',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://lustrous-frangollo-1c41d7.netlify.app/.netlify/functions/twikoo',
      region: 'ap-chengdu',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.pageType === 'post' && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdnjs.cloudflare.com/ajax/libs/twikoo/1.6.41/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Waline' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Waline' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><div class="aplayer no-destroy" data-id="3136952023" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.4/canvas-fluttering-ribbon.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.4/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.4/click-heart.min.js" async="async" mobile="true"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.4/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdnjs.cloudflare.com/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="å¼€å§‹æœç´¢" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>